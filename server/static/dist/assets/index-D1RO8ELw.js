(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();function cx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var zf={exports:{}},ho={};var ib;function lx(){if(ib)return ho;ib=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,r,o){var u=null;if(o!==void 0&&(u=""+o),r.key!==void 0&&(u=""+r.key),"key"in r){o={};for(var l in r)l!=="key"&&(o[l]=r[l])}else o=r;return r=o.ref,{$$typeof:n,type:i,key:u,ref:r!==void 0?r:null,props:o}}return ho.Fragment=e,ho.jsx=t,ho.jsxs=t,ho}var sb;function ux(){return sb||(sb=1,zf.exports=lx()),zf.exports}var y=ux(),Vf={exports:{}},_e={};var ab;function dx(){if(ab)return _e;ab=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),b=Symbol.iterator;function C(I){return I===null||typeof I!="object"?null:(I=b&&I[b]||I["@@iterator"],typeof I=="function"?I:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k=Object.assign,_={};function w(I,Q,oe){this.props=I,this.context=Q,this.refs=_,this.updater=oe||E}w.prototype.isReactComponent={},w.prototype.setState=function(I,Q){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,Q,"setState")},w.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function O(){}O.prototype=w.prototype;function D(I,Q,oe){this.props=I,this.context=Q,this.refs=_,this.updater=oe||E}var x=D.prototype=new O;x.constructor=D,k(x,w.prototype),x.isPureReactComponent=!0;var R=Array.isArray;function M(){}var L={H:null,A:null,T:null,S:null},B=Object.prototype.hasOwnProperty;function V(I,Q,oe){var de=oe.ref;return{$$typeof:n,type:I,key:Q,ref:de!==void 0?de:null,props:oe}}function P(I,Q){return V(I.type,Q,I.props)}function z(I){return typeof I=="object"&&I!==null&&I.$$typeof===n}function W(I){var Q={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(oe){return Q[oe]})}var J=/\/+/g;function he(I,Q){return typeof I=="object"&&I!==null&&I.key!=null?W(""+I.key):Q.toString(36)}function we(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(M,M):(I.status="pending",I.then(function(Q){I.status==="pending"&&(I.status="fulfilled",I.value=Q)},function(Q){I.status==="pending"&&(I.status="rejected",I.reason=Q)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function H(I,Q,oe,de,se){var pe=typeof I;(pe==="undefined"||pe==="boolean")&&(I=null);var ve=!1;if(I===null)ve=!0;else switch(pe){case"bigint":case"string":case"number":ve=!0;break;case"object":switch(I.$$typeof){case n:case e:ve=!0;break;case m:return ve=I._init,H(ve(I._payload),Q,oe,de,se)}}if(ve)return se=se(I),ve=de===""?"."+he(I,0):de,R(se)?(oe="",ve!=null&&(oe=ve.replace(J,"$&/")+"/"),H(se,Q,oe,"",function(wn){return wn})):se!=null&&(z(se)&&(se=P(se,oe+(se.key==null||I&&I.key===se.key?"":(""+se.key).replace(J,"$&/")+"/")+ve)),Q.push(se)),1;ve=0;var Ye=de===""?".":de+":";if(R(I))for(var Ke=0;Ke<I.length;Ke++)de=I[Ke],pe=Ye+he(de,Ke),ve+=H(de,Q,oe,pe,se);else if(Ke=C(I),typeof Ke=="function")for(I=Ke.call(I),Ke=0;!(de=I.next()).done;)de=de.value,pe=Ye+he(de,Ke++),ve+=H(de,Q,oe,pe,se);else if(pe==="object"){if(typeof I.then=="function")return H(we(I),Q,oe,de,se);throw Q=String(I),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return ve}function re(I,Q,oe){if(I==null)return I;var de=[],se=0;return H(I,de,"","",function(pe){return Q.call(oe,pe,se++)}),de}function fe(I){if(I._status===-1){var Q=I._result;Q=Q(),Q.then(function(oe){(I._status===0||I._status===-1)&&(I._status=1,I._result=oe)},function(oe){(I._status===0||I._status===-1)&&(I._status=2,I._result=oe)}),I._status===-1&&(I._status=0,I._result=Q)}if(I._status===1)return I._result.default;throw I._result}var Re=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},Me={map:re,forEach:function(I,Q,oe){re(I,function(){Q.apply(this,arguments)},oe)},count:function(I){var Q=0;return re(I,function(){Q++}),Q},toArray:function(I){return re(I,function(Q){return Q})||[]},only:function(I){if(!z(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};return _e.Activity=g,_e.Children=Me,_e.Component=w,_e.Fragment=t,_e.Profiler=r,_e.PureComponent=D,_e.StrictMode=i,_e.Suspense=f,_e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,_e.__COMPILER_RUNTIME={__proto__:null,c:function(I){return L.H.useMemoCache(I)}},_e.cache=function(I){return function(){return I.apply(null,arguments)}},_e.cacheSignal=function(){return null},_e.cloneElement=function(I,Q,oe){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var de=k({},I.props),se=I.key;if(Q!=null)for(pe in Q.key!==void 0&&(se=""+Q.key),Q)!B.call(Q,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&Q.ref===void 0||(de[pe]=Q[pe]);var pe=arguments.length-2;if(pe===1)de.children=oe;else if(1<pe){for(var ve=Array(pe),Ye=0;Ye<pe;Ye++)ve[Ye]=arguments[Ye+2];de.children=ve}return V(I.type,se,de)},_e.createContext=function(I){return I={$$typeof:u,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:o,_context:I},I},_e.createElement=function(I,Q,oe){var de,se={},pe=null;if(Q!=null)for(de in Q.key!==void 0&&(pe=""+Q.key),Q)B.call(Q,de)&&de!=="key"&&de!=="__self"&&de!=="__source"&&(se[de]=Q[de]);var ve=arguments.length-2;if(ve===1)se.children=oe;else if(1<ve){for(var Ye=Array(ve),Ke=0;Ke<ve;Ke++)Ye[Ke]=arguments[Ke+2];se.children=Ye}if(I&&I.defaultProps)for(de in ve=I.defaultProps,ve)se[de]===void 0&&(se[de]=ve[de]);return V(I,pe,se)},_e.createRef=function(){return{current:null}},_e.forwardRef=function(I){return{$$typeof:l,render:I}},_e.isValidElement=z,_e.lazy=function(I){return{$$typeof:m,_payload:{_status:-1,_result:I},_init:fe}},_e.memo=function(I,Q){return{$$typeof:h,type:I,compare:Q===void 0?null:Q}},_e.startTransition=function(I){var Q=L.T,oe={};L.T=oe;try{var de=I(),se=L.S;se!==null&&se(oe,de),typeof de=="object"&&de!==null&&typeof de.then=="function"&&de.then(M,Re)}catch(pe){Re(pe)}finally{Q!==null&&oe.types!==null&&(Q.types=oe.types),L.T=Q}},_e.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},_e.use=function(I){return L.H.use(I)},_e.useActionState=function(I,Q,oe){return L.H.useActionState(I,Q,oe)},_e.useCallback=function(I,Q){return L.H.useCallback(I,Q)},_e.useContext=function(I){return L.H.useContext(I)},_e.useDebugValue=function(){},_e.useDeferredValue=function(I,Q){return L.H.useDeferredValue(I,Q)},_e.useEffect=function(I,Q){return L.H.useEffect(I,Q)},_e.useEffectEvent=function(I){return L.H.useEffectEvent(I)},_e.useId=function(){return L.H.useId()},_e.useImperativeHandle=function(I,Q,oe){return L.H.useImperativeHandle(I,Q,oe)},_e.useInsertionEffect=function(I,Q){return L.H.useInsertionEffect(I,Q)},_e.useLayoutEffect=function(I,Q){return L.H.useLayoutEffect(I,Q)},_e.useMemo=function(I,Q){return L.H.useMemo(I,Q)},_e.useOptimistic=function(I,Q){return L.H.useOptimistic(I,Q)},_e.useReducer=function(I,Q,oe){return L.H.useReducer(I,Q,oe)},_e.useRef=function(I){return L.H.useRef(I)},_e.useState=function(I){return L.H.useState(I)},_e.useSyncExternalStore=function(I,Q,oe){return L.H.useSyncExternalStore(I,Q,oe)},_e.useTransition=function(){return L.H.useTransition()},_e.version="19.2.4",_e}var rb;function du(){return rb||(rb=1,Vf.exports=dx()),Vf.exports}var T=du();const vl=cx(T);var Ff={exports:{}},mo={},qf={exports:{}},Hf={};var ob;function fx(){return ob||(ob=1,(function(n){function e(H,re){var fe=H.length;H.push(re);e:for(;0<fe;){var Re=fe-1>>>1,Me=H[Re];if(0<r(Me,re))H[Re]=re,H[fe]=Me,fe=Re;else break e}}function t(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var re=H[0],fe=H.pop();if(fe!==re){H[0]=fe;e:for(var Re=0,Me=H.length,I=Me>>>1;Re<I;){var Q=2*(Re+1)-1,oe=H[Q],de=Q+1,se=H[de];if(0>r(oe,fe))de<Me&&0>r(se,oe)?(H[Re]=se,H[de]=fe,Re=de):(H[Re]=oe,H[Q]=fe,Re=Q);else if(de<Me&&0>r(se,fe))H[Re]=se,H[de]=fe,Re=de;else break e}}return re}function r(H,re){var fe=H.sortIndex-re.sortIndex;return fe!==0?fe:H.id-re.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var u=Date,l=u.now();n.unstable_now=function(){return u.now()-l}}var f=[],h=[],m=1,g=null,b=3,C=!1,E=!1,k=!1,_=!1,w=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function x(H){for(var re=t(h);re!==null;){if(re.callback===null)i(h);else if(re.startTime<=H)i(h),re.sortIndex=re.expirationTime,e(f,re);else break;re=t(h)}}function R(H){if(k=!1,x(H),!E)if(t(f)!==null)E=!0,M||(M=!0,W());else{var re=t(h);re!==null&&we(R,re.startTime-H)}}var M=!1,L=-1,B=5,V=-1;function P(){return _?!0:!(n.unstable_now()-V<B)}function z(){if(_=!1,M){var H=n.unstable_now();V=H;var re=!0;try{e:{E=!1,k&&(k=!1,O(L),L=-1),C=!0;var fe=b;try{t:{for(x(H),g=t(f);g!==null&&!(g.expirationTime>H&&P());){var Re=g.callback;if(typeof Re=="function"){g.callback=null,b=g.priorityLevel;var Me=Re(g.expirationTime<=H);if(H=n.unstable_now(),typeof Me=="function"){g.callback=Me,x(H),re=!0;break t}g===t(f)&&i(f),x(H)}else i(f);g=t(f)}if(g!==null)re=!0;else{var I=t(h);I!==null&&we(R,I.startTime-H),re=!1}}break e}finally{g=null,b=fe,C=!1}re=void 0}}finally{re?W():M=!1}}}var W;if(typeof D=="function")W=function(){D(z)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,he=J.port2;J.port1.onmessage=z,W=function(){he.postMessage(null)}}else W=function(){w(z,0)};function we(H,re){L=w(function(){H(n.unstable_now())},re)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return b},n.unstable_next=function(H){switch(b){case 1:case 2:case 3:var re=3;break;default:re=b}var fe=b;b=re;try{return H()}finally{b=fe}},n.unstable_requestPaint=function(){_=!0},n.unstable_runWithPriority=function(H,re){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var fe=b;b=H;try{return re()}finally{b=fe}},n.unstable_scheduleCallback=function(H,re,fe){var Re=n.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?Re+fe:Re):fe=Re,H){case 1:var Me=-1;break;case 2:Me=250;break;case 5:Me=1073741823;break;case 4:Me=1e4;break;default:Me=5e3}return Me=fe+Me,H={id:m++,callback:re,priorityLevel:H,startTime:fe,expirationTime:Me,sortIndex:-1},fe>Re?(H.sortIndex=fe,e(h,H),t(f)===null&&H===t(h)&&(k?(O(L),L=-1):k=!0,we(R,fe-Re))):(H.sortIndex=Me,e(f,H),E||C||(E=!0,M||(M=!0,W()))),H},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(H){var re=b;return function(){var fe=b;b=re;try{return H.apply(this,arguments)}finally{b=fe}}}})(Hf)),Hf}var cb;function hx(){return cb||(cb=1,qf.exports=fx()),qf.exports}var $f={exports:{}},Yt={};var lb;function mx(){if(lb)return Yt;lb=1;var n=du();function e(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function o(f,h,m){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:g==null?null:""+g,children:f,containerInfo:h,implementation:m}}var u=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Yt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Yt.createPortal=function(f,h){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return o(f,h,null,m)},Yt.flushSync=function(f){var h=u.T,m=i.p;try{if(u.T=null,i.p=2,f)return f()}finally{u.T=h,i.p=m,i.d.f()}},Yt.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(f,h))},Yt.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},Yt.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var m=h.as,g=l(m,h.crossOrigin),b=typeof h.integrity=="string"?h.integrity:void 0,C=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;m==="style"?i.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:C}):m==="script"&&i.d.X(f,{crossOrigin:g,integrity:b,fetchPriority:C,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Yt.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var m=l(h.as,h.crossOrigin);i.d.M(f,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(f)},Yt.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var m=h.as,g=l(m,h.crossOrigin);i.d.L(f,m,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Yt.preloadModule=function(f,h){if(typeof f=="string")if(h){var m=l(h.as,h.crossOrigin);i.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(f)},Yt.requestFormReset=function(f){i.d.r(f)},Yt.unstable_batchedUpdates=function(f,h){return f(h)},Yt.useFormState=function(f,h,m){return u.H.useFormState(f,h,m)},Yt.useFormStatus=function(){return u.H.useHostTransitionStatus()},Yt.version="19.2.4",Yt}var ub;function wS(){if(ub)return $f.exports;ub=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),$f.exports=mx(),$f.exports}var db;function px(){if(db)return mo;db=1;var n=hx(),e=du(),t=wS();function i(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function u(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function l(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function f(s){if(o(s)!==s)throw Error(i(188))}function h(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(i(188));return a!==s?null:s}for(var c=s,d=a;;){var p=c.return;if(p===null)break;var v=p.alternate;if(v===null){if(d=p.return,d!==null){c=d;continue}break}if(p.child===v.child){for(v=p.child;v;){if(v===c)return f(p),s;if(v===d)return f(p),a;v=v.sibling}throw Error(i(188))}if(c.return!==d.return)c=p,d=v;else{for(var S=!1,N=p.child;N;){if(N===c){S=!0,c=p,d=v;break}if(N===d){S=!0,d=p,c=v;break}N=N.sibling}if(!S){for(N=v.child;N;){if(N===c){S=!0,c=v,d=p;break}if(N===d){S=!0,d=v,c=p;break}N=N.sibling}if(!S)throw Error(i(189))}}if(c.alternate!==d)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?s:a}function m(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=m(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),D=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),z=Symbol.iterator;function W(s){return s===null||typeof s!="object"?null:(s=z&&s[z]||s["@@iterator"],typeof s=="function"?s:null)}var J=Symbol.for("react.client.reference");function he(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===J?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case k:return"Fragment";case w:return"Profiler";case _:return"StrictMode";case R:return"Suspense";case M:return"SuspenseList";case V:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case E:return"Portal";case D:return s.displayName||"Context";case O:return(s._context.displayName||"Context")+".Consumer";case x:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case L:return a=s.displayName||null,a!==null?a:he(s.type)||"Memo";case B:a=s._payload,s=s._init;try{return he(s(a))}catch{}}return null}var we=Array.isArray,H=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,fe={pending:!1,data:null,method:null,action:null},Re=[],Me=-1;function I(s){return{current:s}}function Q(s){0>Me||(s.current=Re[Me],Re[Me]=null,Me--)}function oe(s,a){Me++,Re[Me]=s.current,s.current=a}var de=I(null),se=I(null),pe=I(null),ve=I(null);function Ye(s,a){switch(oe(pe,a),oe(se,s),oe(de,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Ry(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Ry(a),s=_y(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}Q(de),oe(de,s)}function Ke(){Q(de),Q(se),Q(pe)}function wn(s){s.memoizedState!==null&&oe(ve,s);var a=de.current,c=_y(a,s.type);a!==c&&(oe(se,s),oe(de,c))}function ia(s){se.current===s&&(Q(de),Q(se)),ve.current===s&&(Q(ve),co._currentValue=fe)}var gr,vr;function mi(s){if(gr===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);gr=a&&a[1]||"",vr=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+gr+s+vr}var yr=!1;function br(s,a){if(!s||yr)return"";yr=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(a){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch(Y){var G=Y}Reflect.construct(s,[],ne)}else{try{ne.call()}catch(Y){G=Y}s.call(ne.prototype)}}else{try{throw Error()}catch(Y){G=Y}(ne=s())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch(Y){if(Y&&G&&typeof Y.stack=="string")return[Y.stack,G.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=d.DetermineComponentFrameRoot(),S=v[0],N=v[1];if(S&&N){var j=S.split(`
`),K=N.split(`
`);for(p=d=0;d<j.length&&!j[d].includes("DetermineComponentFrameRoot");)d++;for(;p<K.length&&!K[p].includes("DetermineComponentFrameRoot");)p++;if(d===j.length||p===K.length)for(d=j.length-1,p=K.length-1;1<=d&&0<=p&&j[d]!==K[p];)p--;for(;1<=d&&0<=p;d--,p--)if(j[d]!==K[p]){if(d!==1||p!==1)do if(d--,p--,0>p||j[d]!==K[p]){var Z=`
`+j[d].replace(" at new "," at ");return s.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",s.displayName)),Z}while(1<=d&&0<=p);break}}}finally{yr=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?mi(c):""}function Wo(s,a){switch(s.tag){case 26:case 27:case 5:return mi(s.type);case 16:return mi("Lazy");case 13:return s.child!==a&&a!==null?mi("Suspense Fallback"):mi("Suspense");case 19:return mi("SuspenseList");case 0:case 15:return br(s.type,!1);case 11:return br(s.type.render,!1);case 1:return br(s.type,!0);case 31:return mi("Activity");default:return""}}function le(s){try{var a="",c=null;do a+=Wo(s,c),c=s,s=s.return;while(s);return a}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var Se=Object.prototype.hasOwnProperty,ft=n.unstable_scheduleCallback,Pt=n.unstable_cancelCallback,bt=n.unstable_shouldYield,wt=n.unstable_requestPaint,St=n.unstable_now,Zo=n.unstable_getCurrentPriorityLevel,gn=n.unstable_ImmediatePriority,ap=n.unstable_UserBlockingPriority,ec=n.unstable_NormalPriority,qT=n.unstable_LowPriority,rp=n.unstable_IdlePriority,HT=n.log,$T=n.unstable_setDisableYieldValue,Sr=null,vn=null;function Hi(s){if(typeof HT=="function"&&$T(s),vn&&typeof vn.setStrictMode=="function")try{vn.setStrictMode(Sr,s)}catch{}}var yn=Math.clz32?Math.clz32:YT,KT=Math.log,GT=Math.LN2;function YT(s){return s>>>=0,s===0?32:31-(KT(s)/GT|0)|0}var tc=256,nc=262144,ic=4194304;function Os(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function sc(s,a,c){var d=s.pendingLanes;if(d===0)return 0;var p=0,v=s.suspendedLanes,S=s.pingedLanes;s=s.warmLanes;var N=d&134217727;return N!==0?(d=N&~v,d!==0?p=Os(d):(S&=N,S!==0?p=Os(S):c||(c=N&~s,c!==0&&(p=Os(c))))):(N=d&~v,N!==0?p=Os(N):S!==0?p=Os(S):c||(c=d&~s,c!==0&&(p=Os(c)))),p===0?0:a!==0&&a!==p&&(a&v)===0&&(v=p&-p,c=a&-a,v>=c||v===32&&(c&4194048)!==0)?a:p}function Cr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function JT(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function op(){var s=ic;return ic<<=1,(ic&62914560)===0&&(ic=4194304),s}function _u(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function kr(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function QT(s,a,c,d,p,v){var S=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var N=s.entanglements,j=s.expirationTimes,K=s.hiddenUpdates;for(c=S&~c;0<c;){var Z=31-yn(c),ne=1<<Z;N[Z]=0,j[Z]=-1;var G=K[Z];if(G!==null)for(K[Z]=null,Z=0;Z<G.length;Z++){var Y=G[Z];Y!==null&&(Y.lane&=-536870913)}c&=~ne}d!==0&&cp(s,d,0),v!==0&&p===0&&s.tag!==0&&(s.suspendedLanes|=v&~(S&~a))}function cp(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var d=31-yn(a);s.entangledLanes|=a,s.entanglements[d]=s.entanglements[d]|1073741824|c&261930}function lp(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var d=31-yn(c),p=1<<d;p&a|s[d]&a&&(s[d]|=a),c&=~p}}function up(s,a){var c=a&-a;return c=(c&42)!==0?1:wu(c),(c&(s.suspendedLanes|a))!==0?0:c}function wu(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Mu(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function dp(){var s=re.p;return s!==0?s:(s=window.event,s===void 0?32:Qy(s.type))}function fp(s,a){var c=re.p;try{return re.p=s,a()}finally{re.p=c}}var $i=Math.random().toString(36).slice(2),Vt="__reactFiber$"+$i,rn="__reactProps$"+$i,sa="__reactContainer$"+$i,Nu="__reactEvents$"+$i,XT="__reactListeners$"+$i,WT="__reactHandles$"+$i,hp="__reactResources$"+$i,Tr="__reactMarker$"+$i;function Ou(s){delete s[Vt],delete s[rn],delete s[Nu],delete s[XT],delete s[WT]}function aa(s){var a=s[Vt];if(a)return a;for(var c=s.parentNode;c;){if(a=c[sa]||c[Vt]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=Py(s);s!==null;){if(c=s[Vt])return c;s=Py(s)}return a}s=c,c=s.parentNode}return null}function ra(s){if(s=s[Vt]||s[sa]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function Er(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(i(33))}function oa(s){var a=s[hp];return a||(a=s[hp]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function It(s){s[Tr]=!0}var mp=new Set,pp={};function Ds(s,a){ca(s,a),ca(s+"Capture",a)}function ca(s,a){for(pp[s]=a,s=0;s<a.length;s++)mp.add(a[s])}var ZT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gp={},vp={};function e1(s){return Se.call(vp,s)?!0:Se.call(gp,s)?!1:ZT.test(s)?vp[s]=!0:(gp[s]=!0,!1)}function ac(s,a,c){if(e1(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var d=a.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function rc(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function pi(s,a,c,d){if(d===null)s.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+d)}}function Mn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function yp(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function t1(s,a,c){var d=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var p=d.get,v=d.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return p.call(this)},set:function(S){c=""+S,v.call(this,S)}}),Object.defineProperty(s,a,{enumerable:d.enumerable}),{getValue:function(){return c},setValue:function(S){c=""+S},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function Du(s){if(!s._valueTracker){var a=yp(s)?"checked":"value";s._valueTracker=t1(s,a,""+s[a])}}function bp(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),d="";return s&&(d=yp(s)?s.checked?"true":"false":s.value),s=d,s!==c?(a.setValue(s),!0):!1}function oc(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var n1=/[\n"\\]/g;function Nn(s){return s.replace(n1,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Au(s,a,c,d,p,v,S,N){s.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?s.type=S:s.removeAttribute("type"),a!=null?S==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Mn(a)):s.value!==""+Mn(a)&&(s.value=""+Mn(a)):S!=="submit"&&S!=="reset"||s.removeAttribute("value"),a!=null?Pu(s,S,Mn(a)):c!=null?Pu(s,S,Mn(c)):d!=null&&s.removeAttribute("value"),p==null&&v!=null&&(s.defaultChecked=!!v),p!=null&&(s.checked=p&&typeof p!="function"&&typeof p!="symbol"),N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?s.name=""+Mn(N):s.removeAttribute("name")}function Sp(s,a,c,d,p,v,S,N){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(s.type=v),a!=null||c!=null){if(!(v!=="submit"&&v!=="reset"||a!=null)){Du(s);return}c=c!=null?""+Mn(c):"",a=a!=null?""+Mn(a):c,N||a===s.value||(s.value=a),s.defaultValue=a}d=d??p,d=typeof d!="function"&&typeof d!="symbol"&&!!d,s.checked=N?s.checked:!!d,s.defaultChecked=!!d,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(s.name=S),Du(s)}function Pu(s,a,c){a==="number"&&oc(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function la(s,a,c,d){if(s=s.options,a){a={};for(var p=0;p<c.length;p++)a["$"+c[p]]=!0;for(c=0;c<s.length;c++)p=a.hasOwnProperty("$"+s[c].value),s[c].selected!==p&&(s[c].selected=p),p&&d&&(s[c].defaultSelected=!0)}else{for(c=""+Mn(c),a=null,p=0;p<s.length;p++){if(s[p].value===c){s[p].selected=!0,d&&(s[p].defaultSelected=!0);return}a!==null||s[p].disabled||(a=s[p])}a!==null&&(a.selected=!0)}}function Cp(s,a,c){if(a!=null&&(a=""+Mn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Mn(c):""}function kp(s,a,c,d){if(a==null){if(d!=null){if(c!=null)throw Error(i(92));if(we(d)){if(1<d.length)throw Error(i(93));d=d[0]}c=d}c==null&&(c=""),a=c}c=Mn(a),s.defaultValue=c,d=s.textContent,d===c&&d!==""&&d!==null&&(s.value=d),Du(s)}function ua(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var i1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tp(s,a,c){var d=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":d?s.setProperty(a,c):typeof c!="number"||c===0||i1.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Ep(s,a,c){if(a!=null&&typeof a!="object")throw Error(i(62));if(s=s.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||a!=null&&a.hasOwnProperty(d)||(d.indexOf("--")===0?s.setProperty(d,""):d==="float"?s.cssFloat="":s[d]="");for(var p in a)d=a[p],a.hasOwnProperty(p)&&c[p]!==d&&Tp(s,p,d)}else for(var v in a)a.hasOwnProperty(v)&&Tp(s,v,a[v])}function Lu(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var s1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),a1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function cc(s){return a1.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function gi(){}var ju=null;function Iu(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var da=null,fa=null;function xp(s){var a=ra(s);if(a&&(s=a.stateNode)){var c=s[rn]||null;e:switch(s=a.stateNode,a.type){case"input":if(Au(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Nn(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var d=c[a];if(d!==s&&d.form===s.form){var p=d[rn]||null;if(!p)throw Error(i(90));Au(d,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(a=0;a<c.length;a++)d=c[a],d.form===s.form&&bp(d)}break e;case"textarea":Cp(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&la(s,!!c.multiple,a,!1)}}}var Uu=!1;function Rp(s,a,c){if(Uu)return s(a,c);Uu=!0;try{var d=s(a);return d}finally{if(Uu=!1,(da!==null||fa!==null)&&(Jc(),da&&(a=da,s=fa,fa=da=null,xp(a),s)))for(a=0;a<s.length;a++)xp(s[a])}}function xr(s,a){var c=s.stateNode;if(c===null)return null;var d=c[rn]||null;if(d===null)return null;c=d[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(s=s.type,d=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!d;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(i(231,a,typeof c));return c}var vi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bu=!1;if(vi)try{var Rr={};Object.defineProperty(Rr,"passive",{get:function(){Bu=!0}}),window.addEventListener("test",Rr,Rr),window.removeEventListener("test",Rr,Rr)}catch{Bu=!1}var Ki=null,zu=null,lc=null;function _p(){if(lc)return lc;var s,a=zu,c=a.length,d,p="value"in Ki?Ki.value:Ki.textContent,v=p.length;for(s=0;s<c&&a[s]===p[s];s++);var S=c-s;for(d=1;d<=S&&a[c-d]===p[v-d];d++);return lc=p.slice(s,1<d?1-d:void 0)}function uc(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function dc(){return!0}function wp(){return!1}function on(s){function a(c,d,p,v,S){this._reactName=c,this._targetInst=p,this.type=d,this.nativeEvent=v,this.target=S,this.currentTarget=null;for(var N in s)s.hasOwnProperty(N)&&(c=s[N],this[N]=c?c(v):v[N]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?dc:wp,this.isPropagationStopped=wp,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=dc)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=dc)},persist:function(){},isPersistent:dc}),a}var As={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fc=on(As),_r=g({},As,{view:0,detail:0}),r1=on(_r),Vu,Fu,wr,hc=g({},_r,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==wr&&(wr&&s.type==="mousemove"?(Vu=s.screenX-wr.screenX,Fu=s.screenY-wr.screenY):Fu=Vu=0,wr=s),Vu)},movementY:function(s){return"movementY"in s?s.movementY:Fu}}),Mp=on(hc),o1=g({},hc,{dataTransfer:0}),c1=on(o1),l1=g({},_r,{relatedTarget:0}),qu=on(l1),u1=g({},As,{animationName:0,elapsedTime:0,pseudoElement:0}),d1=on(u1),f1=g({},As,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),h1=on(f1),m1=g({},As,{data:0}),Np=on(m1),p1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},g1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},v1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function y1(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=v1[s])?!!a[s]:!1}function Hu(){return y1}var b1=g({},_r,{key:function(s){if(s.key){var a=p1[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=uc(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?g1[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hu,charCode:function(s){return s.type==="keypress"?uc(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?uc(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),S1=on(b1),C1=g({},hc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Op=on(C1),k1=g({},_r,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hu}),T1=on(k1),E1=g({},As,{propertyName:0,elapsedTime:0,pseudoElement:0}),x1=on(E1),R1=g({},hc,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),_1=on(R1),w1=g({},As,{newState:0,oldState:0}),M1=on(w1),N1=[9,13,27,32],$u=vi&&"CompositionEvent"in window,Mr=null;vi&&"documentMode"in document&&(Mr=document.documentMode);var O1=vi&&"TextEvent"in window&&!Mr,Dp=vi&&(!$u||Mr&&8<Mr&&11>=Mr),Ap=" ",Pp=!1;function Lp(s,a){switch(s){case"keyup":return N1.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jp(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var ha=!1;function D1(s,a){switch(s){case"compositionend":return jp(a);case"keypress":return a.which!==32?null:(Pp=!0,Ap);case"textInput":return s=a.data,s===Ap&&Pp?null:s;default:return null}}function A1(s,a){if(ha)return s==="compositionend"||!$u&&Lp(s,a)?(s=_p(),lc=zu=Ki=null,ha=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Dp&&a.locale!=="ko"?null:a.data;default:return null}}var P1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ip(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!P1[s.type]:a==="textarea"}function Up(s,a,c,d){da?fa?fa.push(d):fa=[d]:da=d,a=nl(a,"onChange"),0<a.length&&(c=new fc("onChange","change",null,c,d),s.push({event:c,listeners:a}))}var Nr=null,Or=null;function L1(s){Sy(s,0)}function mc(s){var a=Er(s);if(bp(a))return s}function Bp(s,a){if(s==="change")return a}var zp=!1;if(vi){var Ku;if(vi){var Gu="oninput"in document;if(!Gu){var Vp=document.createElement("div");Vp.setAttribute("oninput","return;"),Gu=typeof Vp.oninput=="function"}Ku=Gu}else Ku=!1;zp=Ku&&(!document.documentMode||9<document.documentMode)}function Fp(){Nr&&(Nr.detachEvent("onpropertychange",qp),Or=Nr=null)}function qp(s){if(s.propertyName==="value"&&mc(Or)){var a=[];Up(a,Or,s,Iu(s)),Rp(L1,a)}}function j1(s,a,c){s==="focusin"?(Fp(),Nr=a,Or=c,Nr.attachEvent("onpropertychange",qp)):s==="focusout"&&Fp()}function I1(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return mc(Or)}function U1(s,a){if(s==="click")return mc(a)}function B1(s,a){if(s==="input"||s==="change")return mc(a)}function z1(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var bn=typeof Object.is=="function"?Object.is:z1;function Dr(s,a){if(bn(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),d=Object.keys(a);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var p=c[d];if(!Se.call(a,p)||!bn(s[p],a[p]))return!1}return!0}function Hp(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function $p(s,a){var c=Hp(s);s=0;for(var d;c;){if(c.nodeType===3){if(d=s+c.textContent.length,s<=a&&d>=a)return{node:c,offset:a-s};s=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Hp(c)}}function Kp(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?Kp(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function Gp(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=oc(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=oc(s.document)}return a}function Yu(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var V1=vi&&"documentMode"in document&&11>=document.documentMode,ma=null,Ju=null,Ar=null,Qu=!1;function Yp(s,a,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Qu||ma==null||ma!==oc(d)||(d=ma,"selectionStart"in d&&Yu(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Ar&&Dr(Ar,d)||(Ar=d,d=nl(Ju,"onSelect"),0<d.length&&(a=new fc("onSelect","select",null,a,c),s.push({event:a,listeners:d}),a.target=ma)))}function Ps(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var pa={animationend:Ps("Animation","AnimationEnd"),animationiteration:Ps("Animation","AnimationIteration"),animationstart:Ps("Animation","AnimationStart"),transitionrun:Ps("Transition","TransitionRun"),transitionstart:Ps("Transition","TransitionStart"),transitioncancel:Ps("Transition","TransitionCancel"),transitionend:Ps("Transition","TransitionEnd")},Xu={},Jp={};vi&&(Jp=document.createElement("div").style,"AnimationEvent"in window||(delete pa.animationend.animation,delete pa.animationiteration.animation,delete pa.animationstart.animation),"TransitionEvent"in window||delete pa.transitionend.transition);function Ls(s){if(Xu[s])return Xu[s];if(!pa[s])return s;var a=pa[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in Jp)return Xu[s]=a[c];return s}var Qp=Ls("animationend"),Xp=Ls("animationiteration"),Wp=Ls("animationstart"),F1=Ls("transitionrun"),q1=Ls("transitionstart"),H1=Ls("transitioncancel"),Zp=Ls("transitionend"),eg=new Map,Wu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Wu.push("scrollEnd");function qn(s,a){eg.set(s,a),Ds(a,[s])}var pc=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},On=[],ga=0,Zu=0;function gc(){for(var s=ga,a=Zu=ga=0;a<s;){var c=On[a];On[a++]=null;var d=On[a];On[a++]=null;var p=On[a];On[a++]=null;var v=On[a];if(On[a++]=null,d!==null&&p!==null){var S=d.pending;S===null?p.next=p:(p.next=S.next,S.next=p),d.pending=p}v!==0&&tg(c,p,v)}}function vc(s,a,c,d){On[ga++]=s,On[ga++]=a,On[ga++]=c,On[ga++]=d,Zu|=d,s.lanes|=d,s=s.alternate,s!==null&&(s.lanes|=d)}function ed(s,a,c,d){return vc(s,a,c,d),yc(s)}function js(s,a){return vc(s,null,null,a),yc(s)}function tg(s,a,c){s.lanes|=c;var d=s.alternate;d!==null&&(d.lanes|=c);for(var p=!1,v=s.return;v!==null;)v.childLanes|=c,d=v.alternate,d!==null&&(d.childLanes|=c),v.tag===22&&(s=v.stateNode,s===null||s._visibility&1||(p=!0)),s=v,v=v.return;return s.tag===3?(v=s.stateNode,p&&a!==null&&(p=31-yn(c),s=v.hiddenUpdates,d=s[p],d===null?s[p]=[a]:d.push(a),a.lane=c|536870912),v):null}function yc(s){if(50<to)throw to=0,uf=null,Error(i(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var va={};function $1(s,a,c,d){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(s,a,c,d){return new $1(s,a,c,d)}function td(s){return s=s.prototype,!(!s||!s.isReactComponent)}function yi(s,a){var c=s.alternate;return c===null?(c=Sn(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function ng(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function bc(s,a,c,d,p,v){var S=0;if(d=s,typeof s=="function")td(s)&&(S=1);else if(typeof s=="string")S=QE(s,c,de.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case V:return s=Sn(31,c,a,p),s.elementType=V,s.lanes=v,s;case k:return Is(c.children,p,v,a);case _:S=8,p|=24;break;case w:return s=Sn(12,c,a,p|2),s.elementType=w,s.lanes=v,s;case R:return s=Sn(13,c,a,p),s.elementType=R,s.lanes=v,s;case M:return s=Sn(19,c,a,p),s.elementType=M,s.lanes=v,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case D:S=10;break e;case O:S=9;break e;case x:S=11;break e;case L:S=14;break e;case B:S=16,d=null;break e}S=29,c=Error(i(130,s===null?"null":typeof s,"")),d=null}return a=Sn(S,c,a,p),a.elementType=s,a.type=d,a.lanes=v,a}function Is(s,a,c,d){return s=Sn(7,s,d,a),s.lanes=c,s}function nd(s,a,c){return s=Sn(6,s,null,a),s.lanes=c,s}function ig(s){var a=Sn(18,null,null,0);return a.stateNode=s,a}function id(s,a,c){return a=Sn(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var sg=new WeakMap;function Dn(s,a){if(typeof s=="object"&&s!==null){var c=sg.get(s);return c!==void 0?c:(a={value:s,source:a,stack:le(a)},sg.set(s,a),a)}return{value:s,source:a,stack:le(a)}}var ya=[],ba=0,Sc=null,Pr=0,An=[],Pn=0,Gi=null,ti=1,ni="";function bi(s,a){ya[ba++]=Pr,ya[ba++]=Sc,Sc=s,Pr=a}function ag(s,a,c){An[Pn++]=ti,An[Pn++]=ni,An[Pn++]=Gi,Gi=s;var d=ti;s=ni;var p=32-yn(d)-1;d&=~(1<<p),c+=1;var v=32-yn(a)+p;if(30<v){var S=p-p%5;v=(d&(1<<S)-1).toString(32),d>>=S,p-=S,ti=1<<32-yn(a)+p|c<<p|d,ni=v+s}else ti=1<<v|c<<p|d,ni=s}function sd(s){s.return!==null&&(bi(s,1),ag(s,1,0))}function ad(s){for(;s===Sc;)Sc=ya[--ba],ya[ba]=null,Pr=ya[--ba],ya[ba]=null;for(;s===Gi;)Gi=An[--Pn],An[Pn]=null,ni=An[--Pn],An[Pn]=null,ti=An[--Pn],An[Pn]=null}function rg(s,a){An[Pn++]=ti,An[Pn++]=ni,An[Pn++]=Gi,ti=a.id,ni=a.overflow,Gi=s}var Ft=null,rt=null,Fe=!1,Yi=null,Ln=!1,rd=Error(i(519));function Ji(s){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Lr(Dn(a,s)),rd}function og(s){var a=s.stateNode,c=s.type,d=s.memoizedProps;switch(a[Vt]=s,a[rn]=d,c){case"dialog":je("cancel",a),je("close",a);break;case"iframe":case"object":case"embed":je("load",a);break;case"video":case"audio":for(c=0;c<io.length;c++)je(io[c],a);break;case"source":je("error",a);break;case"img":case"image":case"link":je("error",a),je("load",a);break;case"details":je("toggle",a);break;case"input":je("invalid",a),Sp(a,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":je("invalid",a);break;case"textarea":je("invalid",a),kp(a,d.value,d.defaultValue,d.children)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||d.suppressHydrationWarning===!0||Ey(a.textContent,c)?(d.popover!=null&&(je("beforetoggle",a),je("toggle",a)),d.onScroll!=null&&je("scroll",a),d.onScrollEnd!=null&&je("scrollend",a),d.onClick!=null&&(a.onclick=gi),a=!0):a=!1,a||Ji(s,!0)}function cg(s){for(Ft=s.return;Ft;)switch(Ft.tag){case 5:case 31:case 13:Ln=!1;return;case 27:case 3:Ln=!0;return;default:Ft=Ft.return}}function Sa(s){if(s!==Ft)return!1;if(!Fe)return cg(s),Fe=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||xf(s.type,s.memoizedProps)),c=!c),c&&rt&&Ji(s),cg(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));rt=Ay(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));rt=Ay(s)}else a===27?(a=rt,ls(s.type)?(s=Nf,Nf=null,rt=s):rt=a):rt=Ft?In(s.stateNode.nextSibling):null;return!0}function Us(){rt=Ft=null,Fe=!1}function od(){var s=Yi;return s!==null&&(dn===null?dn=s:dn.push.apply(dn,s),Yi=null),s}function Lr(s){Yi===null?Yi=[s]:Yi.push(s)}var cd=I(null),Bs=null,Si=null;function Qi(s,a,c){oe(cd,a._currentValue),a._currentValue=c}function Ci(s){s._currentValue=cd.current,Q(cd)}function ld(s,a,c){for(;s!==null;){var d=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),s===c)break;s=s.return}}function ud(s,a,c,d){var p=s.child;for(p!==null&&(p.return=s);p!==null;){var v=p.dependencies;if(v!==null){var S=p.child;v=v.firstContext;e:for(;v!==null;){var N=v;v=p;for(var j=0;j<a.length;j++)if(N.context===a[j]){v.lanes|=c,N=v.alternate,N!==null&&(N.lanes|=c),ld(v.return,c,s),d||(S=null);break e}v=N.next}}else if(p.tag===18){if(S=p.return,S===null)throw Error(i(341));S.lanes|=c,v=S.alternate,v!==null&&(v.lanes|=c),ld(S,c,s),S=null}else S=p.child;if(S!==null)S.return=p;else for(S=p;S!==null;){if(S===s){S=null;break}if(p=S.sibling,p!==null){p.return=S.return,S=p;break}S=S.return}p=S}}function Ca(s,a,c,d){s=null;for(var p=a,v=!1;p!==null;){if(!v){if((p.flags&524288)!==0)v=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var S=p.alternate;if(S===null)throw Error(i(387));if(S=S.memoizedProps,S!==null){var N=p.type;bn(p.pendingProps.value,S.value)||(s!==null?s.push(N):s=[N])}}else if(p===ve.current){if(S=p.alternate,S===null)throw Error(i(387));S.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(s!==null?s.push(co):s=[co])}p=p.return}s!==null&&ud(a,s,c,d),a.flags|=262144}function Cc(s){for(s=s.firstContext;s!==null;){if(!bn(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function zs(s){Bs=s,Si=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function qt(s){return lg(Bs,s)}function kc(s,a){return Bs===null&&zs(s),lg(s,a)}function lg(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Si===null){if(s===null)throw Error(i(308));Si=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else Si=Si.next=a;return c}var K1=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,d){s.push(d)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},G1=n.unstable_scheduleCallback,Y1=n.unstable_NormalPriority,Mt={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function dd(){return{controller:new K1,data:new Map,refCount:0}}function jr(s){s.refCount--,s.refCount===0&&G1(Y1,function(){s.controller.abort()})}var Ir=null,fd=0,ka=0,Ta=null;function J1(s,a){if(Ir===null){var c=Ir=[];fd=0,ka=gf(),Ta={status:"pending",value:void 0,then:function(d){c.push(d)}}}return fd++,a.then(ug,ug),a}function ug(){if(--fd===0&&Ir!==null){Ta!==null&&(Ta.status="fulfilled");var s=Ir;Ir=null,ka=0,Ta=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function Q1(s,a){var c=[],d={status:"pending",value:null,reason:null,then:function(p){c.push(p)}};return s.then(function(){d.status="fulfilled",d.value=a;for(var p=0;p<c.length;p++)(0,c[p])(a)},function(p){for(d.status="rejected",d.reason=p,p=0;p<c.length;p++)(0,c[p])(void 0)}),d}var dg=H.S;H.S=function(s,a){Yv=St(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&J1(s,a),dg!==null&&dg(s,a)};var Vs=I(null);function hd(){var s=Vs.current;return s!==null?s:nt.pooledCache}function Tc(s,a){a===null?oe(Vs,Vs.current):oe(Vs,a.pool)}function fg(){var s=hd();return s===null?null:{parent:Mt._currentValue,pool:s}}var Ea=Error(i(460)),md=Error(i(474)),Ec=Error(i(542)),xc={then:function(){}};function hg(s){return s=s.status,s==="fulfilled"||s==="rejected"}function mg(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(gi,gi),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,gg(s),s;default:if(typeof a.status=="string")a.then(gi,gi);else{if(s=nt,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=a,s.status="pending",s.then(function(d){if(a.status==="pending"){var p=a;p.status="fulfilled",p.value=d}},function(d){if(a.status==="pending"){var p=a;p.status="rejected",p.reason=d}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,gg(s),s}throw qs=a,Ea}}function Fs(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(qs=c,Ea):c}}var qs=null;function pg(){if(qs===null)throw Error(i(459));var s=qs;return qs=null,s}function gg(s){if(s===Ea||s===Ec)throw Error(i(483))}var xa=null,Ur=0;function Rc(s){var a=Ur;return Ur+=1,xa===null&&(xa=[]),mg(xa,s,a)}function Br(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function _c(s,a){throw a.$$typeof===b?Error(i(525)):(s=Object.prototype.toString.call(a),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function vg(s){function a(F,U){if(s){var $=F.deletions;$===null?(F.deletions=[U],F.flags|=16):$.push(U)}}function c(F,U){if(!s)return null;for(;U!==null;)a(F,U),U=U.sibling;return null}function d(F){for(var U=new Map;F!==null;)F.key!==null?U.set(F.key,F):U.set(F.index,F),F=F.sibling;return U}function p(F,U){return F=yi(F,U),F.index=0,F.sibling=null,F}function v(F,U,$){return F.index=$,s?($=F.alternate,$!==null?($=$.index,$<U?(F.flags|=67108866,U):$):(F.flags|=67108866,U)):(F.flags|=1048576,U)}function S(F){return s&&F.alternate===null&&(F.flags|=67108866),F}function N(F,U,$,te){return U===null||U.tag!==6?(U=nd($,F.mode,te),U.return=F,U):(U=p(U,$),U.return=F,U)}function j(F,U,$,te){var ye=$.type;return ye===k?Z(F,U,$.props.children,te,$.key):U!==null&&(U.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===B&&Fs(ye)===U.type)?(U=p(U,$.props),Br(U,$),U.return=F,U):(U=bc($.type,$.key,$.props,null,F.mode,te),Br(U,$),U.return=F,U)}function K(F,U,$,te){return U===null||U.tag!==4||U.stateNode.containerInfo!==$.containerInfo||U.stateNode.implementation!==$.implementation?(U=id($,F.mode,te),U.return=F,U):(U=p(U,$.children||[]),U.return=F,U)}function Z(F,U,$,te,ye){return U===null||U.tag!==7?(U=Is($,F.mode,te,ye),U.return=F,U):(U=p(U,$),U.return=F,U)}function ne(F,U,$){if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return U=nd(""+U,F.mode,$),U.return=F,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case C:return $=bc(U.type,U.key,U.props,null,F.mode,$),Br($,U),$.return=F,$;case E:return U=id(U,F.mode,$),U.return=F,U;case B:return U=Fs(U),ne(F,U,$)}if(we(U)||W(U))return U=Is(U,F.mode,$,null),U.return=F,U;if(typeof U.then=="function")return ne(F,Rc(U),$);if(U.$$typeof===D)return ne(F,kc(F,U),$);_c(F,U)}return null}function G(F,U,$,te){var ye=U!==null?U.key:null;if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return ye!==null?null:N(F,U,""+$,te);if(typeof $=="object"&&$!==null){switch($.$$typeof){case C:return $.key===ye?j(F,U,$,te):null;case E:return $.key===ye?K(F,U,$,te):null;case B:return $=Fs($),G(F,U,$,te)}if(we($)||W($))return ye!==null?null:Z(F,U,$,te,null);if(typeof $.then=="function")return G(F,U,Rc($),te);if($.$$typeof===D)return G(F,U,kc(F,$),te);_c(F,$)}return null}function Y(F,U,$,te,ye){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return F=F.get($)||null,N(U,F,""+te,ye);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case C:return F=F.get(te.key===null?$:te.key)||null,j(U,F,te,ye);case E:return F=F.get(te.key===null?$:te.key)||null,K(U,F,te,ye);case B:return te=Fs(te),Y(F,U,$,te,ye)}if(we(te)||W(te))return F=F.get($)||null,Z(U,F,te,ye,null);if(typeof te.then=="function")return Y(F,U,$,Rc(te),ye);if(te.$$typeof===D)return Y(F,U,$,kc(U,te),ye);_c(U,te)}return null}function me(F,U,$,te){for(var ye=null,He=null,ge=U,Oe=U=0,ze=null;ge!==null&&Oe<$.length;Oe++){ge.index>Oe?(ze=ge,ge=null):ze=ge.sibling;var $e=G(F,ge,$[Oe],te);if($e===null){ge===null&&(ge=ze);break}s&&ge&&$e.alternate===null&&a(F,ge),U=v($e,U,Oe),He===null?ye=$e:He.sibling=$e,He=$e,ge=ze}if(Oe===$.length)return c(F,ge),Fe&&bi(F,Oe),ye;if(ge===null){for(;Oe<$.length;Oe++)ge=ne(F,$[Oe],te),ge!==null&&(U=v(ge,U,Oe),He===null?ye=ge:He.sibling=ge,He=ge);return Fe&&bi(F,Oe),ye}for(ge=d(ge);Oe<$.length;Oe++)ze=Y(ge,F,Oe,$[Oe],te),ze!==null&&(s&&ze.alternate!==null&&ge.delete(ze.key===null?Oe:ze.key),U=v(ze,U,Oe),He===null?ye=ze:He.sibling=ze,He=ze);return s&&ge.forEach(function(ms){return a(F,ms)}),Fe&&bi(F,Oe),ye}function Ce(F,U,$,te){if($==null)throw Error(i(151));for(var ye=null,He=null,ge=U,Oe=U=0,ze=null,$e=$.next();ge!==null&&!$e.done;Oe++,$e=$.next()){ge.index>Oe?(ze=ge,ge=null):ze=ge.sibling;var ms=G(F,ge,$e.value,te);if(ms===null){ge===null&&(ge=ze);break}s&&ge&&ms.alternate===null&&a(F,ge),U=v(ms,U,Oe),He===null?ye=ms:He.sibling=ms,He=ms,ge=ze}if($e.done)return c(F,ge),Fe&&bi(F,Oe),ye;if(ge===null){for(;!$e.done;Oe++,$e=$.next())$e=ne(F,$e.value,te),$e!==null&&(U=v($e,U,Oe),He===null?ye=$e:He.sibling=$e,He=$e);return Fe&&bi(F,Oe),ye}for(ge=d(ge);!$e.done;Oe++,$e=$.next())$e=Y(ge,F,Oe,$e.value,te),$e!==null&&(s&&$e.alternate!==null&&ge.delete($e.key===null?Oe:$e.key),U=v($e,U,Oe),He===null?ye=$e:He.sibling=$e,He=$e);return s&&ge.forEach(function(ox){return a(F,ox)}),Fe&&bi(F,Oe),ye}function et(F,U,$,te){if(typeof $=="object"&&$!==null&&$.type===k&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case C:e:{for(var ye=$.key;U!==null;){if(U.key===ye){if(ye=$.type,ye===k){if(U.tag===7){c(F,U.sibling),te=p(U,$.props.children),te.return=F,F=te;break e}}else if(U.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===B&&Fs(ye)===U.type){c(F,U.sibling),te=p(U,$.props),Br(te,$),te.return=F,F=te;break e}c(F,U);break}else a(F,U);U=U.sibling}$.type===k?(te=Is($.props.children,F.mode,te,$.key),te.return=F,F=te):(te=bc($.type,$.key,$.props,null,F.mode,te),Br(te,$),te.return=F,F=te)}return S(F);case E:e:{for(ye=$.key;U!==null;){if(U.key===ye)if(U.tag===4&&U.stateNode.containerInfo===$.containerInfo&&U.stateNode.implementation===$.implementation){c(F,U.sibling),te=p(U,$.children||[]),te.return=F,F=te;break e}else{c(F,U);break}else a(F,U);U=U.sibling}te=id($,F.mode,te),te.return=F,F=te}return S(F);case B:return $=Fs($),et(F,U,$,te)}if(we($))return me(F,U,$,te);if(W($)){if(ye=W($),typeof ye!="function")throw Error(i(150));return $=ye.call($),Ce(F,U,$,te)}if(typeof $.then=="function")return et(F,U,Rc($),te);if($.$$typeof===D)return et(F,U,kc(F,$),te);_c(F,$)}return typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint"?($=""+$,U!==null&&U.tag===6?(c(F,U.sibling),te=p(U,$),te.return=F,F=te):(c(F,U),te=nd($,F.mode,te),te.return=F,F=te),S(F)):c(F,U)}return function(F,U,$,te){try{Ur=0;var ye=et(F,U,$,te);return xa=null,ye}catch(ge){if(ge===Ea||ge===Ec)throw ge;var He=Sn(29,ge,null,F.mode);return He.lanes=te,He.return=F,He}}}var Hs=vg(!0),yg=vg(!1),Xi=!1;function pd(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gd(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Wi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Zi(s,a,c){var d=s.updateQueue;if(d===null)return null;if(d=d.shared,(Ge&2)!==0){var p=d.pending;return p===null?a.next=a:(a.next=p.next,p.next=a),d.pending=a,a=yc(s),tg(s,null,c),a}return vc(s,d,a,c),yc(s)}function zr(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var d=a.lanes;d&=s.pendingLanes,c|=d,a.lanes=c,lp(s,c)}}function vd(s,a){var c=s.updateQueue,d=s.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var p=null,v=null;if(c=c.firstBaseUpdate,c!==null){do{var S={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};v===null?p=v=S:v=v.next=S,c=c.next}while(c!==null);v===null?p=v=a:v=v.next=a}else p=v=a;c={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:v,shared:d.shared,callbacks:d.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var yd=!1;function Vr(){if(yd){var s=Ta;if(s!==null)throw s}}function Fr(s,a,c,d){yd=!1;var p=s.updateQueue;Xi=!1;var v=p.firstBaseUpdate,S=p.lastBaseUpdate,N=p.shared.pending;if(N!==null){p.shared.pending=null;var j=N,K=j.next;j.next=null,S===null?v=K:S.next=K,S=j;var Z=s.alternate;Z!==null&&(Z=Z.updateQueue,N=Z.lastBaseUpdate,N!==S&&(N===null?Z.firstBaseUpdate=K:N.next=K,Z.lastBaseUpdate=j))}if(v!==null){var ne=p.baseState;S=0,Z=K=j=null,N=v;do{var G=N.lane&-536870913,Y=G!==N.lane;if(Y?(Be&G)===G:(d&G)===G){G!==0&&G===ka&&(yd=!0),Z!==null&&(Z=Z.next={lane:0,tag:N.tag,payload:N.payload,callback:null,next:null});e:{var me=s,Ce=N;G=a;var et=c;switch(Ce.tag){case 1:if(me=Ce.payload,typeof me=="function"){ne=me.call(et,ne,G);break e}ne=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=Ce.payload,G=typeof me=="function"?me.call(et,ne,G):me,G==null)break e;ne=g({},ne,G);break e;case 2:Xi=!0}}G=N.callback,G!==null&&(s.flags|=64,Y&&(s.flags|=8192),Y=p.callbacks,Y===null?p.callbacks=[G]:Y.push(G))}else Y={lane:G,tag:N.tag,payload:N.payload,callback:N.callback,next:null},Z===null?(K=Z=Y,j=ne):Z=Z.next=Y,S|=G;if(N=N.next,N===null){if(N=p.shared.pending,N===null)break;Y=N,N=Y.next,Y.next=null,p.lastBaseUpdate=Y,p.shared.pending=null}}while(!0);Z===null&&(j=ne),p.baseState=j,p.firstBaseUpdate=K,p.lastBaseUpdate=Z,v===null&&(p.shared.lanes=0),ss|=S,s.lanes=S,s.memoizedState=ne}}function bg(s,a){if(typeof s!="function")throw Error(i(191,s));s.call(a)}function Sg(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)bg(c[s],a)}var Ra=I(null),wc=I(0);function Cg(s,a){s=Ni,oe(wc,s),oe(Ra,a),Ni=s|a.baseLanes}function bd(){oe(wc,Ni),oe(Ra,Ra.current)}function Sd(){Ni=wc.current,Q(Ra),Q(wc)}var Cn=I(null),jn=null;function es(s){var a=s.alternate;oe(Ct,Ct.current&1),oe(Cn,s),jn===null&&(a===null||Ra.current!==null||a.memoizedState!==null)&&(jn=s)}function Cd(s){oe(Ct,Ct.current),oe(Cn,s),jn===null&&(jn=s)}function kg(s){s.tag===22?(oe(Ct,Ct.current),oe(Cn,s),jn===null&&(jn=s)):ts()}function ts(){oe(Ct,Ct.current),oe(Cn,Cn.current)}function kn(s){Q(Cn),jn===s&&(jn=null),Q(Ct)}var Ct=I(0);function Mc(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||wf(c)||Mf(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ki=0,Ne=null,We=null,Nt=null,Nc=!1,_a=!1,$s=!1,Oc=0,qr=0,wa=null,X1=0;function mt(){throw Error(i(321))}function kd(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!bn(s[c],a[c]))return!1;return!0}function Td(s,a,c,d,p,v){return ki=v,Ne=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,H.H=s===null||s.memoizedState===null?av:Ud,$s=!1,v=c(d,p),$s=!1,_a&&(v=Eg(a,c,d,p)),Tg(s),v}function Tg(s){H.H=Kr;var a=We!==null&&We.next!==null;if(ki=0,Nt=We=Ne=null,Nc=!1,qr=0,wa=null,a)throw Error(i(300));s===null||Ot||(s=s.dependencies,s!==null&&Cc(s)&&(Ot=!0))}function Eg(s,a,c,d){Ne=s;var p=0;do{if(_a&&(wa=null),qr=0,_a=!1,25<=p)throw Error(i(301));if(p+=1,Nt=We=null,s.updateQueue!=null){var v=s.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}H.H=rv,v=a(c,d)}while(_a);return v}function W1(){var s=H.H,a=s.useState()[0];return a=typeof a.then=="function"?Hr(a):a,s=s.useState()[0],(We!==null?We.memoizedState:null)!==s&&(Ne.flags|=1024),a}function Ed(){var s=Oc!==0;return Oc=0,s}function xd(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function Rd(s){if(Nc){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Nc=!1}ki=0,Nt=We=Ne=null,_a=!1,qr=Oc=0,wa=null}function Zt(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nt===null?Ne.memoizedState=Nt=s:Nt=Nt.next=s,Nt}function kt(){if(We===null){var s=Ne.alternate;s=s!==null?s.memoizedState:null}else s=We.next;var a=Nt===null?Ne.memoizedState:Nt.next;if(a!==null)Nt=a,We=s;else{if(s===null)throw Ne.alternate===null?Error(i(467)):Error(i(310));We=s,s={memoizedState:We.memoizedState,baseState:We.baseState,baseQueue:We.baseQueue,queue:We.queue,next:null},Nt===null?Ne.memoizedState=Nt=s:Nt=Nt.next=s}return Nt}function Dc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Hr(s){var a=qr;return qr+=1,wa===null&&(wa=[]),s=mg(wa,s,a),a=Ne,(Nt===null?a.memoizedState:Nt.next)===null&&(a=a.alternate,H.H=a===null||a.memoizedState===null?av:Ud),s}function Ac(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Hr(s);if(s.$$typeof===D)return qt(s)}throw Error(i(438,String(s)))}function _d(s){var a=null,c=Ne.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var d=Ne.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(a={data:d.data.map(function(p){return p.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Dc(),Ne.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),d=0;d<s;d++)c[d]=P;return a.index++,c}function Ti(s,a){return typeof a=="function"?a(s):a}function Pc(s){var a=kt();return wd(a,We,s)}function wd(s,a,c){var d=s.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=c;var p=s.baseQueue,v=d.pending;if(v!==null){if(p!==null){var S=p.next;p.next=v.next,v.next=S}a.baseQueue=p=v,d.pending=null}if(v=s.baseState,p===null)s.memoizedState=v;else{a=p.next;var N=S=null,j=null,K=a,Z=!1;do{var ne=K.lane&-536870913;if(ne!==K.lane?(Be&ne)===ne:(ki&ne)===ne){var G=K.revertLane;if(G===0)j!==null&&(j=j.next={lane:0,revertLane:0,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),ne===ka&&(Z=!0);else if((ki&G)===G){K=K.next,G===ka&&(Z=!0);continue}else ne={lane:0,revertLane:K.revertLane,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},j===null?(N=j=ne,S=v):j=j.next=ne,Ne.lanes|=G,ss|=G;ne=K.action,$s&&c(v,ne),v=K.hasEagerState?K.eagerState:c(v,ne)}else G={lane:ne,revertLane:K.revertLane,gesture:K.gesture,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},j===null?(N=j=G,S=v):j=j.next=G,Ne.lanes|=ne,ss|=ne;K=K.next}while(K!==null&&K!==a);if(j===null?S=v:j.next=N,!bn(v,s.memoizedState)&&(Ot=!0,Z&&(c=Ta,c!==null)))throw c;s.memoizedState=v,s.baseState=S,s.baseQueue=j,d.lastRenderedState=v}return p===null&&(d.lanes=0),[s.memoizedState,d.dispatch]}function Md(s){var a=kt(),c=a.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=s;var d=c.dispatch,p=c.pending,v=a.memoizedState;if(p!==null){c.pending=null;var S=p=p.next;do v=s(v,S.action),S=S.next;while(S!==p);bn(v,a.memoizedState)||(Ot=!0),a.memoizedState=v,a.baseQueue===null&&(a.baseState=v),c.lastRenderedState=v}return[v,d]}function xg(s,a,c){var d=Ne,p=kt(),v=Fe;if(v){if(c===void 0)throw Error(i(407));c=c()}else c=a();var S=!bn((We||p).memoizedState,c);if(S&&(p.memoizedState=c,Ot=!0),p=p.queue,Dd(wg.bind(null,d,p,s),[s]),p.getSnapshot!==a||S||Nt!==null&&Nt.memoizedState.tag&1){if(d.flags|=2048,Ma(9,{destroy:void 0},_g.bind(null,d,p,c,a),null),nt===null)throw Error(i(349));v||(ki&127)!==0||Rg(d,a,c)}return c}function Rg(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=Ne.updateQueue,a===null?(a=Dc(),Ne.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function _g(s,a,c,d){a.value=c,a.getSnapshot=d,Mg(a)&&Ng(s)}function wg(s,a,c){return c(function(){Mg(a)&&Ng(s)})}function Mg(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!bn(s,c)}catch{return!0}}function Ng(s){var a=js(s,2);a!==null&&fn(a,s,2)}function Nd(s){var a=Zt();if(typeof s=="function"){var c=s;if(s=c(),$s){Hi(!0);try{c()}finally{Hi(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ti,lastRenderedState:s},a}function Og(s,a,c,d){return s.baseState=c,wd(s,We,typeof d=="function"?d:Ti)}function Z1(s,a,c,d,p){if(Ic(s))throw Error(i(485));if(s=a.action,s!==null){var v={payload:p,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){v.listeners.push(S)}};H.T!==null?c(!0):v.isTransition=!1,d(v),c=a.pending,c===null?(v.next=a.pending=v,Dg(a,v)):(v.next=c.next,a.pending=c.next=v)}}function Dg(s,a){var c=a.action,d=a.payload,p=s.state;if(a.isTransition){var v=H.T,S={};H.T=S;try{var N=c(p,d),j=H.S;j!==null&&j(S,N),Ag(s,a,N)}catch(K){Od(s,a,K)}finally{v!==null&&S.types!==null&&(v.types=S.types),H.T=v}}else try{v=c(p,d),Ag(s,a,v)}catch(K){Od(s,a,K)}}function Ag(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){Pg(s,a,d)},function(d){return Od(s,a,d)}):Pg(s,a,c)}function Pg(s,a,c){a.status="fulfilled",a.value=c,Lg(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,Dg(s,c)))}function Od(s,a,c){var d=s.pending;if(s.pending=null,d!==null){d=d.next;do a.status="rejected",a.reason=c,Lg(a),a=a.next;while(a!==d)}s.action=null}function Lg(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function jg(s,a){return a}function Ig(s,a){if(Fe){var c=nt.formState;if(c!==null){e:{var d=Ne;if(Fe){if(rt){t:{for(var p=rt,v=Ln;p.nodeType!==8;){if(!v){p=null;break t}if(p=In(p.nextSibling),p===null){p=null;break t}}v=p.data,p=v==="F!"||v==="F"?p:null}if(p){rt=In(p.nextSibling),d=p.data==="F!";break e}}Ji(d)}d=!1}d&&(a=c[0])}}return c=Zt(),c.memoizedState=c.baseState=a,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:jg,lastRenderedState:a},c.queue=d,c=nv.bind(null,Ne,d),d.dispatch=c,d=Nd(!1),v=Id.bind(null,Ne,!1,d.queue),d=Zt(),p={state:a,dispatch:null,action:s,pending:null},d.queue=p,c=Z1.bind(null,Ne,p,v,c),p.dispatch=c,d.memoizedState=s,[a,c,!1]}function Ug(s){var a=kt();return Bg(a,We,s)}function Bg(s,a,c){if(a=wd(s,a,jg)[0],s=Pc(Ti)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var d=Hr(a)}catch(S){throw S===Ea?Ec:S}else d=a;a=kt();var p=a.queue,v=p.dispatch;return c!==a.memoizedState&&(Ne.flags|=2048,Ma(9,{destroy:void 0},eE.bind(null,p,c),null)),[d,v,s]}function eE(s,a){s.action=a}function zg(s){var a=kt(),c=We;if(c!==null)return Bg(a,c,s);kt(),a=a.memoizedState,c=kt();var d=c.queue.dispatch;return c.memoizedState=s,[a,d,!1]}function Ma(s,a,c,d){return s={tag:s,create:c,deps:d,inst:a,next:null},a=Ne.updateQueue,a===null&&(a=Dc(),Ne.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(d=c.next,c.next=s,s.next=d,a.lastEffect=s),s}function Vg(){return kt().memoizedState}function Lc(s,a,c,d){var p=Zt();Ne.flags|=s,p.memoizedState=Ma(1|a,{destroy:void 0},c,d===void 0?null:d)}function jc(s,a,c,d){var p=kt();d=d===void 0?null:d;var v=p.memoizedState.inst;We!==null&&d!==null&&kd(d,We.memoizedState.deps)?p.memoizedState=Ma(a,v,c,d):(Ne.flags|=s,p.memoizedState=Ma(1|a,v,c,d))}function Fg(s,a){Lc(8390656,8,s,a)}function Dd(s,a){jc(2048,8,s,a)}function tE(s){Ne.flags|=4;var a=Ne.updateQueue;if(a===null)a=Dc(),Ne.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function qg(s){var a=kt().memoizedState;return tE({ref:a,nextImpl:s}),function(){if((Ge&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function Hg(s,a){return jc(4,2,s,a)}function $g(s,a){return jc(4,4,s,a)}function Kg(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function Gg(s,a,c){c=c!=null?c.concat([s]):null,jc(4,4,Kg.bind(null,a,s),c)}function Ad(){}function Yg(s,a){var c=kt();a=a===void 0?null:a;var d=c.memoizedState;return a!==null&&kd(a,d[1])?d[0]:(c.memoizedState=[s,a],s)}function Jg(s,a){var c=kt();a=a===void 0?null:a;var d=c.memoizedState;if(a!==null&&kd(a,d[1]))return d[0];if(d=s(),$s){Hi(!0);try{s()}finally{Hi(!1)}}return c.memoizedState=[d,a],d}function Pd(s,a,c){return c===void 0||(ki&1073741824)!==0&&(Be&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=Qv(),Ne.lanes|=s,ss|=s,c)}function Qg(s,a,c,d){return bn(c,a)?c:Ra.current!==null?(s=Pd(s,c,d),bn(s,a)||(Ot=!0),s):(ki&42)===0||(ki&1073741824)!==0&&(Be&261930)===0?(Ot=!0,s.memoizedState=c):(s=Qv(),Ne.lanes|=s,ss|=s,a)}function Xg(s,a,c,d,p){var v=re.p;re.p=v!==0&&8>v?v:8;var S=H.T,N={};H.T=N,Id(s,!1,a,c);try{var j=p(),K=H.S;if(K!==null&&K(N,j),j!==null&&typeof j=="object"&&typeof j.then=="function"){var Z=Q1(j,d);$r(s,a,Z,xn(s))}else $r(s,a,d,xn(s))}catch(ne){$r(s,a,{then:function(){},status:"rejected",reason:ne},xn())}finally{re.p=v,S!==null&&N.types!==null&&(S.types=N.types),H.T=S}}function nE(){}function Ld(s,a,c,d){if(s.tag!==5)throw Error(i(476));var p=Wg(s).queue;Xg(s,p,a,fe,c===null?nE:function(){return Zg(s),c(d)})}function Wg(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:fe,baseState:fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ti,lastRenderedState:fe},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ti,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Zg(s){var a=Wg(s);a.next===null&&(a=s.alternate.memoizedState),$r(s,a.next.queue,{},xn())}function jd(){return qt(co)}function ev(){return kt().memoizedState}function tv(){return kt().memoizedState}function iE(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=xn();s=Wi(c);var d=Zi(a,s,c);d!==null&&(fn(d,a,c),zr(d,a,c)),a={cache:dd()},s.payload=a;return}a=a.return}}function sE(s,a,c){var d=xn();c={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Ic(s)?iv(a,c):(c=ed(s,a,c,d),c!==null&&(fn(c,s,d),sv(c,a,d)))}function nv(s,a,c){var d=xn();$r(s,a,c,d)}function $r(s,a,c,d){var p={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Ic(s))iv(a,p);else{var v=s.alternate;if(s.lanes===0&&(v===null||v.lanes===0)&&(v=a.lastRenderedReducer,v!==null))try{var S=a.lastRenderedState,N=v(S,c);if(p.hasEagerState=!0,p.eagerState=N,bn(N,S))return vc(s,a,p,0),nt===null&&gc(),!1}catch{}if(c=ed(s,a,p,d),c!==null)return fn(c,s,d),sv(c,a,d),!0}return!1}function Id(s,a,c,d){if(d={lane:2,revertLane:gf(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Ic(s)){if(a)throw Error(i(479))}else a=ed(s,c,d,2),a!==null&&fn(a,s,2)}function Ic(s){var a=s.alternate;return s===Ne||a!==null&&a===Ne}function iv(s,a){_a=Nc=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function sv(s,a,c){if((c&4194048)!==0){var d=a.lanes;d&=s.pendingLanes,c|=d,a.lanes=c,lp(s,c)}}var Kr={readContext:qt,use:Ac,useCallback:mt,useContext:mt,useEffect:mt,useImperativeHandle:mt,useLayoutEffect:mt,useInsertionEffect:mt,useMemo:mt,useReducer:mt,useRef:mt,useState:mt,useDebugValue:mt,useDeferredValue:mt,useTransition:mt,useSyncExternalStore:mt,useId:mt,useHostTransitionStatus:mt,useFormState:mt,useActionState:mt,useOptimistic:mt,useMemoCache:mt,useCacheRefresh:mt};Kr.useEffectEvent=mt;var av={readContext:qt,use:Ac,useCallback:function(s,a){return Zt().memoizedState=[s,a===void 0?null:a],s},useContext:qt,useEffect:Fg,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,Lc(4194308,4,Kg.bind(null,a,s),c)},useLayoutEffect:function(s,a){return Lc(4194308,4,s,a)},useInsertionEffect:function(s,a){Lc(4,2,s,a)},useMemo:function(s,a){var c=Zt();a=a===void 0?null:a;var d=s();if($s){Hi(!0);try{s()}finally{Hi(!1)}}return c.memoizedState=[d,a],d},useReducer:function(s,a,c){var d=Zt();if(c!==void 0){var p=c(a);if($s){Hi(!0);try{c(a)}finally{Hi(!1)}}}else p=a;return d.memoizedState=d.baseState=p,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:p},d.queue=s,s=s.dispatch=sE.bind(null,Ne,s),[d.memoizedState,s]},useRef:function(s){var a=Zt();return s={current:s},a.memoizedState=s},useState:function(s){s=Nd(s);var a=s.queue,c=nv.bind(null,Ne,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:Ad,useDeferredValue:function(s,a){var c=Zt();return Pd(c,s,a)},useTransition:function(){var s=Nd(!1);return s=Xg.bind(null,Ne,s.queue,!0,!1),Zt().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var d=Ne,p=Zt();if(Fe){if(c===void 0)throw Error(i(407));c=c()}else{if(c=a(),nt===null)throw Error(i(349));(Be&127)!==0||Rg(d,a,c)}p.memoizedState=c;var v={value:c,getSnapshot:a};return p.queue=v,Fg(wg.bind(null,d,v,s),[s]),d.flags|=2048,Ma(9,{destroy:void 0},_g.bind(null,d,v,c,a),null),c},useId:function(){var s=Zt(),a=nt.identifierPrefix;if(Fe){var c=ni,d=ti;c=(d&~(1<<32-yn(d)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Oc++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=X1++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:jd,useFormState:Ig,useActionState:Ig,useOptimistic:function(s){var a=Zt();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Id.bind(null,Ne,!0,c),c.dispatch=a,[s,a]},useMemoCache:_d,useCacheRefresh:function(){return Zt().memoizedState=iE.bind(null,Ne)},useEffectEvent:function(s){var a=Zt(),c={impl:s};return a.memoizedState=c,function(){if((Ge&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},Ud={readContext:qt,use:Ac,useCallback:Yg,useContext:qt,useEffect:Dd,useImperativeHandle:Gg,useInsertionEffect:Hg,useLayoutEffect:$g,useMemo:Jg,useReducer:Pc,useRef:Vg,useState:function(){return Pc(Ti)},useDebugValue:Ad,useDeferredValue:function(s,a){var c=kt();return Qg(c,We.memoizedState,s,a)},useTransition:function(){var s=Pc(Ti)[0],a=kt().memoizedState;return[typeof s=="boolean"?s:Hr(s),a]},useSyncExternalStore:xg,useId:ev,useHostTransitionStatus:jd,useFormState:Ug,useActionState:Ug,useOptimistic:function(s,a){var c=kt();return Og(c,We,s,a)},useMemoCache:_d,useCacheRefresh:tv};Ud.useEffectEvent=qg;var rv={readContext:qt,use:Ac,useCallback:Yg,useContext:qt,useEffect:Dd,useImperativeHandle:Gg,useInsertionEffect:Hg,useLayoutEffect:$g,useMemo:Jg,useReducer:Md,useRef:Vg,useState:function(){return Md(Ti)},useDebugValue:Ad,useDeferredValue:function(s,a){var c=kt();return We===null?Pd(c,s,a):Qg(c,We.memoizedState,s,a)},useTransition:function(){var s=Md(Ti)[0],a=kt().memoizedState;return[typeof s=="boolean"?s:Hr(s),a]},useSyncExternalStore:xg,useId:ev,useHostTransitionStatus:jd,useFormState:zg,useActionState:zg,useOptimistic:function(s,a){var c=kt();return We!==null?Og(c,We,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:_d,useCacheRefresh:tv};rv.useEffectEvent=qg;function Bd(s,a,c,d){a=s.memoizedState,c=c(d,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var zd={enqueueSetState:function(s,a,c){s=s._reactInternals;var d=xn(),p=Wi(d);p.payload=a,c!=null&&(p.callback=c),a=Zi(s,p,d),a!==null&&(fn(a,s,d),zr(a,s,d))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var d=xn(),p=Wi(d);p.tag=1,p.payload=a,c!=null&&(p.callback=c),a=Zi(s,p,d),a!==null&&(fn(a,s,d),zr(a,s,d))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=xn(),d=Wi(c);d.tag=2,a!=null&&(d.callback=a),a=Zi(s,d,c),a!==null&&(fn(a,s,c),zr(a,s,c))}};function ov(s,a,c,d,p,v,S){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(d,v,S):a.prototype&&a.prototype.isPureReactComponent?!Dr(c,d)||!Dr(p,v):!0}function cv(s,a,c,d){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,d),a.state!==s&&zd.enqueueReplaceState(a,a.state,null)}function Ks(s,a){var c=a;if("ref"in a){c={};for(var d in a)d!=="ref"&&(c[d]=a[d])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var p in s)c[p]===void 0&&(c[p]=s[p])}return c}function lv(s){pc(s)}function uv(s){console.error(s)}function dv(s){pc(s)}function Uc(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(d){setTimeout(function(){throw d})}}function fv(s,a,c){try{var d=s.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Vd(s,a,c){return c=Wi(c),c.tag=3,c.payload={element:null},c.callback=function(){Uc(s,a)},c}function hv(s){return s=Wi(s),s.tag=3,s}function mv(s,a,c,d){var p=c.type.getDerivedStateFromError;if(typeof p=="function"){var v=d.value;s.payload=function(){return p(v)},s.callback=function(){fv(a,c,d)}}var S=c.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(s.callback=function(){fv(a,c,d),typeof p!="function"&&(as===null?as=new Set([this]):as.add(this));var N=d.stack;this.componentDidCatch(d.value,{componentStack:N!==null?N:""})})}function aE(s,a,c,d,p){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(a=c.alternate,a!==null&&Ca(a,c,p,!0),c=Cn.current,c!==null){switch(c.tag){case 31:case 13:return jn===null?Qc():c.alternate===null&&pt===0&&(pt=3),c.flags&=-257,c.flags|=65536,c.lanes=p,d===xc?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([d]):a.add(d),hf(s,d,p)),!1;case 22:return c.flags|=65536,d===xc?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([d]):c.add(d)),hf(s,d,p)),!1}throw Error(i(435,c.tag))}return hf(s,d,p),Qc(),!1}if(Fe)return a=Cn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=p,d!==rd&&(s=Error(i(422),{cause:d}),Lr(Dn(s,c)))):(d!==rd&&(a=Error(i(423),{cause:d}),Lr(Dn(a,c))),s=s.current.alternate,s.flags|=65536,p&=-p,s.lanes|=p,d=Dn(d,c),p=Vd(s.stateNode,d,p),vd(s,p),pt!==4&&(pt=2)),!1;var v=Error(i(520),{cause:d});if(v=Dn(v,c),eo===null?eo=[v]:eo.push(v),pt!==4&&(pt=2),a===null)return!0;d=Dn(d,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=p&-p,c.lanes|=s,s=Vd(c.stateNode,d,s),vd(c,s),!1;case 1:if(a=c.type,v=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(as===null||!as.has(v))))return c.flags|=65536,p&=-p,c.lanes|=p,p=hv(p),mv(p,s,c,d),vd(c,p),!1}c=c.return}while(c!==null);return!1}var Fd=Error(i(461)),Ot=!1;function Ht(s,a,c,d){a.child=s===null?yg(a,null,c,d):Hs(a,s.child,c,d)}function pv(s,a,c,d,p){c=c.render;var v=a.ref;if("ref"in d){var S={};for(var N in d)N!=="ref"&&(S[N]=d[N])}else S=d;return zs(a),d=Td(s,a,c,S,v,p),N=Ed(),s!==null&&!Ot?(xd(s,a,p),Ei(s,a,p)):(Fe&&N&&sd(a),a.flags|=1,Ht(s,a,d,p),a.child)}function gv(s,a,c,d,p){if(s===null){var v=c.type;return typeof v=="function"&&!td(v)&&v.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=v,vv(s,a,v,d,p)):(s=bc(c.type,null,d,a,a.mode,p),s.ref=a.ref,s.return=a,a.child=s)}if(v=s.child,!Qd(s,p)){var S=v.memoizedProps;if(c=c.compare,c=c!==null?c:Dr,c(S,d)&&s.ref===a.ref)return Ei(s,a,p)}return a.flags|=1,s=yi(v,d),s.ref=a.ref,s.return=a,a.child=s}function vv(s,a,c,d,p){if(s!==null){var v=s.memoizedProps;if(Dr(v,d)&&s.ref===a.ref)if(Ot=!1,a.pendingProps=d=v,Qd(s,p))(s.flags&131072)!==0&&(Ot=!0);else return a.lanes=s.lanes,Ei(s,a,p)}return qd(s,a,c,d,p)}function yv(s,a,c,d){var p=d.children,v=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((a.flags&128)!==0){if(v=v!==null?v.baseLanes|c:c,s!==null){for(d=a.child=s.child,p=0;d!==null;)p=p|d.lanes|d.childLanes,d=d.sibling;d=p&~v}else d=0,a.child=null;return bv(s,a,v,c,d)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Tc(a,v!==null?v.cachePool:null),v!==null?Cg(a,v):bd(),kg(a);else return d=a.lanes=536870912,bv(s,a,v!==null?v.baseLanes|c:c,c,d)}else v!==null?(Tc(a,v.cachePool),Cg(a,v),ts(),a.memoizedState=null):(s!==null&&Tc(a,null),bd(),ts());return Ht(s,a,p,c),a.child}function Gr(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function bv(s,a,c,d,p){var v=hd();return v=v===null?null:{parent:Mt._currentValue,pool:v},a.memoizedState={baseLanes:c,cachePool:v},s!==null&&Tc(a,null),bd(),kg(a),s!==null&&Ca(s,a,d,!0),a.childLanes=p,null}function Bc(s,a){return a=Vc({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function Sv(s,a,c){return Hs(a,s.child,null,c),s=Bc(a,a.pendingProps),s.flags|=2,kn(a),a.memoizedState=null,s}function rE(s,a,c){var d=a.pendingProps,p=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(Fe){if(d.mode==="hidden")return s=Bc(a,d),a.lanes=536870912,Gr(null,s);if(Cd(a),(s=rt)?(s=Dy(s,Ln),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Gi!==null?{id:ti,overflow:ni}:null,retryLane:536870912,hydrationErrors:null},c=ig(s),c.return=a,a.child=c,Ft=a,rt=null)):s=null,s===null)throw Ji(a);return a.lanes=536870912,null}return Bc(a,d)}var v=s.memoizedState;if(v!==null){var S=v.dehydrated;if(Cd(a),p)if(a.flags&256)a.flags&=-257,a=Sv(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(i(558));else if(Ot||Ca(s,a,c,!1),p=(c&s.childLanes)!==0,Ot||p){if(d=nt,d!==null&&(S=up(d,c),S!==0&&S!==v.retryLane))throw v.retryLane=S,js(s,S),fn(d,s,S),Fd;Qc(),a=Sv(s,a,c)}else s=v.treeContext,rt=In(S.nextSibling),Ft=a,Fe=!0,Yi=null,Ln=!1,s!==null&&rg(a,s),a=Bc(a,d),a.flags|=4096;return a}return s=yi(s.child,{mode:d.mode,children:d.children}),s.ref=a.ref,a.child=s,s.return=a,s}function zc(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function qd(s,a,c,d,p){return zs(a),c=Td(s,a,c,d,void 0,p),d=Ed(),s!==null&&!Ot?(xd(s,a,p),Ei(s,a,p)):(Fe&&d&&sd(a),a.flags|=1,Ht(s,a,c,p),a.child)}function Cv(s,a,c,d,p,v){return zs(a),a.updateQueue=null,c=Eg(a,d,c,p),Tg(s),d=Ed(),s!==null&&!Ot?(xd(s,a,v),Ei(s,a,v)):(Fe&&d&&sd(a),a.flags|=1,Ht(s,a,c,v),a.child)}function kv(s,a,c,d,p){if(zs(a),a.stateNode===null){var v=va,S=c.contextType;typeof S=="object"&&S!==null&&(v=qt(S)),v=new c(d,v),a.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=zd,a.stateNode=v,v._reactInternals=a,v=a.stateNode,v.props=d,v.state=a.memoizedState,v.refs={},pd(a),S=c.contextType,v.context=typeof S=="object"&&S!==null?qt(S):va,v.state=a.memoizedState,S=c.getDerivedStateFromProps,typeof S=="function"&&(Bd(a,c,S,d),v.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(S=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),S!==v.state&&zd.enqueueReplaceState(v,v.state,null),Fr(a,d,v,p),Vr(),v.state=a.memoizedState),typeof v.componentDidMount=="function"&&(a.flags|=4194308),d=!0}else if(s===null){v=a.stateNode;var N=a.memoizedProps,j=Ks(c,N);v.props=j;var K=v.context,Z=c.contextType;S=va,typeof Z=="object"&&Z!==null&&(S=qt(Z));var ne=c.getDerivedStateFromProps;Z=typeof ne=="function"||typeof v.getSnapshotBeforeUpdate=="function",N=a.pendingProps!==N,Z||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(N||K!==S)&&cv(a,v,d,S),Xi=!1;var G=a.memoizedState;v.state=G,Fr(a,d,v,p),Vr(),K=a.memoizedState,N||G!==K||Xi?(typeof ne=="function"&&(Bd(a,c,ne,d),K=a.memoizedState),(j=Xi||ov(a,c,j,d,G,K,S))?(Z||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(a.flags|=4194308)):(typeof v.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=K),v.props=d,v.state=K,v.context=S,d=j):(typeof v.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{v=a.stateNode,gd(s,a),S=a.memoizedProps,Z=Ks(c,S),v.props=Z,ne=a.pendingProps,G=v.context,K=c.contextType,j=va,typeof K=="object"&&K!==null&&(j=qt(K)),N=c.getDerivedStateFromProps,(K=typeof N=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(S!==ne||G!==j)&&cv(a,v,d,j),Xi=!1,G=a.memoizedState,v.state=G,Fr(a,d,v,p),Vr();var Y=a.memoizedState;S!==ne||G!==Y||Xi||s!==null&&s.dependencies!==null&&Cc(s.dependencies)?(typeof N=="function"&&(Bd(a,c,N,d),Y=a.memoizedState),(Z=Xi||ov(a,c,Z,d,G,Y,j)||s!==null&&s.dependencies!==null&&Cc(s.dependencies))?(K||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,Y,j),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,Y,j)),typeof v.componentDidUpdate=="function"&&(a.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof v.componentDidUpdate!="function"||S===s.memoizedProps&&G===s.memoizedState||(a.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||S===s.memoizedProps&&G===s.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=Y),v.props=d,v.state=Y,v.context=j,d=Z):(typeof v.componentDidUpdate!="function"||S===s.memoizedProps&&G===s.memoizedState||(a.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||S===s.memoizedProps&&G===s.memoizedState||(a.flags|=1024),d=!1)}return v=d,zc(s,a),d=(a.flags&128)!==0,v||d?(v=a.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:v.render(),a.flags|=1,s!==null&&d?(a.child=Hs(a,s.child,null,p),a.child=Hs(a,null,c,p)):Ht(s,a,c,p),a.memoizedState=v.state,s=a.child):s=Ei(s,a,p),s}function Tv(s,a,c,d){return Us(),a.flags|=256,Ht(s,a,c,d),a.child}var Hd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $d(s){return{baseLanes:s,cachePool:fg()}}function Kd(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=En),s}function Ev(s,a,c){var d=a.pendingProps,p=!1,v=(a.flags&128)!==0,S;if((S=v)||(S=s!==null&&s.memoizedState===null?!1:(Ct.current&2)!==0),S&&(p=!0,a.flags&=-129),S=(a.flags&32)!==0,a.flags&=-33,s===null){if(Fe){if(p?es(a):ts(),(s=rt)?(s=Dy(s,Ln),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Gi!==null?{id:ti,overflow:ni}:null,retryLane:536870912,hydrationErrors:null},c=ig(s),c.return=a,a.child=c,Ft=a,rt=null)):s=null,s===null)throw Ji(a);return Mf(s)?a.lanes=32:a.lanes=536870912,null}var N=d.children;return d=d.fallback,p?(ts(),p=a.mode,N=Vc({mode:"hidden",children:N},p),d=Is(d,p,c,null),N.return=a,d.return=a,N.sibling=d,a.child=N,d=a.child,d.memoizedState=$d(c),d.childLanes=Kd(s,S,c),a.memoizedState=Hd,Gr(null,d)):(es(a),Gd(a,N))}var j=s.memoizedState;if(j!==null&&(N=j.dehydrated,N!==null)){if(v)a.flags&256?(es(a),a.flags&=-257,a=Yd(s,a,c)):a.memoizedState!==null?(ts(),a.child=s.child,a.flags|=128,a=null):(ts(),N=d.fallback,p=a.mode,d=Vc({mode:"visible",children:d.children},p),N=Is(N,p,c,null),N.flags|=2,d.return=a,N.return=a,d.sibling=N,a.child=d,Hs(a,s.child,null,c),d=a.child,d.memoizedState=$d(c),d.childLanes=Kd(s,S,c),a.memoizedState=Hd,a=Gr(null,d));else if(es(a),Mf(N)){if(S=N.nextSibling&&N.nextSibling.dataset,S)var K=S.dgst;S=K,d=Error(i(419)),d.stack="",d.digest=S,Lr({value:d,source:null,stack:null}),a=Yd(s,a,c)}else if(Ot||Ca(s,a,c,!1),S=(c&s.childLanes)!==0,Ot||S){if(S=nt,S!==null&&(d=up(S,c),d!==0&&d!==j.retryLane))throw j.retryLane=d,js(s,d),fn(S,s,d),Fd;wf(N)||Qc(),a=Yd(s,a,c)}else wf(N)?(a.flags|=192,a.child=s.child,a=null):(s=j.treeContext,rt=In(N.nextSibling),Ft=a,Fe=!0,Yi=null,Ln=!1,s!==null&&rg(a,s),a=Gd(a,d.children),a.flags|=4096);return a}return p?(ts(),N=d.fallback,p=a.mode,j=s.child,K=j.sibling,d=yi(j,{mode:"hidden",children:d.children}),d.subtreeFlags=j.subtreeFlags&65011712,K!==null?N=yi(K,N):(N=Is(N,p,c,null),N.flags|=2),N.return=a,d.return=a,d.sibling=N,a.child=d,Gr(null,d),d=a.child,N=s.child.memoizedState,N===null?N=$d(c):(p=N.cachePool,p!==null?(j=Mt._currentValue,p=p.parent!==j?{parent:j,pool:j}:p):p=fg(),N={baseLanes:N.baseLanes|c,cachePool:p}),d.memoizedState=N,d.childLanes=Kd(s,S,c),a.memoizedState=Hd,Gr(s.child,d)):(es(a),c=s.child,s=c.sibling,c=yi(c,{mode:"visible",children:d.children}),c.return=a,c.sibling=null,s!==null&&(S=a.deletions,S===null?(a.deletions=[s],a.flags|=16):S.push(s)),a.child=c,a.memoizedState=null,c)}function Gd(s,a){return a=Vc({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function Vc(s,a){return s=Sn(22,s,null,a),s.lanes=0,s}function Yd(s,a,c){return Hs(a,s.child,null,c),s=Gd(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function xv(s,a,c){s.lanes|=a;var d=s.alternate;d!==null&&(d.lanes|=a),ld(s.return,a,c)}function Jd(s,a,c,d,p,v){var S=s.memoizedState;S===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:p,treeForkCount:v}:(S.isBackwards=a,S.rendering=null,S.renderingStartTime=0,S.last=d,S.tail=c,S.tailMode=p,S.treeForkCount=v)}function Rv(s,a,c){var d=a.pendingProps,p=d.revealOrder,v=d.tail;d=d.children;var S=Ct.current,N=(S&2)!==0;if(N?(S=S&1|2,a.flags|=128):S&=1,oe(Ct,S),Ht(s,a,d,c),d=Fe?Pr:0,!N&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&xv(s,c,a);else if(s.tag===19)xv(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(p){case"forwards":for(c=a.child,p=null;c!==null;)s=c.alternate,s!==null&&Mc(s)===null&&(p=c),c=c.sibling;c=p,c===null?(p=a.child,a.child=null):(p=c.sibling,c.sibling=null),Jd(a,!1,p,c,v,d);break;case"backwards":case"unstable_legacy-backwards":for(c=null,p=a.child,a.child=null;p!==null;){if(s=p.alternate,s!==null&&Mc(s)===null){a.child=p;break}s=p.sibling,p.sibling=c,c=p,p=s}Jd(a,!0,c,null,v,d);break;case"together":Jd(a,!1,null,null,void 0,d);break;default:a.memoizedState=null}return a.child}function Ei(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),ss|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(Ca(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(i(153));if(a.child!==null){for(s=a.child,c=yi(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=yi(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Qd(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Cc(s)))}function oE(s,a,c){switch(a.tag){case 3:Ye(a,a.stateNode.containerInfo),Qi(a,Mt,s.memoizedState.cache),Us();break;case 27:case 5:wn(a);break;case 4:Ye(a,a.stateNode.containerInfo);break;case 10:Qi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Cd(a),null;break;case 13:var d=a.memoizedState;if(d!==null)return d.dehydrated!==null?(es(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Ev(s,a,c):(es(a),s=Ei(s,a,c),s!==null?s.sibling:null);es(a);break;case 19:var p=(s.flags&128)!==0;if(d=(c&a.childLanes)!==0,d||(Ca(s,a,c,!1),d=(c&a.childLanes)!==0),p){if(d)return Rv(s,a,c);a.flags|=128}if(p=a.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),oe(Ct,Ct.current),d)break;return null;case 22:return a.lanes=0,yv(s,a,c,a.pendingProps);case 24:Qi(a,Mt,s.memoizedState.cache)}return Ei(s,a,c)}function _v(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)Ot=!0;else{if(!Qd(s,c)&&(a.flags&128)===0)return Ot=!1,oE(s,a,c);Ot=(s.flags&131072)!==0}else Ot=!1,Fe&&(a.flags&1048576)!==0&&ag(a,Pr,a.index);switch(a.lanes=0,a.tag){case 16:e:{var d=a.pendingProps;if(s=Fs(a.elementType),a.type=s,typeof s=="function")td(s)?(d=Ks(s,d),a.tag=1,a=kv(null,a,s,d,c)):(a.tag=0,a=qd(null,a,s,d,c));else{if(s!=null){var p=s.$$typeof;if(p===x){a.tag=11,a=pv(null,a,s,d,c);break e}else if(p===L){a.tag=14,a=gv(null,a,s,d,c);break e}}throw a=he(s)||s,Error(i(306,a,""))}}return a;case 0:return qd(s,a,a.type,a.pendingProps,c);case 1:return d=a.type,p=Ks(d,a.pendingProps),kv(s,a,d,p,c);case 3:e:{if(Ye(a,a.stateNode.containerInfo),s===null)throw Error(i(387));d=a.pendingProps;var v=a.memoizedState;p=v.element,gd(s,a),Fr(a,d,null,c);var S=a.memoizedState;if(d=S.cache,Qi(a,Mt,d),d!==v.cache&&ud(a,[Mt],c,!0),Vr(),d=S.element,v.isDehydrated)if(v={element:d,isDehydrated:!1,cache:S.cache},a.updateQueue.baseState=v,a.memoizedState=v,a.flags&256){a=Tv(s,a,d,c);break e}else if(d!==p){p=Dn(Error(i(424)),a),Lr(p),a=Tv(s,a,d,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,rt=In(s.firstChild),Ft=a,Fe=!0,Yi=null,Ln=!0,c=yg(a,null,d,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Us(),d===p){a=Ei(s,a,c);break e}Ht(s,a,d,c)}a=a.child}return a;case 26:return zc(s,a),s===null?(c=Uy(a.type,null,a.pendingProps,null))?a.memoizedState=c:Fe||(c=a.type,s=a.pendingProps,d=il(pe.current).createElement(c),d[Vt]=a,d[rn]=s,$t(d,c,s),It(d),a.stateNode=d):a.memoizedState=Uy(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return wn(a),s===null&&Fe&&(d=a.stateNode=Ly(a.type,a.pendingProps,pe.current),Ft=a,Ln=!0,p=rt,ls(a.type)?(Nf=p,rt=In(d.firstChild)):rt=p),Ht(s,a,a.pendingProps.children,c),zc(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&Fe&&((p=d=rt)&&(d=IE(d,a.type,a.pendingProps,Ln),d!==null?(a.stateNode=d,Ft=a,rt=In(d.firstChild),Ln=!1,p=!0):p=!1),p||Ji(a)),wn(a),p=a.type,v=a.pendingProps,S=s!==null?s.memoizedProps:null,d=v.children,xf(p,v)?d=null:S!==null&&xf(p,S)&&(a.flags|=32),a.memoizedState!==null&&(p=Td(s,a,W1,null,null,c),co._currentValue=p),zc(s,a),Ht(s,a,d,c),a.child;case 6:return s===null&&Fe&&((s=c=rt)&&(c=UE(c,a.pendingProps,Ln),c!==null?(a.stateNode=c,Ft=a,rt=null,s=!0):s=!1),s||Ji(a)),null;case 13:return Ev(s,a,c);case 4:return Ye(a,a.stateNode.containerInfo),d=a.pendingProps,s===null?a.child=Hs(a,null,d,c):Ht(s,a,d,c),a.child;case 11:return pv(s,a,a.type,a.pendingProps,c);case 7:return Ht(s,a,a.pendingProps,c),a.child;case 8:return Ht(s,a,a.pendingProps.children,c),a.child;case 12:return Ht(s,a,a.pendingProps.children,c),a.child;case 10:return d=a.pendingProps,Qi(a,a.type,d.value),Ht(s,a,d.children,c),a.child;case 9:return p=a.type._context,d=a.pendingProps.children,zs(a),p=qt(p),d=d(p),a.flags|=1,Ht(s,a,d,c),a.child;case 14:return gv(s,a,a.type,a.pendingProps,c);case 15:return vv(s,a,a.type,a.pendingProps,c);case 19:return Rv(s,a,c);case 31:return rE(s,a,c);case 22:return yv(s,a,c,a.pendingProps);case 24:return zs(a),d=qt(Mt),s===null?(p=hd(),p===null&&(p=nt,v=dd(),p.pooledCache=v,v.refCount++,v!==null&&(p.pooledCacheLanes|=c),p=v),a.memoizedState={parent:d,cache:p},pd(a),Qi(a,Mt,p)):((s.lanes&c)!==0&&(gd(s,a),Fr(a,null,null,c),Vr()),p=s.memoizedState,v=a.memoizedState,p.parent!==d?(p={parent:d,cache:d},a.memoizedState=p,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=p),Qi(a,Mt,d)):(d=v.cache,Qi(a,Mt,d),d!==p.cache&&ud(a,[Mt],c,!0))),Ht(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function xi(s){s.flags|=4}function Xd(s,a,c,d,p){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(p&335544128)===p)if(s.stateNode.complete)s.flags|=8192;else if(ey())s.flags|=8192;else throw qs=xc,md}else s.flags&=-16777217}function wv(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!qy(a))if(ey())s.flags|=8192;else throw qs=xc,md}function Fc(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?op():536870912,s.lanes|=a,Aa|=a)}function Yr(s,a){if(!Fe)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:d.sibling=null}}function ot(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,d=0;if(a)for(var p=s.child;p!==null;)c|=p.lanes|p.childLanes,d|=p.subtreeFlags&65011712,d|=p.flags&65011712,p.return=s,p=p.sibling;else for(p=s.child;p!==null;)c|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=s,p=p.sibling;return s.subtreeFlags|=d,s.childLanes=c,a}function cE(s,a,c){var d=a.pendingProps;switch(ad(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ot(a),null;case 1:return ot(a),null;case 3:return c=a.stateNode,d=null,s!==null&&(d=s.memoizedState.cache),a.memoizedState.cache!==d&&(a.flags|=2048),Ci(Mt),Ke(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(Sa(a)?xi(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,od())),ot(a),null;case 26:var p=a.type,v=a.memoizedState;return s===null?(xi(a),v!==null?(ot(a),wv(a,v)):(ot(a),Xd(a,p,null,d,c))):v?v!==s.memoizedState?(xi(a),ot(a),wv(a,v)):(ot(a),a.flags&=-16777217):(s=s.memoizedProps,s!==d&&xi(a),ot(a),Xd(a,p,s,d,c)),null;case 27:if(ia(a),c=pe.current,p=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==d&&xi(a);else{if(!d){if(a.stateNode===null)throw Error(i(166));return ot(a),null}s=de.current,Sa(a)?og(a):(s=Ly(p,d,c),a.stateNode=s,xi(a))}return ot(a),null;case 5:if(ia(a),p=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==d&&xi(a);else{if(!d){if(a.stateNode===null)throw Error(i(166));return ot(a),null}if(v=de.current,Sa(a))og(a);else{var S=il(pe.current);switch(v){case 1:v=S.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:v=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":v=S.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":v=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":v=S.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild);break;case"select":v=typeof d.is=="string"?S.createElement("select",{is:d.is}):S.createElement("select"),d.multiple?v.multiple=!0:d.size&&(v.size=d.size);break;default:v=typeof d.is=="string"?S.createElement(p,{is:d.is}):S.createElement(p)}}v[Vt]=a,v[rn]=d;e:for(S=a.child;S!==null;){if(S.tag===5||S.tag===6)v.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===a)break e;for(;S.sibling===null;){if(S.return===null||S.return===a)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}a.stateNode=v;e:switch($t(v,p,d),p){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&xi(a)}}return ot(a),Xd(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==d&&xi(a);else{if(typeof d!="string"&&a.stateNode===null)throw Error(i(166));if(s=pe.current,Sa(a)){if(s=a.stateNode,c=a.memoizedProps,d=null,p=Ft,p!==null)switch(p.tag){case 27:case 5:d=p.memoizedProps}s[Vt]=a,s=!!(s.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||Ey(s.nodeValue,c)),s||Ji(a,!0)}else s=il(s).createTextNode(d),s[Vt]=a,a.stateNode=s}return ot(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(d=Sa(a),c!==null){if(s===null){if(!d)throw Error(i(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(557));s[Vt]=a}else Us(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;ot(a),s=!1}else c=od(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(kn(a),a):(kn(a),null);if((a.flags&128)!==0)throw Error(i(558))}return ot(a),null;case 13:if(d=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(p=Sa(a),d!==null&&d.dehydrated!==null){if(s===null){if(!p)throw Error(i(318));if(p=a.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[Vt]=a}else Us(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;ot(a),p=!1}else p=od(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=p),p=!0;if(!p)return a.flags&256?(kn(a),a):(kn(a),null)}return kn(a),(a.flags&128)!==0?(a.lanes=c,a):(c=d!==null,s=s!==null&&s.memoizedState!==null,c&&(d=a.child,p=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(p=d.alternate.memoizedState.cachePool.pool),v=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==p&&(d.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),Fc(a,a.updateQueue),ot(a),null);case 4:return Ke(),s===null&&Sf(a.stateNode.containerInfo),ot(a),null;case 10:return Ci(a.type),ot(a),null;case 19:if(Q(Ct),d=a.memoizedState,d===null)return ot(a),null;if(p=(a.flags&128)!==0,v=d.rendering,v===null)if(p)Yr(d,!1);else{if(pt!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(v=Mc(s),v!==null){for(a.flags|=128,Yr(d,!1),s=v.updateQueue,a.updateQueue=s,Fc(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)ng(c,s),c=c.sibling;return oe(Ct,Ct.current&1|2),Fe&&bi(a,d.treeForkCount),a.child}s=s.sibling}d.tail!==null&&St()>Gc&&(a.flags|=128,p=!0,Yr(d,!1),a.lanes=4194304)}else{if(!p)if(s=Mc(v),s!==null){if(a.flags|=128,p=!0,s=s.updateQueue,a.updateQueue=s,Fc(a,s),Yr(d,!0),d.tail===null&&d.tailMode==="hidden"&&!v.alternate&&!Fe)return ot(a),null}else 2*St()-d.renderingStartTime>Gc&&c!==536870912&&(a.flags|=128,p=!0,Yr(d,!1),a.lanes=4194304);d.isBackwards?(v.sibling=a.child,a.child=v):(s=d.last,s!==null?s.sibling=v:a.child=v,d.last=v)}return d.tail!==null?(s=d.tail,d.rendering=s,d.tail=s.sibling,d.renderingStartTime=St(),s.sibling=null,c=Ct.current,oe(Ct,p?c&1|2:c&1),Fe&&bi(a,d.treeForkCount),s):(ot(a),null);case 22:case 23:return kn(a),Sd(),d=a.memoizedState!==null,s!==null?s.memoizedState!==null!==d&&(a.flags|=8192):d&&(a.flags|=8192),d?(c&536870912)!==0&&(a.flags&128)===0&&(ot(a),a.subtreeFlags&6&&(a.flags|=8192)):ot(a),c=a.updateQueue,c!==null&&Fc(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),d=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),d!==c&&(a.flags|=2048),s!==null&&Q(Vs),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),Ci(Mt),ot(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function lE(s,a){switch(ad(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return Ci(Mt),Ke(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return ia(a),null;case 31:if(a.memoizedState!==null){if(kn(a),a.alternate===null)throw Error(i(340));Us()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(kn(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Us()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return Q(Ct),null;case 4:return Ke(),null;case 10:return Ci(a.type),null;case 22:case 23:return kn(a),Sd(),s!==null&&Q(Vs),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return Ci(Mt),null;case 25:return null;default:return null}}function Mv(s,a){switch(ad(a),a.tag){case 3:Ci(Mt),Ke();break;case 26:case 27:case 5:ia(a);break;case 4:Ke();break;case 31:a.memoizedState!==null&&kn(a);break;case 13:kn(a);break;case 19:Q(Ct);break;case 10:Ci(a.type);break;case 22:case 23:kn(a),Sd(),s!==null&&Q(Vs);break;case 24:Ci(Mt)}}function Jr(s,a){try{var c=a.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var p=d.next;c=p;do{if((c.tag&s)===s){d=void 0;var v=c.create,S=c.inst;d=v(),S.destroy=d}c=c.next}while(c!==p)}}catch(N){Qe(a,a.return,N)}}function ns(s,a,c){try{var d=a.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var v=p.next;d=v;do{if((d.tag&s)===s){var S=d.inst,N=S.destroy;if(N!==void 0){S.destroy=void 0,p=a;var j=c,K=N;try{K()}catch(Z){Qe(p,j,Z)}}}d=d.next}while(d!==v)}}catch(Z){Qe(a,a.return,Z)}}function Nv(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{Sg(a,c)}catch(d){Qe(s,s.return,d)}}}function Ov(s,a,c){c.props=Ks(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(d){Qe(s,a,d)}}function Qr(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var d=s.stateNode;break;case 30:d=s.stateNode;break;default:d=s.stateNode}typeof c=="function"?s.refCleanup=c(d):c.current=d}}catch(p){Qe(s,a,p)}}function ii(s,a){var c=s.ref,d=s.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(p){Qe(s,a,p)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(p){Qe(s,a,p)}else c.current=null}function Dv(s){var a=s.type,c=s.memoizedProps,d=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break e;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(p){Qe(s,s.return,p)}}function Wd(s,a,c){try{var d=s.stateNode;OE(d,s.type,c,a),d[rn]=a}catch(p){Qe(s,s.return,p)}}function Av(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ls(s.type)||s.tag===4}function Zd(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Av(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ls(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function ef(s,a,c){var d=s.tag;if(d===5||d===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=gi));else if(d!==4&&(d===27&&ls(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(ef(s,a,c),s=s.sibling;s!==null;)ef(s,a,c),s=s.sibling}function qc(s,a,c){var d=s.tag;if(d===5||d===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(d!==4&&(d===27&&ls(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(qc(s,a,c),s=s.sibling;s!==null;)qc(s,a,c),s=s.sibling}function Pv(s){var a=s.stateNode,c=s.memoizedProps;try{for(var d=s.type,p=a.attributes;p.length;)a.removeAttributeNode(p[0]);$t(a,d,c),a[Vt]=s,a[rn]=c}catch(v){Qe(s,s.return,v)}}var Ri=!1,Dt=!1,tf=!1,Lv=typeof WeakSet=="function"?WeakSet:Set,Ut=null;function uE(s,a){if(s=s.containerInfo,Tf=ul,s=Gp(s),Yu(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var p=d.anchorOffset,v=d.focusNode;d=d.focusOffset;try{c.nodeType,v.nodeType}catch{c=null;break e}var S=0,N=-1,j=-1,K=0,Z=0,ne=s,G=null;t:for(;;){for(var Y;ne!==c||p!==0&&ne.nodeType!==3||(N=S+p),ne!==v||d!==0&&ne.nodeType!==3||(j=S+d),ne.nodeType===3&&(S+=ne.nodeValue.length),(Y=ne.firstChild)!==null;)G=ne,ne=Y;for(;;){if(ne===s)break t;if(G===c&&++K===p&&(N=S),G===v&&++Z===d&&(j=S),(Y=ne.nextSibling)!==null)break;ne=G,G=ne.parentNode}ne=Y}c=N===-1||j===-1?null:{start:N,end:j}}else c=null}c=c||{start:0,end:0}}else c=null;for(Ef={focusedElem:s,selectionRange:c},ul=!1,Ut=a;Ut!==null;)if(a=Ut,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Ut=s;else for(;Ut!==null;){switch(a=Ut,v=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)p=s[c],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&v!==null){s=void 0,c=a,p=v.memoizedProps,v=v.memoizedState,d=c.stateNode;try{var me=Ks(c.type,p);s=d.getSnapshotBeforeUpdate(me,v),d.__reactInternalSnapshotBeforeUpdate=s}catch(Ce){Qe(c,c.return,Ce)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)_f(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":_f(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=a.sibling,s!==null){s.return=a.return,Ut=s;break}Ut=a.return}}function jv(s,a,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:wi(s,c),d&4&&Jr(5,c);break;case 1:if(wi(s,c),d&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(S){Qe(c,c.return,S)}else{var p=Ks(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(p,a,s.__reactInternalSnapshotBeforeUpdate)}catch(S){Qe(c,c.return,S)}}d&64&&Nv(c),d&512&&Qr(c,c.return);break;case 3:if(wi(s,c),d&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{Sg(s,a)}catch(S){Qe(c,c.return,S)}}break;case 27:a===null&&d&4&&Pv(c);case 26:case 5:wi(s,c),a===null&&d&4&&Dv(c),d&512&&Qr(c,c.return);break;case 12:wi(s,c);break;case 31:wi(s,c),d&4&&Bv(s,c);break;case 13:wi(s,c),d&4&&zv(s,c),d&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=bE.bind(null,c),BE(s,c))));break;case 22:if(d=c.memoizedState!==null||Ri,!d){a=a!==null&&a.memoizedState!==null||Dt,p=Ri;var v=Dt;Ri=d,(Dt=a)&&!v?Mi(s,c,(c.subtreeFlags&8772)!==0):wi(s,c),Ri=p,Dt=v}break;case 30:break;default:wi(s,c)}}function Iv(s){var a=s.alternate;a!==null&&(s.alternate=null,Iv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Ou(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var ct=null,cn=!1;function _i(s,a,c){for(c=c.child;c!==null;)Uv(s,a,c),c=c.sibling}function Uv(s,a,c){if(vn&&typeof vn.onCommitFiberUnmount=="function")try{vn.onCommitFiberUnmount(Sr,c)}catch{}switch(c.tag){case 26:Dt||ii(c,a),_i(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Dt||ii(c,a);var d=ct,p=cn;ls(c.type)&&(ct=c.stateNode,cn=!1),_i(s,a,c),ao(c.stateNode),ct=d,cn=p;break;case 5:Dt||ii(c,a);case 6:if(d=ct,p=cn,ct=null,_i(s,a,c),ct=d,cn=p,ct!==null)if(cn)try{(ct.nodeType===9?ct.body:ct.nodeName==="HTML"?ct.ownerDocument.body:ct).removeChild(c.stateNode)}catch(v){Qe(c,a,v)}else try{ct.removeChild(c.stateNode)}catch(v){Qe(c,a,v)}break;case 18:ct!==null&&(cn?(s=ct,Ny(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Va(s)):Ny(ct,c.stateNode));break;case 4:d=ct,p=cn,ct=c.stateNode.containerInfo,cn=!0,_i(s,a,c),ct=d,cn=p;break;case 0:case 11:case 14:case 15:ns(2,c,a),Dt||ns(4,c,a),_i(s,a,c);break;case 1:Dt||(ii(c,a),d=c.stateNode,typeof d.componentWillUnmount=="function"&&Ov(c,a,d)),_i(s,a,c);break;case 21:_i(s,a,c);break;case 22:Dt=(d=Dt)||c.memoizedState!==null,_i(s,a,c),Dt=d;break;default:_i(s,a,c)}}function Bv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Va(s)}catch(c){Qe(a,a.return,c)}}}function zv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Va(s)}catch(c){Qe(a,a.return,c)}}function dE(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new Lv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new Lv),a;default:throw Error(i(435,s.tag))}}function Hc(s,a){var c=dE(s);a.forEach(function(d){if(!c.has(d)){c.add(d);var p=SE.bind(null,s,d);d.then(p,p)}})}function ln(s,a){var c=a.deletions;if(c!==null)for(var d=0;d<c.length;d++){var p=c[d],v=s,S=a,N=S;e:for(;N!==null;){switch(N.tag){case 27:if(ls(N.type)){ct=N.stateNode,cn=!1;break e}break;case 5:ct=N.stateNode,cn=!1;break e;case 3:case 4:ct=N.stateNode.containerInfo,cn=!0;break e}N=N.return}if(ct===null)throw Error(i(160));Uv(v,S,p),ct=null,cn=!1,v=p.alternate,v!==null&&(v.return=null),p.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Vv(a,s),a=a.sibling}var Hn=null;function Vv(s,a){var c=s.alternate,d=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:ln(a,s),un(s),d&4&&(ns(3,s,s.return),Jr(3,s),ns(5,s,s.return));break;case 1:ln(a,s),un(s),d&512&&(Dt||c===null||ii(c,c.return)),d&64&&Ri&&(s=s.updateQueue,s!==null&&(d=s.callbacks,d!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var p=Hn;if(ln(a,s),un(s),d&512&&(Dt||c===null||ii(c,c.return)),d&4){var v=c!==null?c.memoizedState:null;if(d=s.memoizedState,c===null)if(d===null)if(s.stateNode===null){e:{d=s.type,c=s.memoizedProps,p=p.ownerDocument||p;t:switch(d){case"title":v=p.getElementsByTagName("title")[0],(!v||v[Tr]||v[Vt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=p.createElement(d),p.head.insertBefore(v,p.querySelector("head > title"))),$t(v,d,c),v[Vt]=s,It(v),d=v;break e;case"link":var S=Vy("link","href",p).get(d+(c.href||""));if(S){for(var N=0;N<S.length;N++)if(v=S[N],v.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&v.getAttribute("rel")===(c.rel==null?null:c.rel)&&v.getAttribute("title")===(c.title==null?null:c.title)&&v.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){S.splice(N,1);break t}}v=p.createElement(d),$t(v,d,c),p.head.appendChild(v);break;case"meta":if(S=Vy("meta","content",p).get(d+(c.content||""))){for(N=0;N<S.length;N++)if(v=S[N],v.getAttribute("content")===(c.content==null?null:""+c.content)&&v.getAttribute("name")===(c.name==null?null:c.name)&&v.getAttribute("property")===(c.property==null?null:c.property)&&v.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&v.getAttribute("charset")===(c.charSet==null?null:c.charSet)){S.splice(N,1);break t}}v=p.createElement(d),$t(v,d,c),p.head.appendChild(v);break;default:throw Error(i(468,d))}v[Vt]=s,It(v),d=v}s.stateNode=d}else Fy(p,s.type,s.stateNode);else s.stateNode=zy(p,d,s.memoizedProps);else v!==d?(v===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):v.count--,d===null?Fy(p,s.type,s.stateNode):zy(p,d,s.memoizedProps)):d===null&&s.stateNode!==null&&Wd(s,s.memoizedProps,c.memoizedProps)}break;case 27:ln(a,s),un(s),d&512&&(Dt||c===null||ii(c,c.return)),c!==null&&d&4&&Wd(s,s.memoizedProps,c.memoizedProps);break;case 5:if(ln(a,s),un(s),d&512&&(Dt||c===null||ii(c,c.return)),s.flags&32){p=s.stateNode;try{ua(p,"")}catch(me){Qe(s,s.return,me)}}d&4&&s.stateNode!=null&&(p=s.memoizedProps,Wd(s,p,c!==null?c.memoizedProps:p)),d&1024&&(tf=!0);break;case 6:if(ln(a,s),un(s),d&4){if(s.stateNode===null)throw Error(i(162));d=s.memoizedProps,c=s.stateNode;try{c.nodeValue=d}catch(me){Qe(s,s.return,me)}}break;case 3:if(rl=null,p=Hn,Hn=sl(a.containerInfo),ln(a,s),Hn=p,un(s),d&4&&c!==null&&c.memoizedState.isDehydrated)try{Va(a.containerInfo)}catch(me){Qe(s,s.return,me)}tf&&(tf=!1,Fv(s));break;case 4:d=Hn,Hn=sl(s.stateNode.containerInfo),ln(a,s),un(s),Hn=d;break;case 12:ln(a,s),un(s);break;case 31:ln(a,s),un(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,Hc(s,d)));break;case 13:ln(a,s),un(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Kc=St()),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,Hc(s,d)));break;case 22:p=s.memoizedState!==null;var j=c!==null&&c.memoizedState!==null,K=Ri,Z=Dt;if(Ri=K||p,Dt=Z||j,ln(a,s),Dt=Z,Ri=K,un(s),d&8192)e:for(a=s.stateNode,a._visibility=p?a._visibility&-2:a._visibility|1,p&&(c===null||j||Ri||Dt||Gs(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){j=c=a;try{if(v=j.stateNode,p)S=v.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{N=j.stateNode;var ne=j.memoizedProps.style,G=ne!=null&&ne.hasOwnProperty("display")?ne.display:null;N.style.display=G==null||typeof G=="boolean"?"":(""+G).trim()}}catch(me){Qe(j,j.return,me)}}}else if(a.tag===6){if(c===null){j=a;try{j.stateNode.nodeValue=p?"":j.memoizedProps}catch(me){Qe(j,j.return,me)}}}else if(a.tag===18){if(c===null){j=a;try{var Y=j.stateNode;p?Oy(Y,!0):Oy(j.stateNode,!1)}catch(me){Qe(j,j.return,me)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}d&4&&(d=s.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,Hc(s,c))));break;case 19:ln(a,s),un(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,Hc(s,d)));break;case 30:break;case 21:break;default:ln(a,s),un(s)}}function un(s){var a=s.flags;if(a&2){try{for(var c,d=s.return;d!==null;){if(Av(d)){c=d;break}d=d.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var p=c.stateNode,v=Zd(s);qc(s,v,p);break;case 5:var S=c.stateNode;c.flags&32&&(ua(S,""),c.flags&=-33);var N=Zd(s);qc(s,N,S);break;case 3:case 4:var j=c.stateNode.containerInfo,K=Zd(s);ef(s,K,j);break;default:throw Error(i(161))}}catch(Z){Qe(s,s.return,Z)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function Fv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;Fv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function wi(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)jv(s,a.alternate,a),a=a.sibling}function Gs(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:ns(4,a,a.return),Gs(a);break;case 1:ii(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Ov(a,a.return,c),Gs(a);break;case 27:ao(a.stateNode);case 26:case 5:ii(a,a.return),Gs(a);break;case 22:a.memoizedState===null&&Gs(a);break;case 30:Gs(a);break;default:Gs(a)}s=s.sibling}}function Mi(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var d=a.alternate,p=s,v=a,S=v.flags;switch(v.tag){case 0:case 11:case 15:Mi(p,v,c),Jr(4,v);break;case 1:if(Mi(p,v,c),d=v,p=d.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(K){Qe(d,d.return,K)}if(d=v,p=d.updateQueue,p!==null){var N=d.stateNode;try{var j=p.shared.hiddenCallbacks;if(j!==null)for(p.shared.hiddenCallbacks=null,p=0;p<j.length;p++)bg(j[p],N)}catch(K){Qe(d,d.return,K)}}c&&S&64&&Nv(v),Qr(v,v.return);break;case 27:Pv(v);case 26:case 5:Mi(p,v,c),c&&d===null&&S&4&&Dv(v),Qr(v,v.return);break;case 12:Mi(p,v,c);break;case 31:Mi(p,v,c),c&&S&4&&Bv(p,v);break;case 13:Mi(p,v,c),c&&S&4&&zv(p,v);break;case 22:v.memoizedState===null&&Mi(p,v,c),Qr(v,v.return);break;case 30:break;default:Mi(p,v,c)}a=a.sibling}}function nf(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&jr(c))}function sf(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&jr(s))}function $n(s,a,c,d){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)qv(s,a,c,d),a=a.sibling}function qv(s,a,c,d){var p=a.flags;switch(a.tag){case 0:case 11:case 15:$n(s,a,c,d),p&2048&&Jr(9,a);break;case 1:$n(s,a,c,d);break;case 3:$n(s,a,c,d),p&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&jr(s)));break;case 12:if(p&2048){$n(s,a,c,d),s=a.stateNode;try{var v=a.memoizedProps,S=v.id,N=v.onPostCommit;typeof N=="function"&&N(S,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(j){Qe(a,a.return,j)}}else $n(s,a,c,d);break;case 31:$n(s,a,c,d);break;case 13:$n(s,a,c,d);break;case 23:break;case 22:v=a.stateNode,S=a.alternate,a.memoizedState!==null?v._visibility&2?$n(s,a,c,d):Xr(s,a):v._visibility&2?$n(s,a,c,d):(v._visibility|=2,Na(s,a,c,d,(a.subtreeFlags&10256)!==0||!1)),p&2048&&nf(S,a);break;case 24:$n(s,a,c,d),p&2048&&sf(a.alternate,a);break;default:$n(s,a,c,d)}}function Na(s,a,c,d,p){for(p=p&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var v=s,S=a,N=c,j=d,K=S.flags;switch(S.tag){case 0:case 11:case 15:Na(v,S,N,j,p),Jr(8,S);break;case 23:break;case 22:var Z=S.stateNode;S.memoizedState!==null?Z._visibility&2?Na(v,S,N,j,p):Xr(v,S):(Z._visibility|=2,Na(v,S,N,j,p)),p&&K&2048&&nf(S.alternate,S);break;case 24:Na(v,S,N,j,p),p&&K&2048&&sf(S.alternate,S);break;default:Na(v,S,N,j,p)}a=a.sibling}}function Xr(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,d=a,p=d.flags;switch(d.tag){case 22:Xr(c,d),p&2048&&nf(d.alternate,d);break;case 24:Xr(c,d),p&2048&&sf(d.alternate,d);break;default:Xr(c,d)}a=a.sibling}}var Wr=8192;function Oa(s,a,c){if(s.subtreeFlags&Wr)for(s=s.child;s!==null;)Hv(s,a,c),s=s.sibling}function Hv(s,a,c){switch(s.tag){case 26:Oa(s,a,c),s.flags&Wr&&s.memoizedState!==null&&XE(c,Hn,s.memoizedState,s.memoizedProps);break;case 5:Oa(s,a,c);break;case 3:case 4:var d=Hn;Hn=sl(s.stateNode.containerInfo),Oa(s,a,c),Hn=d;break;case 22:s.memoizedState===null&&(d=s.alternate,d!==null&&d.memoizedState!==null?(d=Wr,Wr=16777216,Oa(s,a,c),Wr=d):Oa(s,a,c));break;default:Oa(s,a,c)}}function $v(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function Zr(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var d=a[c];Ut=d,Gv(d,s)}$v(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Kv(s),s=s.sibling}function Kv(s){switch(s.tag){case 0:case 11:case 15:Zr(s),s.flags&2048&&ns(9,s,s.return);break;case 3:Zr(s);break;case 12:Zr(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,$c(s)):Zr(s);break;default:Zr(s)}}function $c(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var d=a[c];Ut=d,Gv(d,s)}$v(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:ns(8,a,a.return),$c(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,$c(a));break;default:$c(a)}s=s.sibling}}function Gv(s,a){for(;Ut!==null;){var c=Ut;switch(c.tag){case 0:case 11:case 15:ns(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:jr(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,Ut=d;else e:for(c=s;Ut!==null;){d=Ut;var p=d.sibling,v=d.return;if(Iv(d),d===c){Ut=null;break e}if(p!==null){p.return=v,Ut=p;break e}Ut=v}}}var fE={getCacheForType:function(s){var a=qt(Mt),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return qt(Mt).controller.signal}},hE=typeof WeakMap=="function"?WeakMap:Map,Ge=0,nt=null,Le=null,Be=0,Je=0,Tn=null,is=!1,Da=!1,af=!1,Ni=0,pt=0,ss=0,Ys=0,rf=0,En=0,Aa=0,eo=null,dn=null,of=!1,Kc=0,Yv=0,Gc=1/0,Yc=null,as=null,Lt=0,rs=null,Pa=null,Oi=0,cf=0,lf=null,Jv=null,to=0,uf=null;function xn(){return(Ge&2)!==0&&Be!==0?Be&-Be:H.T!==null?gf():dp()}function Qv(){if(En===0)if((Be&536870912)===0||Fe){var s=nc;nc<<=1,(nc&3932160)===0&&(nc=262144),En=s}else En=536870912;return s=Cn.current,s!==null&&(s.flags|=32),En}function fn(s,a,c){(s===nt&&(Je===2||Je===9)||s.cancelPendingCommit!==null)&&(La(s,0),os(s,Be,En,!1)),kr(s,c),((Ge&2)===0||s!==nt)&&(s===nt&&((Ge&2)===0&&(Ys|=c),pt===4&&os(s,Be,En,!1)),si(s))}function Xv(s,a,c){if((Ge&6)!==0)throw Error(i(327));var d=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Cr(s,a),p=d?gE(s,a):ff(s,a,!0),v=d;do{if(p===0){Da&&!d&&os(s,a,0,!1);break}else{if(c=s.current.alternate,v&&!mE(c)){p=ff(s,a,!1),v=!1;continue}if(p===2){if(v=a,s.errorRecoveryDisabledLanes&v)var S=0;else S=s.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){a=S;e:{var N=s;p=eo;var j=N.current.memoizedState.isDehydrated;if(j&&(La(N,S).flags|=256),S=ff(N,S,!1),S!==2){if(af&&!j){N.errorRecoveryDisabledLanes|=v,Ys|=v,p=4;break e}v=dn,dn=p,v!==null&&(dn===null?dn=v:dn.push.apply(dn,v))}p=S}if(v=!1,p!==2)continue}}if(p===1){La(s,0),os(s,a,0,!0);break}e:{switch(d=s,v=p,v){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:os(d,a,En,!is);break e;case 2:dn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(p=Kc+300-St(),10<p)){if(os(d,a,En,!is),sc(d,0,!0)!==0)break e;Oi=a,d.timeoutHandle=wy(Wv.bind(null,d,c,dn,Yc,of,a,En,Ys,Aa,is,v,"Throttled",-0,0),p);break e}Wv(d,c,dn,Yc,of,a,En,Ys,Aa,is,v,null,-0,0)}}break}while(!0);si(s)}function Wv(s,a,c,d,p,v,S,N,j,K,Z,ne,G,Y){if(s.timeoutHandle=-1,ne=a.subtreeFlags,ne&8192||(ne&16785408)===16785408){ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:gi},Hv(a,v,ne);var me=(v&62914560)===v?Kc-St():(v&4194048)===v?Yv-St():0;if(me=WE(ne,me),me!==null){Oi=v,s.cancelPendingCommit=me(ry.bind(null,s,a,v,c,d,p,S,N,j,Z,ne,null,G,Y)),os(s,v,S,!K);return}}ry(s,a,v,c,d,p,S,N,j)}function mE(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var p=c[d],v=p.getSnapshot;p=p.value;try{if(!bn(v(),p))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function os(s,a,c,d){a&=~rf,a&=~Ys,s.suspendedLanes|=a,s.pingedLanes&=~a,d&&(s.warmLanes|=a),d=s.expirationTimes;for(var p=a;0<p;){var v=31-yn(p),S=1<<v;d[v]=-1,p&=~S}c!==0&&cp(s,c,a)}function Jc(){return(Ge&6)===0?(no(0),!1):!0}function df(){if(Le!==null){if(Je===0)var s=Le.return;else s=Le,Si=Bs=null,Rd(s),xa=null,Ur=0,s=Le;for(;s!==null;)Mv(s.alternate,s),s=s.return;Le=null}}function La(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,PE(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),Oi=0,df(),nt=s,Le=c=yi(s.current,null),Be=a,Je=0,Tn=null,is=!1,Da=Cr(s,a),af=!1,Aa=En=rf=Ys=ss=pt=0,dn=eo=null,of=!1,(a&8)!==0&&(a|=a&32);var d=s.entangledLanes;if(d!==0)for(s=s.entanglements,d&=a;0<d;){var p=31-yn(d),v=1<<p;a|=s[p],d&=~v}return Ni=a,gc(),c}function Zv(s,a){Ne=null,H.H=Kr,a===Ea||a===Ec?(a=pg(),Je=3):a===md?(a=pg(),Je=4):Je=a===Fd?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Tn=a,Le===null&&(pt=1,Uc(s,Dn(a,s.current)))}function ey(){var s=Cn.current;return s===null?!0:(Be&4194048)===Be?jn===null:(Be&62914560)===Be||(Be&536870912)!==0?s===jn:!1}function ty(){var s=H.H;return H.H=Kr,s===null?Kr:s}function ny(){var s=H.A;return H.A=fE,s}function Qc(){pt=4,is||(Be&4194048)!==Be&&Cn.current!==null||(Da=!0),(ss&134217727)===0&&(Ys&134217727)===0||nt===null||os(nt,Be,En,!1)}function ff(s,a,c){var d=Ge;Ge|=2;var p=ty(),v=ny();(nt!==s||Be!==a)&&(Yc=null,La(s,a)),a=!1;var S=pt;e:do try{if(Je!==0&&Le!==null){var N=Le,j=Tn;switch(Je){case 8:df(),S=6;break e;case 3:case 2:case 9:case 6:Cn.current===null&&(a=!0);var K=Je;if(Je=0,Tn=null,ja(s,N,j,K),c&&Da){S=0;break e}break;default:K=Je,Je=0,Tn=null,ja(s,N,j,K)}}pE(),S=pt;break}catch(Z){Zv(s,Z)}while(!0);return a&&s.shellSuspendCounter++,Si=Bs=null,Ge=d,H.H=p,H.A=v,Le===null&&(nt=null,Be=0,gc()),S}function pE(){for(;Le!==null;)iy(Le)}function gE(s,a){var c=Ge;Ge|=2;var d=ty(),p=ny();nt!==s||Be!==a?(Yc=null,Gc=St()+500,La(s,a)):Da=Cr(s,a);e:do try{if(Je!==0&&Le!==null){a=Le;var v=Tn;t:switch(Je){case 1:Je=0,Tn=null,ja(s,a,v,1);break;case 2:case 9:if(hg(v)){Je=0,Tn=null,sy(a);break}a=function(){Je!==2&&Je!==9||nt!==s||(Je=7),si(s)},v.then(a,a);break e;case 3:Je=7;break e;case 4:Je=5;break e;case 7:hg(v)?(Je=0,Tn=null,sy(a)):(Je=0,Tn=null,ja(s,a,v,7));break;case 5:var S=null;switch(Le.tag){case 26:S=Le.memoizedState;case 5:case 27:var N=Le;if(S?qy(S):N.stateNode.complete){Je=0,Tn=null;var j=N.sibling;if(j!==null)Le=j;else{var K=N.return;K!==null?(Le=K,Xc(K)):Le=null}break t}}Je=0,Tn=null,ja(s,a,v,5);break;case 6:Je=0,Tn=null,ja(s,a,v,6);break;case 8:df(),pt=6;break e;default:throw Error(i(462))}}vE();break}catch(Z){Zv(s,Z)}while(!0);return Si=Bs=null,H.H=d,H.A=p,Ge=c,Le!==null?0:(nt=null,Be=0,gc(),pt)}function vE(){for(;Le!==null&&!bt();)iy(Le)}function iy(s){var a=_v(s.alternate,s,Ni);s.memoizedProps=s.pendingProps,a===null?Xc(s):Le=a}function sy(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Cv(c,a,a.pendingProps,a.type,void 0,Be);break;case 11:a=Cv(c,a,a.pendingProps,a.type.render,a.ref,Be);break;case 5:Rd(a);default:Mv(c,a),a=Le=ng(a,Ni),a=_v(c,a,Ni)}s.memoizedProps=s.pendingProps,a===null?Xc(s):Le=a}function ja(s,a,c,d){Si=Bs=null,Rd(a),xa=null,Ur=0;var p=a.return;try{if(aE(s,p,a,c,Be)){pt=1,Uc(s,Dn(c,s.current)),Le=null;return}}catch(v){if(p!==null)throw Le=p,v;pt=1,Uc(s,Dn(c,s.current)),Le=null;return}a.flags&32768?(Fe||d===1?s=!0:Da||(Be&536870912)!==0?s=!1:(is=s=!0,(d===2||d===9||d===3||d===6)&&(d=Cn.current,d!==null&&d.tag===13&&(d.flags|=16384))),ay(a,s)):Xc(a)}function Xc(s){var a=s;do{if((a.flags&32768)!==0){ay(a,is);return}s=a.return;var c=cE(a.alternate,a,Ni);if(c!==null){Le=c;return}if(a=a.sibling,a!==null){Le=a;return}Le=a=s}while(a!==null);pt===0&&(pt=5)}function ay(s,a){do{var c=lE(s.alternate,s);if(c!==null){c.flags&=32767,Le=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){Le=s;return}Le=s=c}while(s!==null);pt=6,Le=null}function ry(s,a,c,d,p,v,S,N,j){s.cancelPendingCommit=null;do Wc();while(Lt!==0);if((Ge&6)!==0)throw Error(i(327));if(a!==null){if(a===s.current)throw Error(i(177));if(v=a.lanes|a.childLanes,v|=Zu,QT(s,c,v,S,N,j),s===nt&&(Le=nt=null,Be=0),Pa=a,rs=s,Oi=c,cf=v,lf=p,Jv=d,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,CE(ec,function(){return dy(),null})):(s.callbackNode=null,s.callbackPriority=0),d=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||d){d=H.T,H.T=null,p=re.p,re.p=2,S=Ge,Ge|=4;try{uE(s,a,c)}finally{Ge=S,re.p=p,H.T=d}}Lt=1,oy(),cy(),ly()}}function oy(){if(Lt===1){Lt=0;var s=rs,a=Pa,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=H.T,H.T=null;var d=re.p;re.p=2;var p=Ge;Ge|=4;try{Vv(a,s);var v=Ef,S=Gp(s.containerInfo),N=v.focusedElem,j=v.selectionRange;if(S!==N&&N&&N.ownerDocument&&Kp(N.ownerDocument.documentElement,N)){if(j!==null&&Yu(N)){var K=j.start,Z=j.end;if(Z===void 0&&(Z=K),"selectionStart"in N)N.selectionStart=K,N.selectionEnd=Math.min(Z,N.value.length);else{var ne=N.ownerDocument||document,G=ne&&ne.defaultView||window;if(G.getSelection){var Y=G.getSelection(),me=N.textContent.length,Ce=Math.min(j.start,me),et=j.end===void 0?Ce:Math.min(j.end,me);!Y.extend&&Ce>et&&(S=et,et=Ce,Ce=S);var F=$p(N,Ce),U=$p(N,et);if(F&&U&&(Y.rangeCount!==1||Y.anchorNode!==F.node||Y.anchorOffset!==F.offset||Y.focusNode!==U.node||Y.focusOffset!==U.offset)){var $=ne.createRange();$.setStart(F.node,F.offset),Y.removeAllRanges(),Ce>et?(Y.addRange($),Y.extend(U.node,U.offset)):($.setEnd(U.node,U.offset),Y.addRange($))}}}}for(ne=[],Y=N;Y=Y.parentNode;)Y.nodeType===1&&ne.push({element:Y,left:Y.scrollLeft,top:Y.scrollTop});for(typeof N.focus=="function"&&N.focus(),N=0;N<ne.length;N++){var te=ne[N];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}ul=!!Tf,Ef=Tf=null}finally{Ge=p,re.p=d,H.T=c}}s.current=a,Lt=2}}function cy(){if(Lt===2){Lt=0;var s=rs,a=Pa,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=H.T,H.T=null;var d=re.p;re.p=2;var p=Ge;Ge|=4;try{jv(s,a.alternate,a)}finally{Ge=p,re.p=d,H.T=c}}Lt=3}}function ly(){if(Lt===4||Lt===3){Lt=0,wt();var s=rs,a=Pa,c=Oi,d=Jv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Lt=5:(Lt=0,Pa=rs=null,uy(s,s.pendingLanes));var p=s.pendingLanes;if(p===0&&(as=null),Mu(c),a=a.stateNode,vn&&typeof vn.onCommitFiberRoot=="function")try{vn.onCommitFiberRoot(Sr,a,void 0,(a.current.flags&128)===128)}catch{}if(d!==null){a=H.T,p=re.p,re.p=2,H.T=null;try{for(var v=s.onRecoverableError,S=0;S<d.length;S++){var N=d[S];v(N.value,{componentStack:N.stack})}}finally{H.T=a,re.p=p}}(Oi&3)!==0&&Wc(),si(s),p=s.pendingLanes,(c&261930)!==0&&(p&42)!==0?s===uf?to++:(to=0,uf=s):to=0,no(0)}}function uy(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,jr(a)))}function Wc(){return oy(),cy(),ly(),dy()}function dy(){if(Lt!==5)return!1;var s=rs,a=cf;cf=0;var c=Mu(Oi),d=H.T,p=re.p;try{re.p=32>c?32:c,H.T=null,c=lf,lf=null;var v=rs,S=Oi;if(Lt=0,Pa=rs=null,Oi=0,(Ge&6)!==0)throw Error(i(331));var N=Ge;if(Ge|=4,Kv(v.current),qv(v,v.current,S,c),Ge=N,no(0,!1),vn&&typeof vn.onPostCommitFiberRoot=="function")try{vn.onPostCommitFiberRoot(Sr,v)}catch{}return!0}finally{re.p=p,H.T=d,uy(s,a)}}function fy(s,a,c){a=Dn(c,a),a=Vd(s.stateNode,a,2),s=Zi(s,a,2),s!==null&&(kr(s,2),si(s))}function Qe(s,a,c){if(s.tag===3)fy(s,s,c);else for(;a!==null;){if(a.tag===3){fy(a,s,c);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(as===null||!as.has(d))){s=Dn(c,s),c=hv(2),d=Zi(a,c,2),d!==null&&(mv(c,d,a,s),kr(d,2),si(d));break}}a=a.return}}function hf(s,a,c){var d=s.pingCache;if(d===null){d=s.pingCache=new hE;var p=new Set;d.set(a,p)}else p=d.get(a),p===void 0&&(p=new Set,d.set(a,p));p.has(c)||(af=!0,p.add(c),s=yE.bind(null,s,a,c),a.then(s,s))}function yE(s,a,c){var d=s.pingCache;d!==null&&d.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,nt===s&&(Be&c)===c&&(pt===4||pt===3&&(Be&62914560)===Be&&300>St()-Kc?(Ge&2)===0&&La(s,0):rf|=c,Aa===Be&&(Aa=0)),si(s)}function hy(s,a){a===0&&(a=op()),s=js(s,a),s!==null&&(kr(s,a),si(s))}function bE(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),hy(s,c)}function SE(s,a){var c=0;switch(s.tag){case 31:case 13:var d=s.stateNode,p=s.memoizedState;p!==null&&(c=p.retryLane);break;case 19:d=s.stateNode;break;case 22:d=s.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(a),hy(s,c)}function CE(s,a){return ft(s,a)}var Zc=null,Ia=null,mf=!1,el=!1,pf=!1,cs=0;function si(s){s!==Ia&&s.next===null&&(Ia===null?Zc=Ia=s:Ia=Ia.next=s),el=!0,mf||(mf=!0,TE())}function no(s,a){if(!pf&&el){pf=!0;do for(var c=!1,d=Zc;d!==null;){if(s!==0){var p=d.pendingLanes;if(p===0)var v=0;else{var S=d.suspendedLanes,N=d.pingedLanes;v=(1<<31-yn(42|s)+1)-1,v&=p&~(S&~N),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(c=!0,vy(d,v))}else v=Be,v=sc(d,d===nt?v:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(v&3)===0||Cr(d,v)||(c=!0,vy(d,v));d=d.next}while(c);pf=!1}}function kE(){my()}function my(){el=mf=!1;var s=0;cs!==0&&AE()&&(s=cs);for(var a=St(),c=null,d=Zc;d!==null;){var p=d.next,v=py(d,a);v===0?(d.next=null,c===null?Zc=p:c.next=p,p===null&&(Ia=c)):(c=d,(s!==0||(v&3)!==0)&&(el=!0)),d=p}Lt!==0&&Lt!==5||no(s),cs!==0&&(cs=0)}function py(s,a){for(var c=s.suspendedLanes,d=s.pingedLanes,p=s.expirationTimes,v=s.pendingLanes&-62914561;0<v;){var S=31-yn(v),N=1<<S,j=p[S];j===-1?((N&c)===0||(N&d)!==0)&&(p[S]=JT(N,a)):j<=a&&(s.expiredLanes|=N),v&=~N}if(a=nt,c=Be,c=sc(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d=s.callbackNode,c===0||s===a&&(Je===2||Je===9)||s.cancelPendingCommit!==null)return d!==null&&d!==null&&Pt(d),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Cr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(d!==null&&Pt(d),Mu(c)){case 2:case 8:c=ap;break;case 32:c=ec;break;case 268435456:c=rp;break;default:c=ec}return d=gy.bind(null,s),c=ft(c,d),s.callbackPriority=a,s.callbackNode=c,a}return d!==null&&d!==null&&Pt(d),s.callbackPriority=2,s.callbackNode=null,2}function gy(s,a){if(Lt!==0&&Lt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Wc()&&s.callbackNode!==c)return null;var d=Be;return d=sc(s,s===nt?d:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d===0?null:(Xv(s,d,a),py(s,St()),s.callbackNode!=null&&s.callbackNode===c?gy.bind(null,s):null)}function vy(s,a){if(Wc())return null;Xv(s,a,!0)}function TE(){LE(function(){(Ge&6)!==0?ft(gn,kE):my()})}function gf(){if(cs===0){var s=ka;s===0&&(s=tc,tc<<=1,(tc&261888)===0&&(tc=256)),cs=s}return cs}function yy(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:cc(""+s)}function by(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function EE(s,a,c,d,p){if(a==="submit"&&c&&c.stateNode===p){var v=yy((p[rn]||null).action),S=d.submitter;S&&(a=(a=S[rn]||null)?yy(a.formAction):S.getAttribute("formAction"),a!==null&&(v=a,S=null));var N=new fc("action","action",null,d,p);s.push({event:N,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(cs!==0){var j=S?by(p,S):new FormData(p);Ld(c,{pending:!0,data:j,method:p.method,action:v},null,j)}}else typeof v=="function"&&(N.preventDefault(),j=S?by(p,S):new FormData(p),Ld(c,{pending:!0,data:j,method:p.method,action:v},v,j))},currentTarget:p}]})}}for(var vf=0;vf<Wu.length;vf++){var yf=Wu[vf],xE=yf.toLowerCase(),RE=yf[0].toUpperCase()+yf.slice(1);qn(xE,"on"+RE)}qn(Qp,"onAnimationEnd"),qn(Xp,"onAnimationIteration"),qn(Wp,"onAnimationStart"),qn("dblclick","onDoubleClick"),qn("focusin","onFocus"),qn("focusout","onBlur"),qn(F1,"onTransitionRun"),qn(q1,"onTransitionStart"),qn(H1,"onTransitionCancel"),qn(Zp,"onTransitionEnd"),ca("onMouseEnter",["mouseout","mouseover"]),ca("onMouseLeave",["mouseout","mouseover"]),ca("onPointerEnter",["pointerout","pointerover"]),ca("onPointerLeave",["pointerout","pointerover"]),Ds("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ds("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ds("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ds("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ds("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ds("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var io="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_E=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(io));function Sy(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var d=s[c],p=d.event;d=d.listeners;e:{var v=void 0;if(a)for(var S=d.length-1;0<=S;S--){var N=d[S],j=N.instance,K=N.currentTarget;if(N=N.listener,j!==v&&p.isPropagationStopped())break e;v=N,p.currentTarget=K;try{v(p)}catch(Z){pc(Z)}p.currentTarget=null,v=j}else for(S=0;S<d.length;S++){if(N=d[S],j=N.instance,K=N.currentTarget,N=N.listener,j!==v&&p.isPropagationStopped())break e;v=N,p.currentTarget=K;try{v(p)}catch(Z){pc(Z)}p.currentTarget=null,v=j}}}}function je(s,a){var c=a[Nu];c===void 0&&(c=a[Nu]=new Set);var d=s+"__bubble";c.has(d)||(Cy(a,s,2,!1),c.add(d))}function bf(s,a,c){var d=0;a&&(d|=4),Cy(c,s,d,a)}var tl="_reactListening"+Math.random().toString(36).slice(2);function Sf(s){if(!s[tl]){s[tl]=!0,mp.forEach(function(c){c!=="selectionchange"&&(_E.has(c)||bf(c,!1,s),bf(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[tl]||(a[tl]=!0,bf("selectionchange",!1,a))}}function Cy(s,a,c,d){switch(Qy(a)){case 2:var p=tx;break;case 8:p=nx;break;default:p=Lf}c=p.bind(null,a,c,s),p=void 0,!Bu||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(p=!0),d?p!==void 0?s.addEventListener(a,c,{capture:!0,passive:p}):s.addEventListener(a,c,!0):p!==void 0?s.addEventListener(a,c,{passive:p}):s.addEventListener(a,c,!1)}function Cf(s,a,c,d,p){var v=d;if((a&1)===0&&(a&2)===0&&d!==null)e:for(;;){if(d===null)return;var S=d.tag;if(S===3||S===4){var N=d.stateNode.containerInfo;if(N===p)break;if(S===4)for(S=d.return;S!==null;){var j=S.tag;if((j===3||j===4)&&S.stateNode.containerInfo===p)return;S=S.return}for(;N!==null;){if(S=aa(N),S===null)return;if(j=S.tag,j===5||j===6||j===26||j===27){d=v=S;continue e}N=N.parentNode}}d=d.return}Rp(function(){var K=v,Z=Iu(c),ne=[];e:{var G=eg.get(s);if(G!==void 0){var Y=fc,me=s;switch(s){case"keypress":if(uc(c)===0)break e;case"keydown":case"keyup":Y=S1;break;case"focusin":me="focus",Y=qu;break;case"focusout":me="blur",Y=qu;break;case"beforeblur":case"afterblur":Y=qu;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=Mp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=c1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=T1;break;case Qp:case Xp:case Wp:Y=d1;break;case Zp:Y=x1;break;case"scroll":case"scrollend":Y=r1;break;case"wheel":Y=_1;break;case"copy":case"cut":case"paste":Y=h1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=Op;break;case"toggle":case"beforetoggle":Y=M1}var Ce=(a&4)!==0,et=!Ce&&(s==="scroll"||s==="scrollend"),F=Ce?G!==null?G+"Capture":null:G;Ce=[];for(var U=K,$;U!==null;){var te=U;if($=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||$===null||F===null||(te=xr(U,F),te!=null&&Ce.push(so(U,te,$))),et)break;U=U.return}0<Ce.length&&(G=new Y(G,me,null,c,Z),ne.push({event:G,listeners:Ce}))}}if((a&7)===0){e:{if(G=s==="mouseover"||s==="pointerover",Y=s==="mouseout"||s==="pointerout",G&&c!==ju&&(me=c.relatedTarget||c.fromElement)&&(aa(me)||me[sa]))break e;if((Y||G)&&(G=Z.window===Z?Z:(G=Z.ownerDocument)?G.defaultView||G.parentWindow:window,Y?(me=c.relatedTarget||c.toElement,Y=K,me=me?aa(me):null,me!==null&&(et=o(me),Ce=me.tag,me!==et||Ce!==5&&Ce!==27&&Ce!==6)&&(me=null)):(Y=null,me=K),Y!==me)){if(Ce=Mp,te="onMouseLeave",F="onMouseEnter",U="mouse",(s==="pointerout"||s==="pointerover")&&(Ce=Op,te="onPointerLeave",F="onPointerEnter",U="pointer"),et=Y==null?G:Er(Y),$=me==null?G:Er(me),G=new Ce(te,U+"leave",Y,c,Z),G.target=et,G.relatedTarget=$,te=null,aa(Z)===K&&(Ce=new Ce(F,U+"enter",me,c,Z),Ce.target=$,Ce.relatedTarget=et,te=Ce),et=te,Y&&me)t:{for(Ce=wE,F=Y,U=me,$=0,te=F;te;te=Ce(te))$++;te=0;for(var ye=U;ye;ye=Ce(ye))te++;for(;0<$-te;)F=Ce(F),$--;for(;0<te-$;)U=Ce(U),te--;for(;$--;){if(F===U||U!==null&&F===U.alternate){Ce=F;break t}F=Ce(F),U=Ce(U)}Ce=null}else Ce=null;Y!==null&&ky(ne,G,Y,Ce,!1),me!==null&&et!==null&&ky(ne,et,me,Ce,!0)}}e:{if(G=K?Er(K):window,Y=G.nodeName&&G.nodeName.toLowerCase(),Y==="select"||Y==="input"&&G.type==="file")var He=Bp;else if(Ip(G))if(zp)He=B1;else{He=I1;var ge=j1}else Y=G.nodeName,!Y||Y.toLowerCase()!=="input"||G.type!=="checkbox"&&G.type!=="radio"?K&&Lu(K.elementType)&&(He=Bp):He=U1;if(He&&(He=He(s,K))){Up(ne,He,c,Z);break e}ge&&ge(s,G,K),s==="focusout"&&K&&G.type==="number"&&K.memoizedProps.value!=null&&Pu(G,"number",G.value)}switch(ge=K?Er(K):window,s){case"focusin":(Ip(ge)||ge.contentEditable==="true")&&(ma=ge,Ju=K,Ar=null);break;case"focusout":Ar=Ju=ma=null;break;case"mousedown":Qu=!0;break;case"contextmenu":case"mouseup":case"dragend":Qu=!1,Yp(ne,c,Z);break;case"selectionchange":if(V1)break;case"keydown":case"keyup":Yp(ne,c,Z)}var Oe;if($u)e:{switch(s){case"compositionstart":var ze="onCompositionStart";break e;case"compositionend":ze="onCompositionEnd";break e;case"compositionupdate":ze="onCompositionUpdate";break e}ze=void 0}else ha?Lp(s,c)&&(ze="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(ze="onCompositionStart");ze&&(Dp&&c.locale!=="ko"&&(ha||ze!=="onCompositionStart"?ze==="onCompositionEnd"&&ha&&(Oe=_p()):(Ki=Z,zu="value"in Ki?Ki.value:Ki.textContent,ha=!0)),ge=nl(K,ze),0<ge.length&&(ze=new Np(ze,s,null,c,Z),ne.push({event:ze,listeners:ge}),Oe?ze.data=Oe:(Oe=jp(c),Oe!==null&&(ze.data=Oe)))),(Oe=O1?D1(s,c):A1(s,c))&&(ze=nl(K,"onBeforeInput"),0<ze.length&&(ge=new Np("onBeforeInput","beforeinput",null,c,Z),ne.push({event:ge,listeners:ze}),ge.data=Oe)),EE(ne,s,K,c,Z)}Sy(ne,a)})}function so(s,a,c){return{instance:s,listener:a,currentTarget:c}}function nl(s,a){for(var c=a+"Capture",d=[];s!==null;){var p=s,v=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||v===null||(p=xr(s,c),p!=null&&d.unshift(so(s,p,v)),p=xr(s,a),p!=null&&d.push(so(s,p,v))),s.tag===3)return d;s=s.return}return[]}function wE(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function ky(s,a,c,d,p){for(var v=a._reactName,S=[];c!==null&&c!==d;){var N=c,j=N.alternate,K=N.stateNode;if(N=N.tag,j!==null&&j===d)break;N!==5&&N!==26&&N!==27||K===null||(j=K,p?(K=xr(c,v),K!=null&&S.unshift(so(c,K,j))):p||(K=xr(c,v),K!=null&&S.push(so(c,K,j)))),c=c.return}S.length!==0&&s.push({event:a,listeners:S})}var ME=/\r\n?/g,NE=/\u0000|\uFFFD/g;function Ty(s){return(typeof s=="string"?s:""+s).replace(ME,`
`).replace(NE,"")}function Ey(s,a){return a=Ty(a),Ty(s)===a}function Ze(s,a,c,d,p,v){switch(c){case"children":typeof d=="string"?a==="body"||a==="textarea"&&d===""||ua(s,d):(typeof d=="number"||typeof d=="bigint")&&a!=="body"&&ua(s,""+d);break;case"className":rc(s,"class",d);break;case"tabIndex":rc(s,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":rc(s,c,d);break;case"style":Ep(s,d,v);break;case"data":if(a!=="object"){rc(s,"data",d);break}case"src":case"href":if(d===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(c);break}d=cc(""+d),s.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(c==="formAction"?(a!=="input"&&Ze(s,a,"name",p.name,p,null),Ze(s,a,"formEncType",p.formEncType,p,null),Ze(s,a,"formMethod",p.formMethod,p,null),Ze(s,a,"formTarget",p.formTarget,p,null)):(Ze(s,a,"encType",p.encType,p,null),Ze(s,a,"method",p.method,p,null),Ze(s,a,"target",p.target,p,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(c);break}d=cc(""+d),s.setAttribute(c,d);break;case"onClick":d!=null&&(s.onclick=gi);break;case"onScroll":d!=null&&je("scroll",s);break;case"onScrollEnd":d!=null&&je("scrollend",s);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(c=d.__html,c!=null){if(p.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"multiple":s.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":s.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){s.removeAttribute("xlink:href");break}c=cc(""+d),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(c,""+d):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":d===!0?s.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(c,d):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?s.setAttribute(c,d):s.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?s.removeAttribute(c):s.setAttribute(c,d);break;case"popover":je("beforetoggle",s),je("toggle",s),ac(s,"popover",d);break;case"xlinkActuate":pi(s,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":pi(s,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":pi(s,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":pi(s,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":pi(s,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":pi(s,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":pi(s,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":pi(s,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":pi(s,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":ac(s,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=s1.get(c)||c,ac(s,c,d))}}function kf(s,a,c,d,p,v){switch(c){case"style":Ep(s,d,v);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(c=d.__html,c!=null){if(p.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"children":typeof d=="string"?ua(s,d):(typeof d=="number"||typeof d=="bigint")&&ua(s,""+d);break;case"onScroll":d!=null&&je("scroll",s);break;case"onScrollEnd":d!=null&&je("scrollend",s);break;case"onClick":d!=null&&(s.onclick=gi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!pp.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(p=c.endsWith("Capture"),a=c.slice(2,p?c.length-7:void 0),v=s[rn]||null,v=v!=null?v[c]:null,typeof v=="function"&&s.removeEventListener(a,v,p),typeof d=="function")){typeof v!="function"&&v!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,d,p);break e}c in s?s[c]=d:d===!0?s.setAttribute(c,""):ac(s,c,d)}}}function $t(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":je("error",s),je("load",s);var d=!1,p=!1,v;for(v in c)if(c.hasOwnProperty(v)){var S=c[v];if(S!=null)switch(v){case"src":d=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ze(s,a,v,S,c,null)}}p&&Ze(s,a,"srcSet",c.srcSet,c,null),d&&Ze(s,a,"src",c.src,c,null);return;case"input":je("invalid",s);var N=v=S=p=null,j=null,K=null;for(d in c)if(c.hasOwnProperty(d)){var Z=c[d];if(Z!=null)switch(d){case"name":p=Z;break;case"type":S=Z;break;case"checked":j=Z;break;case"defaultChecked":K=Z;break;case"value":v=Z;break;case"defaultValue":N=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,a));break;default:Ze(s,a,d,Z,c,null)}}Sp(s,v,N,j,K,S,p,!1);return;case"select":je("invalid",s),d=S=v=null;for(p in c)if(c.hasOwnProperty(p)&&(N=c[p],N!=null))switch(p){case"value":v=N;break;case"defaultValue":S=N;break;case"multiple":d=N;default:Ze(s,a,p,N,c,null)}a=v,c=S,s.multiple=!!d,a!=null?la(s,!!d,a,!1):c!=null&&la(s,!!d,c,!0);return;case"textarea":je("invalid",s),v=p=d=null;for(S in c)if(c.hasOwnProperty(S)&&(N=c[S],N!=null))switch(S){case"value":d=N;break;case"defaultValue":p=N;break;case"children":v=N;break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(i(91));break;default:Ze(s,a,S,N,c,null)}kp(s,d,p,v);return;case"option":for(j in c)c.hasOwnProperty(j)&&(d=c[j],d!=null)&&(j==="selected"?s.selected=d&&typeof d!="function"&&typeof d!="symbol":Ze(s,a,j,d,c,null));return;case"dialog":je("beforetoggle",s),je("toggle",s),je("cancel",s),je("close",s);break;case"iframe":case"object":je("load",s);break;case"video":case"audio":for(d=0;d<io.length;d++)je(io[d],s);break;case"image":je("error",s),je("load",s);break;case"details":je("toggle",s);break;case"embed":case"source":case"link":je("error",s),je("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(K in c)if(c.hasOwnProperty(K)&&(d=c[K],d!=null))switch(K){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ze(s,a,K,d,c,null)}return;default:if(Lu(a)){for(Z in c)c.hasOwnProperty(Z)&&(d=c[Z],d!==void 0&&kf(s,a,Z,d,c,void 0));return}}for(N in c)c.hasOwnProperty(N)&&(d=c[N],d!=null&&Ze(s,a,N,d,c,null))}function OE(s,a,c,d){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,v=null,S=null,N=null,j=null,K=null,Z=null;for(Y in c){var ne=c[Y];if(c.hasOwnProperty(Y)&&ne!=null)switch(Y){case"checked":break;case"value":break;case"defaultValue":j=ne;default:d.hasOwnProperty(Y)||Ze(s,a,Y,null,d,ne)}}for(var G in d){var Y=d[G];if(ne=c[G],d.hasOwnProperty(G)&&(Y!=null||ne!=null))switch(G){case"type":v=Y;break;case"name":p=Y;break;case"checked":K=Y;break;case"defaultChecked":Z=Y;break;case"value":S=Y;break;case"defaultValue":N=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(i(137,a));break;default:Y!==ne&&Ze(s,a,G,Y,d,ne)}}Au(s,S,N,j,K,Z,v,p);return;case"select":Y=S=N=G=null;for(v in c)if(j=c[v],c.hasOwnProperty(v)&&j!=null)switch(v){case"value":break;case"multiple":Y=j;default:d.hasOwnProperty(v)||Ze(s,a,v,null,d,j)}for(p in d)if(v=d[p],j=c[p],d.hasOwnProperty(p)&&(v!=null||j!=null))switch(p){case"value":G=v;break;case"defaultValue":N=v;break;case"multiple":S=v;default:v!==j&&Ze(s,a,p,v,d,j)}a=N,c=S,d=Y,G!=null?la(s,!!c,G,!1):!!d!=!!c&&(a!=null?la(s,!!c,a,!0):la(s,!!c,c?[]:"",!1));return;case"textarea":Y=G=null;for(N in c)if(p=c[N],c.hasOwnProperty(N)&&p!=null&&!d.hasOwnProperty(N))switch(N){case"value":break;case"children":break;default:Ze(s,a,N,null,d,p)}for(S in d)if(p=d[S],v=c[S],d.hasOwnProperty(S)&&(p!=null||v!=null))switch(S){case"value":G=p;break;case"defaultValue":Y=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==v&&Ze(s,a,S,p,d,v)}Cp(s,G,Y);return;case"option":for(var me in c)G=c[me],c.hasOwnProperty(me)&&G!=null&&!d.hasOwnProperty(me)&&(me==="selected"?s.selected=!1:Ze(s,a,me,null,d,G));for(j in d)G=d[j],Y=c[j],d.hasOwnProperty(j)&&G!==Y&&(G!=null||Y!=null)&&(j==="selected"?s.selected=G&&typeof G!="function"&&typeof G!="symbol":Ze(s,a,j,G,d,Y));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ce in c)G=c[Ce],c.hasOwnProperty(Ce)&&G!=null&&!d.hasOwnProperty(Ce)&&Ze(s,a,Ce,null,d,G);for(K in d)if(G=d[K],Y=c[K],d.hasOwnProperty(K)&&G!==Y&&(G!=null||Y!=null))switch(K){case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(i(137,a));break;default:Ze(s,a,K,G,d,Y)}return;default:if(Lu(a)){for(var et in c)G=c[et],c.hasOwnProperty(et)&&G!==void 0&&!d.hasOwnProperty(et)&&kf(s,a,et,void 0,d,G);for(Z in d)G=d[Z],Y=c[Z],!d.hasOwnProperty(Z)||G===Y||G===void 0&&Y===void 0||kf(s,a,Z,G,d,Y);return}}for(var F in c)G=c[F],c.hasOwnProperty(F)&&G!=null&&!d.hasOwnProperty(F)&&Ze(s,a,F,null,d,G);for(ne in d)G=d[ne],Y=c[ne],!d.hasOwnProperty(ne)||G===Y||G==null&&Y==null||Ze(s,a,ne,G,d,Y)}function xy(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function DE(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),d=0;d<c.length;d++){var p=c[d],v=p.transferSize,S=p.initiatorType,N=p.duration;if(v&&N&&xy(S)){for(S=0,N=p.responseEnd,d+=1;d<c.length;d++){var j=c[d],K=j.startTime;if(K>N)break;var Z=j.transferSize,ne=j.initiatorType;Z&&xy(ne)&&(j=j.responseEnd,S+=Z*(j<N?1:(N-K)/(j-K)))}if(--d,a+=8*(v+S)/(p.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var Tf=null,Ef=null;function il(s){return s.nodeType===9?s:s.ownerDocument}function Ry(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _y(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function xf(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Rf=null;function AE(){var s=window.event;return s&&s.type==="popstate"?s===Rf?!1:(Rf=s,!0):(Rf=null,!1)}var wy=typeof setTimeout=="function"?setTimeout:void 0,PE=typeof clearTimeout=="function"?clearTimeout:void 0,My=typeof Promise=="function"?Promise:void 0,LE=typeof queueMicrotask=="function"?queueMicrotask:typeof My<"u"?function(s){return My.resolve(null).then(s).catch(jE)}:wy;function jE(s){setTimeout(function(){throw s})}function ls(s){return s==="head"}function Ny(s,a){var c=a,d=0;do{var p=c.nextSibling;if(s.removeChild(c),p&&p.nodeType===8)if(c=p.data,c==="/$"||c==="/&"){if(d===0){s.removeChild(p),Va(a);return}d--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")d++;else if(c==="html")ao(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,ao(c);for(var v=c.firstChild;v;){var S=v.nextSibling,N=v.nodeName;v[Tr]||N==="SCRIPT"||N==="STYLE"||N==="LINK"&&v.rel.toLowerCase()==="stylesheet"||c.removeChild(v),v=S}}else c==="body"&&ao(s.ownerDocument.body);c=p}while(c);Va(a)}function Oy(s,a){var c=s;s=0;do{var d=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),d&&d.nodeType===8)if(c=d.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=d}while(c)}function _f(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":_f(c),Ou(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function IE(s,a,c,d){for(;s.nodeType===1;){var p=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!d&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(d){if(!s[Tr])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(v=s.getAttribute("rel"),v==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(v!==p.rel||s.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||s.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||s.getAttribute("title")!==(p.title==null?null:p.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(v=s.getAttribute("src"),(v!==(p.src==null?null:p.src)||s.getAttribute("type")!==(p.type==null?null:p.type)||s.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&v&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var v=p.name==null?null:""+p.name;if(p.type==="hidden"&&s.getAttribute("name")===v)return s}else return s;if(s=In(s.nextSibling),s===null)break}return null}function UE(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=In(s.nextSibling),s===null))return null;return s}function Dy(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=In(s.nextSibling),s===null))return null;return s}function wf(s){return s.data==="$?"||s.data==="$~"}function Mf(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function BE(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var d=function(){a(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),s._reactRetry=d}}function In(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var Nf=null;function Ay(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return In(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function Py(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function Ly(s,a,c){switch(a=il(c),s){case"html":if(s=a.documentElement,!s)throw Error(i(452));return s;case"head":if(s=a.head,!s)throw Error(i(453));return s;case"body":if(s=a.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function ao(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Ou(s)}var Un=new Map,jy=new Set;function sl(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Di=re.d;re.d={f:zE,r:VE,D:FE,C:qE,L:HE,m:$E,X:GE,S:KE,M:YE};function zE(){var s=Di.f(),a=Jc();return s||a}function VE(s){var a=ra(s);a!==null&&a.tag===5&&a.type==="form"?Zg(a):Di.r(s)}var Ua=typeof document>"u"?null:document;function Iy(s,a,c){var d=Ua;if(d&&typeof a=="string"&&a){var p=Nn(a);p='link[rel="'+s+'"][href="'+p+'"]',typeof c=="string"&&(p+='[crossorigin="'+c+'"]'),jy.has(p)||(jy.add(p),s={rel:s,crossOrigin:c,href:a},d.querySelector(p)===null&&(a=d.createElement("link"),$t(a,"link",s),It(a),d.head.appendChild(a)))}}function FE(s){Di.D(s),Iy("dns-prefetch",s,null)}function qE(s,a){Di.C(s,a),Iy("preconnect",s,a)}function HE(s,a,c){Di.L(s,a,c);var d=Ua;if(d&&s&&a){var p='link[rel="preload"][as="'+Nn(a)+'"]';a==="image"&&c&&c.imageSrcSet?(p+='[imagesrcset="'+Nn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(p+='[imagesizes="'+Nn(c.imageSizes)+'"]')):p+='[href="'+Nn(s)+'"]';var v=p;switch(a){case"style":v=Ba(s);break;case"script":v=za(s)}Un.has(v)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Un.set(v,s),d.querySelector(p)!==null||a==="style"&&d.querySelector(ro(v))||a==="script"&&d.querySelector(oo(v))||(a=d.createElement("link"),$t(a,"link",s),It(a),d.head.appendChild(a)))}}function $E(s,a){Di.m(s,a);var c=Ua;if(c&&s){var d=a&&typeof a.as=="string"?a.as:"script",p='link[rel="modulepreload"][as="'+Nn(d)+'"][href="'+Nn(s)+'"]',v=p;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=za(s)}if(!Un.has(v)&&(s=g({rel:"modulepreload",href:s},a),Un.set(v,s),c.querySelector(p)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(oo(v)))return}d=c.createElement("link"),$t(d,"link",s),It(d),c.head.appendChild(d)}}}function KE(s,a,c){Di.S(s,a,c);var d=Ua;if(d&&s){var p=oa(d).hoistableStyles,v=Ba(s);a=a||"default";var S=p.get(v);if(!S){var N={loading:0,preload:null};if(S=d.querySelector(ro(v)))N.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Un.get(v))&&Of(s,c);var j=S=d.createElement("link");It(j),$t(j,"link",s),j._p=new Promise(function(K,Z){j.onload=K,j.onerror=Z}),j.addEventListener("load",function(){N.loading|=1}),j.addEventListener("error",function(){N.loading|=2}),N.loading|=4,al(S,a,d)}S={type:"stylesheet",instance:S,count:1,state:N},p.set(v,S)}}}function GE(s,a){Di.X(s,a);var c=Ua;if(c&&s){var d=oa(c).hoistableScripts,p=za(s),v=d.get(p);v||(v=c.querySelector(oo(p)),v||(s=g({src:s,async:!0},a),(a=Un.get(p))&&Df(s,a),v=c.createElement("script"),It(v),$t(v,"link",s),c.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(p,v))}}function YE(s,a){Di.M(s,a);var c=Ua;if(c&&s){var d=oa(c).hoistableScripts,p=za(s),v=d.get(p);v||(v=c.querySelector(oo(p)),v||(s=g({src:s,async:!0,type:"module"},a),(a=Un.get(p))&&Df(s,a),v=c.createElement("script"),It(v),$t(v,"link",s),c.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(p,v))}}function Uy(s,a,c,d){var p=(p=pe.current)?sl(p):null;if(!p)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Ba(c.href),c=oa(p).hoistableStyles,d=c.get(a),d||(d={type:"style",instance:null,count:0,state:null},c.set(a,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Ba(c.href);var v=oa(p).hoistableStyles,S=v.get(s);if(S||(p=p.ownerDocument||p,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(s,S),(v=p.querySelector(ro(s)))&&!v._p&&(S.instance=v,S.state.loading=5),Un.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Un.set(s,c),v||JE(p,s,c,S.state))),a&&d===null)throw Error(i(528,""));return S}if(a&&d!==null)throw Error(i(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=za(c),c=oa(p).hoistableScripts,d=c.get(a),d||(d={type:"script",instance:null,count:0,state:null},c.set(a,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function Ba(s){return'href="'+Nn(s)+'"'}function ro(s){return'link[rel="stylesheet"]['+s+"]"}function By(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function JE(s,a,c,d){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?d.loading=1:(a=s.createElement("link"),d.preload=a,a.addEventListener("load",function(){return d.loading|=1}),a.addEventListener("error",function(){return d.loading|=2}),$t(a,"link",c),It(a),s.head.appendChild(a))}function za(s){return'[src="'+Nn(s)+'"]'}function oo(s){return"script[async]"+s}function zy(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var d=s.querySelector('style[data-href~="'+Nn(c.href)+'"]');if(d)return a.instance=d,It(d),d;var p=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(s.ownerDocument||s).createElement("style"),It(d),$t(d,"style",p),al(d,c.precedence,s),a.instance=d;case"stylesheet":p=Ba(c.href);var v=s.querySelector(ro(p));if(v)return a.state.loading|=4,a.instance=v,It(v),v;d=By(c),(p=Un.get(p))&&Of(d,p),v=(s.ownerDocument||s).createElement("link"),It(v);var S=v;return S._p=new Promise(function(N,j){S.onload=N,S.onerror=j}),$t(v,"link",d),a.state.loading|=4,al(v,c.precedence,s),a.instance=v;case"script":return v=za(c.src),(p=s.querySelector(oo(v)))?(a.instance=p,It(p),p):(d=c,(p=Un.get(v))&&(d=g({},c),Df(d,p)),s=s.ownerDocument||s,p=s.createElement("script"),It(p),$t(p,"link",d),s.head.appendChild(p),a.instance=p);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(d=a.instance,a.state.loading|=4,al(d,c.precedence,s));return a.instance}function al(s,a,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=d.length?d[d.length-1]:null,v=p,S=0;S<d.length;S++){var N=d[S];if(N.dataset.precedence===a)v=N;else if(v!==p)break}v?v.parentNode.insertBefore(s,v.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function Of(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function Df(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var rl=null;function Vy(s,a,c){if(rl===null){var d=new Map,p=rl=new Map;p.set(c,d)}else p=rl,d=p.get(c),d||(d=new Map,p.set(c,d));if(d.has(s))return d;for(d.set(s,null),c=c.getElementsByTagName(s),p=0;p<c.length;p++){var v=c[p];if(!(v[Tr]||v[Vt]||s==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var S=v.getAttribute(a)||"";S=s+S;var N=d.get(S);N?N.push(v):d.set(S,[v])}}return d}function Fy(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function QE(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function qy(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function XE(s,a,c,d){if(c.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var p=Ba(d.href),v=a.querySelector(ro(p));if(v){a=v._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=ol.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=v,It(v);return}v=a.ownerDocument||a,d=By(d),(p=Un.get(p))&&Of(d,p),v=v.createElement("link"),It(v);var S=v;S._p=new Promise(function(N,j){S.onload=N,S.onerror=j}),$t(v,"link",d),c.instance=v}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=ol.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var Af=0;function WE(s,a){return s.stylesheets&&s.count===0&&ll(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var d=setTimeout(function(){if(s.stylesheets&&ll(s,s.stylesheets),s.unsuspend){var v=s.unsuspend;s.unsuspend=null,v()}},6e4+a);0<s.imgBytes&&Af===0&&(Af=62500*DE());var p=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&ll(s,s.stylesheets),s.unsuspend)){var v=s.unsuspend;s.unsuspend=null,v()}},(s.imgBytes>Af?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(d),clearTimeout(p)}}:null}function ol(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ll(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var cl=null;function ll(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,cl=new Map,a.forEach(ZE,s),cl=null,ol.call(s))}function ZE(s,a){if(!(a.state.loading&4)){var c=cl.get(s);if(c)var d=c.get(null);else{c=new Map,cl.set(s,c);for(var p=s.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<p.length;v++){var S=p[v];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(c.set(S.dataset.precedence,S),d=S)}d&&c.set(null,d)}p=a.instance,S=p.getAttribute("data-precedence"),v=c.get(S)||d,v===d&&c.set(null,p),c.set(S,p),this.count++,d=ol.bind(this),p.addEventListener("load",d),p.addEventListener("error",d),v?v.parentNode.insertBefore(p,v.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(p,s.firstChild)),a.state.loading|=4}}var co={$$typeof:D,Provider:null,Consumer:null,_currentValue:fe,_currentValue2:fe,_threadCount:0};function ex(s,a,c,d,p,v,S,N,j){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_u(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_u(0),this.hiddenUpdates=_u(null),this.identifierPrefix=d,this.onUncaughtError=p,this.onCaughtError=v,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function Hy(s,a,c,d,p,v,S,N,j,K,Z,ne){return s=new ex(s,a,c,S,j,K,Z,ne,N),a=1,v===!0&&(a|=24),v=Sn(3,null,null,a),s.current=v,v.stateNode=s,a=dd(),a.refCount++,s.pooledCache=a,a.refCount++,v.memoizedState={element:d,isDehydrated:c,cache:a},pd(v),s}function $y(s){return s?(s=va,s):va}function Ky(s,a,c,d,p,v){p=$y(p),d.context===null?d.context=p:d.pendingContext=p,d=Wi(a),d.payload={element:c},v=v===void 0?null:v,v!==null&&(d.callback=v),c=Zi(s,d,a),c!==null&&(fn(c,s,a),zr(c,s,a))}function Gy(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function Pf(s,a){Gy(s,a),(s=s.alternate)&&Gy(s,a)}function Yy(s){if(s.tag===13||s.tag===31){var a=js(s,67108864);a!==null&&fn(a,s,67108864),Pf(s,67108864)}}function Jy(s){if(s.tag===13||s.tag===31){var a=xn();a=wu(a);var c=js(s,a);c!==null&&fn(c,s,a),Pf(s,a)}}var ul=!0;function tx(s,a,c,d){var p=H.T;H.T=null;var v=re.p;try{re.p=2,Lf(s,a,c,d)}finally{re.p=v,H.T=p}}function nx(s,a,c,d){var p=H.T;H.T=null;var v=re.p;try{re.p=8,Lf(s,a,c,d)}finally{re.p=v,H.T=p}}function Lf(s,a,c,d){if(ul){var p=jf(d);if(p===null)Cf(s,a,d,dl,c),Xy(s,d);else if(sx(p,s,a,c,d))d.stopPropagation();else if(Xy(s,d),a&4&&-1<ix.indexOf(s)){for(;p!==null;){var v=ra(p);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var S=Os(v.pendingLanes);if(S!==0){var N=v;for(N.pendingLanes|=2,N.entangledLanes|=2;S;){var j=1<<31-yn(S);N.entanglements[1]|=j,S&=~j}si(v),(Ge&6)===0&&(Gc=St()+500,no(0))}}break;case 31:case 13:N=js(v,2),N!==null&&fn(N,v,2),Jc(),Pf(v,2)}if(v=jf(d),v===null&&Cf(s,a,d,dl,c),v===p)break;p=v}p!==null&&d.stopPropagation()}else Cf(s,a,d,null,c)}}function jf(s){return s=Iu(s),If(s)}var dl=null;function If(s){if(dl=null,s=aa(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=u(a),s!==null)return s;s=null}else if(c===31){if(s=l(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return dl=s,null}function Qy(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Zo()){case gn:return 2;case ap:return 8;case ec:case qT:return 32;case rp:return 268435456;default:return 32}default:return 32}}var Uf=!1,us=null,ds=null,fs=null,lo=new Map,uo=new Map,hs=[],ix="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Xy(s,a){switch(s){case"focusin":case"focusout":us=null;break;case"dragenter":case"dragleave":ds=null;break;case"mouseover":case"mouseout":fs=null;break;case"pointerover":case"pointerout":lo.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":uo.delete(a.pointerId)}}function fo(s,a,c,d,p,v){return s===null||s.nativeEvent!==v?(s={blockedOn:a,domEventName:c,eventSystemFlags:d,nativeEvent:v,targetContainers:[p]},a!==null&&(a=ra(a),a!==null&&Yy(a)),s):(s.eventSystemFlags|=d,a=s.targetContainers,p!==null&&a.indexOf(p)===-1&&a.push(p),s)}function sx(s,a,c,d,p){switch(a){case"focusin":return us=fo(us,s,a,c,d,p),!0;case"dragenter":return ds=fo(ds,s,a,c,d,p),!0;case"mouseover":return fs=fo(fs,s,a,c,d,p),!0;case"pointerover":var v=p.pointerId;return lo.set(v,fo(lo.get(v)||null,s,a,c,d,p)),!0;case"gotpointercapture":return v=p.pointerId,uo.set(v,fo(uo.get(v)||null,s,a,c,d,p)),!0}return!1}function Wy(s){var a=aa(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=u(c),a!==null){s.blockedOn=a,fp(s.priority,function(){Jy(c)});return}}else if(a===31){if(a=l(c),a!==null){s.blockedOn=a,fp(s.priority,function(){Jy(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function fl(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=jf(s.nativeEvent);if(c===null){c=s.nativeEvent;var d=new c.constructor(c.type,c);ju=d,c.target.dispatchEvent(d),ju=null}else return a=ra(c),a!==null&&Yy(a),s.blockedOn=c,!1;a.shift()}return!0}function Zy(s,a,c){fl(s)&&c.delete(a)}function ax(){Uf=!1,us!==null&&fl(us)&&(us=null),ds!==null&&fl(ds)&&(ds=null),fs!==null&&fl(fs)&&(fs=null),lo.forEach(Zy),uo.forEach(Zy)}function hl(s,a){s.blockedOn===a&&(s.blockedOn=null,Uf||(Uf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,ax)))}var ml=null;function eb(s){ml!==s&&(ml=s,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){ml===s&&(ml=null);for(var a=0;a<s.length;a+=3){var c=s[a],d=s[a+1],p=s[a+2];if(typeof d!="function"){if(If(d||c)===null)continue;break}var v=ra(c);v!==null&&(s.splice(a,3),a-=3,Ld(v,{pending:!0,data:p,method:c.method,action:d},d,p))}}))}function Va(s){function a(j){return hl(j,s)}us!==null&&hl(us,s),ds!==null&&hl(ds,s),fs!==null&&hl(fs,s),lo.forEach(a),uo.forEach(a);for(var c=0;c<hs.length;c++){var d=hs[c];d.blockedOn===s&&(d.blockedOn=null)}for(;0<hs.length&&(c=hs[0],c.blockedOn===null);)Wy(c),c.blockedOn===null&&hs.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var p=c[d],v=c[d+1],S=p[rn]||null;if(typeof v=="function")S||eb(c);else if(S){var N=null;if(v&&v.hasAttribute("formAction")){if(p=v,S=v[rn]||null)N=S.formAction;else if(If(p)!==null)continue}else N=S.action;typeof N=="function"?c[d+1]=N:(c.splice(d,3),d-=3),eb(c)}}}function tb(){function s(v){v.canIntercept&&v.info==="react-transition"&&v.intercept({handler:function(){return new Promise(function(S){return p=S})},focusReset:"manual",scroll:"manual"})}function a(){p!==null&&(p(),p=null),d||setTimeout(c,20)}function c(){if(!d&&!navigation.transition){var v=navigation.currentEntry;v&&v.url!=null&&navigation.navigate(v.url,{state:v.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,p=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){d=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),p!==null&&(p(),p=null)}}}function Bf(s){this._internalRoot=s}pl.prototype.render=Bf.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(i(409));var c=a.current,d=xn();Ky(c,d,s,a,null,null)},pl.prototype.unmount=Bf.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;Ky(s.current,2,null,s,null,null),Jc(),a[sa]=null}};function pl(s){this._internalRoot=s}pl.prototype.unstable_scheduleHydration=function(s){if(s){var a=dp();s={blockedOn:null,target:s,priority:a};for(var c=0;c<hs.length&&a!==0&&a<hs[c].priority;c++);hs.splice(c,0,s),c===0&&Wy(s)}};var nb=e.version;if(nb!=="19.2.4")throw Error(i(527,nb,"19.2.4"));re.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=h(a),s=s!==null?m(s):null,s=s===null?null:s.stateNode,s};var rx={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:H,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gl.isDisabled&&gl.supportsFiber)try{Sr=gl.inject(rx),vn=gl}catch{}}return mo.createRoot=function(s,a){if(!r(s))throw Error(i(299));var c=!1,d="",p=lv,v=uv,S=dv;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(p=a.onUncaughtError),a.onCaughtError!==void 0&&(v=a.onCaughtError),a.onRecoverableError!==void 0&&(S=a.onRecoverableError)),a=Hy(s,1,!1,null,null,c,d,null,p,v,S,tb),s[sa]=a.current,Sf(s),new Bf(a)},mo.hydrateRoot=function(s,a,c){if(!r(s))throw Error(i(299));var d=!1,p="",v=lv,S=uv,N=dv,j=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(v=c.onUncaughtError),c.onCaughtError!==void 0&&(S=c.onCaughtError),c.onRecoverableError!==void 0&&(N=c.onRecoverableError),c.formState!==void 0&&(j=c.formState)),a=Hy(s,1,!0,a,c??null,d,p,j,v,S,N,tb),a.context=$y(null),c=a.current,d=xn(),d=wu(d),p=Wi(d),p.callback=null,Zi(c,p,d),c=d,a.current.lanes=c,kr(a,c),si(a),s[sa]=a.current,Sf(s),new pl(a)},mo.version="19.2.4",mo}var fb;function gx(){if(fb)return Ff.exports;fb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Ff.exports=px(),Ff.exports}var vx=gx();var hb="popstate";function yx(n={}){function e(i,r){let{pathname:o,search:u,hash:l}=i.location;return wh("",{pathname:o,search:u,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(i,r){return typeof r=="string"?r:jo(r)}return Sx(e,t,null,n)}function dt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Zn(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function bx(){return Math.random().toString(36).substring(2,10)}function mb(n,e){return{usr:n.state,key:n.key,idx:e}}function wh(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?dr(e):e,state:t,key:e&&e.key||i||bx()}}function jo({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function dr(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function Sx(n,e,t,i={}){let{window:r=document.defaultView,v5Compat:o=!1}=i,u=r.history,l="POP",f=null,h=m();h==null&&(h=0,u.replaceState({...u.state,idx:h},""));function m(){return(u.state||{idx:null}).idx}function g(){l="POP";let _=m(),w=_==null?null:_-h;h=_,f&&f({action:l,location:k.location,delta:w})}function b(_,w){l="PUSH";let O=wh(k.location,_,w);h=m()+1;let D=mb(O,h),x=k.createHref(O);try{u.pushState(D,"",x)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;r.location.assign(x)}o&&f&&f({action:l,location:k.location,delta:1})}function C(_,w){l="REPLACE";let O=wh(k.location,_,w);h=m();let D=mb(O,h),x=k.createHref(O);u.replaceState(D,"",x),o&&f&&f({action:l,location:k.location,delta:0})}function E(_){return Cx(_)}let k={get action(){return l},get location(){return n(r,u)},listen(_){if(f)throw new Error("A history only accepts one active listener");return r.addEventListener(hb,g),f=_,()=>{r.removeEventListener(hb,g),f=null}},createHref(_){return e(r,_)},createURL:E,encodeLocation(_){let w=E(_);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:b,replace:C,go(_){return u.go(_)}};return k}function Cx(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),dt(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:jo(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function MS(n,e,t="/"){return kx(n,e,t,!1)}function kx(n,e,t,i){let r=typeof e=="string"?dr(e):e,o=zi(r.pathname||"/",t);if(o==null)return null;let u=NS(n);Tx(u);let l=null;for(let f=0;l==null&&f<u.length;++f){let h=Px(o);l=Dx(u[f],h,i)}return l}function NS(n,e=[],t=[],i="",r=!1){let o=(u,l,f=r,h)=>{let m={relativePath:h===void 0?u.path||"":h,caseSensitive:u.caseSensitive===!0,childrenIndex:l,route:u};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(i)&&f)return;dt(m.relativePath.startsWith(i),`Absolute route path "${m.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(i.length)}let g=Bi([i,m.relativePath]),b=t.concat(m);u.children&&u.children.length>0&&(dt(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),NS(u.children,e,b,g,f)),!(u.path==null&&!u.index)&&e.push({path:g,score:Nx(g,u.index),routesMeta:b})};return n.forEach((u,l)=>{if(u.path===""||!u.path?.includes("?"))o(u,l);else for(let f of OS(u.path))o(u,l,!0,f)}),e}function OS(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,r=t.endsWith("?"),o=t.replace(/\?$/,"");if(i.length===0)return r?[o,""]:[o];let u=OS(i.join("/")),l=[];return l.push(...u.map(f=>f===""?o:[o,f].join("/"))),r&&l.push(...u),l.map(f=>n.startsWith("/")&&f===""?"/":f)}function Tx(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:Ox(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var Ex=/^:[\w-]+$/,xx=3,Rx=2,_x=1,wx=10,Mx=-2,pb=n=>n==="*";function Nx(n,e){let t=n.split("/"),i=t.length;return t.some(pb)&&(i+=Mx),e&&(i+=Rx),t.filter(r=>!pb(r)).reduce((r,o)=>r+(Ex.test(o)?xx:o===""?_x:wx),i)}function Ox(n,e){return n.length===e.length&&n.slice(0,-1).every((i,r)=>i===e[r])?n[n.length-1]-e[e.length-1]:0}function Dx(n,e,t=!1){let{routesMeta:i}=n,r={},o="/",u=[];for(let l=0;l<i.length;++l){let f=i[l],h=l===i.length-1,m=o==="/"?e:e.slice(o.length)||"/",g=Hl({path:f.relativePath,caseSensitive:f.caseSensitive,end:h},m),b=f.route;if(!g&&h&&t&&!i[i.length-1].route.index&&(g=Hl({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},m)),!g)return null;Object.assign(r,g.params),u.push({params:r,pathname:Bi([o,g.pathname]),pathnameBase:Ux(Bi([o,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(o=Bi([o,g.pathnameBase]))}return u}function Hl(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=Ax(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let o=r[0],u=o.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:i.reduce((h,{paramName:m,isOptional:g},b)=>{if(m==="*"){let E=l[b]||"";u=o.slice(0,o.length-E.length).replace(/(.)\/+$/,"$1")}const C=l[b];return g&&!C?h[m]=void 0:h[m]=(C||"").replace(/%2F/g,"/"),h},{}),pathname:o,pathnameBase:u,pattern:n}}function Ax(n,e=!1,t=!0){Zn(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,l,f)=>(i.push({paramName:l,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function Px(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Zn(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function zi(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}var Lx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function jx(n,e="/"){let{pathname:t,search:i="",hash:r=""}=typeof n=="string"?dr(n):n,o;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?o=gb(t.substring(1),"/"):o=gb(t,e)):o=e,{pathname:o,search:Bx(i),hash:zx(r)}}function gb(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function Kf(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Ix(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function mm(n){let e=Ix(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function pm(n,e,t,i=!1){let r;typeof n=="string"?r=dr(n):(r={...n},dt(!r.pathname||!r.pathname.includes("?"),Kf("?","pathname","search",r)),dt(!r.pathname||!r.pathname.includes("#"),Kf("#","pathname","hash",r)),dt(!r.search||!r.search.includes("#"),Kf("#","search","hash",r)));let o=n===""||r.pathname==="",u=o?"/":r.pathname,l;if(u==null)l=t;else{let g=e.length-1;if(!i&&u.startsWith("..")){let b=u.split("/");for(;b[0]==="..";)b.shift(),g-=1;r.pathname=b.join("/")}l=g>=0?e[g]:"/"}let f=jx(r,l),h=u&&u!=="/"&&u.endsWith("/"),m=(o||u===".")&&t.endsWith("/");return!f.pathname.endsWith("/")&&(h||m)&&(f.pathname+="/"),f}var Bi=n=>n.join("/").replace(/\/\/+/g,"/"),Ux=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Bx=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,zx=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,Vx=class{constructor(n,e,t,i=!1){this.status=n,this.statusText=e||"",this.internal=i,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function Fx(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function qx(n){return n.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var DS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function AS(n,e){let t=n;if(typeof t!="string"||!Lx.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let i=t,r=!1;if(DS)try{let o=new URL(window.location.href),u=t.startsWith("//")?new URL(o.protocol+t):new URL(t),l=zi(u.pathname,e);u.origin===o.origin&&l!=null?t=l+u.search+u.hash:r=!0}catch{Zn(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:i,isExternal:r,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var PS=["POST","PUT","PATCH","DELETE"];new Set(PS);var Hx=["GET",...PS];new Set(Hx);var fr=T.createContext(null);fr.displayName="DataRouter";var fu=T.createContext(null);fu.displayName="DataRouterState";var $x=T.createContext(!1),LS=T.createContext({isTransitioning:!1});LS.displayName="ViewTransition";var Kx=T.createContext(new Map);Kx.displayName="Fetchers";var Gx=T.createContext(null);Gx.displayName="Await";var _n=T.createContext(null);_n.displayName="Navigation";var Ko=T.createContext(null);Ko.displayName="Location";var fi=T.createContext({outlet:null,matches:[],isDataRoute:!1});fi.displayName="Route";var gm=T.createContext(null);gm.displayName="RouteError";var jS="REACT_ROUTER_ERROR",Yx="REDIRECT",Jx="ROUTE_ERROR_RESPONSE";function Qx(n){if(n.startsWith(`${jS}:${Yx}:{`))try{let e=JSON.parse(n.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function Xx(n){if(n.startsWith(`${jS}:${Jx}:{`))try{let e=JSON.parse(n.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new Vx(e.status,e.statusText,e.data)}catch{}}function Wx(n,{relative:e}={}){dt(hr(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=T.useContext(_n),{hash:r,pathname:o,search:u}=Go(n,{relative:e}),l=o;return t!=="/"&&(l=o==="/"?t:Bi([t,o])),i.createHref({pathname:l,search:u,hash:r})}function hr(){return T.useContext(Ko)!=null}function _s(){return dt(hr(),"useLocation() may be used only in the context of a <Router> component."),T.useContext(Ko).location}var IS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function US(n){T.useContext(_n).static||T.useLayoutEffect(n)}function hu(){let{isDataRoute:n}=T.useContext(fi);return n?dR():Zx()}function Zx(){dt(hr(),"useNavigate() may be used only in the context of a <Router> component.");let n=T.useContext(fr),{basename:e,navigator:t}=T.useContext(_n),{matches:i}=T.useContext(fi),{pathname:r}=_s(),o=JSON.stringify(mm(i)),u=T.useRef(!1);return US(()=>{u.current=!0}),T.useCallback((f,h={})=>{if(Zn(u.current,IS),!u.current)return;if(typeof f=="number"){t.go(f);return}let m=pm(f,JSON.parse(o),r,h.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Bi([e,m.pathname])),(h.replace?t.replace:t.push)(m,h.state,h)},[e,t,o,r,n])}T.createContext(null);function Go(n,{relative:e}={}){let{matches:t}=T.useContext(fi),{pathname:i}=_s(),r=JSON.stringify(mm(t));return T.useMemo(()=>pm(n,JSON.parse(r),i,e==="path"),[n,r,i,e])}function eR(n,e){return BS(n,e)}function BS(n,e,t,i,r){dt(hr(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=T.useContext(_n),{matches:u}=T.useContext(fi),l=u[u.length-1],f=l?l.params:{},h=l?l.pathname:"/",m=l?l.pathnameBase:"/",g=l&&l.route;{let O=g&&g.path||"";VS(h,!g||O.endsWith("*")||O.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${O}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${O}"> to <Route path="${O==="/"?"*":`${O}/*`}">.`)}let b=_s(),C;if(e){let O=typeof e=="string"?dr(e):e;dt(m==="/"||O.pathname?.startsWith(m),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${O.pathname}" was given in the \`location\` prop.`),C=O}else C=b;let E=C.pathname||"/",k=E;if(m!=="/"){let O=m.replace(/^\//,"").split("/");k="/"+E.replace(/^\//,"").split("/").slice(O.length).join("/")}let _=MS(n,{pathname:k});Zn(g||_!=null,`No routes matched location "${C.pathname}${C.search}${C.hash}" `),Zn(_==null||_[_.length-1].route.element!==void 0||_[_.length-1].route.Component!==void 0||_[_.length-1].route.lazy!==void 0,`Matched leaf route at location "${C.pathname}${C.search}${C.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let w=aR(_&&_.map(O=>Object.assign({},O,{params:Object.assign({},f,O.params),pathname:Bi([m,o.encodeLocation?o.encodeLocation(O.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:O.pathname]),pathnameBase:O.pathnameBase==="/"?m:Bi([m,o.encodeLocation?o.encodeLocation(O.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:O.pathnameBase])})),u,t,i,r);return e&&w?T.createElement(Ko.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...C},navigationType:"POP"}},w):w}function tR(){let n=uR(),e=Fx(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i},o={padding:"2px 4px",backgroundColor:i},u=null;return console.error("Error handled by React Router default ErrorBoundary:",n),u=T.createElement(T.Fragment,null,T.createElement("p",null," Hey developer "),T.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",T.createElement("code",{style:o},"ErrorBoundary")," or"," ",T.createElement("code",{style:o},"errorElement")," prop on your route.")),T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},e),t?T.createElement("pre",{style:r},t):null,u)}var nR=T.createElement(tR,null),zS=class extends T.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.onError?this.props.onError(n,e):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const t=Xx(n.digest);t&&(n=t)}let e=n!==void 0?T.createElement(fi.Provider,{value:this.props.routeContext},T.createElement(gm.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?T.createElement(iR,{error:n},e):e}};zS.contextType=$x;var Gf=new WeakMap;function iR({children:n,error:e}){let{basename:t}=T.useContext(_n);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let i=Qx(e.digest);if(i){let r=Gf.get(e);if(r)throw r;let o=AS(i.location,t);if(DS&&!Gf.get(e))if(o.isExternal||i.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const u=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:i.replace}));throw Gf.set(e,u),u}return T.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return n}function sR({routeContext:n,match:e,children:t}){let i=T.useContext(fr);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),T.createElement(fi.Provider,{value:n},t)}function aR(n,e=[],t=null,i=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,u=t?.errors;if(u!=null){let m=o.findIndex(g=>g.route.id&&u?.[g.route.id]!==void 0);dt(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),o=o.slice(0,Math.min(o.length,m+1))}let l=!1,f=-1;if(t)for(let m=0;m<o.length;m++){let g=o[m];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(f=m),g.route.id){let{loaderData:b,errors:C}=t,E=g.route.loader&&!b.hasOwnProperty(g.route.id)&&(!C||C[g.route.id]===void 0);if(g.route.lazy||E){l=!0,f>=0?o=o.slice(0,f+1):o=[o[0]];break}}}let h=t&&i?(m,g)=>{i(m,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:qx(t.matches),errorInfo:g})}:void 0;return o.reduceRight((m,g,b)=>{let C,E=!1,k=null,_=null;t&&(C=u&&g.route.id?u[g.route.id]:void 0,k=g.route.errorElement||nR,l&&(f<0&&b===0?(VS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),E=!0,_=null):f===b&&(E=!0,_=g.route.hydrateFallbackElement||null)));let w=e.concat(o.slice(0,b+1)),O=()=>{let D;return C?D=k:E?D=_:g.route.Component?D=T.createElement(g.route.Component,null):g.route.element?D=g.route.element:D=m,T.createElement(sR,{match:g,routeContext:{outlet:m,matches:w,isDataRoute:t!=null},children:D})};return t&&(g.route.ErrorBoundary||g.route.errorElement||b===0)?T.createElement(zS,{location:t.location,revalidation:t.revalidation,component:k,error:C,children:O(),routeContext:{outlet:null,matches:w,isDataRoute:!0},onError:h}):O()},null)}function vm(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rR(n){let e=T.useContext(fr);return dt(e,vm(n)),e}function oR(n){let e=T.useContext(fu);return dt(e,vm(n)),e}function cR(n){let e=T.useContext(fi);return dt(e,vm(n)),e}function ym(n){let e=cR(n),t=e.matches[e.matches.length-1];return dt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function lR(){return ym("useRouteId")}function uR(){let n=T.useContext(gm),e=oR("useRouteError"),t=ym("useRouteError");return n!==void 0?n:e.errors?.[t]}function dR(){let{router:n}=rR("useNavigate"),e=ym("useNavigate"),t=T.useRef(!1);return US(()=>{t.current=!0}),T.useCallback(async(r,o={})=>{Zn(t.current,IS),t.current&&(typeof r=="number"?await n.navigate(r):await n.navigate(r,{fromRouteId:e,...o}))},[n,e])}var vb={};function VS(n,e,t){!e&&!vb[n]&&(vb[n]=!0,Zn(!1,t))}T.memo(fR);function fR({routes:n,future:e,state:t,onError:i}){return BS(n,void 0,t,i,e)}function yl({to:n,replace:e,state:t,relative:i}){dt(hr(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=T.useContext(_n);Zn(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=T.useContext(fi),{pathname:u}=_s(),l=hu(),f=pm(n,mm(o),u,i==="path"),h=JSON.stringify(f);return T.useEffect(()=>{l(JSON.parse(h),{replace:e,state:t,relative:i})},[l,h,i,e,t]),null}function xo(n){dt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function hR({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:r,static:o=!1,unstable_useTransitions:u}){dt(!hr(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=n.replace(/^\/*/,"/"),f=T.useMemo(()=>({basename:l,navigator:r,static:o,unstable_useTransitions:u,future:{}}),[l,r,o,u]);typeof t=="string"&&(t=dr(t));let{pathname:h="/",search:m="",hash:g="",state:b=null,key:C="default"}=t,E=T.useMemo(()=>{let k=zi(h,l);return k==null?null:{location:{pathname:k,search:m,hash:g,state:b,key:C},navigationType:i}},[l,h,m,g,b,C,i]);return Zn(E!=null,`<Router basename="${l}"> is not able to match the URL "${h}${m}${g}" because it does not start with the basename, so the <Router> won't render anything.`),E==null?null:T.createElement(_n.Provider,{value:f},T.createElement(Ko.Provider,{children:e,value:E}))}function mR({children:n,location:e}){return eR(Mh(n),e)}function Mh(n,e=[]){let t=[];return T.Children.forEach(n,(i,r)=>{if(!T.isValidElement(i))return;let o=[...e,r];if(i.type===T.Fragment){t.push.apply(t,Mh(i.props.children,o));return}dt(i.type===xo,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),dt(!i.props.index||!i.props.children,"An index route cannot have child routes.");let u={id:i.props.id||o.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(u.children=Mh(i.props.children,o)),t.push(u)}),t}var Rl="get",_l="application/x-www-form-urlencoded";function mu(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function pR(n){return mu(n)&&n.tagName.toLowerCase()==="button"}function gR(n){return mu(n)&&n.tagName.toLowerCase()==="form"}function vR(n){return mu(n)&&n.tagName.toLowerCase()==="input"}function yR(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function bR(n,e){return n.button===0&&(!e||e==="_self")&&!yR(n)}var bl=null;function SR(){if(bl===null)try{new FormData(document.createElement("form"),0),bl=!1}catch{bl=!0}return bl}var CR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Yf(n){return n!=null&&!CR.has(n)?(Zn(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${_l}"`),null):n}function kR(n,e){let t,i,r,o,u;if(gR(n)){let l=n.getAttribute("action");i=l?zi(l,e):null,t=n.getAttribute("method")||Rl,r=Yf(n.getAttribute("enctype"))||_l,o=new FormData(n)}else if(pR(n)||vR(n)&&(n.type==="submit"||n.type==="image")){let l=n.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=n.getAttribute("formaction")||l.getAttribute("action");if(i=f?zi(f,e):null,t=n.getAttribute("formmethod")||l.getAttribute("method")||Rl,r=Yf(n.getAttribute("formenctype"))||Yf(l.getAttribute("enctype"))||_l,o=new FormData(l,n),!SR()){let{name:h,type:m,value:g}=n;if(m==="image"){let b=h?`${h}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else h&&o.append(h,g)}}else{if(mu(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Rl,i=null,r=_l,u=n}return o&&r==="text/plain"&&(u=o,o=void 0),{action:i,method:t.toLowerCase(),encType:r,formData:o,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function bm(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function TR(n,e,t,i){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return t?r.pathname.endsWith("/")?r.pathname=`${r.pathname}_.${i}`:r.pathname=`${r.pathname}.${i}`:r.pathname==="/"?r.pathname=`_root.${i}`:e&&zi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${i}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${i}`,r}async function ER(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function xR(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function RR(n,e,t){let i=await Promise.all(n.map(async r=>{let o=e.routes[r.route.id];if(o){let u=await ER(o,t);return u.links?u.links():[]}return[]}));return NR(i.flat(1).filter(xR).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function yb(n,e,t,i,r,o){let u=(f,h)=>t[h]?f.route.id!==t[h].route.id:!0,l=(f,h)=>t[h].pathname!==f.pathname||t[h].route.path?.endsWith("*")&&t[h].params["*"]!==f.params["*"];return o==="assets"?e.filter((f,h)=>u(f,h)||l(f,h)):o==="data"?e.filter((f,h)=>{let m=i.routes[f.route.id];if(!m||!m.hasLoader)return!1;if(u(f,h)||l(f,h))return!0;if(f.route.shouldRevalidate){let g=f.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function _R(n,e,{includeHydrateFallback:t}={}){return wR(n.map(i=>{let r=e.routes[i.route.id];if(!r)return[];let o=[r.module];return r.clientActionModule&&(o=o.concat(r.clientActionModule)),r.clientLoaderModule&&(o=o.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(o=o.concat(r.hydrateFallbackModule)),r.imports&&(o=o.concat(r.imports)),o}).flat(1))}function wR(n){return[...new Set(n)]}function MR(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function NR(n,e){let t=new Set;return new Set(e),n.reduce((i,r)=>{let o=JSON.stringify(MR(r));return t.has(o)||(t.add(o),i.push({key:o,link:r})),i},[])}function FS(){let n=T.useContext(fr);return bm(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function OR(){let n=T.useContext(fu);return bm(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Sm=T.createContext(void 0);Sm.displayName="FrameworkContext";function qS(){let n=T.useContext(Sm);return bm(n,"You must render this element inside a <HydratedRouter> element"),n}function DR(n,e){let t=T.useContext(Sm),[i,r]=T.useState(!1),[o,u]=T.useState(!1),{onFocus:l,onBlur:f,onMouseEnter:h,onMouseLeave:m,onTouchStart:g}=e,b=T.useRef(null);T.useEffect(()=>{if(n==="render"&&u(!0),n==="viewport"){let k=w=>{w.forEach(O=>{u(O.isIntersecting)})},_=new IntersectionObserver(k,{threshold:.5});return b.current&&_.observe(b.current),()=>{_.disconnect()}}},[n]),T.useEffect(()=>{if(i){let k=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(k)}}},[i]);let C=()=>{r(!0)},E=()=>{r(!1),u(!1)};return t?n!=="intent"?[o,b,{}]:[o,b,{onFocus:po(l,C),onBlur:po(f,E),onMouseEnter:po(h,C),onMouseLeave:po(m,E),onTouchStart:po(g,C)}]:[!1,b,{}]}function po(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function AR({page:n,...e}){let{router:t}=FS(),i=T.useMemo(()=>MS(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?T.createElement(LR,{page:n,matches:i,...e}):null}function PR(n){let{manifest:e,routeModules:t}=qS(),[i,r]=T.useState([]);return T.useEffect(()=>{let o=!1;return RR(n,e,t).then(u=>{o||r(u)}),()=>{o=!0}},[n,e,t]),i}function LR({page:n,matches:e,...t}){let i=_s(),{future:r,manifest:o,routeModules:u}=qS(),{basename:l}=FS(),{loaderData:f,matches:h}=OR(),m=T.useMemo(()=>yb(n,e,h,o,i,"data"),[n,e,h,o,i]),g=T.useMemo(()=>yb(n,e,h,o,i,"assets"),[n,e,h,o,i]),b=T.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let k=new Set,_=!1;if(e.forEach(O=>{let D=o.routes[O.route.id];!D||!D.hasLoader||(!m.some(x=>x.route.id===O.route.id)&&O.route.id in f&&u[O.route.id]?.shouldRevalidate||D.hasClientLoader?_=!0:k.add(O.route.id))}),k.size===0)return[];let w=TR(n,l,r.unstable_trailingSlashAwareDataRequests,"data");return _&&k.size>0&&w.searchParams.set("_routes",e.filter(O=>k.has(O.route.id)).map(O=>O.route.id).join(",")),[w.pathname+w.search]},[l,r.unstable_trailingSlashAwareDataRequests,f,i,o,m,e,n,u]),C=T.useMemo(()=>_R(g,o),[g,o]),E=PR(g);return T.createElement(T.Fragment,null,b.map(k=>T.createElement("link",{key:k,rel:"prefetch",as:"fetch",href:k,...t})),C.map(k=>T.createElement("link",{key:k,rel:"modulepreload",href:k,...t})),E.map(({key:k,link:_})=>T.createElement("link",{key:k,nonce:t.nonce,..._,crossOrigin:_.crossOrigin??t.crossOrigin})))}function jR(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var IR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{IR&&(window.__reactRouterVersion="7.13.0")}catch{}function UR({basename:n,children:e,unstable_useTransitions:t,window:i}){let r=T.useRef();r.current==null&&(r.current=yx({window:i,v5Compat:!0}));let o=r.current,[u,l]=T.useState({action:o.action,location:o.location}),f=T.useCallback(h=>{t===!1?l(h):T.startTransition(()=>l(h))},[t]);return T.useLayoutEffect(()=>o.listen(f),[o,f]),T.createElement(hR,{basename:n,children:e,location:u.location,navigationType:u.action,navigator:o,unstable_useTransitions:t})}var HS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,pu=T.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:r,reloadDocument:o,replace:u,state:l,target:f,to:h,preventScrollReset:m,viewTransition:g,unstable_defaultShouldRevalidate:b,...C},E){let{basename:k,unstable_useTransitions:_}=T.useContext(_n),w=typeof h=="string"&&HS.test(h),O=AS(h,k);h=O.to;let D=Wx(h,{relative:r}),[x,R,M]=DR(i,C),L=FR(h,{replace:u,state:l,target:f,preventScrollReset:m,relative:r,viewTransition:g,unstable_defaultShouldRevalidate:b,unstable_useTransitions:_});function B(P){e&&e(P),P.defaultPrevented||L(P)}let V=T.createElement("a",{...C,...M,href:O.absoluteURL||D,onClick:O.isExternal||o?e:B,ref:jR(E,R),target:f,"data-discover":!w&&t==="render"?"true":void 0});return x&&!w?T.createElement(T.Fragment,null,V,T.createElement(AR,{page:D})):V});pu.displayName="Link";var BR=T.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:r=!1,style:o,to:u,viewTransition:l,children:f,...h},m){let g=Go(u,{relative:h.relative}),b=_s(),C=T.useContext(fu),{navigator:E,basename:k}=T.useContext(_n),_=C!=null&&GR(g)&&l===!0,w=E.encodeLocation?E.encodeLocation(g).pathname:g.pathname,O=b.pathname,D=C&&C.navigation&&C.navigation.location?C.navigation.location.pathname:null;t||(O=O.toLowerCase(),D=D?D.toLowerCase():null,w=w.toLowerCase()),D&&k&&(D=zi(D,k)||D);const x=w!=="/"&&w.endsWith("/")?w.length-1:w.length;let R=O===w||!r&&O.startsWith(w)&&O.charAt(x)==="/",M=D!=null&&(D===w||!r&&D.startsWith(w)&&D.charAt(w.length)==="/"),L={isActive:R,isPending:M,isTransitioning:_},B=R?e:void 0,V;typeof i=="function"?V=i(L):V=[i,R?"active":null,M?"pending":null,_?"transitioning":null].filter(Boolean).join(" ");let P=typeof o=="function"?o(L):o;return T.createElement(pu,{...h,"aria-current":B,className:V,ref:m,style:P,to:u,viewTransition:l},typeof f=="function"?f(L):f)});BR.displayName="NavLink";var zR=T.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:r,state:o,method:u=Rl,action:l,onSubmit:f,relative:h,preventScrollReset:m,viewTransition:g,unstable_defaultShouldRevalidate:b,...C},E)=>{let{unstable_useTransitions:k}=T.useContext(_n),_=$R(),w=KR(l,{relative:h}),O=u.toLowerCase()==="get"?"get":"post",D=typeof l=="string"&&HS.test(l),x=R=>{if(f&&f(R),R.defaultPrevented)return;R.preventDefault();let M=R.nativeEvent.submitter,L=M?.getAttribute("formmethod")||u,B=()=>_(M||R.currentTarget,{fetcherKey:e,method:L,navigate:t,replace:r,state:o,relative:h,preventScrollReset:m,viewTransition:g,unstable_defaultShouldRevalidate:b});k&&t!==!1?T.startTransition(()=>B()):B()};return T.createElement("form",{ref:E,method:O,action:w,onSubmit:i?f:x,...C,"data-discover":!D&&n==="render"?"true":void 0})});zR.displayName="Form";function VR(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $S(n){let e=T.useContext(fr);return dt(e,VR(n)),e}function FR(n,{target:e,replace:t,state:i,preventScrollReset:r,relative:o,viewTransition:u,unstable_defaultShouldRevalidate:l,unstable_useTransitions:f}={}){let h=hu(),m=_s(),g=Go(n,{relative:o});return T.useCallback(b=>{if(bR(b,e)){b.preventDefault();let C=t!==void 0?t:jo(m)===jo(g),E=()=>h(n,{replace:C,state:i,preventScrollReset:r,relative:o,viewTransition:u,unstable_defaultShouldRevalidate:l});f?T.startTransition(()=>E()):E()}},[m,h,g,t,i,e,n,r,o,u,l,f])}var qR=0,HR=()=>`__${String(++qR)}__`;function $R(){let{router:n}=$S("useSubmit"),{basename:e}=T.useContext(_n),t=lR(),i=n.fetch,r=n.navigate;return T.useCallback(async(o,u={})=>{let{action:l,method:f,encType:h,formData:m,body:g}=kR(o,e);if(u.navigate===!1){let b=u.fetcherKey||HR();await i(b,t,u.action||l,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:m,body:g,formMethod:u.method||f,formEncType:u.encType||h,flushSync:u.flushSync})}else await r(u.action||l,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:m,body:g,formMethod:u.method||f,formEncType:u.encType||h,replace:u.replace,state:u.state,fromRouteId:t,flushSync:u.flushSync,viewTransition:u.viewTransition})},[i,r,e,t])}function KR(n,{relative:e}={}){let{basename:t}=T.useContext(_n),i=T.useContext(fi);dt(i,"useFormAction must be used inside a RouteContext");let[r]=i.matches.slice(-1),o={...Go(n||".",{relative:e})},u=_s();if(n==null){o.search=u.search;let l=new URLSearchParams(o.search),f=l.getAll("index");if(f.some(m=>m==="")){l.delete("index"),f.filter(g=>g).forEach(g=>l.append("index",g));let m=l.toString();o.search=m?`?${m}`:""}}return(!n||n===".")&&r.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(o.pathname=o.pathname==="/"?t:Bi([t,o.pathname])),jo(o)}function GR(n,{relative:e}={}){let t=T.useContext(LS);dt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=$S("useViewTransitionState"),r=Go(n,{relative:e});if(!t.isTransitioning)return!1;let o=zi(t.currentLocation.pathname,i)||t.currentLocation.pathname,u=zi(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Hl(r.pathname,u)!=null||Hl(r.pathname,o)!=null}var KS=wS();const Ee=n=>typeof n=="string",go=()=>{let n,e;const t=new Promise((i,r)=>{n=i,e=r});return t.resolve=n,t.reject=e,t},bb=n=>n==null?"":""+n,YR=(n,e,t)=>{n.forEach(i=>{e[i]&&(t[i]=e[i])})},JR=/###/g,Sb=n=>n&&n.indexOf("###")>-1?n.replace(JR,"."):n,Cb=n=>!n||Ee(n),wo=(n,e,t)=>{const i=Ee(e)?e.split("."):e;let r=0;for(;r<i.length-1;){if(Cb(n))return{};const o=Sb(i[r]);!n[o]&&t&&(n[o]=new t),Object.prototype.hasOwnProperty.call(n,o)?n=n[o]:n={},++r}return Cb(n)?{}:{obj:n,k:Sb(i[r])}},kb=(n,e,t)=>{const{obj:i,k:r}=wo(n,e,Object);if(i!==void 0||e.length===1){i[r]=t;return}let o=e[e.length-1],u=e.slice(0,e.length-1),l=wo(n,u,Object);for(;l.obj===void 0&&u.length;)o=`${u[u.length-1]}.${o}`,u=u.slice(0,u.length-1),l=wo(n,u,Object),l?.obj&&typeof l.obj[`${l.k}.${o}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${o}`]=t},QR=(n,e,t,i)=>{const{obj:r,k:o}=wo(n,e,Object);r[o]=r[o]||[],r[o].push(t)},$l=(n,e)=>{const{obj:t,k:i}=wo(n,e);if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i]},XR=(n,e,t)=>{const i=$l(n,t);return i!==void 0?i:$l(e,t)},GS=(n,e,t)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in n?Ee(n[i])||n[i]instanceof String||Ee(e[i])||e[i]instanceof String?t&&(n[i]=e[i]):GS(n[i],e[i],t):n[i]=e[i]);return n},Fa=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var WR={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const ZR=n=>Ee(n)?n.replace(/[&<>"'\/]/g,e=>WR[e]):n;class e_{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const t_=[" ",",","?","!",";"],n_=new e_(20),i_=(n,e,t)=>{e=e||"",t=t||"";const i=t_.filter(u=>e.indexOf(u)<0&&t.indexOf(u)<0);if(i.length===0)return!0;const r=n_.getRegExp(`(${i.map(u=>u==="?"?"\\?":u).join("|")})`);let o=!r.test(n);if(!o){const u=n.indexOf(t);u>0&&!r.test(n.substring(0,u))&&(o=!0)}return o},Nh=(n,e,t=".")=>{if(!n)return;if(n[e])return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0;const i=e.split(t);let r=n;for(let o=0;o<i.length;){if(!r||typeof r!="object")return;let u,l="";for(let f=o;f<i.length;++f)if(f!==o&&(l+=t),l+=i[f],u=r[l],u!==void 0){if(["string","number","boolean"].indexOf(typeof u)>-1&&f<i.length-1)continue;o+=f-o+1;break}r=u}return r},Io=n=>n?.replace("_","-"),s_={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console?.[n]?.apply?.(console,e)}};class Kl{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||s_,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,r){return r&&!this.debug?null:(Ee(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Kl(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Kl(this.logger,e)}}var oi=new Kl;class gu{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const r=this.observers[i].get(t)||0;this.observers[i].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([r,o])=>{for(let u=0;u<o;u++)r(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([r,o])=>{for(let u=0;u<o;u++)r.apply(r,[e,...t])})}}class Tb extends gu{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i,r={}){const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,u=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],i&&(Array.isArray(i)?l.push(...i):Ee(i)&&o?l.push(...i.split(o)):l.push(i)));const f=$l(this.data,l);return!f&&!t&&!i&&e.indexOf(".")>-1&&(e=l[0],t=l[1],i=l.slice(2).join(".")),f||!u||!Ee(i)?f:Nh(this.data?.[e]?.[t],i,o)}addResource(e,t,i,r,o={silent:!1}){const u=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let l=[e,t];i&&(l=l.concat(u?i.split(u):i)),e.indexOf(".")>-1&&(l=e.split("."),r=t,t=l[1]),this.addNamespaces(t),kb(this.data,l,r),o.silent||this.emit("added",e,t,i,r)}addResources(e,t,i,r={silent:!1}){for(const o in i)(Ee(i[o])||Array.isArray(i[o]))&&this.addResource(e,t,o,i[o],{silent:!0});r.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,r,o,u={silent:!1,skipCopy:!1}){let l=[e,t];e.indexOf(".")>-1&&(l=e.split("."),r=i,i=t,t=l[1]),this.addNamespaces(t);let f=$l(this.data,l)||{};u.skipCopy||(i=JSON.parse(JSON.stringify(i))),r?GS(f,i,o):f={...f,...i},kb(this.data,l,f),u.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var YS={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,i,r){return n.forEach(o=>{e=this.processors[o]?.process(e,t,i,r)??e}),e}};const JS=Symbol("i18next/PATH_KEY");function a_(){const n=[],e=Object.create(null);let t;return e.get=(i,r)=>(t?.revoke?.(),r===JS?n:(n.push(r),t=Proxy.revocable(i,e),t.proxy)),Proxy.revocable(Object.create(null),e).proxy}function Oh(n,e){const{[JS]:t}=n(a_());return t.join(e?.keySeparator??".")}const Eb={},Jf=n=>!Ee(n)&&typeof n!="boolean"&&typeof n!="number";class Gl extends gu{constructor(e,t={}){super(),YR(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=oi.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const i={...t};if(e==null)return!1;const r=this.resolve(e,i);if(r?.res===void 0)return!1;const o=Jf(r.res);return!(i.returnObjects===!1&&o)}extractFromKey(e,t){let i=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let o=t.ns||this.options.defaultNS||[];const u=i&&e.indexOf(i)>-1,l=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!i_(e,i,r);if(u&&!l){const f=e.match(this.interpolator.nestingRegexp);if(f&&f.length>0)return{key:e,namespaces:Ee(o)?[o]:o};const h=e.split(i);(i!==r||i===r&&this.options.ns.indexOf(h[0])>-1)&&(o=h.shift()),e=h.join(r)}return{key:e,namespaces:Ee(o)?[o]:o}}translate(e,t,i){let r=typeof t=="object"?{...t}:t;if(typeof r!="object"&&this.options.overloadTranslationOptionHandler&&(r=this.options.overloadTranslationOptionHandler(arguments)),typeof r=="object"&&(r={...r}),r||(r={}),e==null)return"";typeof e=="function"&&(e=Oh(e,{...this.options,...r})),Array.isArray(e)||(e=[String(e)]);const o=r.returnDetails!==void 0?r.returnDetails:this.options.returnDetails,u=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,{key:l,namespaces:f}=this.extractFromKey(e[e.length-1],r),h=f[f.length-1];let m=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;m===void 0&&(m=":");const g=r.lng||this.language,b=r.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(g?.toLowerCase()==="cimode")return b?o?{res:`${h}${m}${l}`,usedKey:l,exactUsedKey:l,usedLng:g,usedNS:h,usedParams:this.getUsedParamsDetails(r)}:`${h}${m}${l}`:o?{res:l,usedKey:l,exactUsedKey:l,usedLng:g,usedNS:h,usedParams:this.getUsedParamsDetails(r)}:l;const C=this.resolve(e,r);let E=C?.res;const k=C?.usedKey||l,_=C?.exactUsedKey||l,w=["[object Number]","[object Function]","[object RegExp]"],O=r.joinArrays!==void 0?r.joinArrays:this.options.joinArrays,D=!this.i18nFormat||this.i18nFormat.handleAsObject,x=r.count!==void 0&&!Ee(r.count),R=Gl.hasDefaultValue(r),M=x?this.pluralResolver.getSuffix(g,r.count,r):"",L=r.ordinal&&x?this.pluralResolver.getSuffix(g,r.count,{ordinal:!1}):"",B=x&&!r.ordinal&&r.count===0,V=B&&r[`defaultValue${this.options.pluralSeparator}zero`]||r[`defaultValue${M}`]||r[`defaultValue${L}`]||r.defaultValue;let P=E;D&&!E&&R&&(P=V);const z=Jf(P),W=Object.prototype.toString.apply(P);if(D&&P&&z&&w.indexOf(W)<0&&!(Ee(O)&&Array.isArray(P))){if(!r.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const J=this.options.returnedObjectHandler?this.options.returnedObjectHandler(k,P,{...r,ns:f}):`key '${l} (${this.language})' returned an object instead of string.`;return o?(C.res=J,C.usedParams=this.getUsedParamsDetails(r),C):J}if(u){const J=Array.isArray(P),he=J?[]:{},we=J?_:k;for(const H in P)if(Object.prototype.hasOwnProperty.call(P,H)){const re=`${we}${u}${H}`;R&&!E?he[H]=this.translate(re,{...r,defaultValue:Jf(V)?V[H]:void 0,joinArrays:!1,ns:f}):he[H]=this.translate(re,{...r,joinArrays:!1,ns:f}),he[H]===re&&(he[H]=P[H])}E=he}}else if(D&&Ee(O)&&Array.isArray(E))E=E.join(O),E&&(E=this.extendTranslation(E,e,r,i));else{let J=!1,he=!1;!this.isValidLookup(E)&&R&&(J=!0,E=V),this.isValidLookup(E)||(he=!0,E=l);const H=(r.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&he?void 0:E,re=R&&V!==E&&this.options.updateMissing;if(he||J||re){if(this.logger.log(re?"updateKey":"missingKey",g,h,l,re?V:E),u){const I=this.resolve(l,{...r,keySeparator:!1});I&&I.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let fe=[];const Re=this.languageUtils.getFallbackCodes(this.options.fallbackLng,r.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Re&&Re[0])for(let I=0;I<Re.length;I++)fe.push(Re[I]);else this.options.saveMissingTo==="all"?fe=this.languageUtils.toResolveHierarchy(r.lng||this.language):fe.push(r.lng||this.language);const Me=(I,Q,oe)=>{const de=R&&oe!==E?oe:H;this.options.missingKeyHandler?this.options.missingKeyHandler(I,h,Q,de,re,r):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(I,h,Q,de,re,r),this.emit("missingKey",I,h,Q,E)};this.options.saveMissing&&(this.options.saveMissingPlurals&&x?fe.forEach(I=>{const Q=this.pluralResolver.getSuffixes(I,r);B&&r[`defaultValue${this.options.pluralSeparator}zero`]&&Q.indexOf(`${this.options.pluralSeparator}zero`)<0&&Q.push(`${this.options.pluralSeparator}zero`),Q.forEach(oe=>{Me([I],l+oe,r[`defaultValue${oe}`]||V)})}):Me(fe,l,V))}E=this.extendTranslation(E,e,r,C,i),he&&E===l&&this.options.appendNamespaceToMissingKey&&(E=`${h}${m}${l}`),(he||J)&&this.options.parseMissingKeyHandler&&(E=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${h}${m}${l}`:l,J?E:void 0,r))}return o?(C.res=E,C.usedParams=this.getUsedParamsDetails(r),C):E}extendTranslation(e,t,i,r,o){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const f=Ee(e)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let h;if(f){const g=e.match(this.interpolator.nestingRegexp);h=g&&g.length}let m=i.replace&&!Ee(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(m={...this.options.interpolation.defaultVariables,...m}),e=this.interpolator.interpolate(e,m,i.lng||this.language||r.usedLng,i),f){const g=e.match(this.interpolator.nestingRegexp),b=g&&g.length;h<b&&(i.nest=!1)}!i.lng&&r&&r.res&&(i.lng=this.language||r.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,(...g)=>o?.[0]===g[0]&&!i.context?(this.logger.warn(`It seems you are nesting recursively key: ${g[0]} in key: ${t[0]}`),null):this.translate(...g,t),i)),i.interpolation&&this.interpolator.reset()}const u=i.postProcess||this.options.postProcess,l=Ee(u)?[u]:u;return e!=null&&l?.length&&i.applyPostProcessor!==!1&&(e=YS.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e,t={}){let i,r,o,u,l;return Ee(e)&&(e=[e]),e.forEach(f=>{if(this.isValidLookup(i))return;const h=this.extractFromKey(f,t),m=h.key;r=m;let g=h.namespaces;this.options.fallbackNS&&(g=g.concat(this.options.fallbackNS));const b=t.count!==void 0&&!Ee(t.count),C=b&&!t.ordinal&&t.count===0,E=t.context!==void 0&&(Ee(t.context)||typeof t.context=="number")&&t.context!=="",k=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);g.forEach(_=>{this.isValidLookup(i)||(l=_,!Eb[`${k[0]}-${_}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(l)&&(Eb[`${k[0]}-${_}`]=!0,this.logger.warn(`key "${r}" for languages "${k.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),k.forEach(w=>{if(this.isValidLookup(i))return;u=w;const O=[m];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(O,m,w,_,t);else{let x;b&&(x=this.pluralResolver.getSuffix(w,t.count,t));const R=`${this.options.pluralSeparator}zero`,M=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(b&&(t.ordinal&&x.indexOf(M)===0&&O.push(m+x.replace(M,this.options.pluralSeparator)),O.push(m+x),C&&O.push(m+R)),E){const L=`${m}${this.options.contextSeparator||"_"}${t.context}`;O.push(L),b&&(t.ordinal&&x.indexOf(M)===0&&O.push(L+x.replace(M,this.options.pluralSeparator)),O.push(L+x),C&&O.push(L+R))}}let D;for(;D=O.pop();)this.isValidLookup(i)||(o=D,i=this.getResource(w,_,D,t))}))})}),{res:i,usedKey:r,exactUsedKey:o,usedLng:u,usedNS:l}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,i,r={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,i,r):this.resourceStore.getResource(e,t,i,r)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!Ee(e.replace);let r=i?e.replace:e;if(i&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!i){r={...r};for(const o of t)delete r[o]}return r}static hasDefaultValue(e){const t="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&e[i]!==void 0)return!0;return!1}}class xb{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=oi.create("languageUtils")}getScriptPartFromCode(e){if(e=Io(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=Io(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(Ee(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(i=>{if(t)return;const r=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(i=>{if(t)return;const r=this.getScriptPartFromCode(i);if(this.isSupportedCode(r))return t=r;const o=this.getLanguagePartFromCode(i);if(this.isSupportedCode(o))return t=o;t=this.options.supportedLngs.find(u=>{if(u===o)return u;if(!(u.indexOf("-")<0&&o.indexOf("-")<0)&&(u.indexOf("-")>0&&o.indexOf("-")<0&&u.substring(0,u.indexOf("-"))===o||u.indexOf(o)===0&&o.length>1))return u})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),Ee(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes((t===!1?[]:t)||this.options.fallbackLng||[],e),r=[],o=u=>{u&&(this.isSupportedCode(u)?r.push(u):this.logger.warn(`rejecting language code not found in supportedLngs: ${u}`))};return Ee(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(e))):Ee(e)&&o(this.formatLanguageCode(e)),i.forEach(u=>{r.indexOf(u)<0&&o(this.formatLanguageCode(u))}),r}}const Rb={zero:0,one:1,two:2,few:3,many:4,other:5},_b={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class r_{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=oi.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const i=Io(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:i,type:r});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let u;try{u=new Intl.PluralRules(i,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),_b;if(!e.match(/-|_/))return _b;const f=this.languageUtils.getLanguagePartFromCode(e);u=this.getRule(f,t)}return this.pluralRulesCache[o]=u,u}needsPlural(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,i={}){return this.getSuffixes(e,i).map(r=>`${t}${r}`)}getSuffixes(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?i.resolvedOptions().pluralCategories.sort((r,o)=>Rb[r]-Rb[o]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):[]}getSuffix(e,t,i={}){const r=this.getRule(e,i);return r?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,i))}}const wb=(n,e,t,i=".",r=!0)=>{let o=XR(n,e,t);return!o&&r&&Ee(t)&&(o=Nh(n,t,i),o===void 0&&(o=Nh(e,t,i))),o},Qf=n=>n.replace(/\$/g,"$$$$");class Mb{constructor(e={}){this.logger=oi.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(t=>t),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:r,prefix:o,prefixEscaped:u,suffix:l,suffixEscaped:f,formatSeparator:h,unescapeSuffix:m,unescapePrefix:g,nestingPrefix:b,nestingPrefixEscaped:C,nestingSuffix:E,nestingSuffixEscaped:k,nestingOptionsSeparator:_,maxReplaces:w,alwaysFormat:O}=e.interpolation;this.escape=t!==void 0?t:ZR,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=o?Fa(o):u||"{{",this.suffix=l?Fa(l):f||"}}",this.formatSeparator=h||",",this.unescapePrefix=m?"":g||"-",this.unescapeSuffix=this.unescapePrefix?"":m||"",this.nestingPrefix=b?Fa(b):C||Fa("$t("),this.nestingSuffix=E?Fa(E):k||Fa(")"),this.nestingOptionsSeparator=_||",",this.maxReplaces=w||1e3,this.alwaysFormat=O!==void 0?O:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,i)=>t?.source===i?(t.lastIndex=0,t):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,i,r){let o,u,l;const f=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=C=>{if(C.indexOf(this.formatSeparator)<0){const w=wb(t,f,C,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(w,void 0,i,{...r,...t,interpolationkey:C}):w}const E=C.split(this.formatSeparator),k=E.shift().trim(),_=E.join(this.formatSeparator).trim();return this.format(wb(t,f,k,this.options.keySeparator,this.options.ignoreJSONStructure),_,i,{...r,...t,interpolationkey:k})};this.resetRegExp();const m=r?.missingInterpolationHandler||this.options.missingInterpolationHandler,g=r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:C=>Qf(C)},{regex:this.regexp,safeValue:C=>this.escapeValue?Qf(this.escape(C)):Qf(C)}].forEach(C=>{for(l=0;o=C.regex.exec(e);){const E=o[1].trim();if(u=h(E),u===void 0)if(typeof m=="function"){const _=m(e,o,r);u=Ee(_)?_:""}else if(r&&Object.prototype.hasOwnProperty.call(r,E))u="";else if(g){u=o[0];continue}else this.logger.warn(`missed to pass in variable ${E} for interpolating ${e}`),u="";else!Ee(u)&&!this.useRawValueToEscape&&(u=bb(u));const k=C.safeValue(u);if(e=e.replace(o[0],k),g?(C.regex.lastIndex+=u.length,C.regex.lastIndex-=o[0].length):C.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),e}nest(e,t,i={}){let r,o,u;const l=(f,h)=>{const m=this.nestingOptionsSeparator;if(f.indexOf(m)<0)return f;const g=f.split(new RegExp(`${m}[ ]*{`));let b=`{${g[1]}`;f=g[0],b=this.interpolate(b,u);const C=b.match(/'/g),E=b.match(/"/g);((C?.length??0)%2===0&&!E||E.length%2!==0)&&(b=b.replace(/'/g,'"'));try{u=JSON.parse(b),h&&(u={...h,...u})}catch(k){return this.logger.warn(`failed parsing options string in nesting for key ${f}`,k),`${f}${m}${b}`}return u.defaultValue&&u.defaultValue.indexOf(this.prefix)>-1&&delete u.defaultValue,f};for(;r=this.nestingRegexp.exec(e);){let f=[];u={...i},u=u.replace&&!Ee(u.replace)?u.replace:u,u.applyPostProcessor=!1,delete u.defaultValue;const h=/{.*}/.test(r[1])?r[1].lastIndexOf("}")+1:r[1].indexOf(this.formatSeparator);if(h!==-1&&(f=r[1].slice(h).split(this.formatSeparator).map(m=>m.trim()).filter(Boolean),r[1]=r[1].slice(0,h)),o=t(l.call(this,r[1].trim(),u),u),o&&r[0]===e&&!Ee(o))return o;Ee(o)||(o=bb(o)),o||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),o=""),f.length&&(o=f.reduce((m,g)=>this.format(m,g,i.lng,{...i,interpolationkey:r[1].trim()}),o.trim())),e=e.replace(r[0],o),this.regexp.lastIndex=0}return e}}const o_=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const i=n.split("(");e=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(u=>{if(u){const[l,...f]=u.split(":"),h=f.join(":").trim().replace(/^'+|'+$/g,""),m=l.trim();t[m]||(t[m]=h),h==="false"&&(t[m]=!1),h==="true"&&(t[m]=!0),isNaN(h)||(t[m]=parseInt(h,10))}})}return{formatName:e,formatOptions:t}},Nb=n=>{const e={};return(t,i,r)=>{let o=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(o={...o,[r.interpolationkey]:void 0});const u=i+JSON.stringify(o);let l=e[u];return l||(l=n(Io(i),r),e[u]=l),l(t)}},c_=n=>(e,t,i)=>n(Io(t),i)(e);class l_{constructor(e={}){this.logger=oi.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const i=t.cacheInBuiltFormats?Nb:c_;this.formats={number:i((r,o)=>{const u=new Intl.NumberFormat(r,{...o});return l=>u.format(l)}),currency:i((r,o)=>{const u=new Intl.NumberFormat(r,{...o,style:"currency"});return l=>u.format(l)}),datetime:i((r,o)=>{const u=new Intl.DateTimeFormat(r,{...o});return l=>u.format(l)}),relativetime:i((r,o)=>{const u=new Intl.RelativeTimeFormat(r,{...o});return l=>u.format(l,o.range||"day")}),list:i((r,o)=>{const u=new Intl.ListFormat(r,{...o});return l=>u.format(l)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Nb(t)}format(e,t,i,r={}){const o=t.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(l=>l.indexOf(")")>-1)){const l=o.findIndex(f=>f.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,l)].join(this.formatSeparator)}return o.reduce((l,f)=>{const{formatName:h,formatOptions:m}=o_(f);if(this.formats[h]){let g=l;try{const b=r?.formatParams?.[r.interpolationkey]||{},C=b.locale||b.lng||r.locale||r.lng||i;g=this.formats[h](l,C,{...m,...r,...b})}catch(b){this.logger.warn(b)}return g}else this.logger.warn(`there was no format function for ${h}`);return l},e)}}const u_=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class d_ extends gu{constructor(e,t,i,r={}){super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=r,this.logger=oi.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,r.backend,r)}queueLoad(e,t,i,r){const o={},u={},l={},f={};return e.forEach(h=>{let m=!0;t.forEach(g=>{const b=`${h}|${g}`;!i.reload&&this.store.hasResourceBundle(h,g)?this.state[b]=2:this.state[b]<0||(this.state[b]===1?u[b]===void 0&&(u[b]=!0):(this.state[b]=1,m=!1,u[b]===void 0&&(u[b]=!0),o[b]===void 0&&(o[b]=!0),f[g]===void 0&&(f[g]=!0)))}),m||(l[h]=!0)}),(Object.keys(o).length||Object.keys(u).length)&&this.queue.push({pending:u,pendingCount:Object.keys(u).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(o),pending:Object.keys(u),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(f)}}loaded(e,t,i){const r=e.split("|"),o=r[0],u=r[1];t&&this.emit("failedLoading",o,u,t),!t&&i&&this.store.addResourceBundle(o,u,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const l={};this.queue.forEach(f=>{QR(f.loaded,[o],u),u_(f,e),t&&f.errors.push(t),f.pendingCount===0&&!f.done&&(Object.keys(f.loaded).forEach(h=>{l[h]||(l[h]={});const m=f.loaded[h];m.length&&m.forEach(g=>{l[h][g]===void 0&&(l[h][g]=!0)})}),f.done=!0,f.errors.length?f.callback(f.errors):f.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(f=>!f.done)}read(e,t,i,r=0,o=this.retryTimeout,u){if(!e.length)return u(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:i,tried:r,wait:o,callback:u});return}this.readingCalls++;const l=(h,m)=>{if(this.readingCalls--,this.waitingReads.length>0){const g=this.waitingReads.shift();this.read(g.lng,g.ns,g.fcName,g.tried,g.wait,g.callback)}if(h&&m&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,i,r+1,o*2,u)},o);return}u(h,m)},f=this.backend[i].bind(this.backend);if(f.length===2){try{const h=f(e,t);h&&typeof h.then=="function"?h.then(m=>l(null,m)).catch(l):l(null,h)}catch(h){l(h)}return}return f(e,t,l)}prepareLoading(e,t,i={},r){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();Ee(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Ee(t)&&(t=[t]);const o=this.queueLoad(e,t,i,r);if(!o.toLoad.length)return o.pending.length||r(),null;o.toLoad.forEach(u=>{this.loadOne(u)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e,t=""){const i=e.split("|"),r=i[0],o=i[1];this.read(r,o,"read",void 0,void 0,(u,l)=>{u&&this.logger.warn(`${t}loading namespace ${o} for language ${r} failed`,u),!u&&l&&this.logger.log(`${t}loaded namespace ${o} for language ${r}`,l),this.loaded(e,u,l)})}saveMissing(e,t,i,r,o,u={},l=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend?.create){const f={...u,isUpdate:o},h=this.backend.create.bind(this.backend);if(h.length<6)try{let m;h.length===5?m=h(e,t,i,r,f):m=h(e,t,i,r),m&&typeof m.then=="function"?m.then(g=>l(null,g)).catch(l):l(null,m)}catch(m){l(m)}else h(e,t,i,r,l,f)}!e||!e[0]||this.store.addResource(e[0],t,i,r)}}}const Xf=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),Ee(n[1])&&(e.defaultValue=n[1]),Ee(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(i=>{e[i]=t[i]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Ob=n=>(Ee(n.ns)&&(n.ns=[n.ns]),Ee(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),Ee(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs?.indexOf?.("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n),Sl=()=>{},f_=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})},h_=n=>!!(n?.modules?.backend?.name?.indexOf("Locize")>0||n?.modules?.backend?.constructor?.name?.indexOf("Locize")>0||n?.options?.backend?.backends&&n.options.backend.backends.some(e=>e?.name?.indexOf("Locize")>0||e?.constructor?.name?.indexOf("Locize")>0));class Mo extends gu{constructor(e={},t){if(super(),this.options=Ob(e),this.services={},this.logger=oi,this.modules={external:[]},f_(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,typeof e=="function"&&(t=e,e={}),e.defaultNS==null&&e.ns&&(Ee(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const i=Xf();this.options={...i,...this.options,...Ob(e)},this.options.interpolation={...i.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=i.overloadTranslationOptionHandler),this.options.showSupportNotice!==!1&&!h_(this)&&typeof console<"u"&&typeof console.info<"u"&&console.info(" i18next is maintained with support from locize.com  consider powering your project with managed localization (AI, CDN, integrations): https://locize.com ");const r=h=>h?typeof h=="function"?new h:h:null;if(!this.options.isClone){this.modules.logger?oi.init(r(this.modules.logger),this.options):oi.init(null,this.options);let h;this.modules.formatter?h=this.modules.formatter:h=l_;const m=new xb(this.options);this.store=new Tb(this.options.resources,this.options);const g=this.services;g.logger=oi,g.resourceStore=this.store,g.languageUtils=m,g.pluralResolver=new r_(m,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),h&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(g.formatter=r(h),g.formatter.init&&g.formatter.init(g,this.options),this.options.interpolation.format=g.formatter.format.bind(g.formatter)),g.interpolator=new Mb(this.options),g.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},g.backendConnector=new d_(r(this.modules.backend),g.resourceStore,g,this.options),g.backendConnector.on("*",(C,...E)=>{this.emit(C,...E)}),this.modules.languageDetector&&(g.languageDetector=r(this.modules.languageDetector),g.languageDetector.init&&g.languageDetector.init(g,this.options.detection,this.options)),this.modules.i18nFormat&&(g.i18nFormat=r(this.modules.i18nFormat),g.i18nFormat.init&&g.i18nFormat.init(this)),this.translator=new Gl(this.services,this.options),this.translator.on("*",(C,...E)=>{this.emit(C,...E)}),this.modules.external.forEach(C=>{C.init&&C.init(this)})}if(this.format=this.options.interpolation.format,t||(t=Sl),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const h=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);h.length>0&&h[0]!=="dev"&&(this.options.lng=h[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(h=>{this[h]=(...m)=>this.store[h](...m)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(h=>{this[h]=(...m)=>(this.store[h](...m),this)});const l=go(),f=()=>{const h=(m,g)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(g),t(m,g)};if(this.languages&&!this.isInitialized)return h(null,this.t.bind(this));this.changeLanguage(this.options.lng,h)};return this.options.resources||!this.options.initAsync?f():setTimeout(f,0),l}loadResources(e,t=Sl){let i=t;const r=Ee(e)?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const o=[],u=l=>{if(!l||l==="cimode")return;this.services.languageUtils.toResolveHierarchy(l).forEach(h=>{h!=="cimode"&&o.indexOf(h)<0&&o.push(h)})};r?u(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(f=>u(f)),this.options.preload?.forEach?.(l=>u(l)),this.services.backendConnector.load(o,this.options.ns,l=>{!l&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(l)})}else i(null)}reloadResources(e,t,i){const r=go();return typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=Sl),this.services.backendConnector.reload(e,t,o=>{r.resolve(),i(o)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&YS.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let t=0;t<this.languages.length;t++){const i=this.languages[t];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const i=go();this.emit("languageChanging",e);const r=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},o=(l,f)=>{f?this.isLanguageChangingTo===e&&(r(f),this.translator.changeLanguage(f),this.isLanguageChangingTo=void 0,this.emit("languageChanged",f),this.logger.log("languageChanged",f)):this.isLanguageChangingTo=void 0,i.resolve((...h)=>this.t(...h)),t&&t(l,(...h)=>this.t(...h))},u=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const f=Ee(l)?l:l&&l[0],h=this.store.hasLanguageSomeTranslations(f)?f:this.services.languageUtils.getBestMatchFromCodes(Ee(l)?[l]:l);h&&(this.language||r(h),this.translator.language||this.translator.changeLanguage(h),this.services.languageDetector?.cacheUserLanguage?.(h)),this.loadResources(h,m=>{o(m,h)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?u(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(u):this.services.languageDetector.detect(u):u(e),i}getFixedT(e,t,i){const r=(o,u,...l)=>{let f;typeof u!="object"?f=this.options.overloadTranslationOptionHandler([o,u].concat(l)):f={...u},f.lng=f.lng||r.lng,f.lngs=f.lngs||r.lngs,f.ns=f.ns||r.ns,f.keyPrefix!==""&&(f.keyPrefix=f.keyPrefix||i||r.keyPrefix);const h=this.options.keySeparator||".";let m;return f.keyPrefix&&Array.isArray(o)?m=o.map(g=>(typeof g=="function"&&(g=Oh(g,{...this.options,...u})),`${f.keyPrefix}${h}${g}`)):(typeof o=="function"&&(o=Oh(o,{...this.options,...u})),m=f.keyPrefix?`${f.keyPrefix}${h}${o}`:o),this.t(m,f)};return Ee(e)?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=i,r}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const u=(l,f)=>{const h=this.services.backendConnector.state[`${l}|${f}`];return h===-1||h===0||h===2};if(t.precheck){const l=t.precheck(this,u);if(l!==void 0)return l}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||u(i,e)&&(!r||u(o,e)))}loadNamespaces(e,t){const i=go();return this.options.ns?(Ee(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{i.resolve(),t&&t(r)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=go();Ee(e)&&(e=[e]);const r=this.options.preload||[],o=e.filter(u=>r.indexOf(u)<0&&this.services.languageUtils.isSupportedCode(u));return o.length?(this.options.preload=r.concat(o),this.loadResources(u=>{i.resolve(),t&&t(u)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const r=new Intl.Locale(e);if(r&&r.getTextInfo){const o=r.getTextInfo();if(o&&o.direction)return o.direction}}catch{}const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services?.languageUtils||new xb(Xf());return e.toLowerCase().indexOf("-latn")>1?"ltr":t.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){const i=new Mo(e,t);return i.createInstance=Mo.createInstance,i}cloneInstance(e={},t=Sl){const i=e.forkResourceStore;i&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},o=new Mo(r);if((e.debug!==void 0||e.prefix!==void 0)&&(o.logger=o.logger.clone(e)),["store","services","language"].forEach(l=>{o[l]=this[l]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},i){const l=Object.keys(this.store.data).reduce((f,h)=>(f[h]={...this.store.data[h]},f[h]=Object.keys(f[h]).reduce((m,g)=>(m[g]={...f[h][g]},m),f[h]),f),{});o.store=new Tb(l,r),o.services.resourceStore=o.store}if(e.interpolation){const f={...Xf().interpolation,...this.options.interpolation,...e.interpolation},h={...r,interpolation:f};o.services.interpolator=new Mb(h)}return o.translator=new Gl(o.services,r),o.translator.on("*",(l,...f)=>{o.emit(l,...f)}),o.init(r,t),o.translator.options=r,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const sn=Mo.createInstance();sn.createInstance;sn.dir;sn.init;sn.loadResources;sn.reloadResources;sn.use;sn.changeLanguage;sn.getFixedT;sn.t;sn.exists;sn.setDefaultNamespace;sn.hasLoadedNamespace;sn.loadNamespaces;sn.loadLanguages;const m_=(n,e,t,i)=>{const r=[t,{code:e,...i||{}}];if(n?.services?.logger?.forward)return n.services.logger.forward(r,"warn","react-i18next::",!0);Ws(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),n?.services?.logger?.warn?n.services.logger.warn(...r):console?.warn&&console.warn(...r)},Db={},QS=(n,e,t,i)=>{Ws(t)&&Db[t]||(Ws(t)&&(Db[t]=new Date),m_(n,e,t,i))},XS=(n,e)=>()=>{if(n.isInitialized)e();else{const t=()=>{setTimeout(()=>{n.off("initialized",t)},0),e()};n.on("initialized",t)}},Dh=(n,e,t)=>{n.loadNamespaces(e,XS(n,t))},Ab=(n,e,t,i)=>{if(Ws(t)&&(t=[t]),n.options.preload&&n.options.preload.indexOf(e)>-1)return Dh(n,t,i);t.forEach(r=>{n.options.ns.indexOf(r)<0&&n.options.ns.push(r)}),n.loadLanguages(e,XS(n,i))},p_=(n,e,t={})=>!e.languages||!e.languages.length?(QS(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(n,{lng:t.lng,precheck:(i,r)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!r(i.isLanguageChangingTo,n))return!1}}),Ws=n=>typeof n=="string",g_=n=>typeof n=="object"&&n!==null,v_=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,y_={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},b_=n=>y_[n],S_=n=>n.replace(v_,b_);let Ah={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:S_,transDefaultProps:void 0};const C_=(n={})=>{Ah={...Ah,...n}},k_=()=>Ah;let WS;const T_=n=>{WS=n},E_=()=>WS,x_={type:"3rdParty",init(n){C_(n.options.react),T_(n)}},R_=T.createContext();class __{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var Wf={exports:{}},Zf={};var Pb;function w_(){if(Pb)return Zf;Pb=1;var n=du();function e(g,b){return g===b&&(g!==0||1/g===1/b)||g!==g&&b!==b}var t=typeof Object.is=="function"?Object.is:e,i=n.useState,r=n.useEffect,o=n.useLayoutEffect,u=n.useDebugValue;function l(g,b){var C=b(),E=i({inst:{value:C,getSnapshot:b}}),k=E[0].inst,_=E[1];return o(function(){k.value=C,k.getSnapshot=b,f(k)&&_({inst:k})},[g,C,b]),r(function(){return f(k)&&_({inst:k}),g(function(){f(k)&&_({inst:k})})},[g]),u(C),C}function f(g){var b=g.getSnapshot;g=g.value;try{var C=b();return!t(g,C)}catch{return!0}}function h(g,b){return b()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?h:l;return Zf.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:m,Zf}var Lb;function M_(){return Lb||(Lb=1,Wf.exports=w_()),Wf.exports}var N_=M_();const O_=(n,e)=>Ws(e)?e:g_(e)&&Ws(e.defaultValue)?e.defaultValue:Array.isArray(n)?n[n.length-1]:n,D_={t:O_,ready:!1},A_=()=>()=>{},Te=(n,e={})=>{const{i18n:t}=e,{i18n:i,defaultNS:r}=T.useContext(R_)||{},o=t||i||E_();o&&!o.reportNamespaces&&(o.reportNamespaces=new __),o||QS(o,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const u=T.useMemo(()=>({...k_(),...o?.options?.react,...e}),[o,e]),{useSuspense:l,keyPrefix:f}=u,h=n||r||o?.options?.defaultNS,m=Ws(h)?[h]:h||["translation"],g=T.useMemo(()=>m,m);o?.reportNamespaces?.addUsedNamespaces?.(g);const b=T.useRef(0),C=T.useCallback(V=>{if(!o)return A_;const{bindI18n:P,bindI18nStore:z}=u,W=()=>{b.current+=1,V()};return P&&o.on(P,W),z&&o.store.on(z,W),()=>{P&&P.split(" ").forEach(J=>o.off(J,W)),z&&z.split(" ").forEach(J=>o.store.off(J,W))}},[o,u]),E=T.useRef(),k=T.useCallback(()=>{if(!o)return D_;const V=!!(o.isInitialized||o.initializedStoreOnce)&&g.every(we=>p_(we,o,u)),P=e.lng||o.language,z=b.current,W=E.current;if(W&&W.ready===V&&W.lng===P&&W.keyPrefix===f&&W.revision===z)return W;const he={t:o.getFixedT(P,u.nsMode==="fallback"?g:g[0],f),ready:V,lng:P,keyPrefix:f,revision:z};return E.current=he,he},[o,g,f,u,e.lng]),[_,w]=T.useState(0),{t:O,ready:D}=N_.useSyncExternalStore(C,k,k);T.useEffect(()=>{if(o&&!D&&!l){const V=()=>w(P=>P+1);e.lng?Ab(o,e.lng,g,V):Dh(o,g,V)}},[o,e.lng,g,D,l,_]);const x=o||{},R=T.useRef(null),M=T.useRef(),L=V=>{const P=Object.getOwnPropertyDescriptors(V);P.__original&&delete P.__original;const z=Object.create(Object.getPrototypeOf(V),P);if(!Object.prototype.hasOwnProperty.call(z,"__original"))try{Object.defineProperty(z,"__original",{value:V,writable:!1,enumerable:!1,configurable:!1})}catch{}return z},B=T.useMemo(()=>{const V=x,P=V?.language;let z=V;V&&(R.current&&R.current.__original===V?M.current!==P?(z=L(V),R.current=z,M.current=P):z=R.current:(z=L(V),R.current=z,M.current=P));const W=[O,z,D];return W.t=O,W.i18n=z,W.ready=D,W},[O,x,D,x.resolvedLanguage,x.language,x.languages]);if(o&&l&&!D)throw new Promise(V=>{const P=()=>V();e.lng?Ab(o,e.lng,g,P):Dh(o,g,P)});return B},{slice:P_,forEach:L_}=[];function j_(n){return L_.call(P_.call(arguments,1),e=>{if(e)for(const t in e)n[t]===void 0&&(n[t]=e[t])}),n}function I_(n){return typeof n!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(t=>t.test(n))}const jb=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,U_=function(n,e){const i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},r=encodeURIComponent(e);let o=`${n}=${r}`;if(i.maxAge>0){const u=i.maxAge-0;if(Number.isNaN(u))throw new Error("maxAge should be a Number");o+=`; Max-Age=${Math.floor(u)}`}if(i.domain){if(!jb.test(i.domain))throw new TypeError("option domain is invalid");o+=`; Domain=${i.domain}`}if(i.path){if(!jb.test(i.path))throw new TypeError("option path is invalid");o+=`; Path=${i.path}`}if(i.expires){if(typeof i.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+=`; Expires=${i.expires.toUTCString()}`}if(i.httpOnly&&(o+="; HttpOnly"),i.secure&&(o+="; Secure"),i.sameSite)switch(typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i.partitioned&&(o+="; Partitioned"),o},Ib={create(n,e,t,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(r.expires=new Date,r.expires.setTime(r.expires.getTime()+t*60*1e3)),i&&(r.domain=i),document.cookie=U_(n,e,r)},read(n){const e=`${n}=`,t=document.cookie.split(";");for(let i=0;i<t.length;i++){let r=t[i];for(;r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(e)===0)return r.substring(e.length,r.length)}return null},remove(n,e){this.create(n,"",-1,e)}};var B_={name:"cookie",lookup(n){let{lookupCookie:e}=n;if(e&&typeof document<"u")return Ib.read(e)||void 0},cacheUserLanguage(n,e){let{lookupCookie:t,cookieMinutes:i,cookieDomain:r,cookieOptions:o}=e;t&&typeof document<"u"&&Ib.create(t,n,i,r,o)}},z_={name:"querystring",lookup(n){let{lookupQuerystring:e}=n,t;if(typeof window<"u"){let{search:i}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(i=window.location.hash.substring(window.location.hash.indexOf("?")));const o=i.substring(1).split("&");for(let u=0;u<o.length;u++){const l=o[u].indexOf("=");l>0&&o[u].substring(0,l)===e&&(t=o[u].substring(l+1))}}return t}},V_={name:"hash",lookup(n){let{lookupHash:e,lookupFromHashIndex:t}=n,i;if(typeof window<"u"){const{hash:r}=window.location;if(r&&r.length>2){const o=r.substring(1);if(e){const u=o.split("&");for(let l=0;l<u.length;l++){const f=u[l].indexOf("=");f>0&&u[l].substring(0,f)===e&&(i=u[l].substring(f+1))}}if(i)return i;if(!i&&t>-1){const u=r.match(/\/([a-zA-Z-]*)/g);return Array.isArray(u)?u[typeof t=="number"?t:0]?.replace("/",""):void 0}}}return i}};let qa=null;const Ub=()=>{if(qa!==null)return qa;try{if(qa=typeof window<"u"&&window.localStorage!==null,!qa)return!1;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{qa=!1}return qa};var F_={name:"localStorage",lookup(n){let{lookupLocalStorage:e}=n;if(e&&Ub())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupLocalStorage:t}=e;t&&Ub()&&window.localStorage.setItem(t,n)}};let Ha=null;const Bb=()=>{if(Ha!==null)return Ha;try{if(Ha=typeof window<"u"&&window.sessionStorage!==null,!Ha)return!1;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{Ha=!1}return Ha};var q_={name:"sessionStorage",lookup(n){let{lookupSessionStorage:e}=n;if(e&&Bb())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupSessionStorage:t}=e;t&&Bb()&&window.sessionStorage.setItem(t,n)}},H_={name:"navigator",lookup(n){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:i,language:r}=navigator;if(t)for(let o=0;o<t.length;o++)e.push(t[o]);i&&e.push(i),r&&e.push(r)}return e.length>0?e:void 0}},$_={name:"htmlTag",lookup(n){let{htmlTag:e}=n,t;const i=e||(typeof document<"u"?document.documentElement:null);return i&&typeof i.getAttribute=="function"&&(t=i.getAttribute("lang")),t}},K_={name:"path",lookup(n){let{lookupFromPathIndex:e}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?t[typeof e=="number"?e:0]?.replace("/",""):void 0}},G_={name:"subdomain",lookup(n){let{lookupFromSubdomainIndex:e}=n;const t=typeof e=="number"?e+1:1,i=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(i)return i[t]}};let ZS=!1;try{document.cookie,ZS=!0}catch{}const eC=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];ZS||eC.splice(1,1);const Y_=()=>({order:eC,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n});class tC{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=j_(t,this.options||{},Y_()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=r=>r.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=i,this.addDetector(B_),this.addDetector(z_),this.addDetector(F_),this.addDetector(q_),this.addDetector(H_),this.addDetector($_),this.addDetector(K_),this.addDetector(G_),this.addDetector(V_)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,t=[];return e.forEach(i=>{if(this.detectors[i]){let r=this.detectors[i].lookup(this.options);r&&typeof r=="string"&&(r=[r]),r&&(t=t.concat(r))}}),t=t.filter(i=>i!=null&&!I_(i)).map(i=>this.options.convertDetectedLanguage(i)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(i=>{this.detectors[i]&&this.detectors[i].cacheUserLanguage(e,this.options)}))}}tC.type="languageDetector";const J_="mqvi",Q_="Loading...",X_="Save",W_="Cancel",Z_="Edit",ew="Create",tw="Close",nw="Confirm",iw="Back",sw="Next",aw="Submit",rw="Search",ow="Online",cw="Offline",lw="Idle",uw="Do Not Disturb",dw="Error",fw="Success",hw="Something went wrong",mw="No results found",pw="Copied to clipboard",gw="Language",vw="Members",yw="Kick",bw="Ban",Sw="Unban",Cw="Manage Roles",kw="Joined {{date}}",Tw="Roles",Ew="Are you sure you want to kick {{username}}?",xw="Are you sure you want to ban {{username}}?",Rw="Reason for ban",_w="No roles",ww="Warning",Mw="Info",Nw="Settings",Ow="Upload",Dw="Uploading...",Aw="Close Tab",Pw="Server",Lw="Add Server",jw="Messages",Iw="Files",Uw="Send Message",Bw="Quick Switcher",zw="Search channels and DMs...",Vw="Channels",Fw="Direct Messages",qw={appName:J_,loading:Q_,save:X_,cancel:W_,delete:"Delete",edit:Z_,create:ew,close:tw,confirm:nw,back:iw,next:sw,submit:aw,search:rw,online:ow,offline:cw,idle:lw,dnd:uw,error:dw,success:fw,somethingWentWrong:hw,noResults:mw,copySuccess:pw,language:gw,members:vw,kick:yw,ban:bw,unban:Sw,manageRoles:Cw,joinedAt:kw,roles:Tw,confirmKick:Ew,confirmBan:xw,banReason:Rw,noRoles:_w,warning:ww,info:Mw,settings:Nw,upload:Ow,uploading:Dw,closeTab:Aw,server:Pw,addServer:Lw,messages:jw,files:Iw,sendMessage:Uw,quickSwitcher:Bw,quickSwitcherPlaceholder:zw,channels:Vw,directMessages:Fw},Hw="Welcome back!",$w="We're so excited to see you again!",Kw="Create an account",Gw="Username",Yw="Display Name",Jw="Password",Qw="Confirm Password",Xw="Log In",Ww="Logging in...",Zw="Continue",eM="Creating account...",tM="Need an account?",nM="Already have an account?",iM="Register",sM="Log In",aM="Logout",rM="Login failed",oM="Registration failed",cM="Passwords do not match",lM="Password must be at least 8 characters",uM="Invalid username or password",dM="Invite Code",fM="Enter invite code (optional)",hM={welcomeBack:Hw,excitedToSeeYou:$w,createAccount:Kw,username:Gw,displayName:Yw,password:Jw,confirmPassword:Qw,login:Xw,loggingIn:Ww,register:Zw,registering:eM,needAccount:tM,alreadyHaveAccount:nM,registerLink:iM,loginLink:sM,logout:aM,loginFailed:rM,registrationFailed:oM,passwordsDoNotMatch:cM,passwordTooShort:lM,invalidCredentials:uM,inviteCode:dM,inviteCodePlaceholder:fM},mM="Text Channels",pM="Voice Channels",gM="Create Channel",vM="Edit Channel",yM="Delete Channel",bM="Channel Name",SM="Channel Topic",CM="Channel Type",kM="Text",TM="Voice",EM="Are you sure you want to delete #{{name}}?",xM="No channels yet",RM="Channel order updated",_M="Failed to update channel order",wM="Channels",MM="Channel created",NM="Failed to create channel",OM="Channel deleted",DM="Failed to delete channel",AM="Cancel",PM={textChannels:mM,voiceChannels:pM,createChannel:gM,editChannel:vM,deleteChannel:yM,channelName:bM,channelTopic:SM,channelType:CM,text:kM,voice:TM,deleteConfirm:EM,noChannels:xM,reorderSuccess:RM,reorderError:_M,channelsTitle:wM,channelCreated:MM,channelCreateError:NM,channelDeleted:OM,channelDeleteError:DM,cancel:AM},LM="Message #{{channel}}",jM="Edit Message",IM="Delete Message",UM="Are you sure you want to delete this message?",BM="{{user}} is typing...",zM="{{count}} people are typing...",VM="Welcome to #{{channel}}!",FM="This is the start of the #{{channel}} channel.",qM="Today",HM="Yesterday",$M="(edited)",KM="Upload File",GM="File is too large (max {{max}}MB)",YM="Select a channel",JM="cancel",QM="save",XM="Pin Message",WM="Unpin Message",ZM="Pinned Messages",eN="No pinned messages in this channel",tN="Pinned by {{user}}",nN="{{count}} pinned",iN="Search Messages",sN="Search messages...",aN="Searching...",rN="Start typing to search",oN="No results found",cN="{{count}} results",lN="Previous",uN="Next",dN="Direct Messages",fN="No conversations yet",hN="Message @{{user}}",mN="This is the beginning of your conversation with {{user}}.",pN="Copy Message",gN="Copy ID",vN="Add Reaction",yN="Frequently Used",bN="Smileys & People",SN="Gestures",CN="Animals & Nature",kN="Food & Drink",TN="Objects & Symbols",EN="Reply",xN="Replying to {{user}}",RN="Original message was deleted",_N="Unknown User",wN="Click to see attachment",MN="You do not have permission to send messages in this channel",NN={messagePlaceholder:LM,editMessage:jM,deleteMessage:IM,deleteMessageConfirm:UM,typing:BM,typingMultiple:zM,welcomeChannel:VM,channelStart:FM,today:qM,yesterday:HM,edited:$M,uploadFile:KM,fileTooLarge:GM,noChannel:YM,editCancel:JM,editSave:QM,pinMessage:XM,unpinMessage:WM,pinnedMessages:ZM,noPinnedMessages:eN,pinnedBy:tN,pinCount:nN,searchMessages:iN,searchPlaceholder:sN,searching:aN,searchHint:rN,noSearchResults:oN,searchResultCount:cN,searchPrev:lN,searchNext:uN,directMessages:dN,noDMs:fN,dmPlaceholder:hN,dmWelcome:mN,copyMessage:pN,copyId:gN,addReaction:vN,emojiFrequent:yN,emojiPeople:bN,emojiGestures:SN,emojiNature:CN,emojiFood:kN,emojiObjects:TN,replyMessage:EN,replyingTo:xN,replyDeleted:RN,unknownUser:_N,noContent:wN,noSendPermission:MN},ON="Settings",DN="User Settings",AN="Server Settings",PN="Voice & Video",LN="Appearance",jN="Language",IN="Select Language",UN="Profile",BN="Change Avatar",zN="Roles",VN="Members",FN="Channels",qN="Invites",HN="Danger Zone",$N="Create Role",KN="Edit Role",GN="Role Name",YN="Role Color",JN="Permissions",QN="Delete Role",XN='Are you sure you want to delete the role "{{name}}"? This action cannot be undone.',WN="Manage Channels",ZN="Create, edit, and delete channels",eO="Manage Roles",tO="Create, edit, and delete roles below their highest role",nO="Kick Members",iO="Remove members from the server",sO="Ban Members",aO="Permanently ban members from the server",rO="Manage Messages",oO="Delete and edit other members' messages",cO="Send Messages",lO="Send messages in text channels",uO="Read Messages",dO="View messages in text channels",fO="Connect",hO="Join voice channels",mO="Speak",pO="Speak in voice channels",gO="Screen Share",vO="Share screen in voice channels",yO="Administrator",bO="Members with this permission have every permission and can bypass channel-specific overrides",SO="This is a dangerous permission to grant!",CO="Save Changes",kO="You have unsaved changes",TO="This is the default role assigned to all members. It cannot be deleted.",EO="Select a role to edit its settings",xO="General",RO="Display Name",_O="How others see you",wO="Custom Status",MO="Set a custom status",NO="Click to upload avatar",OO="Max 8MB. JPG, PNG, GIF, or WebP.",DO="Select your preferred language",AO="English",PO="Trke",LO="Profile updated successfully",jO="Failed to update profile",IO="Avatar updated",UO="Failed to upload avatar",BO="Server Name",zO="Server Icon",VO="Server settings updated",FO="Failed to update server settings",qO="Coming soon",HO="You don't have permission to access this section",$O="Log Out",KO="Are you sure you want to log out?",GO="Role updated successfully",YO="Role created successfully",JO="Role deleted successfully",QO="Failed to update role",XO="Manage Invites",WO="Create, view, and delete invite links",ZO="Expire After",eD="Max Uses",tD="Create Invite",nD="Creating...",iD="Invite created",sD="Failed to create invite",aD="Invite code copied to clipboard",rD="Failed to copy invite code",oD="Invite deleted",cD="Failed to delete invite",lD="Copy",uD="Delete",dD="Expired",fD="{{count}}d left",hD="{{count}}h left",mD="{{count}}m left",pD="uses",gD="No invite links yet",vD="Loading...",yD="30 minutes",bD="1 hour",SD="6 hours",CD="12 hours",kD="1 day",TD="7 days",ED="Never",xD="No limit",RD="1 use",_D="5 uses",wD="10 uses",MD="25 uses",ND="50 uses",OD="100 uses",DD="Require Invite",AD="When enabled, new members must provide an invite code to register",PD="Input Mode",LD="Voice Activity",jD="Automatically transmit when you speak",ID="Push to Talk",UD="Hold a key to transmit",BD="PTT Key",zD="Click and press a key to bind",VD="Press a key...",FD="Mic Sensitivity",qD="Input Device",HD="Output Device",$D="Default",KD="Output Volume",GD="Join/Leave Sounds",YD="Play a sound when someone joins or leaves voice",JD="Select a channel to edit its permissions",QD="Select a role to edit overrides",XD="Text Permissions",WD="Voice Permissions",ZD="Override role permissions for this channel. Inherit uses the role's default setting.",eA="Channel permission saved",tA="Failed to save channel permission",nA="Inherit",iA="Allow",sA="Deny",aA={title:ON,userSettings:DN,serverSettings:AN,voiceSettings:PN,appearance:LN,language:jN,selectLanguage:IN,profile:UN,changeAvatar:BN,roles:zN,members:VN,channels:FN,invites:qN,dangerZone:HN,createRole:$N,editRole:KN,roleName:GN,roleColor:YN,permissions:JN,deleteRole:QN,confirmDeleteRole:XN,permManageChannels:WN,permManageChannelsDesc:ZN,permManageRoles:eO,permManageRolesDesc:tO,permKickMembers:nO,permKickMembersDesc:iO,permBanMembers:sO,permBanMembersDesc:aO,permManageMessages:rO,permManageMessagesDesc:oO,permSendMessages:cO,permSendMessagesDesc:lO,permReadMessages:uO,permReadMessagesDesc:dO,permConnect:fO,permConnectDesc:hO,permSpeak:mO,permSpeakDesc:pO,permStream:gO,permStreamDesc:vO,permAdmin:yO,permAdminDesc:bO,permAdminWarning:SO,saveChanges:CO,unsavedChanges:kO,defaultRoleWarning:TO,noRoleSelected:EO,general:xO,displayName:RO,displayNamePlaceholder:_O,customStatus:wO,customStatusPlaceholder:MO,avatarUpload:NO,avatarMaxSize:OO,languageDescription:DO,english:AO,turkish:PO,profileSaved:LO,profileSaveError:jO,avatarUploaded:IO,avatarUploadError:UO,serverName:BO,serverIcon:zO,serverSaved:VO,serverSaveError:FO,comingSoon:qO,noPermission:HO,logOut:$O,logOutConfirm:KO,roleSaved:GO,roleCreated:YO,roleDeleted:JO,roleSaveError:QO,permManageInvites:XO,permManageInvitesDesc:WO,inviteExpiry:ZO,inviteMaxUses:eD,inviteCreate:tD,inviteCreating:nD,inviteCreated:iD,inviteCreateError:sD,inviteCopied:aD,inviteCopyError:rD,inviteDeleted:oD,inviteDeleteError:cD,inviteCopy:lD,inviteDelete:uD,inviteExpired:dD,inviteExpiresInDays:fD,inviteExpiresInHours:hD,inviteExpiresInMinutes:mD,inviteUsesLabel:pD,noInvites:gD,loading:vD,expiry30min:yD,expiry1h:bD,expiry6h:SD,expiry12h:CD,expiry1d:kD,expiry7d:TD,expiryNever:ED,usesNoLimit:xD,uses1:RD,uses5:_D,uses10:wD,uses25:MD,uses50:ND,uses100:OD,inviteRequired:DD,inviteRequiredDesc:AD,voiceInputMode:PD,voiceActivity:LD,voiceActivityDesc:jD,pushToTalk:ID,pushToTalkDesc:UD,pttKey:BD,pttKeyHint:zD,pttListening:VD,micSensitivity:FD,inputDevice:qD,outputDevice:HD,defaultDevice:$D,masterVolume:KD,joinLeaveSounds:GD,joinLeaveSoundsDesc:YD,selectChannelToEdit:JD,selectRoleToEdit:QD,textPermissions:XD,voicePermissions:WD,channelPermDesc:ZD,channelPermSaved:eA,channelPermSaveError:tA,permOverrideInherit:nA,permOverrideAllow:iA,permOverrideDeny:sA},rA="Join Voice",oA="Disconnect",cA="Mute",lA="Unmute",uA="Deafen",dA="Undeafen",fA="Share Screen",hA="Stop Sharing",mA="Voice Connected",pA="No one is in this voice channel",gA="Maximum of 2 screen shares reached",vA="This voice channel is full",yA="Connecting...",bA="Reconnecting...",SA="Voice disconnected",CA="Click to join this voice channel",kA="Fullscreen",TA="Exit Fullscreen",EA="Toggle Layout",xA="End Call",RA="Minimize",_A={joinVoice:rA,leaveVoice:oA,mute:cA,unmute:lA,deafen:uA,undeafen:dA,screenShare:fA,stopScreenShare:hA,voiceConnected:mA,noOneInVoice:pA,screenShareLimit:gA,voiceChannelFull:vA,connectingToVoice:yA,reconnectingToVoice:bA,voiceDisconnected:SA,joinVoicePrompt:CA,fullscreen:kA,exitFullscreen:TA,toggleLayout:EA,endCall:xA,minimize:RA},wA="mqvi",MA="Ykleniyor...",NA="Kaydet",OA="ptal",DA="Dzenle",AA="Olutur",PA="Kapat",LA="Onayla",jA="Geri",IA="leri",UA="Gnder",BA="Ara",zA="evrimii",VA="evrimd",FA="Bota",qA="Rahatsz Etmeyin",HA="Hata",$A="Baarl",KA="Bir eyler ters gitti",GA="Sonu bulunamad",YA="Panoya kopyaland",JA="Dil",QA="yeler",XA="At",WA="Yasakla",ZA="Yasa Kaldr",eP="Rolleri Ynet",tP="Katld: {{date}}",nP="Roller",iP="{{username}} adl kullancy atmak istediinizden emin misiniz?",sP="{{username}} adl kullancy yasaklamak istediinizden emin misiniz?",aP="Yasaklama sebebi",rP="Rol yok",oP="Uyar",cP="Bilgi",lP="Ayarlar",uP="Ykle",dP="Ykleniyor...",fP="Sekmeyi Kapat",hP="Sunucu",mP="Sunucu Ekle",pP="Mesajlar",gP="Dosyalar",vP="Mesaj Gnder",yP="Hzl Gei",bP="Kanal ve DM ara...",SP="Kanallar",CP="Direkt Mesajlar",kP={appName:wA,loading:MA,save:NA,cancel:OA,delete:"Sil",edit:DA,create:AA,close:PA,confirm:LA,back:jA,next:IA,submit:UA,search:BA,online:zA,offline:VA,idle:FA,dnd:qA,error:HA,success:$A,somethingWentWrong:KA,noResults:GA,copySuccess:YA,language:JA,members:QA,kick:XA,ban:WA,unban:ZA,manageRoles:eP,joinedAt:tP,roles:nP,confirmKick:iP,confirmBan:sP,banReason:aP,noRoles:rP,warning:oP,info:cP,settings:lP,upload:uP,uploading:dP,closeTab:fP,server:hP,addServer:mP,messages:pP,files:gP,sendMessage:vP,quickSwitcher:yP,quickSwitcherPlaceholder:bP,channels:SP,directMessages:CP},TP="Tekrar ho geldin!",EP="Seni tekrar grdmze ok sevindik!",xP="Hesap olutur",RP="Kullanc Ad",_P="Grnen Ad",wP="ifre",MP="ifre Tekrar",NP="Giri Yap",OP="Giri yaplyor...",DP="Devam Et",AP="Hesap oluturuluyor...",PP="Hesabn yok mu?",LP="Zaten hesabn var m?",jP="Kayt Ol",IP="Giri Yap",UP="k Yap",BP="Giri baarsz",zP="Kayt baarsz",VP="ifreler elemiyor",FP="ifre en az 8 karakter olmal",qP="Geersiz kullanc ad veya ifre",HP="Davet Kodu",$P="Davet kodunu girin (opsiyonel)",KP={welcomeBack:TP,excitedToSeeYou:EP,createAccount:xP,username:RP,displayName:_P,password:wP,confirmPassword:MP,login:NP,loggingIn:OP,register:DP,registering:AP,needAccount:PP,alreadyHaveAccount:LP,registerLink:jP,loginLink:IP,logout:UP,loginFailed:BP,registrationFailed:zP,passwordsDoNotMatch:VP,passwordTooShort:FP,invalidCredentials:qP,inviteCode:HP,inviteCodePlaceholder:$P},GP="Metin Kanallar",YP="Sesli Kanallar",JP="Kanal Olutur",QP="Kanal Dzenle",XP="Kanal Sil",WP="Kanal Ad",ZP="Kanal Konusu",eL="Kanal Tr",tL="Metin",nL="Sesli",iL="#{{name}} kanaln silmek istediinize emin misiniz?",sL="Henz kanal yok",aL="Kanal sras gncellendi",rL="Kanal sras gncellenemedi",oL="Kanallar",cL="Kanal oluturuldu",lL="Kanal oluturulamad",uL="Kanal silindi",dL="Kanal silinemedi",fL="ptal",hL={textChannels:GP,voiceChannels:YP,createChannel:JP,editChannel:QP,deleteChannel:XP,channelName:WP,channelTopic:ZP,channelType:eL,text:tL,voice:nL,deleteConfirm:iL,noChannels:sL,reorderSuccess:aL,reorderError:rL,channelsTitle:oL,channelCreated:cL,channelCreateError:lL,channelDeleted:uL,channelDeleteError:dL,cancel:fL},mL="#{{channel}} kanalna mesaj yaz",pL="Mesaj Dzenle",gL="Mesaj Sil",vL="Bu mesaj silmek istediinize emin misiniz?",yL="{{user}} yazyor...",bL="{{count}} kii yazyor...",SL="#{{channel}} kanalna ho geldiniz!",CL="Bu, #{{channel}} kanalnn balangcdr.",kL="Bugn",TL="Dn",EL="(dzenlendi)",xL="Dosya Ykle",RL="Dosya ok byk (maks. {{max}}MB)",_L="Bir kanal sein",wL="iptal",ML="kaydet",NL="Mesaj Sabitle",OL="Sabitlemeyi Kaldr",DL="Sabitlenmi Mesajlar",AL="Bu kanalda sabitlenmi mesaj yok",PL="{{user}} tarafndan sabitlendi",LL="{{count}} sabitlenmi",jL="Mesaj Ara",IL="Mesajlarda ara...",UL="Aranyor...",BL="Aramaya balamak iin yazn",zL="Sonu bulunamad",VL="{{count}} sonu",FL="nceki",qL="Sonraki",HL="Direkt Mesajlar",$L="Henz konuma yok",KL="@{{user}} kullancsna mesaj yaz",GL="{{user}} ile konumanzn balangc.",YL="Mesaj Kopyala",JL="ID Kopyala",QL="Tepki Ekle",XL="Sk Kullanlanlar",WL="Yzler ve nsanlar",ZL="El aretleri",ej="Hayvanlar ve Doa",tj="Yiyecek ve ecek",nj="Nesneler ve Semboller",ij="Yantla",sj="{{user}} kullancsna yant",aj="Orijinal mesaj silindi",rj="Bilinmeyen Kullanc",oj="Eki grmek iin tklayn",cj="Bu kanalda mesaj gnderme yetkiniz yok",lj={messagePlaceholder:mL,editMessage:pL,deleteMessage:gL,deleteMessageConfirm:vL,typing:yL,typingMultiple:bL,welcomeChannel:SL,channelStart:CL,today:kL,yesterday:TL,edited:EL,uploadFile:xL,fileTooLarge:RL,noChannel:_L,editCancel:wL,editSave:ML,pinMessage:NL,unpinMessage:OL,pinnedMessages:DL,noPinnedMessages:AL,pinnedBy:PL,pinCount:LL,searchMessages:jL,searchPlaceholder:IL,searching:UL,searchHint:BL,noSearchResults:zL,searchResultCount:VL,searchPrev:FL,searchNext:qL,directMessages:HL,noDMs:$L,dmPlaceholder:KL,dmWelcome:GL,copyMessage:YL,copyId:JL,addReaction:QL,emojiFrequent:XL,emojiPeople:WL,emojiGestures:ZL,emojiNature:ej,emojiFood:tj,emojiObjects:nj,replyMessage:ij,replyingTo:sj,replyDeleted:aj,unknownUser:rj,noContent:oj,noSendPermission:cj},uj="Ayarlar",dj="Kullanc Ayarlar",fj="Sunucu Ayarlar",hj="Ses ve Grnt",mj="Grnm",pj="Dil",gj="Dil Sein",vj="Profil",yj="Avatar Deitir",bj="Roller",Sj="yeler",Cj="Kanallar",kj="Davetler",Tj="Tehlikeli Blge",Ej="Rol Olutur",xj="Rol Dzenle",Rj="Rol Ad",_j="Rol Rengi",wj="Yetkiler",Mj="Rol Sil",Nj='"{{name}}" roln silmek istediinizden emin misiniz? Bu ilem geri alnamaz.',Oj="Kanallar Ynet",Dj="Kanal oluturma, dzenleme ve silme",Aj="Rolleri Ynet",Pj="Kendi rolnden dk rolleri oluturma, dzenleme ve silme",Lj="yeleri At",jj="yeleri sunucudan karma",Ij="yeleri Yasakla",Uj="yeleri sunucudan kalc olarak yasaklama",Bj="Mesajlar Ynet",zj="Dier yelerin mesajlarn silme ve dzenleme",Vj="Mesaj Gnder",Fj="Metin kanallarnda mesaj gnderme",qj="Mesajlar Oku",Hj="Metin kanallarndaki mesajlar grntleme",$j="Balan",Kj="Ses kanallarna katlma",Gj="Konu",Yj="Ses kanallarnda konuma",Jj="Ekran Paylam",Qj="Ses kanallarnda ekran paylam",Xj="Ynetici",Wj="Bu yetkiye sahip yeler tm yetkilere sahiptir ve kanal bazl kstlamalar atlayabilir",Zj="Bu yetkiyi vermek tehlikeli olabilir!",e2="Deiiklikleri Kaydet",t2="Kaydedilmemi deiiklikler var",n2="Bu tm yelere atanan varsaylan roldr. Silinemez.",i2="Ayarlarn dzenlemek iin bir rol sein",s2="Genel",a2="Grnen Ad",r2="Dierlerinin sizi grd isim",o2="zel Durum",c2="zel bir durum belirleyin",l2="Avatar yklemek iin tklayn",u2="Maksimum 8MB. JPG, PNG, GIF veya WebP.",d2="Tercih ettiiniz dili sein",f2="English",h2="Trke",m2="Profil baaryla gncellendi",p2="Profil gncellenirken hata olutu",g2="Avatar gncellendi",v2="Avatar yklenirken hata olutu",y2="Sunucu Ad",b2="Sunucu Simgesi",S2="Sunucu ayarlar gncellendi",C2="Sunucu ayarlar gncellenirken hata olutu",k2="Yaknda",T2="Bu blme eriim yetkiniz yok",E2="k Yap",x2="k yapmak istediinizden emin misiniz?",R2="Rol baaryla gncellendi",_2="Rol baaryla oluturuldu",w2="Rol baaryla silindi",M2="Rol gncellenirken hata olutu",N2="Davetleri Ynet",O2="Davet balantlar oluturma, grntleme ve silme",D2="Geerlilik Sresi",A2="Maks. Kullanm",P2="Davet Olutur",L2="Oluturuluyor...",j2="Davet oluturuldu",I2="Davet oluturulamad",U2="Davet kodu panoya kopyaland",B2="Davet kodu kopyalanamad",z2="Davet silindi",V2="Davet silinemedi",F2="Kopyala",q2="Sil",H2="Sresi dolmu",$2="{{count}} gn kald",K2="{{count}} saat kald",G2="{{count}} dk kald",Y2="kullanm",J2="Henz davet balants yok",Q2="Ykleniyor...",X2="30 dakika",W2="1 saat",Z2="6 saat",eI="12 saat",tI="1 gn",nI="7 gn",iI="Sresiz",sI="Snrsz",aI="1 kullanm",rI="5 kullanm",oI="10 kullanm",cI="25 kullanm",lI="50 kullanm",uI="100 kullanm",dI="Davet Zorunlu",fI="Aktifken yeni yelerin kayt olmak iin davet kodu girmesi gerekir",hI="Giri Modu",mI="Ses Etkinlii",pI="Konutuunuzda otomatik iletim",gI="Bas-Konu",vI="Bir tuu basl tutarak iletim",yI="Bas-Konu Tuu",bI="Tklayp bir tua basn",SI="Bir tua basn...",CI="Mikrofon Hassasiyeti",kI="Giri Cihaz",TI="k Cihaz",EI="Varsaylan",xI="k Sesi",RI="Giri/k Sesleri",_I="Biri ses kanalna girip ktnda ses al",wI="zinlerini dzenlemek iin bir kanal sein",MI="Override dzenlemek iin bir rol sein",NI="Metin zinleri",OI="Ses zinleri",DI="Bu kanal iin rol izinlerini geersiz kln. Devral, roln varsaylan ayarn kullanr.",AI="Kanal izni kaydedildi",PI="Kanal izni kaydedilemedi",LI="Devral",jI="zin Ver",II="Reddet",UI={title:uj,userSettings:dj,serverSettings:fj,voiceSettings:hj,appearance:mj,language:pj,selectLanguage:gj,profile:vj,changeAvatar:yj,roles:bj,members:Sj,channels:Cj,invites:kj,dangerZone:Tj,createRole:Ej,editRole:xj,roleName:Rj,roleColor:_j,permissions:wj,deleteRole:Mj,confirmDeleteRole:Nj,permManageChannels:Oj,permManageChannelsDesc:Dj,permManageRoles:Aj,permManageRolesDesc:Pj,permKickMembers:Lj,permKickMembersDesc:jj,permBanMembers:Ij,permBanMembersDesc:Uj,permManageMessages:Bj,permManageMessagesDesc:zj,permSendMessages:Vj,permSendMessagesDesc:Fj,permReadMessages:qj,permReadMessagesDesc:Hj,permConnect:$j,permConnectDesc:Kj,permSpeak:Gj,permSpeakDesc:Yj,permStream:Jj,permStreamDesc:Qj,permAdmin:Xj,permAdminDesc:Wj,permAdminWarning:Zj,saveChanges:e2,unsavedChanges:t2,defaultRoleWarning:n2,noRoleSelected:i2,general:s2,displayName:a2,displayNamePlaceholder:r2,customStatus:o2,customStatusPlaceholder:c2,avatarUpload:l2,avatarMaxSize:u2,languageDescription:d2,english:f2,turkish:h2,profileSaved:m2,profileSaveError:p2,avatarUploaded:g2,avatarUploadError:v2,serverName:y2,serverIcon:b2,serverSaved:S2,serverSaveError:C2,comingSoon:k2,noPermission:T2,logOut:E2,logOutConfirm:x2,roleSaved:R2,roleCreated:_2,roleDeleted:w2,roleSaveError:M2,permManageInvites:N2,permManageInvitesDesc:O2,inviteExpiry:D2,inviteMaxUses:A2,inviteCreate:P2,inviteCreating:L2,inviteCreated:j2,inviteCreateError:I2,inviteCopied:U2,inviteCopyError:B2,inviteDeleted:z2,inviteDeleteError:V2,inviteCopy:F2,inviteDelete:q2,inviteExpired:H2,inviteExpiresInDays:$2,inviteExpiresInHours:K2,inviteExpiresInMinutes:G2,inviteUsesLabel:Y2,noInvites:J2,loading:Q2,expiry30min:X2,expiry1h:W2,expiry6h:Z2,expiry12h:eI,expiry1d:tI,expiry7d:nI,expiryNever:iI,usesNoLimit:sI,uses1:aI,uses5:rI,uses10:oI,uses25:cI,uses50:lI,uses100:uI,inviteRequired:dI,inviteRequiredDesc:fI,voiceInputMode:hI,voiceActivity:mI,voiceActivityDesc:pI,pushToTalk:gI,pushToTalkDesc:vI,pttKey:yI,pttKeyHint:bI,pttListening:SI,micSensitivity:CI,inputDevice:kI,outputDevice:TI,defaultDevice:EI,masterVolume:xI,joinLeaveSounds:RI,joinLeaveSoundsDesc:_I,selectChannelToEdit:wI,selectRoleToEdit:MI,textPermissions:NI,voicePermissions:OI,channelPermDesc:DI,channelPermSaved:AI,channelPermSaveError:PI,permOverrideInherit:LI,permOverrideAllow:jI,permOverrideDeny:II},BI="Sese Katl",zI="Balanty Kes",VI="Sessiz",FI="Sesi A",qI="Sarlatr",HI="Sarlatrmay Kapat",$I="Ekran Payla",KI="Paylam Durdur",GI="Ses Bal",YI="Bu ses kanalnda kimse yok",JI="Maksimum 2 ekran paylamna ulald",QI="Bu ses kanal dolu",XI="Balanyor...",WI="Yeniden balanyor...",ZI="Ses balants koptu",eU="Bu ses kanalna katlmak iin tklayn",tU="Tam Ekran",nU="Tam Ekrandan k",iU="Dzen Deitir",sU="Aramay Bitir",aU="Klt",rU={joinVoice:BI,leaveVoice:zI,mute:VI,unmute:FI,deafen:qI,undeafen:HI,screenShare:$I,stopScreenShare:KI,voiceConnected:GI,noOneInVoice:YI,screenShareLimit:JI,voiceChannelFull:QI,connectingToVoice:XI,reconnectingToVoice:WI,voiceDisconnected:ZI,joinVoicePrompt:eU,fullscreen:tU,exitFullscreen:nU,toggleLayout:iU,endCall:sU,minimize:aU},oU={en:"English",tr:"Trke"},cU="en";sn.use(tC).use(x_).init({resources:{en:{common:qw,auth:hM,channels:PM,chat:NN,settings:aA,voice:_A},tr:{common:kP,auth:KP,channels:hL,chat:lj,settings:UI,voice:rU}},fallbackLng:cU,supportedLngs:Object.keys(oU),defaultNS:"common",ns:["common","auth","channels","chat","settings","voice"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],lookupLocalStorage:"language",caches:["localStorage"]}});const zb=n=>{let e;const t=new Set,i=(h,m)=>{const g=typeof h=="function"?h(e):h;if(!Object.is(g,e)){const b=e;e=m??(typeof g!="object"||g===null)?g:Object.assign({},e,g),t.forEach(C=>C(e,b))}},r=()=>e,l={setState:i,getState:r,getInitialState:()=>f,subscribe:h=>(t.add(h),()=>t.delete(h))},f=e=n(i,r,l);return l},lU=(n=>n?zb(n):zb),uU=n=>n;function dU(n,e=uU){const t=vl.useSyncExternalStore(n.subscribe,vl.useCallback(()=>e(n.getState()),[n,e]),vl.useCallback(()=>e(n.getInitialState()),[n,e]));return vl.useDebugValue(t),t}const Vb=n=>{const e=lU(n),t=i=>dU(e,i);return Object.assign(t,e),t},Wt=(n=>n?Vb(n):Vb),Ph="/api",fU=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`,hU=3e4,mU=3,Fb=50,pU=25*1024*1024,gU=["image/jpeg","image/png","image/gif","image/webp","video/mp4","video/webm","audio/mpeg","audio/ogg","application/pdf","text/plain"],vU=300*1e3,qb=["mousemove","keydown","mousedown","scroll","touchstart"];function Lh(){return localStorage.getItem("access_token")}function nC(){return localStorage.getItem("refresh_token")}function jh(n,e){localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",e)}function No(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}async function yU(){const n=nC();if(!n)return!1;try{const e=await fetch(`${Ph}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:n})});if(!e.ok)return No(),!1;const t=await e.json();return t.success&&t.data?(jh(t.data.access_token,t.data.refresh_token),!0):(No(),!1)}catch{return No(),!1}}async function xe(n,e={}){const{method:t="GET",body:i,headers:r}=e,o={...r},u=Lh();u&&(o.Authorization=`Bearer ${u}`),i&&!(i instanceof FormData)&&(o["Content-Type"]="application/json");const l={method:t,headers:o};i&&(l.body=i instanceof FormData?i:JSON.stringify(i));let f=await fetch(`${Ph}${n}`,l);return f.status===401&&nC()&&await yU()&&(o.Authorization=`Bearer ${Lh()}`,f=await fetch(`${Ph}${n}`,{...l,headers:o})),await f.json()}async function bU(n){return xe("/auth/register",{method:"POST",body:n})}async function SU(n){return xe("/auth/login",{method:"POST",body:n})}async function CU(n){return xe("/auth/logout",{method:"POST",body:{refresh_token:n}})}async function kU(){return xe("/users/me")}const at=Wt(n=>({user:null,isLoading:!1,error:null,isInitialized:!1,register:async(e,t,i,r)=>{n({isLoading:!0,error:null});const o=await bU({username:e,password:t,display_name:i,invite_code:r});return o.success&&o.data?(jh(o.data.access_token,o.data.refresh_token),n({user:o.data.user,isLoading:!1}),!0):(n({error:o.error??"Registration failed",isLoading:!1}),!1)},login:async(e,t)=>{n({isLoading:!0,error:null});const i=await SU({username:e,password:t});return i.success&&i.data?(jh(i.data.access_token,i.data.refresh_token),n({user:i.data.user,isLoading:!1}),!0):(n({error:i.error??"Login failed",isLoading:!1}),!1)},logout:async()=>{const e=localStorage.getItem("refresh_token");e&&await CU(e),No(),n({user:null})},initialize:async()=>{if(!localStorage.getItem("access_token")){n({isInitialized:!0});return}const t=await kU();t.success&&t.data?n({user:t.data,isInitialized:!0}):(No(),n({isInitialized:!0}))},clearError:()=>n({error:null}),updateUser:e=>n(t=>({user:t.user?{...t.user,...e}:null}))}));function TU(){const{t:n}=Te("auth"),e=at(b=>b.login),t=at(b=>b.isLoading),i=at(b=>b.error),r=at(b=>b.clearError),o=hu(),[u,l]=T.useState(""),[f,h]=T.useState("");async function m(b){b.preventDefault(),await e(u,f)&&o("/channels")}function g(){i&&r()}return y.jsx("div",{className:"auth-page",children:y.jsxs("div",{className:"auth-card",children:[y.jsx("h1",{className:"auth-title",children:n("welcomeBack")}),y.jsx("p",{className:"auth-subtitle",children:n("excitedToSeeYou")}),i&&y.jsx("div",{className:"auth-error",children:i}),y.jsxs("form",{onSubmit:m,children:[y.jsxs("div",{className:"auth-field",children:[y.jsx("label",{htmlFor:"username",className:"auth-label",children:n("username")}),y.jsx("input",{id:"username",type:"text",value:u,onChange:b=>{l(b.target.value),g()},required:!0,autoFocus:!0,className:"auth-input"})]}),y.jsxs("div",{className:"auth-field",children:[y.jsx("label",{htmlFor:"password",className:"auth-label",children:n("password")}),y.jsx("input",{id:"password",type:"password",value:f,onChange:b=>{h(b.target.value),g()},required:!0,className:"auth-input"})]}),y.jsx("button",{type:"submit",disabled:t,className:"auth-btn",children:n(t?"loggingIn":"login")})]}),y.jsxs("p",{className:"auth-link",children:[n("needAccount")," ",y.jsx(pu,{to:"/register",children:n("registerLink")})]})]})})}function EU(){const{t:n}=Te("auth"),e=at(R=>R.register),t=at(R=>R.isLoading),i=at(R=>R.error),r=at(R=>R.clearError),o=hu(),[u,l]=T.useState(""),[f,h]=T.useState(""),[m,g]=T.useState(""),[b,C]=T.useState(""),[E,k]=T.useState(""),[_,w]=T.useState(null);async function O(R){if(R.preventDefault(),w(null),m!==b){w(n("passwordsDoNotMatch"));return}if(m.length<8){w(n("passwordTooShort"));return}await e(u,m,f||void 0,E||void 0)&&o("/channels")}function D(){i&&r(),_&&w(null)}const x=_??i;return y.jsx("div",{className:"auth-page",children:y.jsxs("div",{className:"auth-card",children:[y.jsx("h1",{className:"auth-title",children:n("createAccount")}),x&&y.jsx("div",{className:"auth-error",children:x}),y.jsxs("form",{onSubmit:O,children:[y.jsxs("div",{className:"auth-field",children:[y.jsxs("label",{htmlFor:"username",className:"auth-label",children:[n("username")," ",y.jsx("span",{style:{color:"var(--red)"},children:"*"})]}),y.jsx("input",{id:"username",type:"text",value:u,onChange:R=>{l(R.target.value),D()},required:!0,autoFocus:!0,minLength:3,maxLength:32,pattern:"[a-zA-Z0-9_]+",title:"Letters, numbers, and underscores only",className:"auth-input"})]}),y.jsxs("div",{className:"auth-field",children:[y.jsx("label",{htmlFor:"displayName",className:"auth-label",children:n("displayName")}),y.jsx("input",{id:"displayName",type:"text",value:f,onChange:R=>{h(R.target.value),D()},maxLength:32,className:"auth-input"})]}),y.jsxs("div",{className:"auth-field",children:[y.jsx("label",{htmlFor:"inviteCode",className:"auth-label",children:n("inviteCode")}),y.jsx("input",{id:"inviteCode",type:"text",value:E,onChange:R=>{k(R.target.value),D()},placeholder:n("inviteCodePlaceholder"),maxLength:32,className:"auth-input"})]}),y.jsxs("div",{className:"auth-field",children:[y.jsxs("label",{htmlFor:"password",className:"auth-label",children:[n("password")," ",y.jsx("span",{style:{color:"var(--red)"},children:"*"})]}),y.jsx("input",{id:"password",type:"password",value:m,onChange:R=>{g(R.target.value),D()},required:!0,minLength:8,className:"auth-input"})]}),y.jsxs("div",{className:"auth-field",children:[y.jsxs("label",{htmlFor:"confirmPassword",className:"auth-label",children:[n("confirmPassword")," ",y.jsx("span",{style:{color:"var(--red)"},children:"*"})]}),y.jsx("input",{id:"confirmPassword",type:"password",value:b,onChange:R=>{C(R.target.value),D()},required:!0,className:"auth-input"})]}),y.jsx("button",{type:"submit",disabled:t,className:"auth-btn",children:n(t?"registering":"register")})]}),y.jsxs("p",{className:"auth-link",children:[n("alreadyHaveAccount")," ",y.jsx(pu,{to:"/login",children:n("loginLink")})]})]})})}async function iC(){return xe("/server")}async function xU(n){return xe("/server",{method:"PATCH",body:n})}async function RU(n){const e=new FormData;return e.append("file",n),xe("/server/icon",{method:"POST",body:e})}const Cm=Wt(n=>({server:null,fetchServer:async()=>{const e=await iC();e.success&&e.data&&n({server:e.data})},handleServerUpdate:e=>{n({server:e})}}));async function _U(n){return xe("/voice/token",{method:"POST",body:{channel_id:n}})}const sC="mqvi_voice_settings",eh={inputMode:"voice_activity",pttKey:"Space",micSensitivity:50,userVolumes:{},inputDevice:"",outputDevice:"",masterVolume:100,soundsEnabled:!0};function wU(){try{const n=localStorage.getItem(sC);if(!n)return{...eh};const e=JSON.parse(n);return{...eh,...e}}catch{return{...eh}}}function ps(n){try{localStorage.setItem(sC,JSON.stringify(n))}catch{}}const gs=wU(),be=Wt((n,e)=>({voiceStates:{},currentVoiceChannelId:null,isMuted:!1,isDeafened:!1,isStreaming:!1,livekitUrl:null,livekitToken:null,inputMode:gs.inputMode,pttKey:gs.pttKey,micSensitivity:gs.micSensitivity,userVolumes:gs.userVolumes,inputDevice:gs.inputDevice,outputDevice:gs.outputDevice,masterVolume:gs.masterVolume,soundsEnabled:gs.soundsEnabled,_onLeaveCallback:null,registerOnLeave:t=>n({_onLeaveCallback:t}),joinVoiceChannel:async t=>{try{const i=await _U(t);if(!i.success||!i.data)return console.error("[voiceStore] Failed to get voice token:",i.error),null;console.log("[voiceStore] Voice token obtained, connecting to:",i.data.url);const r=e().inputMode==="push_to_talk";return n({currentVoiceChannelId:t,livekitUrl:i.data.url,livekitToken:i.data.token,isMuted:r,isDeafened:!1,isStreaming:!1}),i.data}catch(i){return console.error("[voiceStore] Voice join error:",i),null}},leaveVoiceChannel:()=>{n({currentVoiceChannelId:null,livekitUrl:null,livekitToken:null,isMuted:!1,isDeafened:!1,isStreaming:!1})},toggleMute:()=>{const{isMuted:t,isDeafened:i}=e();n(i?{isDeafened:!1,isMuted:!t}:{isMuted:!t})},toggleDeafen:()=>{const{isDeafened:t}=e();n(t?{isDeafened:!1}:{isDeafened:!0,isMuted:!0})},setStreaming:t=>{n({isStreaming:t})},setInputMode:t=>{n({inputMode:t});const i=e();ps({inputMode:t,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setPTTKey:t=>{n({pttKey:t});const i=e();ps({inputMode:i.inputMode,pttKey:t,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setMicSensitivity:t=>{n({micSensitivity:t});const i=e();ps({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:t,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setUserVolume:(t,i)=>{const r={...e().userVolumes,[t]:i};n({userVolumes:r});const o=e();ps({inputMode:o.inputMode,pttKey:o.pttKey,micSensitivity:o.micSensitivity,userVolumes:r,inputDevice:o.inputDevice,outputDevice:o.outputDevice,masterVolume:o.masterVolume,soundsEnabled:o.soundsEnabled})},setInputDevice:t=>{n({inputDevice:t});const i=e();ps({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:t,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setOutputDevice:t=>{n({outputDevice:t});const i=e();ps({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:t,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setMasterVolume:t=>{n({masterVolume:t});const i=e();ps({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:t,soundsEnabled:i.soundsEnabled})},setSoundsEnabled:t=>{n({soundsEnabled:t});const i=e();ps({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:t})},handleVoiceStateUpdate:t=>{n(i=>{const r={...i.voiceStates};switch(t.action){case"join":{for(const u of Object.keys(r))r[u]=r[u].filter(l=>l.user_id!==t.user_id),r[u].length===0&&delete r[u];const o=r[t.channel_id]??[];r[t.channel_id]=[...o,{user_id:t.user_id,channel_id:t.channel_id,username:t.username,avatar_url:t.avatar_url,is_muted:t.is_muted,is_deafened:t.is_deafened,is_streaming:t.is_streaming}];break}case"leave":{r[t.channel_id]&&(r[t.channel_id]=r[t.channel_id].filter(o=>o.user_id!==t.user_id),r[t.channel_id].length===0&&delete r[t.channel_id]);break}case"update":{r[t.channel_id]&&(r[t.channel_id]=r[t.channel_id].map(o=>o.user_id===t.user_id?{...o,is_muted:t.is_muted,is_deafened:t.is_deafened,is_streaming:t.is_streaming}:o));break}}return{voiceStates:r}})},handleVoiceStatesSync:t=>{const i={};for(const r of t)i[r.channel_id]||(i[r.channel_id]=[]),i[r.channel_id].push(r);n({voiceStates:i})}}));let Hb=0;function aC(){return Hb+=1,`panel-${Hb}`}let $b=0;function MU(){return $b+=1,`tab-${$b}`}function NU(n,e){for(const[t,i]of Object.entries(n)){const r=i.tabs.find(o=>o.channelId===e);if(r)return{panelId:t,tabId:r.id}}return null}function Yl(n,e){if(n.type==="leaf")return n.panelId===e?null:n;const t=Yl(n.children[0],e),i=Yl(n.children[1],e);return t===null&&i===null?null:t===null?i:i===null?t:{...n,children:[t,i]}}function rC(n,e,t){if(e.length===0&&n.type==="split")return{...n,ratio:t};if(n.type==="split"&&e.length>0){const[i,...r]=e,o=[...n.children];return o[i]=rC(o[i],r,t),{...n,children:o}}return n}function th(n){if(!n||n.type!=="voice"&&n.type!=="screen")return;const e=be.getState();e.currentVoiceChannelId===n.channelId&&e._onLeaveCallback&&e._onLeaveCallback()}const wl=aC(),OU={id:wl,tabs:[],activeTabId:null},Xe=Wt((n,e)=>({panels:{[wl]:OU},layout:{type:"leaf",panelId:wl},activePanelId:wl,membersOpen:!0,quickSwitcherOpen:!1,openTab(t,i,r,o){const u=e(),l=NU(u.panels,t);if(l){n({activePanelId:l.panelId,panels:{...u.panels,[l.panelId]:{...u.panels[l.panelId],activeTabId:l.tabId}}});return}const f=u.panels[u.activePanelId];if(!f)return;const h={id:MU(),channelId:t,type:i,label:r,serverShort:o};n({panels:{...u.panels,[f.id]:{...f,tabs:[...f.tabs,h],activeTabId:h.id}}})},closeTab(t,i){const r=e(),o=r.panels[t];if(!o)return;const u=o.tabs.find(h=>h.id===i),l=o.tabs.filter(h=>h.id!==i);if(l.length===0){if(Object.keys(r.panels).length<=1){n({panels:{[t]:{...o,tabs:[],activeTabId:null}}}),th(u);return}const m=Yl(r.layout,t),g={...r.panels};delete g[t];const b=r.activePanelId===t?Object.keys(g)[0]:r.activePanelId;n({panels:g,layout:m??{type:"leaf",panelId:b},activePanelId:b}),th(u);return}const f=o.activeTabId===i?l[Math.max(0,l.findIndex(h=>h.id===i)-1)]?.id??l[0]?.id??null:o.activeTabId;n({panels:{...r.panels,[t]:{...o,tabs:l,activeTabId:f}}}),th(u)},closeVoiceTabs(t){const i=e(),r=[];for(const[o,u]of Object.entries(i.panels))for(const l of u.tabs)(l.type==="voice"||l.type==="screen")&&l.channelId===t&&r.push({panelId:o,tabId:l.id});for(const{panelId:o,tabId:u}of r)e().closeTab(o,u)},setActiveTab(t,i){const r=e(),o=r.panels[t];o&&n({activePanelId:t,panels:{...r.panels,[t]:{...o,activeTabId:i}}})},splitPanel(t,i,r,o="after"){const u=e(),l=u.panels[t];if(!l)return;const f=l.tabs.find(E=>E.id===r);if(!f)return;const h=l.tabs.filter(E=>E.id!==r),m=l.activeTabId===r?h[0]?.id??null:l.activeTabId,g=aC(),b={id:g,tabs:[f],activeTabId:f.id};function C(E){return E.type==="leaf"&&E.panelId===t?{type:"split",direction:i,children:[o==="before"?{type:"leaf",panelId:g}:{type:"leaf",panelId:t},o==="before"?{type:"leaf",panelId:t}:{type:"leaf",panelId:g}],ratio:.5}:E.type==="split"?{...E,children:[C(E.children[0]),C(E.children[1])]}:E}n({panels:{...u.panels,[t]:{...l,tabs:h,activeTabId:m},[g]:b},layout:C(u.layout),activePanelId:g})},moveTab(t,i,r){const o=e(),u=o.panels[t],l=o.panels[i];if(!u||!l)return;const f=u.tabs.find(b=>b.id===r);if(!f)return;const h=u.tabs.filter(b=>b.id!==r),m=u.activeTabId===r?h[0]?.id??null:u.activeTabId,g={...o.panels};if(h.length===0&&Object.keys(g).length>1){const b=Yl(o.layout,t);delete g[t],g[i]={...l,tabs:[...l.tabs,f],activeTabId:f.id},n({panels:g,layout:b??{type:"leaf",panelId:i},activePanelId:i});return}g[t]={...u,tabs:h,activeTabId:m},g[i]={...l,tabs:[...l.tabs,f],activeTabId:f.id},n({panels:g,activePanelId:i})},setSplitRatio(t,i){const r=Math.max(.15,Math.min(.85,i));n(o=>({layout:rC(o.layout,t,r)}))},setActivePanel(t){n({activePanelId:t})},toggleMembers(){n(t=>({membersOpen:!t.membersOpen}))},toggleQuickSwitcher(){n(t=>({quickSwitcherOpen:!t.quickSwitcherOpen}))},closeQuickSwitcher(){n({quickSwitcherOpen:!1})}}));function DU(n){const e=[];for(const t of Object.values(n))for(const i of t.tabs)e.push({...i,panelId:t.id,isActive:i.id===t.activeTabId});return e}function AU(){const{t:n}=Te("common"),e=Cm(f=>f.server),t=Xe(f=>f.panels),i=Xe(f=>f.activePanelId),r=Xe(f=>f.setActiveTab),o=Xe(f=>f.closeTab),u=DU(t);function l(f,h){f.dataTransfer.setData("text/tab-id",h.id),f.dataTransfer.setData("text/panel-id",h.panelId),f.dataTransfer.effectAllowed="move"}return y.jsxs("div",{className:"top-bar",children:[y.jsxs("div",{className:"server-pill",children:[y.jsx("img",{src:"/mqvi-icon.svg",alt:"mqvi",className:"sp-avatar"}),y.jsx("span",{className:"sp-name",children:e?.name??"mqvi Server"}),y.jsx("span",{className:"sp-chevron",children:""})]}),y.jsx("div",{className:"tab-strip",children:u.map(f=>{const h=f.panelId===i&&f.isActive,m=f.type==="voice",g=f.type==="screen";let b="tab";return h&&(b+=" tab-active"),m&&(b+=" tab-voice"),g&&(b+=" tab-screen"),y.jsxs("div",{className:b,style:{maxWidth:170},draggable:!0,onDragStart:C=>l(C,f),onClick:()=>r(f.panelId,f.id),children:[y.jsx("span",{className:"tab-icon",children:f.type==="text"?"#":f.type==="voice"?"":""}),y.jsx("span",{className:"tab-label",children:f.label}),f.serverShort&&y.jsx("span",{className:"tab-srv",children:f.serverShort}),f.hasUnread&&!h&&y.jsx("span",{className:"tab-dot"}),y.jsx("button",{className:"tab-close",onClick:C=>{C.stopPropagation(),o(f.panelId,f.id)},title:n("closeTab"),children:""})]},f.id)})})]})}async function oC(){return xe("/channels")}async function km(n){return xe("/channels",{method:"POST",body:n})}async function cC(n){return xe(`/channels/${n}`,{method:"DELETE"})}async function lC(n){return xe("/channels/reorder",{method:"PATCH",body:{items:n}})}const PU=Object.freeze(Object.defineProperty({__proto__:null,createChannel:km,deleteChannel:cC,getChannels:oC,reorderChannels:lC},Symbol.toStringTag,{value:"Module"})),xt=Wt((n,e)=>({categories:[],selectedChannelId:null,isLoading:!1,fetchChannels:async()=>{n({isLoading:!0});const t=await oC();if(t.success&&t.data){if(n({categories:t.data,isLoading:!1}),!e().selectedChannelId){const r=t.data.flatMap(o=>o.channels).find(o=>o.type==="text");r&&n({selectedChannelId:r.id})}}else n({isLoading:!1})},selectChannel:t=>{n({selectedChannelId:t})},handleChannelCreate:t=>{n(i=>{const r=i.categories.map(u=>u.category.id===(t.category_id??"")?{...u,channels:[...u.channels,t]}:u);if(!r.some(u=>u.channels.some(l=>l.id===t.id))&&r.length>0){const u={...r[0]};u.channels=[...u.channels,t],r[0]=u}return{categories:r}})},handleChannelUpdate:t=>{n(i=>({categories:i.categories.map(r=>({...r,channels:r.channels.map(o=>o.id===t.id?t:o)}))}))},handleChannelDelete:t=>{n(i=>{const r=i.categories.map(u=>({...u,channels:u.channels.filter(l=>l.id!==t)}));let o=i.selectedChannelId;return o===t&&(o=r.flatMap(l=>l.channels).find(l=>l.type==="text")?.id??null),{categories:r,selectedChannelId:o}})},handleCategoryCreate:t=>{n(i=>({categories:[...i.categories,{category:t,channels:[]}]}))},handleCategoryUpdate:t=>{n(i=>({categories:i.categories.map(r=>r.category.id===t.id?{...r,category:t}:r)}))},handleCategoryDelete:t=>{n(i=>({categories:i.categories.filter(r=>r.category.id!==t)}))},reorderChannels:async t=>{const i=e().categories,r=new Map(t.map(u=>[u.id,u.position]));return n(u=>({categories:u.categories.map(l=>({...l,channels:l.channels.map(f=>{const h=r.get(f.id);return h!==void 0?{...f,position:h}:f}).sort((f,h)=>f.position-h.position)}))})),(await lC(t)).success?!0:(n({categories:i}),!1)},handleChannelReorder:t=>{n({categories:t})}}));function LU({panelId:n}){const{t:e}=Te("common"),t=Xe(o=>o.panels[n]),i=Xe(o=>o.setActiveTab),r=Xe(o=>o.closeTab);return t?y.jsx("div",{className:"panel-tab-bar",children:t.tabs.map(o=>{const u=o.id===t.activeTabId,l=o.type==="voice",f=o.type==="screen";let h="panel-tab";return u&&(h+=" active"),l&&(h+=" tab-voice"),f&&(h+=" tab-screen"),y.jsxs("div",{className:h,draggable:!0,onDragStart:m=>{m.dataTransfer.setData("text/tab-id",o.id),m.dataTransfer.setData("text/panel-id",n),m.dataTransfer.effectAllowed="move"},onClick:()=>i(n,o.id),children:[y.jsx("span",{className:"tab-icon",children:o.type==="text"?"#":o.type==="voice"?"":""}),y.jsx("span",{className:"tab-label",children:o.label}),y.jsx("button",{className:"panel-tab-close",onClick:m=>{m.stopPropagation(),r(n,o.id)},title:e("closeTab"),children:""})]},o.id)})}):null}async function jU(n){return xe(`/channels/${n}/pins`)}async function IU(n,e){return xe(`/channels/${n}/messages/${e}/pin`,{method:"POST"})}async function UU(n,e){return xe(`/channels/${n}/messages/${e}/pin`,{method:"DELETE"})}const BU=[],Xn=Wt((n,e)=>({pins:{},isLoading:!1,fetchPins:async t=>{n({isLoading:!0});const i=await jU(t);i.success&&i.data?n(r=>({pins:{...r.pins,[t]:i.data},isLoading:!1})):n({isLoading:!1})},pin:async(t,i)=>(await IU(t,i)).success,unpin:async(t,i)=>(await UU(t,i)).success,handleMessagePin:t=>{n(i=>{const r=i.pins[t.channel_id]??[];return r.some(o=>o.message_id===t.message_id)?i:{pins:{...i.pins,[t.channel_id]:[t,...r]}}})},handleMessageUnpin:t=>{n(i=>{const r=i.pins[t.channel_id];return r?{pins:{...i.pins,[t.channel_id]:r.filter(o=>o.message_id!==t.message_id)}}:i})},getPinsForChannel:t=>e().pins[t]??BU,isMessagePinned:(t,i)=>{const r=e().pins[t];return r?r.some(o=>o.message_id===i):!1}}));async function zU(n){return xe(`/channels/${n}/permissions`)}async function VU(n,e,t,i){return xe(`/channels/${n}/permissions/${e}`,{method:"PUT",body:{allow:t,deny:i}})}async function FU(n,e){return xe(`/channels/${n}/permissions/${e}`,{method:"DELETE"})}const qU=[],Uo=Wt((n,e)=>({overridesByChannel:{},fetchedChannels:new Set,fetchOverrides:async t=>{if(e().fetchedChannels.has(t))return;const i=await zU(t);i.data&&n(r=>({overridesByChannel:{...r.overridesByChannel,[t]:i.data},fetchedChannels:new Set([...r.fetchedChannels,t])}))},setOverride:async(t,i,r,o)=>!!(await VU(t,i,r,o)).data,deleteOverride:async(t,i)=>!!(await FU(t,i)).data,getOverrides:t=>e().overridesByChannel[t]??qU,handleOverrideUpdate:t=>{n(i=>{const r=i.overridesByChannel[t.channel_id]??[],u=r.some(l=>l.role_id===t.role_id)?r.map(l=>l.role_id===t.role_id?t:l):[...r,t];return{overridesByChannel:{...i.overridesByChannel,[t.channel_id]:u}}})},handleOverrideDelete:(t,i)=>{n(r=>{const o=r.overridesByChannel[t];return o?{overridesByChannel:{...r.overridesByChannel,[t]:o.filter(u=>u.role_id!==i)}}:r})}}));async function HU(){return xe("/members")}async function uC(n){return xe(`/members/${n}`,{method:"DELETE"})}async function dC(n,e){return xe(`/members/${n}/ban`,{method:"POST",body:{reason:e}})}const Et=Wt(n=>({members:[],onlineUserIds:new Set,isLoading:!1,fetchMembers:async()=>{n({isLoading:!0});const e=await HU();e.data?n({members:e.data,isLoading:!1}):n({isLoading:!1})},handleReady:e=>{n({onlineUserIds:new Set(e)}),Et.getState().fetchMembers()},handlePresenceUpdate:(e,t)=>{n(i=>{const r=new Set(i.onlineUserIds);t==="offline"?r.delete(e):r.add(e);const o=i.members.map(u=>u.id===e?{...u,status:t}:u);return{onlineUserIds:r,members:o}})},handleMemberJoin:e=>{n(t=>t.members.some(i=>i.id===e.id)?t:{members:[...t.members,e]})},handleMemberLeave:e=>{n(t=>{const i=new Set(t.onlineUserIds);return i.delete(e),{members:t.members.filter(r=>r.id!==e),onlineUserIds:i}})},handleMemberUpdate:e=>{n(t=>({members:t.members.map(i=>i.id===e.id?e:i)}))},handleRoleCreate:e=>{},handleRoleUpdate:e=>{n(t=>({members:t.members.map(i=>({...i,roles:i.roles.map(r=>r.id===e.id?e:r)}))}))},handleRoleDelete:e=>{n(t=>({members:t.members.map(i=>({...i,roles:i.roles.filter(r=>r.id!==e)}))}))}})),Pe={ManageChannels:1,ManageRoles:2,KickMembers:4,BanMembers:8,ManageMessages:16,SendMessages:32,ConnectVoice:64,Speak:128,Stream:256,Admin:512,ManageInvites:1024,ReadMessages:2048};function Vn(n,e){return(n&Pe.Admin)!==0?!0:(n&e)!==0}function $U(n,e,t){if((n&Pe.Admin)!==0)return 4095;const i=new Set(e);let r=0,o=0;for(const u of t)i.has(u.role_id)&&(r|=u.allow,o|=u.deny);return r===0&&o===0?n:n&~o|r}function KU(n){const e=at(h=>h.user),t=Et(h=>h.members),i=Uo(h=>h.getOverrides),r=T.useMemo(()=>t.find(h=>h.id===e?.id),[t,e?.id]),o=n?i(n):[],u=T.useMemo(()=>r?.roles.map(h=>h.id)??[],[r?.roles]),l=T.useMemo(()=>{const h=r?.effective_permissions??0;return!n||o.length===0?h:$U(h,u,o)},[r?.effective_permissions,n,u,o]),f=T.useMemo(()=>h=>(l&Pe.Admin)!==0?!0:(l&h)!==0,[l]);return{channelPerms:l,hasChannelPerm:f}}async function Kb(n,e,t){const i=new URLSearchParams;e&&i.set("before",e),i.set("limit",t.toString());const r=i.toString(),o=`/channels/${n}/messages${r?`?${r}`:""}`;return xe(o)}async function GU(n,e,t,i){if(t&&t.length>0){const r=new FormData;r.append("content",e),i&&r.append("reply_to_id",i);for(const o of t)r.append("files",o);return xe(`/channels/${n}/messages`,{method:"POST",body:r})}return xe(`/channels/${n}/messages`,{method:"POST",body:{content:e,reply_to_id:i}})}async function YU(n,e){return xe(`/messages/${n}`,{method:"PATCH",body:{content:e}})}async function JU(n){return xe(`/messages/${n}`,{method:"DELETE"})}async function QU(n,e){return xe(`/messages/${n}/reactions`,{method:"POST",body:{emoji:e}})}const XU=5e3,nh=new Map,ht=Wt((n,e)=>({messagesByChannel:{},hasMoreByChannel:{},isLoading:!1,isLoadingMore:!1,typingUsers:{},replyingTo:null,scrollToMessageId:null,fetchMessages:async t=>{if(e().messagesByChannel[t])return;n({isLoading:!0});const i=await Kb(t,void 0,Fb);i.success&&i.data?n(r=>({messagesByChannel:{...r.messagesByChannel,[t]:i.data.messages},hasMoreByChannel:{...r.hasMoreByChannel,[t]:i.data.has_more},isLoading:!1})):n({isLoading:!1})},fetchOlderMessages:async t=>{const i=e().messagesByChannel[t];if(!i||i.length===0||!e().hasMoreByChannel[t])return;n({isLoadingMore:!0});const r=i[0].id,o=await Kb(t,r,Fb);o.success&&o.data?n(u=>({messagesByChannel:{...u.messagesByChannel,[t]:[...o.data.messages,...u.messagesByChannel[t]]},hasMoreByChannel:{...u.hasMoreByChannel,[t]:o.data.has_more},isLoadingMore:!1})):n({isLoadingMore:!1})},sendMessage:async(t,i,r,o)=>(await GU(t,i,r,o)).success,editMessage:async(t,i)=>(await YU(t,i)).success,deleteMessage:async t=>(await JU(t)).success,setReplyingTo:t=>n({replyingTo:t}),setScrollToMessageId:t=>n({scrollToMessageId:t}),toggleReaction:async(t,i,r)=>{await QU(t,r)},handleMessageCreate:t=>{n(i=>{const r=i.messagesByChannel[t.channel_id];if(!r||r.some(u=>u.id===t.id))return i;const o={...i.typingUsers};return o[t.channel_id]&&(o[t.channel_id]=o[t.channel_id].filter(u=>u!==t.author?.username)),{messagesByChannel:{...i.messagesByChannel,[t.channel_id]:[...r,t]},typingUsers:o}})},handleMessageUpdate:t=>{n(i=>{const r=i.messagesByChannel[t.channel_id];return r?{messagesByChannel:{...i.messagesByChannel,[t.channel_id]:r.map(o=>o.id===t.id?t:o)}}:i})},handleMessageDelete:t=>{n(i=>{const r=i.messagesByChannel[t.channel_id];if(!r)return i;const o=r.filter(u=>u.id!==t.id).map(u=>u.reply_to_id===t.id?{...u,referenced_message:{id:t.id,author:null,content:null}}:u);return{messagesByChannel:{...i.messagesByChannel,[t.channel_id]:o}}})},handleTypingStart:(t,i)=>{n(u=>{const l=u.typingUsers[t]??[];return l.includes(i)?u:{typingUsers:{...u.typingUsers,[t]:[...l,i]}}});const r=`${t}:${i}`,o=nh.get(r);o&&clearTimeout(o),nh.set(r,setTimeout(()=>{n(u=>({typingUsers:{...u.typingUsers,[t]:(u.typingUsers[t]??[]).filter(l=>l!==i)}})),nh.delete(r)},XU))},handleReactionUpdate:t=>{n(i=>{const r=i.messagesByChannel[t.channel_id];return r?{messagesByChannel:{...i.messagesByChannel,[t.channel_id]:r.map(o=>o.id===t.message_id?{...o,reactions:t.reactions}:o)}}:i})}}));function WU({count:n=5}){return y.jsx("div",{className:"sk-container",children:Array.from({length:n},(e,t)=>y.jsxs("div",{className:"sk-message",children:[y.jsx("div",{className:"sk-avatar"}),y.jsxs("div",{className:"sk-body",children:[y.jsx("div",{className:"sk-line sk-short"}),y.jsx("div",{className:"sk-line sk-long"}),t%2===0&&y.jsx("div",{className:"sk-line sk-medium"})]})]},t))})}function ZU({count:n=8}){return y.jsx("div",{className:"sk-container",children:Array.from({length:n},(e,t)=>y.jsxs("div",{className:"sk-member",children:[y.jsx("div",{className:"sk-avatar-sm"}),y.jsx("div",{className:"sk-line sk-name"})]},t))})}function e3({count:n=4}){return y.jsx(y.Fragment,{children:Array.from({length:n},(e,t)=>y.jsxs("div",{className:"sk-channel",children:[y.jsx("div",{className:"sk-ch-icon"}),y.jsx("div",{className:"sk-line sk-ch-name"})]},t))})}const Gb={isOpen:!1,x:0,y:0,items:[]};function Tm(){const[n,e]=T.useState(Gb),t=T.useCallback((r,o)=>{r.preventDefault(),r.stopPropagation(),e({isOpen:!0,x:r.clientX,y:r.clientY,items:o})},[]),i=T.useCallback(()=>{e(Gb)},[]);return{menuState:n,openMenu:t,closeMenu:i}}function t3(n){switch(n){case"admin":return"av-admin";case"mod":return"av-mod";default:return"av-default"}}function li({name:n,role:e,avatarUrl:t,size:i=30,isCircle:r=!1}){const o=r?"avatar avatar-round":"avatar",u=i*.37;return t?y.jsx("img",{src:t,alt:n,className:o,style:{width:i,height:i,objectFit:"cover"}}):y.jsx("div",{className:`${o} ${t3(e)}`,style:{width:i,height:i,fontSize:u},children:n.charAt(0).toUpperCase()})}function Em({state:n,onClose:e}){const t=T.useRef(null);return T.useEffect(()=>{if(!n.isOpen)return;function i(o){t.current&&!t.current.contains(o.target)&&e()}function r(o){o.key==="Escape"&&e()}return requestAnimationFrame(()=>{document.addEventListener("mousedown",i),document.addEventListener("keydown",r)}),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("keydown",r)}},[n.isOpen,e]),T.useEffect(()=>{if(!n.isOpen||!t.current)return;const i=t.current,r=i.getBoundingClientRect(),o=window.innerWidth,u=window.innerHeight;let l=n.x,f=n.y;l+r.width>o-8&&(l=o-r.width-8),f+r.height>u-8&&(f=u-r.height-8),i.style.left=`${l}px`,i.style.top=`${f}px`},[n.isOpen,n.x,n.y]),n.isOpen?KS.createPortal(y.jsx("div",{ref:t,className:"ctx-menu",style:{left:n.x,top:n.y},children:n.items.map((i,r)=>y.jsxs("div",{children:[i.separator&&y.jsx("div",{className:"ctx-separator"}),y.jsx("button",{className:`ctx-item${i.danger?" ctx-danger":""}${i.disabled?" ctx-disabled":""}`,onClick:()=>{i.disabled||(i.onClick(),e())},disabled:i.disabled,children:i.label})]},r))}),document.body):null}const Yb=[{labelKey:"emojiFrequent",icon:"",emojis:["","","","","","","","","","","",""]},{labelKey:"emojiPeople",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{labelKey:"emojiGestures",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{labelKey:"emojiNature",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","",""]},{labelKey:"emojiFood",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","",""]},{labelKey:"emojiObjects",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}];function Jb({onSelect:n,onClose:e}){const{t}=Te("chat"),[i,r]=T.useState(0),o=T.useRef(null);T.useEffect(()=>{function f(m){o.current&&!o.current.contains(m.target)&&e()}const h=setTimeout(()=>{document.addEventListener("mousedown",f)},0);return()=>{clearTimeout(h),document.removeEventListener("mousedown",f)}},[e]),T.useEffect(()=>{function f(h){h.key==="Escape"&&e()}return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[e]);const u=T.useCallback(f=>{n(f),e()},[n,e]),l=Yb[i];return y.jsxs("div",{className:"emoji-picker",ref:o,children:[y.jsx("div",{className:"emoji-picker-tabs",children:Yb.map((f,h)=>y.jsx("button",{className:`emoji-picker-tab${h===i?" active":""}`,onClick:()=>r(h),title:t(f.labelKey),children:f.icon},f.labelKey))}),y.jsx("div",{className:"emoji-picker-grid",children:l.emojis.map(f=>y.jsx("button",{className:"emoji-picker-btn",onClick:()=>u(f),children:f},f))})]})}function n3(n){if(!n||n.roles.length===0)return null;const t=n.roles.reduce((i,r)=>r.position>i.position?r:i).name.toLowerCase();return t.includes("admin")||t.includes("owner")?"admin":t.includes("mod")?"mod":null}function i3(n){switch(n){case"admin":return"name-admin";case"mod":return"name-mod";default:return"name-default"}}function s3({message:n,isCompact:e}){const{t}=Te("chat"),i=at(se=>se.user),r=ht(se=>se.editMessage),o=ht(se=>se.deleteMessage),u=ht(se=>se.toggleReaction),l=ht(se=>se.setReplyingTo),f=ht(se=>se.setScrollToMessageId),h=Et(se=>se.members),m=Xn(se=>se.pin),g=Xn(se=>se.unpin),b=Xn(se=>se.isMessagePinned),{menuState:C,openMenu:E,closeMenu:k}=Tm(),[_,w]=T.useState(!1),[O,D]=T.useState(n.content??""),[x,R]=T.useState(null),M=i?.id===n.user_id,L=h.find(se=>se.id===n.user_id),B=n3(L),V=h.find(se=>se.id===i?.id),P=V?Vn(V.effective_permissions,Pe.ManageMessages):!1,z=b(n.channel_id,n.id),W=T.useCallback(se=>new Date(se).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),[]),J=T.useCallback(se=>new Date(se).toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),[]);async function he(){O.trim()&&O.trim()!==n.content&&await r(n.id,O.trim()),w(!1)}function we(){D(n.content??""),w(!1)}async function H(){await o(n.id)}async function re(){z?await g(n.channel_id,n.id):await m(n.channel_id,n.id)}function fe(){l(n)}function Re(){n.reply_to_id&&f(n.reply_to_id)}function Me(se){u(n.id,n.channel_id,se)}function I(se){const pe=[];pe.push({label:t("replyMessage"),onClick:fe}),pe.push({label:t("addReaction"),onClick:()=>R("bar")}),pe.push({label:t("copyMessage"),onClick:()=>{n.content&&navigator.clipboard.writeText(n.content)}}),P&&pe.push({label:t(z?"unpinMessage":"pinMessage"),onClick:re,separator:!0}),M&&pe.push({label:t("editMessage"),onClick:()=>{D(n.content??""),w(!0)},separator:!P}),(M||P)&&pe.push({label:t("deleteMessage"),onClick:H,danger:!0}),pe.push({label:t("copyId"),onClick:()=>navigator.clipboard.writeText(n.id),separator:!0}),E(se,pe)}const Q=n.author?.display_name??n.author?.username??"Unknown";function oe(se){return se?se.split(/(@\w+)/g).map((ve,Ye)=>/^@\w+$/.test(ve)?y.jsx("span",{className:"msg-mention",children:ve},Ye):ve):null}const de=`msg${e?" grouped":" first-of-group"}${x?" picker-open":""}`;return y.jsxs("div",{className:de,onContextMenu:I,children:[y.jsx("span",{className:"msg-gtime",children:W(n.created_at)}),y.jsxs("div",{className:"msg-row",children:[y.jsx("div",{className:"msg-avatar",children:y.jsx(li,{name:Q,role:B,avatarUrl:n.author?.avatar_url??void 0,size:30})}),y.jsxs("div",{className:"msg-body",children:[y.jsxs("div",{className:"msg-meta",children:[y.jsx("span",{className:`msg-name ${i3(B)}`,children:Q}),y.jsx("span",{className:"msg-time",title:J(n.created_at),children:W(n.created_at)})]}),n.reply_to_id&&y.jsxs("div",{className:"msg-reply-preview",onClick:Re,children:[y.jsx("div",{className:"msg-reply-bar"}),n.referenced_message?.author?y.jsxs(y.Fragment,{children:[y.jsx("span",{className:"msg-reply-author",children:n.referenced_message.author.display_name??n.referenced_message.author.username}),y.jsx("span",{className:"msg-reply-content",children:n.referenced_message.content??t("noContent")})]}):y.jsx("span",{className:"msg-reply-deleted",children:t("replyDeleted")})]}),z&&y.jsxs("div",{className:"msg-pin-indicator",children:[y.jsx("svg",{style:{width:12,height:12},fill:"currentColor",viewBox:"0 0 24 24",stroke:"none",children:y.jsx("path",{d:"M16 4v4l2 2v4h-5v6l-1 1-1-1v-6H6v-4l2-2V4a1 1 0 011-1h6a1 1 0 011 1z"})}),y.jsx("span",{children:t("pinnedMessages")})]}),_?y.jsxs("div",{className:"msg-edit-area",children:[y.jsx("textarea",{value:O,onChange:se=>D(se.target.value),onKeyDown:se=>{se.key==="Enter"&&!se.shiftKey&&(se.preventDefault(),he()),se.key==="Escape"&&we()},className:"msg-edit-textarea",rows:2,autoFocus:!0}),y.jsxs("p",{className:"msg-edit-hint",children:["escape = ",t("editCancel","cancel"),", enter = ",t("editSave","save")]})]}):y.jsxs("div",{className:"msg-text",children:[oe(n.content),n.edited_at&&y.jsx("span",{className:"msg-edited",children:t("edited")})]}),n.attachments&&n.attachments.length>0&&y.jsx("div",{className:"msg-attachments",children:n.attachments.map(se=>se.mime_type?.startsWith("image/")?y.jsx("a",{href:se.file_url,target:"_blank",rel:"noopener noreferrer",children:y.jsx("img",{src:se.file_url,alt:se.filename,className:"msg-attachment-img",loading:"lazy"})},se.id):y.jsxs("a",{href:se.file_url,target:"_blank",rel:"noopener noreferrer",className:"msg-attachment-file",children:[y.jsx("svg",{className:"msg-attachment-file-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})}),y.jsxs("div",{style:{minWidth:0},children:[y.jsx("p",{className:"msg-attachment-file-name",children:se.filename}),se.file_size&&y.jsx("p",{className:"msg-attachment-file-size",children:a3(se.file_size)})]})]},se.id))}),(n.reactions&&n.reactions.length>0||x==="bar")&&y.jsxs("div",{className:"msg-reactions",children:[n.reactions?.map(se=>{const pe=i?se.users.includes(i.id):!1;return y.jsxs("button",{className:`msg-reaction-btn${pe?" active":""}`,onClick:()=>Me(se.emoji),title:se.users.length.toString(),children:[y.jsx("span",{className:"msg-reaction-emoji",children:se.emoji}),y.jsx("span",{className:"msg-reaction-count",children:se.count})]},se.emoji)}),y.jsxs("div",{className:"msg-reaction-add-wrap",children:[y.jsx("button",{className:"msg-reaction-add",onClick:()=>R("bar"),title:t("addReaction"),children:"+"}),x==="bar"&&y.jsx(Jb,{onSelect:Me,onClose:()=>R(null)})]})]})]})]}),y.jsx(Em,{state:C,onClose:k}),!_&&y.jsxs("div",{className:"msg-hover-actions",children:[y.jsx("button",{onClick:fe,title:t("replyMessage"),children:y.jsx("svg",{style:{width:14,height:14},fill:"currentColor",viewBox:"0 0 24 24",stroke:"none",children:y.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"})})}),y.jsxs("div",{className:"msg-reaction-add-wrap",children:[y.jsx("button",{onClick:()=>R("hover"),title:t("addReaction"),children:y.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),x==="hover"&&y.jsx(Jb,{onSelect:Me,onClose:()=>R(null)})]}),P&&y.jsx("button",{onClick:re,title:t(z?"unpinMessage":"pinMessage"),children:y.jsx("svg",{style:{width:14,height:14},fill:z?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 4v4l2 2v4h-5v6l-1 1-1-1v-6H6v-4l2-2V4a1 1 0 011-1h6a1 1 0 011 1z"})})}),M&&y.jsx("button",{onClick:()=>{D(n.content??""),w(!0)},title:t("editMessage"),children:y.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(M||P)&&y.jsx("button",{onClick:H,title:t("deleteMessage"),children:y.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})}function a3(n){return n<1024?`${n} B`:n<1024*1024?`${(n/1024).toFixed(1)} KB`:`${(n/(1024*1024)).toFixed(1)} MB`}const r3=300*1e3,Qb=[],Xb=new Map;function o3({channelId:n}){const{t:e}=Te("chat"),t=xt(O=>O.categories),i=ht(O=>n?O.messagesByChannel[n]??Qb:Qb),r=ht(O=>n?O.hasMoreByChannel[n]??!1:!1),o=ht(O=>O.isLoading),u=ht(O=>O.isLoadingMore),l=ht(O=>O.fetchMessages),f=ht(O=>O.fetchOlderMessages),h=ht(O=>O.scrollToMessageId),m=ht(O=>O.setScrollToMessageId),g=T.useRef(null),b=T.useRef(!0),C=T.useRef(0),E=t.flatMap(O=>O.channels).find(O=>O.id===n)?.name??"";T.useEffect(()=>{b.current=!1,n&&l(n)},[n,l]),T.useEffect(()=>{i.length>C.current&&b.current&&k(),C.current=i.length},[i.length]),T.useLayoutEffect(()=>{if(!o&&i.length>0&&g.current){const O=Xb.get(n);O!==void 0?g.current.scrollTop=O:k(),C.current=i.length;const{scrollTop:D,scrollHeight:x,clientHeight:R}=g.current;b.current=x-D-R<20}},[o,n]),T.useEffect(()=>{if(!h)return;const O=document.getElementById(`msg-${h}`);if(O){O.scrollIntoView({behavior:"smooth",block:"center"}),O.classList.add("msg-highlight");const D=setTimeout(()=>{O.classList.remove("msg-highlight")},2e3);return m(null),()=>clearTimeout(D)}m(null)},[h,m]);function k(){g.current&&(g.current.scrollTop=g.current.scrollHeight)}const _=T.useCallback(()=>{if(!g.current)return;const{scrollTop:O,scrollHeight:D,clientHeight:x}=g.current;if(b.current=D-O-x<20,n&&Xb.set(n,O),O<100&&r&&!u&&n){const R=g.current.scrollHeight;f(n).then(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight-R)})}},[r,u,n,f]);function w(O){if(O===0)return!1;const D=i[O];if(D.reply_to_id)return!1;const x=i[O-1];return D.user_id!==x.user_id?!1:new Date(D.created_at).getTime()-new Date(x.created_at).getTime()<r3}return n?o?y.jsx("div",{className:"messages-scroll",children:y.jsx(WU,{count:6})}):y.jsxs("div",{ref:g,onScroll:_,className:"messages-scroll",children:[u&&y.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"16px 0"},children:y.jsx("div",{className:"spinner"})}),i.length===0?y.jsxs("div",{className:"msg-welcome",children:[y.jsx("div",{className:"msg-welcome-icon",children:y.jsx("span",{children:"#"})}),y.jsx("h2",{children:e("welcomeChannel",{channel:E})}),y.jsx("p",{children:e("channelStart",{channel:E})})]}):y.jsx("div",{style:{display:"flex",flexDirection:"column",justifyContent:"flex-end",padding:"8px 0"},children:i.map((O,D)=>y.jsx("div",{id:`msg-${O.id}`,children:y.jsx(s3,{message:O,isCompact:w(D)})},O.id))})]}):y.jsx("div",{className:"no-channel",children:"Select a channel"})}function c3({files:n,onRemove:e}){return n.length===0?null:y.jsx("div",{className:"file-preview",children:n.map((t,i)=>y.jsx(l3,{file:t,onRemove:()=>e(i)},i))})}function l3({file:n,onRemove:e}){const t=n.type.startsWith("image/"),i=T.useMemo(()=>t?URL.createObjectURL(n):null,[n,t]);return y.jsxs("div",{className:"file-preview-item",children:[y.jsx("button",{className:"file-preview-remove",onClick:e,children:""}),t&&i?y.jsx("img",{src:i,alt:n.name}):y.jsx("span",{className:"file-preview-name",children:n.name})]})}const u3=5;function d3({query:n,onSelect:e,onClose:t}){const i=Et(f=>f.members),[r,o]=T.useState(0),u=i.filter(f=>{const h=n.toLowerCase();return f.username.toLowerCase().includes(h)||(f.display_name?.toLowerCase().includes(h)??!1)}).slice(0,u3);T.useEffect(()=>{o(0)},[n]),T.useEffect(()=>{u.length===0&&n.length>0&&t()},[u.length,n.length,t]);const l=T.useCallback(f=>{if(u.length!==0)switch(f.key){case"ArrowUp":f.preventDefault(),o(h=>h>0?h-1:u.length-1);break;case"ArrowDown":f.preventDefault(),o(h=>h<u.length-1?h+1:0);break;case"Enter":case"Tab":f.preventDefault(),u[r]&&e(u[r].username);break;case"Escape":f.preventDefault(),t();break}},[u,r,e,t]);return T.useEffect(()=>(document.addEventListener("keydown",l,!0),()=>document.removeEventListener("keydown",l,!0)),[l]),u.length===0?null:y.jsx("div",{className:"mention-popup",children:u.map((f,h)=>y.jsxs("button",{className:`mention-item${h===r?" active":""}`,onMouseDown:m=>{m.preventDefault(),e(f.username)},onMouseEnter:()=>o(h),children:[y.jsx("div",{className:"mention-item-avatar",children:y.jsx(li,{name:f.display_name??f.username,avatarUrl:f.avatar_url??void 0,size:22})}),y.jsx("span",{className:"mention-item-name",children:f.display_name??f.username}),y.jsxs("span",{className:"mention-item-username",children:["@",f.username]})]},f.id))})}function f3({message:n,onCancel:e}){const{t}=Te("chat"),i=n.author?.display_name??n.author?.username??t("unknownUser"),r=n.content??t("noContent");return y.jsxs("div",{className:"reply-bar",children:[y.jsx("svg",{className:"reply-bar-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:y.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"})}),y.jsx("span",{className:"reply-bar-user",children:t("replyingTo",{user:i})}),y.jsx("span",{className:"reply-bar-text",children:r}),y.jsx("button",{className:"reply-bar-close",onClick:e,title:"Escape",children:y.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:y.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]})}function h3({sendTyping:n,channelId:e,channelName:t,canSend:i}){const{t:r}=Te("chat"),o=ht(P=>P.sendMessage),u=ht(P=>P.replyingTo),l=ht(P=>P.setReplyingTo),[f,h]=T.useState(""),[m,g]=T.useState([]),[b,C]=T.useState(!1),[E,k]=T.useState(null),_=T.useRef(-1),w=T.useRef(null),O=T.useRef(null);T.useEffect(()=>{u&&w.current?.focus()},[u]);const D=T.useCallback(async()=>{if(!e||!f.trim()&&m.length===0||b)return;C(!0);const P=u?.id;await o(e,f.trim(),m,P)&&(h(""),g([]),l(null),w.current&&(w.current.style.height="auto")),C(!1),requestAnimationFrame(()=>{w.current?.focus()})},[e,f,m,b,o,u,l]);function x(P){if(!(E!==null&&["Enter","Tab","ArrowUp","ArrowDown","Escape"].includes(P.key))){if(P.key==="Escape"&&u){P.preventDefault(),l(null);return}P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),D())}}function R(P){const z=P.target.value;h(z),e&&z.length>0&&n(e);const W=P.target.selectionStart??z.length,J=z.slice(0,W),he=J.lastIndexOf("@");if(he>=0){const we=he>0?J[he-1]:" ";if(we===" "||we===`
`||he===0){const H=J.slice(he+1);!H.includes(" ")&&!H.includes(`
`)?(_.current=he,k(H)):k(null)}else k(null)}else k(null);w.current&&(w.current.style.height="auto",w.current.style.height=`${Math.min(w.current.scrollHeight,200)}px`)}function M(P){const z=_.current;if(z<0)return;const W=w.current?.selectionStart??f.length,J=f.slice(0,z),he=f.slice(W),we=`${J}@${P} ${he}`;h(we),k(null),_.current=-1,requestAnimationFrame(()=>{if(w.current){const H=z+P.length+2;w.current.selectionStart=H,w.current.selectionEnd=H,w.current.focus()}})}function L(){k(null),_.current=-1}function B(P){if(!P.target.files)return;const z=Array.from(P.target.files),W=[];for(const J of z)J.size>pU||gU.includes(J.type)&&W.push(J);g(J=>[...J,...W]),P.target.value=""}function V(P){g(z=>z.filter((W,J)=>J!==P))}return e?i?y.jsxs("div",{className:"input-area",children:[E!==null&&y.jsx(d3,{query:E,onSelect:M,onClose:L}),u&&y.jsx(f3,{message:u,onCancel:()=>l(null)}),y.jsx(c3,{files:m,onRemove:V}),y.jsxs("div",{className:"input-box",children:[y.jsx("button",{onClick:()=>O.current?.click(),children:""}),y.jsx("input",{ref:O,type:"file",multiple:!0,style:{display:"none"},onChange:B}),y.jsx("textarea",{ref:w,value:f,onChange:R,onKeyDown:x,placeholder:r("messagePlaceholder",{channel:t}),rows:1,disabled:b}),y.jsx("button",{children:""}),y.jsx("button",{className:"send-btn",onClick:D,children:y.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:y.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]})]}):y.jsx("div",{className:"input-area",children:y.jsx("div",{className:"input-box input-box-disabled",children:y.jsx("span",{className:"input-no-perm",children:r("noSendPermission")})})}):null}const Wb=[];function m3({channelId:n}){const{t:e}=Te("chat"),t=ht(r=>n?r.typingUsers[n]??Wb:Wb);if(t.length===0)return null;const i=t.length===1?e("typing",{user:t[0]}):e("typingMultiple",{count:t.length});return y.jsxs("div",{className:"typing-indicator",children:[y.jsxs("div",{className:"typing-dots",children:[y.jsx("i",{}),y.jsx("i",{}),y.jsx("i",{})]}),y.jsx("span",{children:i})]})}function p3({channelId:n,onClose:e}){const{t}=Te("chat"),i=Xn(E=>E.fetchPins),r=Xn(E=>E.getPinsForChannel),o=Xn(E=>E.unpin),u=Xn(E=>E.isLoading),l=Et(E=>E.members),f=at(E=>E.user),h=r(n),m=l.find(E=>E.id===f?.id),g=m?Vn(m.effective_permissions,Pe.ManageMessages):!1;T.useEffect(()=>{i(n)},[n,i]);const b=T.useCallback(async E=>{await o(n,E)},[n,o]);function C(E){return new Date(E).toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}return y.jsxs("div",{className:"pinned-panel",children:[y.jsxs("div",{className:"pinned-header",children:[y.jsx("span",{className:"pinned-header-title",children:t("pinnedMessages")}),y.jsx("button",{onClick:e,className:"pinned-close",children:y.jsx("svg",{style:{width:16,height:16},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),y.jsx("div",{className:"pinned-list",children:u?y.jsx("p",{className:"pinned-empty",children:t("noPinnedMessages")}):h.length===0?y.jsx("p",{className:"pinned-empty",children:t("noPinnedMessages")}):h.map(E=>{const k=E.message?.author,_=k?.display_name??k?.username??"Unknown";return y.jsxs("div",{className:"pinned-item",children:[y.jsxs("div",{className:"pinned-item-header",children:[y.jsx(li,{name:_,avatarUrl:k?.avatar_url??void 0,size:20}),y.jsx("span",{className:"pinned-item-author",children:_}),y.jsx("span",{className:"pinned-item-time",children:C(E.message?.created_at??E.created_at)})]}),y.jsx("div",{className:"pinned-item-content",children:E.message?.content??""}),g&&y.jsx("button",{onClick:()=>b(E.message_id),className:"pinned-item-unpin",title:t("unpinMessage"),children:y.jsx("svg",{style:{width:12,height:12},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},E.id)})})]})}async function g3(n,e,t=25,i=0){const r=new URLSearchParams({q:n});return e&&r.set("channel_id",e),t!==25&&r.set("limit",String(t)),i>0&&r.set("offset",String(i)),xe(`/search?${r.toString()}`)}const v3=300;function y3({channelId:n,onClose:e,onSelectResult:t}){const{t:i}=Te("chat"),[r,o]=T.useState(""),[u,l]=T.useState(null),[f,h]=T.useState(!1),[m,g]=T.useState(0),b=T.useRef(null),C=T.useRef(null),E=25;T.useEffect(()=>{C.current?.focus()},[]);const k=T.useCallback(async(M,L)=>{if(M.trim().length<1){l(null);return}h(!0);const B=await g3(M.trim(),n,E,L);B.success&&B.data?l(B.data):l({messages:[],total_count:0}),h(!1)},[n]);function _(M){o(M),g(0),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{k(M,0)},v3)}function w(){const M=m+E;g(M),k(r,M)}function O(){const M=Math.max(0,m-E);g(M),k(r,M)}function D(M){return new Date(M).toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}const x=u?Math.ceil(u.total_count/E):0,R=Math.floor(m/E)+1;return y.jsxs("div",{className:"search-panel",children:[y.jsxs("div",{className:"search-header",children:[y.jsx("span",{className:"search-header-title",children:i("searchMessages")}),y.jsx("button",{onClick:e,className:"search-close",children:y.jsx("svg",{style:{width:16,height:16},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),y.jsxs("div",{className:"search-input-wrap",children:[y.jsx("svg",{className:"search-input-icon",style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),y.jsx("input",{ref:C,type:"text",value:r,onChange:M=>_(M.target.value),placeholder:i("searchPlaceholder"),className:"search-input"})]}),y.jsx("div",{className:"search-results",children:f?y.jsx("p",{className:"search-empty",children:i("searching")}):u?u.messages.length===0?y.jsx("p",{className:"search-empty",children:i("noSearchResults")}):y.jsxs(y.Fragment,{children:[y.jsx("p",{className:"search-count",children:i("searchResultCount",{count:u.total_count})}),u.messages.map(M=>{const L=M.author?.display_name??M.author?.username??"Unknown";return y.jsxs("div",{className:"search-result-item",onClick:()=>t?.(M),children:[y.jsxs("div",{className:"search-result-header",children:[y.jsx(li,{name:L,avatarUrl:M.author?.avatar_url??void 0,size:18}),y.jsx("span",{className:"search-result-author",children:L}),y.jsx("span",{className:"search-result-time",children:D(M.created_at)})]}),y.jsx("div",{className:"search-result-content",children:M.content??""})]},M.id)}),x>1&&y.jsxs("div",{className:"search-pagination",children:[y.jsx("button",{onClick:O,disabled:R<=1,className:"search-page-btn",children:i("searchPrev")}),y.jsxs("span",{className:"search-page-info",children:[R," / ",x]}),y.jsx("button",{onClick:w,disabled:R>=x,className:"search-page-btn",children:i("searchNext")})]})]}):y.jsx("p",{className:"search-empty",children:i("searchHint")})})]})}function b3({channelId:n,channel:e,sendTyping:t}){const{t:i}=Te("chat"),r=Xe(_=>_.toggleMembers),o=Xe(_=>_.membersOpen),u=Xn(_=>_.getPinsForChannel),l=Xn(_=>_.fetchPins),f=Uo(_=>_.fetchOverrides),{hasChannelPerm:h}=KU(n),[m,g]=T.useState(!1),[b,C]=T.useState(!1);T.useEffect(()=>{n&&(l(n),f(n))},[n,l,f]);const E=u(n).length,k=h(Pe.SendMessages);return y.jsxs("div",{className:"chat-area",children:[y.jsx("div",{className:"channel-bar",children:e?y.jsxs(y.Fragment,{children:[y.jsx("span",{className:"ch-hash",children:"#"}),y.jsx("span",{className:"ch-name",children:e.name}),e.topic&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"ch-divider"}),y.jsx("span",{className:"ch-topic",children:e.topic})]}),y.jsxs("div",{className:"ch-actions",children:[y.jsx("button",{className:m?"active":"",onClick:()=>g(_=>!_),title:i("pinnedMessages"),children:y.jsx("svg",{style:{width:16,height:16},fill:E>0?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 4v4l2 2v4h-5v6l-1 1-1-1v-6H6v-4l2-2V4a1 1 0 011-1h6a1 1 0 011 1z"})})}),y.jsx("button",{className:b?"active":"",onClick:()=>C(_=>!_),title:i("searchMessages"),children:y.jsx("svg",{style:{width:16,height:16},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),y.jsx("button",{className:o?"active":"",onClick:r,children:y.jsx("svg",{style:{width:16,height:16},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})]})]}):y.jsx("span",{className:"ch-topic",children:i("channelStart",{channel:""})})}),m&&y.jsx(p3,{channelId:n,onClose:()=>g(!1)}),b&&y.jsx(y3,{channelId:n,onClose:()=>C(!1)}),y.jsx(o3,{channelId:n}),y.jsx(m3,{channelId:n}),y.jsx(h3,{sendTyping:t,channelId:n,channelName:e?.name??"",canSend:k})]})}var Zb={};function S3(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(n)}var C3=Object.defineProperty,k3=(n,e,t)=>e in n?C3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,e0=(n,e,t)=>k3(n,typeof e!="symbol"?e+"":e,t);class nn{constructor(){e0(this,"_locking"),e0(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),i}}function vt(n,e){if(!n)throw new Error(e)}const T3=34028234663852886e22,E3=-34028234663852886e22,x3=4294967295,R3=2147483647,_3=-2147483648;function Ml(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>R3||n<_3)throw new Error("invalid int 32: "+n)}function Ih(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>x3||n<0)throw new Error("invalid uint 32: "+n)}function fC(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>T3||n<E3))throw new Error("invalid float 32: "+n)}const hC=Symbol("@bufbuild/protobuf/enum-type");function w3(n){const e=n[hC];return vt(e,"missing enum type on enum object"),e}function mC(n,e,t,i){n[hC]=pC(e,t.map(r=>({no:r.no,name:r.name,localName:n[r.no]})))}function pC(n,e,t){const i=Object.create(null),r=Object.create(null),o=[];for(const u of e){const l=gC(u);o.push(l),i[u.name]=l,r[u.no]=l}return{typeName:n,values:o,findName(u){return i[u]},findNumber(u){return r[u]}}}function M3(n,e,t){const i={};for(const r of e){const o=gC(r);i[o.localName]=o.no,i[o.no]=o.localName}return mC(i,n,e),i}function gC(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class xm{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),r=i.runtime.bin,o=r.makeReadOptions(t);return r.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,t){const i=this.getType(),r=i.runtime.json,o=r.makeReadOptions(t);return r.readMessage(i,e,o,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,r=i.makeWriteOptions(e),o=r.writerFactory();return i.writeMessage(this,o,r),o.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e?.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function N3(n,e,t,i){var r;const o=(r=i?.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),u={[o]:function(l){n.util.initFields(this),n.util.initPartial(l,this)}}[o];return Object.setPrototypeOf(u.prototype,new xm),Object.assign(u,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(l,f){return new u().fromBinary(l,f)},fromJson(l,f){return new u().fromJson(l,f)},fromJsonString(l,f){return new u().fromJsonString(l,f)},equals(l,f){return n.util.equals(u,l,f)}}),u}function O3(){let n=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(n|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function ih(n,e,t){for(let o=0;o<28;o=o+7){const u=n>>>o,l=!(!(u>>>7)&&e==0),f=(l?u|128:u)&255;if(t.push(f),!l)return}const i=n>>>28&15|(e&7)<<4,r=e>>3!=0;if(t.push((r?i|128:i)&255),!!r){for(let o=3;o<31;o=o+7){const u=e>>>o,l=!!(u>>>7),f=(l?u|128:u)&255;if(t.push(f),!l)return}t.push(e>>>31&1)}}const Nl=4294967296;function t0(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,r=0;function o(u,l){const f=Number(n.slice(u,l));r*=t,i=i*t+f,i>=Nl&&(r=r+(i/Nl|0),i=i%Nl)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?yC(i,r):Rm(i,r)}function D3(n,e){let t=Rm(n,e);const i=t.hi&2147483648;i&&(t=yC(t.lo,t.hi));const r=vC(t.lo,t.hi);return i?"-"+r:r}function vC(n,e){if({lo:n,hi:e}=A3(n,e),e<=2097151)return String(Nl*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,r=e>>16&65535;let o=t+i*6777216+r*6710656,u=i+r*8147497,l=r*2;const f=1e7;return o>=f&&(u+=Math.floor(o/f),o%=f),u>=f&&(l+=Math.floor(u/f),u%=f),l.toString()+n0(u)+n0(o)}function A3(n,e){return{lo:n>>>0,hi:e>>>0}}function Rm(n,e){return{lo:n|0,hi:e|0}}function yC(n,e){return e=~e,n?n=~n+1:e+=1,Rm(n,e)}const n0=n=>{const e=String(n);return"0000000".slice(e.length)+e};function i0(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function P3(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function L3(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof Zb!="object"||Zb.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),u=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(f){const h=typeof f=="bigint"?f:BigInt(f);if(h>o||h<r)throw new Error("int64 invalid: ".concat(f));return h},uParse(f){const h=typeof f=="bigint"?f:BigInt(f);if(h>l||h<u)throw new Error("uint64 invalid: ".concat(f));return h},enc(f){return n.setBigInt64(0,this.parse(f),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(f){return n.setBigInt64(0,this.uParse(f),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(f,h){return n.setInt32(0,f,!0),n.setInt32(4,h,!0),n.getBigInt64(0,!0)},uDec(f,h){return n.setInt32(0,f,!0),n.setInt32(4,h,!0),n.getBigUint64(0,!0)}}}const t=r=>vt(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>vt(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),t(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),t(r),t0(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),t0(r)},dec(r,o){return D3(r,o)},uDec(r,o){return vC(r,o)}}}const ut=L3();var ae;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(ae||(ae={}));var xs;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(xs||(xs={}));function vs(n,e,t){if(e===t)return!0;if(n==ae.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case ae.UINT64:case ae.FIXED64:case ae.INT64:case ae.SFIXED64:case ae.SINT64:return e==t}return!1}function or(n,e){switch(n){case ae.BOOL:return!1;case ae.UINT64:case ae.FIXED64:case ae.INT64:case ae.SFIXED64:case ae.SINT64:return e==0?ut.zero:"0";case ae.DOUBLE:case ae.FLOAT:return 0;case ae.BYTES:return new Uint8Array(0);case ae.STRING:return"";default:return 0}}function bC(n,e){switch(n){case ae.BOOL:return e===!1;case ae.STRING:return e==="";case ae.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Rt;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(Rt||(Rt={}));class j3{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let t=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)t.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Ih(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Ml(e),i0(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){fC(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Ih(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Ml(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Ml(e),e=(e<<1^e>>31)>>>0,i0(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=ut.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=ut.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}int64(e){let t=ut.enc(e);return ih(t.lo,t.hi,this.buf),this}sint64(e){let t=ut.enc(e),i=t.hi>>31,r=t.lo<<1^i,o=(t.hi<<1|t.lo>>>31)^i;return ih(r,o,this.buf),this}uint64(e){let t=ut.uEnc(e);return ih(t.lo,t.hi,this.buf),this}}class I3{constructor(e,t){this.varint64=O3,this.uint32=P3,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case Rt.Varint:for(;this.buf[this.pos++]&128;);break;case Rt.Bit64:this.pos+=4;case Rt.Bit32:this.pos+=4;break;case Rt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Rt.StartGroup:for(;;){const[o,u]=this.tag();if(u===Rt.EndGroup){if(t!==void 0&&o!==t)throw new Error("invalid end group tag");break}this.skip(u,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ut.dec(...this.varint64())}uint64(){return ut.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,ut.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ut.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ut.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function U3(n,e,t,i){let r;return{typeName:e,extendee:t,get field(){if(!r){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),r=n.util.newFieldList([o]).list()[0]}return r},runtime:n}}function SC(n){const e=n.field.localName,t=Object.create(null);return t[e]=B3(n),[t,()=>t[e]]}function B3(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return or(e.T,e.L);case"message":const t=e.T,i=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function z3(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let Li="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),vu=[];for(let n=0;n<Li.length;n++)vu[Li[n].charCodeAt(0)]=n;vu[45]=Li.indexOf("+");vu[95]=Li.indexOf("/");const CC={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,r=0,o,u=0;for(let l=0;l<n.length;l++){if(o=vu[n.charCodeAt(l)],o===void 0)switch(n[l]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:u=o,r=1;break;case 1:t[i++]=u<<2|(o&48)>>4,u=o,r=2;break;case 2:t[i++]=(u&15)<<4|(o&60)>>2,u=o,r=3;break;case 3:t[i++]=(u&3)<<6|o,r=0;break}}if(r==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,r=0;for(let o=0;o<n.length;o++)switch(i=n[o],t){case 0:e+=Li[i>>2],r=(i&3)<<4,t=1;break;case 1:e+=Li[r|i>>4],r=(i&15)<<2,t=2;break;case 2:e+=Li[r|i>>6],e+=Li[i&63],t=0;break}return t&&(e+=Li[r],e+="=",t==1&&(e+="=")),e}};function V3(n,e,t){TC(e,n);const i=e.runtime.bin.makeReadOptions(t),r=z3(n.getType().runtime.bin.listUnknownFields(n),e.field),[o,u]=SC(e);for(const l of r)e.runtime.bin.readField(o,i.readerFactory(l.data),e.field,l.wireType,i);return u()}function F3(n,e,t,i){TC(e,n);const r=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(kC(n,e)){const h=n.getType().runtime.bin.listUnknownFields(n).filter(m=>m.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const m of h)n.getType().runtime.bin.onUnknownField(n,m.no,m.wireType,m.data)}const u=o.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,t,u,o);const f=r.readerFactory(u.finish());for(;f.pos<f.len;){const[h,m]=f.tag(),g=f.skip(m,h);n.getType().runtime.bin.onUnknownField(n,h,m,g)}}function kC(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(i=>i.no==e.field.no)}function TC(n,e){vt(n.extendee.typeName==e.getType().typeName,"extension ".concat(n.typeName," can only be applied to message ").concat(n.extendee.typeName))}function EC(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!bC(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function s0(n,e){const t=n.localName,i=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=i?n.T.values[0].no:void 0;break;case"scalar":e[t]=i?or(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function ji(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(xm.prototype).every(i=>i in n&&typeof n[i]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function xC(n,e){return ji(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}ae.DOUBLE,ae.FLOAT,ae.INT64,ae.UINT64,ae.INT32,ae.UINT32,ae.BOOL,ae.STRING,ae.BYTES;const a0={ignoreUnknownFields:!1},r0={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function q3(n){return n?Object.assign(Object.assign({},a0),n):a0}function H3(n){return n?Object.assign(Object.assign({},r0),n):r0}const Jl=Symbol(),Ol=Symbol();function $3(){return{makeReadOptions:q3,makeWriteOptions:H3,readMessage(n,e,t,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(n.typeName," from JSON: ").concat(ri(e)));i=i??new n;const r=new Map,o=t.typeRegistry;for(const[u,l]of Object.entries(e)){const f=n.fields.findJsonName(u);if(f){if(f.oneof){if(l===null&&f.kind=="scalar")continue;const h=r.get(f.oneof);if(h!==void 0)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: multiple keys for oneof "').concat(f.oneof.name,'" present: "').concat(h,'", "').concat(u,'"'));r.set(f.oneof,u)}o0(i,l,f,t,n)}else{let h=!1;if(o?.findExtension&&u.startsWith("[")&&u.endsWith("]")){const m=o.findExtension(u.substring(1,u.length-1));if(m&&m.extendee.typeName==n.typeName){h=!0;const[g,b]=SC(m);o0(g,l,m.field,t,m),F3(i,m,b(),t)}}if(!h&&!t.ignoreUnknownFields)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: key "').concat(u,'" is unknown'))}}return i},writeMessage(n,e){const t=n.getType(),i={};let r;try{for(r of t.fields.byNumber()){if(!EC(r,n)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!G3(r))continue}const u=r.oneof?n[r.oneof.localName].value:n[r.localName],l=c0(r,u,e);l!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=l)}const o=e.typeRegistry;if(o?.findExtensionFor)for(const u of t.runtime.bin.listUnknownFields(n)){const l=o.findExtensionFor(t.typeName,u.no);if(l&&kC(n,l)){const f=V3(n,l,e),h=c0(l.field,f,e);h!==void 0&&(i[l.field.jsonName]=h)}}}catch(o){const u=r?"cannot encode field ".concat(t.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(t.typeName," to JSON"),l=o instanceof Error?o.message:String(o);throw new Error(u+(l.length>0?": ".concat(l):""))}return i},readScalar(n,e,t){return Oo(n,e,t??xs.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||bC(n,e)))return Dl(n,e)},debug:ri}}function ri(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function o0(n,e,t,i,r){let o=t.localName;if(t.repeated){if(vt(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(t.name," from JSON: ").concat(ri(e)));const u=n[o];for(const l of e){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(t.name," from JSON: ").concat(ri(l)));switch(t.kind){case"message":u.push(t.T.fromJson(l,i));break;case"enum":const f=sh(t.T,l,i.ignoreUnknownFields,!0);f!==Ol&&u.push(f);break;case"scalar":try{u.push(Oo(t.T,l,t.L,!0))}catch(h){let m="cannot decode field ".concat(r.typeName,".").concat(t.name," from JSON: ").concat(ri(l));throw h instanceof Error&&h.message.length>0&&(m+=": ".concat(h.message)),new Error(m)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(t.name," from JSON: ").concat(ri(e)));const u=n[o];for(const[l,f]of Object.entries(e)){if(f===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(t.name," from JSON: map value null"));let h;try{h=K3(t.K,l)}catch(m){let g="cannot decode map key for field ".concat(r.typeName,".").concat(t.name," from JSON: ").concat(ri(e));throw m instanceof Error&&m.message.length>0&&(g+=": ".concat(m.message)),new Error(g)}switch(t.V.kind){case"message":u[h]=t.V.T.fromJson(f,i);break;case"enum":const m=sh(t.V.T,f,i.ignoreUnknownFields,!0);m!==Ol&&(u[h]=m);break;case"scalar":try{u[h]=Oo(t.V.T,f,xs.BIGINT,!0)}catch(g){let b="cannot decode map value for field ".concat(r.typeName,".").concat(t.name," from JSON: ").concat(ri(e));throw g instanceof Error&&g.message.length>0&&(b+=": ".concat(g.message)),new Error(b)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:o},o="value"),t.kind){case"message":const u=t.T;if(e===null&&u.typeName!="google.protobuf.Value")return;let l=n[o];ji(l)?l.fromJson(e,i):(n[o]=l=u.fromJson(e,i),u.fieldWrapper&&!t.oneof&&(n[o]=u.fieldWrapper.unwrapField(l)));break;case"enum":const f=sh(t.T,e,i.ignoreUnknownFields,!1);switch(f){case Jl:s0(t,n);break;case Ol:break;default:n[o]=f;break}break;case"scalar":try{const h=Oo(t.T,e,t.L,!1);h===Jl?s0(t,n):n[o]=h}catch(h){let m="cannot decode field ".concat(r.typeName,".").concat(t.name," from JSON: ").concat(ri(e));throw h instanceof Error&&h.message.length>0&&(m+=": ".concat(h.message)),new Error(m)}break}}function K3(n,e){if(n===ae.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Oo(n,e,xs.BIGINT,!0).toString()}function Oo(n,e,t,i){if(e===null)return i?or(n,t):Jl;switch(n){case ae.DOUBLE:case ae.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return n==ae.FLOAT&&fC(r),r;case ae.INT32:case ae.FIXED32:case ae.SFIXED32:case ae.SINT32:case ae.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return n==ae.UINT32||n==ae.FIXED32?Ih(o):Ml(o),o;case ae.INT64:case ae.SFIXED64:case ae.SINT64:if(typeof e!="number"&&typeof e!="string")break;const u=ut.parse(e);return t?u.toString():u;case ae.FIXED64:case ae.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=ut.uParse(e);return t?l.toString():l;case ae.BOOL:if(typeof e!="boolean")break;return e;case ae.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case ae.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return CC.dec(e)}throw new Error}function sh(n,e,t,i){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:i?n.values[0].no:Jl;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=n.findName(e);if(r!==void 0)return r.no;if(t)return Ol;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(ri(e)))}function G3(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function c0(n,e,t){if(n.kind=="map"){vt(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(n.V.kind){case"scalar":for(const[u,l]of r)i[u.toString()]=Dl(n.V.T,l);break;case"message":for(const[u,l]of r)i[u.toString()]=l.toJson(t);break;case"enum":const o=n.V.T;for(const[u,l]of r)i[u.toString()]=ah(o,l,t.enumAsInteger);break}return t.emitDefaultValues||r.length>0?i:void 0}if(n.repeated){vt(Array.isArray(e));const i=[];switch(n.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Dl(n.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(ah(n.T,e[r],t.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(t));break}return t.emitDefaultValues||i.length>0?i:void 0}switch(n.kind){case"scalar":return Dl(n.T,e);case"enum":return ah(n.T,e,t.enumAsInteger);case"message":return xC(n.T,e).toJson(t)}}function ah(n,e,t){var i;if(vt(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const r=n.findNumber(e);return(i=r?.name)!==null&&i!==void 0?i:e}function Dl(n,e){switch(n){case ae.INT32:case ae.SFIXED32:case ae.SINT32:case ae.FIXED32:case ae.UINT32:return vt(typeof e=="number"),e;case ae.FLOAT:case ae.DOUBLE:return vt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case ae.STRING:return vt(typeof e=="string"),e;case ae.BOOL:return vt(typeof e=="boolean"),e;case ae.UINT64:case ae.FIXED64:case ae.INT64:case ae.SFIXED64:case ae.SINT64:return vt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case ae.BYTES:return vt(e instanceof Uint8Array),CC.enc(e)}}const $a=Symbol("@bufbuild/protobuf/unknown-fields"),l0={readUnknownFields:!0,readerFactory:n=>new I3(n)},u0={writeUnknownFields:!0,writerFactory:()=>new j3};function Y3(n){return n?Object.assign(Object.assign({},l0),n):l0}function J3(n){return n?Object.assign(Object.assign({},u0),n):u0}function Q3(){return{makeReadOptions:Y3,makeWriteOptions:J3,listUnknownFields(n){var e;return(e=n[$a])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[$a]},writeUnknownFields(n,e){const i=n[$a];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(n,e,t,i){const r=n;Array.isArray(r[$a])||(r[$a]=[]),r[$a].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i,r){const o=n.getType(),u=r?e.len:e.pos+t;let l,f;for(;e.pos<u&&([l,f]=e.tag(),!(r===!0&&f==Rt.EndGroup));){const h=o.fields.find(l);if(!h){const m=e.skip(f,l);i.readUnknownFields&&this.onUnknownField(n,l,f,m);continue}d0(n,e,h,f,i)}if(r&&(f!=Rt.EndGroup||l!==t))throw new Error("invalid end group tag")},readField:d0,writeMessage(n,e,t){const i=n.getType();for(const r of i.fields.byNumber()){if(!EC(r,n)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const o=r.oneof?n[r.oneof.localName].value:n[r.localName];f0(r,o,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,i){e!==void 0&&f0(n,e,t,i)}}}function d0(n,e,t,i,r){let{repeated:o,localName:u}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=u&&delete n.value,n.case=u,u="value"),t.kind){case"scalar":case"enum":const l=t.kind=="enum"?ae.INT32:t.T;let f=Ql;if(t.kind=="scalar"&&t.L>0&&(f=W3),o){let b=n[u];if(i==Rt.LengthDelimited&&l!=ae.STRING&&l!=ae.BYTES){let E=e.uint32()+e.pos;for(;e.pos<E;)b.push(f(e,l))}else b.push(f(e,l))}else n[u]=f(e,l);break;case"message":const h=t.T;o?n[u].push(Al(e,new h,r,t)):ji(n[u])?Al(e,n[u],r,t):(n[u]=Al(e,new h,r,t),h.fieldWrapper&&!t.oneof&&!t.repeated&&(n[u]=h.fieldWrapper.unwrapField(n[u])));break;case"map":let[m,g]=X3(t,e,r);n[u][m]=g;break}}function Al(n,e,t,i){const r=e.getType().runtime.bin,o=i?.delimited;return r.readMessage(e,n,o?i.no:n.uint32(),t,o),e}function X3(n,e,t){const i=e.uint32(),r=e.pos+i;let o,u;for(;e.pos<r;){const[l]=e.tag();switch(l){case 1:o=Ql(e,n.K);break;case 2:switch(n.V.kind){case"scalar":u=Ql(e,n.V.T);break;case"enum":u=e.int32();break;case"message":u=Al(e,new n.V.T,t,void 0);break}break}}if(o===void 0&&(o=or(n.K,xs.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),u===void 0)switch(n.V.kind){case"scalar":u=or(n.V.T,xs.BIGINT);break;case"enum":u=n.V.T.values[0].no;break;case"message":u=new n.V.T;break}return[o,u]}function W3(n,e){const t=Ql(n,e);return typeof t=="bigint"?t.toString():t}function Ql(n,e){switch(e){case ae.STRING:return n.string();case ae.BOOL:return n.bool();case ae.DOUBLE:return n.double();case ae.FLOAT:return n.float();case ae.INT32:return n.int32();case ae.INT64:return n.int64();case ae.UINT64:return n.uint64();case ae.FIXED64:return n.fixed64();case ae.BYTES:return n.bytes();case ae.FIXED32:return n.fixed32();case ae.SFIXED32:return n.sfixed32();case ae.SFIXED64:return n.sfixed64();case ae.SINT64:return n.sint64();case ae.UINT32:return n.uint32();case ae.SINT32:return n.sint32()}}function f0(n,e,t,i){vt(e!==void 0);const r=n.repeated;switch(n.kind){case"scalar":case"enum":let o=n.kind=="enum"?ae.INT32:n.T;if(r)if(vt(Array.isArray(e)),n.packed)e4(t,o,n.no,e);else for(const u of e)Do(t,o,n.no,u);else Do(t,o,n.no,e);break;case"message":if(r){vt(Array.isArray(e));for(const u of e)h0(t,i,n,u)}else h0(t,i,n,e);break;case"map":vt(typeof e=="object"&&e!=null);for(const[u,l]of Object.entries(e))Z3(t,i,n,u,l);break}}function Z3(n,e,t,i,r){n.tag(t.no,Rt.LengthDelimited),n.fork();let o=i;switch(t.K){case ae.INT32:case ae.FIXED32:case ae.UINT32:case ae.SFIXED32:case ae.SINT32:o=Number.parseInt(i);break;case ae.BOOL:vt(i=="true"||i=="false"),o=i=="true";break}switch(Do(n,t.K,1,o),t.V.kind){case"scalar":Do(n,t.V.T,2,r);break;case"enum":Do(n,ae.INT32,2,r);break;case"message":vt(r!==void 0),n.tag(2,Rt.LengthDelimited).bytes(r.toBinary(e));break}n.join()}function h0(n,e,t,i){const r=xC(t.T,i);t.delimited?n.tag(t.no,Rt.StartGroup).raw(r.toBinary(e)).tag(t.no,Rt.EndGroup):n.tag(t.no,Rt.LengthDelimited).bytes(r.toBinary(e))}function Do(n,e,t,i){vt(i!==void 0);let[r,o]=RC(e);n.tag(t,r)[o](i)}function e4(n,e,t,i){if(!i.length)return;n.tag(t,Rt.LengthDelimited).fork();let[,r]=RC(e);for(let o=0;o<i.length;o++)n[r](i[o]);n.join()}function RC(n){let e=Rt.Varint;switch(n){case ae.BYTES:case ae.STRING:e=Rt.LengthDelimited;break;case ae.DOUBLE:case ae.FIXED64:case ae.SFIXED64:e=Rt.Bit64;break;case ae.FIXED32:case ae.SFIXED32:case ae.FLOAT:e=Rt.Bit32;break}const t=ae[n].toLowerCase();return[e,t]}function t4(){return{setEnumType:mC,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const r=i.localName,o=e,u=n;if(u[r]!=null)switch(i.kind){case"oneof":const l=u[r].case;if(l===void 0)continue;const f=i.findField(l);let h=u[r].value;f&&f.kind=="message"&&!ji(h,f.T)?h=new f.T(h):f&&f.kind==="scalar"&&f.T===ae.BYTES&&(h=vo(h)),o[r]={case:l,value:h};break;case"scalar":case"enum":let m=u[r];i.T===ae.BYTES&&(m=i.repeated?m.map(vo):vo(m)),o[r]=m;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===ae.BYTES)for(const[C,E]of Object.entries(u[r]))o[r][C]=vo(E);else Object.assign(o[r],u[r]);break;case"message":const b=i.V.T;for(const C of Object.keys(u[r])){let E=u[r][C];b.fieldWrapper||(E=new b(E)),o[r][C]=E}break}break;case"message":const g=i.T;if(i.repeated)o[r]=u[r].map(b=>ji(b,g)?b:new g(b));else{const b=u[r];g.fieldWrapper?g.typeName==="google.protobuf.BytesValue"?o[r]=vo(b):o[r]=b:o[r]=ji(b,g)?b:new g(b)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const r=e[i.localName],o=t[i.localName];if(i.repeated){if(r.length!==o.length)return!1;switch(i.kind){case"message":return r.every((u,l)=>i.T.equals(u,o[l]));case"scalar":return r.every((u,l)=>vs(i.T,u,o[l]));case"enum":return r.every((u,l)=>vs(ae.INT32,u,o[l]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let u=r,l=o;return i.T.fieldWrapper&&(u!==void 0&&!ji(u)&&(u=i.T.fieldWrapper.wrapField(u)),l!==void 0&&!ji(l)&&(l=i.T.fieldWrapper.wrapField(l))),i.T.equals(u,l);case"enum":return vs(ae.INT32,r,o);case"scalar":return vs(i.T,r,o);case"oneof":if(r.case!==o.case)return!1;const f=i.findField(r.case);if(f===void 0)return!0;switch(f.kind){case"message":return f.T.equals(r.value,o.value);case"enum":return vs(ae.INT32,r.value,o.value);case"scalar":return vs(f.T,r.value,o.value)}throw new Error("oneof cannot contain ".concat(f.kind));case"map":const h=Object.keys(r).concat(Object.keys(o));switch(i.V.kind){case"message":const m=i.V.T;return h.every(b=>m.equals(r[b],o[b]));case"enum":return h.every(b=>vs(ae.INT32,r[b],o[b]));case"scalar":const g=i.V.T;return h.every(b=>vs(g,r[b],o[b]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const r of e.fields.byMember()){const o=n[r.localName];let u;if(r.repeated)u=o.map(Cl);else if(r.kind=="map"){u=i[r.localName];for(const[l,f]of Object.entries(o))u[l]=Cl(f)}else r.kind=="oneof"?u=r.findField(o.case)?{case:o.case,value:Cl(o.value)}:{case:void 0}:u=Cl(o);i[r.localName]=u}for(const r of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return t}}}function Cl(n){if(n===void 0)return n;if(ji(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function vo(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function n4(n,e,t){return{syntax:n,json:$3(),bin:Q3(),util:Object.assign(Object.assign({},t4()),{newFieldList:e,initFields:t}),makeMessageType(i,r,o){return N3(this,i,r,o)},makeEnum:M3,makeEnumType:pC,getEnumType:w3,makeExtension(i,r,o){return U3(this,i,r,o)}}}class i4{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}}function _C(n,e){const t=wC(n);return e?t:l4(c4(t))}function s4(n){return _C(n,!1)}const a4=wC;function wC(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let r=n.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),t.push(r);break}}return t.join("")}const r4=new Set(["constructor","toString","toJSON","valueOf"]),o4=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),MC=n=>"".concat(n,"$"),c4=n=>o4.has(n)?MC(n):n,l4=n=>r4.has(n)?MC(n):n;class u4{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=s4(e)}addField(e){vt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function d4(n,e){var t,i,r,o,u,l;const f=[];let h;for(const m of typeof n=="function"?n():n){const g=m;if(g.localName=_C(m.name,m.oneof!==void 0),g.jsonName=(t=m.jsonName)!==null&&t!==void 0?t:a4(m.name),g.repeated=(i=m.repeated)!==null&&i!==void 0?i:!1,m.kind=="scalar"&&(g.L=(r=m.L)!==null&&r!==void 0?r:xs.BIGINT),g.delimited=(o=m.delimited)!==null&&o!==void 0?o:!1,g.req=(u=m.req)!==null&&u!==void 0?u:!1,g.opt=(l=m.opt)!==null&&l!==void 0?l:!1,m.packed===void 0&&(g.packed=m.kind=="enum"||m.kind=="scalar"&&m.T!=ae.BYTES&&m.T!=ae.STRING),m.oneof!==void 0){const b=typeof m.oneof=="string"?m.oneof:m.oneof.name;(!h||h.name!=b)&&(h=new u4(b)),g.oneof=h,h.addField(g)}f.push(g)}return f}const q=n4("proto3",n=>new i4(n,e=>d4(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=or(e.T,e.L);break}}});class hn extends xm{constructor(e){super(),this.seconds=ut.zero,this.nanos=0,q.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(q.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ut.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(t).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return hn.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new hn({seconds:ut.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new hn().fromBinary(e,t)}static fromJson(e,t){return new hn().fromJson(e,t)}static fromJsonString(e,t){return new hn().fromJsonString(e,t)}static equals(e,t){return q.util.equals(hn,e,t)}}hn.runtime=q;hn.typeName="google.protobuf.Timestamp";hn.fields=q.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const f4=q.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:hn},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:h4,repeated:!0},{no:5,name:"events",kind:"message",T:p4,repeated:!0}]),h4=q.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:m4,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),m4=q.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:hn},{no:3,name:"value",kind:"scalar",T:2}]),p4=q.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:hn},{no:7,name:"normalized_end_timestamp",kind:"message",T:hn,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),NC=q.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Yn=q.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),At=q.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),_m=q.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Ro=q.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Bo=q.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Wn=q.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Js=q.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),g4=q.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Bt=q.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),yu=q.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Xl,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:qC}]),Xl=q.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),v4=q.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:q.getEnumType(At),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Zs=q.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:q.getEnumType(Qa)},{no:4,name:"tracks",kind:"message",T:Ga,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:v4},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:q.getEnumType(zo)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:q.getEnumType(Wn)},{no:18,name:"kind_details",kind:"enum",T:q.getEnumType(y4),repeated:!0},{no:19,name:"data_tracks",kind:"message",T:wm,repeated:!0}]),Qa=q.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),zo=q.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"},{no:8,name:"BRIDGE"}]),y4=q.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"},{no:2,name:"CONNECTOR_WHATSAPP"},{no:3,name:"CONNECTOR_TWILIO"},{no:4,name:"BRIDGE_RTSP"}]),_t=q.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),b4=q.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ks,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:q.getEnumType(OC)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Ga=q.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:q.getEnumType(Yn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:q.getEnumType(At)},{no:10,name:"layers",kind:"message",T:ks,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:b4,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:q.getEnumType(_t)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:qC},{no:19,name:"audio_features",kind:"enum",T:q.getEnumType(Bt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:q.getEnumType(NC)}]),wm=q.makeMessageType("livekit.DataTrackInfo",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"sid",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"encryption",kind:"enum",T:q.getEnumType(_t)}]),S4=q.makeMessageType("livekit.DataTrackSubscriptionOptions",()=>[{no:1,name:"target_fps",kind:"scalar",T:13,opt:!0}]),ks=q.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:q.getEnumType(_m)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9},{no:8,name:"repair_ssrc",kind:"scalar",T:13}]),OC=q.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),tn=q.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:q.getEnumType(Ae)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Mm,oneof:"value"},{no:3,name:"speaker",kind:"message",T:C4,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:LC,oneof:"value"},{no:7,name:"transcription",kind:"message",T:k4,oneof:"value"},{no:8,name:"metrics",kind:"message",T:f4,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Wl,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Nm,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Om,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Dm,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Zl,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:eu,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:tu,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:DC,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Ae=q.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),DC=q.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:q.getEnumType(_t)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),AC=q.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Mm,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Wl,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Nm,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Om,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Dm,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Zl,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:eu,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:tu,oneof:"value"}]),C4=q.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:PC,repeated:!0}]),PC=q.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Mm=q.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),LC=q.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),k4=q.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:T4,repeated:!0}]),T4=q.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Wl=q.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Nm=q.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Om=q.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Dm=q.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:jC,oneof:"value"}]),jC=q.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),IC=q.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),UC=q.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:q.getEnumType(BC)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),BC=q.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),zC=q.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:q.getEnumType(VC)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),VC=q.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),FC=q.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:m0},{no:2,name:"screen",kind:"message",T:m0},{no:3,name:"resume_connection",kind:"enum",T:q.getEnumType(Bo)},{no:4,name:"disabled_codecs",kind:"message",T:E4},{no:5,name:"force_relay",kind:"enum",T:q.getEnumType(Bo)}]),m0=q.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:q.getEnumType(Bo)}]),E4=q.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Xl,repeated:!0},{no:2,name:"publish",kind:"message",T:Xl,repeated:!0}]),qC=q.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Uh=q.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),HC=q.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:q.getEnumType(Uh)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),$C=q.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Zl=q.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:q.getEnumType(_t)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:HC,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:$C,oneof:"content_header"}],{localName:"DataStream_Header"}),eu=q.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),tu=q.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),x4=q.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Jn=q.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Bh=q.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),R4=q.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),_4=q.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Rs,oneof:"message"},{no:2,name:"answer",kind:"message",T:Rs,oneof:"message"},{no:3,name:"trickle",kind:"message",T:bu,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Vo,oneof:"message"},{no:5,name:"mute",kind:"message",T:Su,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Cu,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:JC,oneof:"message"},{no:8,name:"leave",kind:"message",T:ku,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:XC,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:ek,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Im,oneof:"message"},{no:13,name:"simulate",kind:"message",T:ai,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Lm,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:ik,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Pm,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:QC,oneof:"message"},{no:19,name:"publish_data_track_request",kind:"message",T:KC,oneof:"message"},{no:20,name:"unpublish_data_track_request",kind:"message",T:YC,oneof:"message"},{no:21,name:"update_data_subscription",kind:"message",T:L4,oneof:"message"}]),p0=q.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:O4,oneof:"message"},{no:2,name:"answer",kind:"message",T:Rs,oneof:"message"},{no:3,name:"offer",kind:"message",T:Rs,oneof:"message"},{no:4,name:"trickle",kind:"message",T:bu,oneof:"message"},{no:5,name:"update",kind:"message",T:P4,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Am,oneof:"message"},{no:8,name:"leave",kind:"message",T:ku,oneof:"message"},{no:9,name:"mute",kind:"message",T:Su,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:I4,oneof:"message"},{no:11,name:"room_update",kind:"message",T:U4,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:z4,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:F4,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:H4,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:K4,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:A4,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:D4,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Y4,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:X4,oneof:"message"},{no:22,name:"request_response",kind:"message",T:W4,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Z4,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:G4,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:i5,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:$4,oneof:"message"},{no:27,name:"publish_data_track_response",kind:"message",T:GC,oneof:"message"},{no:28,name:"unpublish_data_track_response",kind:"message",T:w4,oneof:"message"},{no:29,name:"data_track_subscriber_handles",kind:"message",T:M4,oneof:"message"}]),zh=q.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ks,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:q.getEnumType(OC)}]),Vo=q.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:q.getEnumType(Yn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:q.getEnumType(At)},{no:9,name:"layers",kind:"message",T:ks,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:zh,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:q.getEnumType(_t)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:q.getEnumType(NC)},{no:17,name:"audio_features",kind:"enum",T:q.getEnumType(Bt),repeated:!0}]),KC=q.makeMessageType("livekit.PublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"encryption",kind:"enum",T:q.getEnumType(_t)}]),GC=q.makeMessageType("livekit.PublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:wm}]),YC=q.makeMessageType("livekit.UnpublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13}]),w4=q.makeMessageType("livekit.UnpublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:wm}]),M4=q.makeMessageType("livekit.DataTrackSubscriberHandles",()=>[{no:1,name:"sub_handles",kind:"map",K:13,V:{kind:"message",T:N4}}]),N4=q.makeMessageType("livekit.DataTrackSubscriberHandles.PublishedDataTrack",()=>[{no:1,name:"publisher_identity",kind:"scalar",T:9},{no:2,name:"publisher_sid",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9}],{localName:"DataTrackSubscriberHandles_PublishedDataTrack"}),bu=q.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:q.getEnumType(Jn)},{no:3,name:"final",kind:"scalar",T:8}]),Su=q.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),O4=q.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:yu},{no:2,name:"participant",kind:"message",T:Zs},{no:3,name:"other_participants",kind:"message",T:Zs,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:WC,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:FC},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:UC},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Xl,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),D4=q.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:WC,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:FC},{no:3,name:"server_info",kind:"message",T:UC},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Am=q.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Ga}]),A4=q.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Rs=q.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),P4=q.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Zs,repeated:!0}]),Cu=q.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:IC,repeated:!0}]),L4=q.makeMessageType("livekit.UpdateDataSubscription",()=>[{no:1,name:"updates",kind:"message",T:j4,repeated:!0}]),j4=q.makeMessageType("livekit.UpdateDataSubscription.Update",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"options",kind:"message",T:S4}],{localName:"UpdateDataSubscription_Update"}),JC=q.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:q.getEnumType(_m)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Pm=q.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:q.getEnumType(Bt),repeated:!0}]),QC=q.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),ku=q.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:q.getEnumType(Wn)},{no:3,name:"action",kind:"enum",T:q.getEnumType(Xa)},{no:4,name:"regions",kind:"message",T:J4}]),Xa=q.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),XC=q.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ks,repeated:!0}]),Lm=q.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),WC=q.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),I4=q.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:PC,repeated:!0}]),U4=q.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:yu}]),B4=q.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:q.getEnumType(Ro)},{no:3,name:"score",kind:"scalar",T:2}]),z4=q.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:B4,repeated:!0}]),V4=q.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:q.getEnumType(Bh)}]),F4=q.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:V4,repeated:!0}]),jm=q.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:q.getEnumType(_m)},{no:2,name:"enabled",kind:"scalar",T:8}]),q4=q.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:jm,repeated:!0}]),H4=q.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:jm,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:q4,repeated:!0}]),$4=q.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:x4,repeated:!0}]),ZC=q.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),ek=q.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:ZC,repeated:!0}]),K4=q.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),G4=q.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:yu},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Zs},{no:4,name:"other_participants",kind:"message",T:Zs,repeated:!0}]),Im=q.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Rs},{no:2,name:"subscription",kind:"message",T:Cu},{no:3,name:"publish_tracks",kind:"message",T:Am,repeated:!0},{no:4,name:"data_channels",kind:"message",T:nk,repeated:!0},{no:5,name:"offer",kind:"message",T:Rs},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:tk,repeated:!0},{no:8,name:"publish_data_tracks",kind:"message",T:GC,repeated:!0}]),tk=q.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),nk=q.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:q.getEnumType(Jn)}]),ai=q.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:q.getEnumType(R4),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),ik=q.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Y4=q.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),J4=q.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Q4,repeated:!0}]),Q4=q.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),X4=q.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:q.getEnumType(g4)}]),W4=q.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:q.getEnumType(Um)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:bu,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Vo,oneof:"request"},{no:6,name:"mute",kind:"message",T:Su,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Lm,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Pm,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:QC,oneof:"request"},{no:10,name:"publish_data_track",kind:"message",T:KC,oneof:"request"},{no:11,name:"unpublish_data_track",kind:"message",T:YC,oneof:"request"}]),Um=q.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"},{no:7,name:"INVALID_HANDLE"},{no:8,name:"INVALID_NAME"},{no:9,name:"DUPLICATE_HANDLE"},{no:10,name:"DUPLICATE_NAME"}]),Z4=q.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),sk=q.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8},{no:5,name:"auto_subscribe_data_track",kind:"scalar",T:8,opt:!0}]),e5=q.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:zC},{no:2,name:"connection_settings",kind:"message",T:sk},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Vo,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Rs},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:q.getEnumType(Js)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Im}]),t5=q.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:q.getEnumType(n5)},{no:2,name:"join_request",kind:"scalar",T:12}]),n5=q.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),i5=q.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function s5(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Pl={exports:{}},a5=Pl.exports,g0;function r5(){return g0||(g0=1,(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(a5,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},u=null;function l(k,_){var w=k[_];if(typeof w.bind=="function")return w.bind(k);try{return Function.prototype.bind.call(w,k)}catch{return function(){return Function.prototype.apply.apply(w,[k,arguments])}}}function f(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function h(k){return k==="debug"&&(k="log"),typeof console===t?!1:k==="trace"&&i?f:console[k]!==void 0?l(console,k):console.log!==void 0?l(console,"log"):e}function m(){for(var k=this.getLevel(),_=0;_<r.length;_++){var w=r[_];this[w]=_<k?e:this.methodFactory(w,k,this.name)}if(this.log=this.debug,typeof console===t&&k<this.levels.SILENT)return"No console available for logging"}function g(k){return function(){typeof console!==t&&(m.call(this),this[k].apply(this,arguments))}}function b(k,_,w){return h(k)||g.apply(this,arguments)}function C(k,_){var w=this,O,D,x,R="loglevel";typeof k=="string"?R+=":"+k:typeof k=="symbol"&&(R=void 0);function M(z){var W=(r[z]||"silent").toUpperCase();if(!(typeof window===t||!R)){try{window.localStorage[R]=W;return}catch{}try{window.document.cookie=encodeURIComponent(R)+"="+W+";"}catch{}}}function L(){var z;if(!(typeof window===t||!R)){try{z=window.localStorage[R]}catch{}if(typeof z===t)try{var W=window.document.cookie,J=encodeURIComponent(R),he=W.indexOf(J+"=");he!==-1&&(z=/^([^;]+)/.exec(W.slice(he+J.length+1))[1])}catch{}return w.levels[z]===void 0&&(z=void 0),z}}function B(){if(!(typeof window===t||!R)){try{window.localStorage.removeItem(R)}catch{}try{window.document.cookie=encodeURIComponent(R)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function V(z){var W=z;if(typeof W=="string"&&w.levels[W.toUpperCase()]!==void 0&&(W=w.levels[W.toUpperCase()]),typeof W=="number"&&W>=0&&W<=w.levels.SILENT)return W;throw new TypeError("log.setLevel() called with invalid level: "+z)}w.name=k,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=_||b,w.getLevel=function(){return x??D??O},w.setLevel=function(z,W){return x=V(z),W!==!1&&M(x),m.call(w)},w.setDefaultLevel=function(z){D=V(z),L()||w.setLevel(z,!1)},w.resetLevel=function(){x=null,B(),m.call(w)},w.enableAll=function(z){w.setLevel(w.levels.TRACE,z)},w.disableAll=function(z){w.setLevel(w.levels.SILENT,z)},w.rebuild=function(){if(u!==w&&(O=V(u.getLevel())),m.call(w),u===w)for(var z in o)o[z].rebuild()},O=V(u?u.getLevel():"WARN");var P=L();P!=null&&(x=V(P)),m.call(w)}u=new C,u.getLogger=function(_){if(typeof _!="symbol"&&typeof _!="string"||_==="")throw new TypeError("You must supply a name when creating a logger.");var w=o[_];return w||(w=o[_]=new C(_,u.methodFactory)),w};var E=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=E),u},u.getLoggers=function(){return o},u.default=u,u})})(Pl)),Pl.exports}var Tu=r5(),Vh;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(Vh||(Vh={}));var ei;(function(n){n.Default="livekit",n.Room="livekit-room",n.TokenSource="livekit-token-source",n.Participant="livekit-participant",n.Track="livekit-track",n.Publication="livekit-track-publication",n.Engine="livekit-engine",n.Signal="livekit-signal",n.PCManager="livekit-pc-manager",n.PCTransport="livekit-pc-transport",n.E2EE="lk-e2ee"})(ei||(ei={}));let De=Tu.getLogger("livekit");Object.values(ei).map(n=>Tu.getLogger(n));De.setDefaultLevel(Vh.info);function Vi(n){const e=Tu.getLogger(n);return e.setDefaultLevel(De.getLevel()),e}const o5=Tu.getLogger("lk-e2ee"),yo=7e3,c5=[0,300,4*300,9*300,16*300,yo,yo,yo,yo,yo];class l5{constructor(e){this._retryDelays=e!==void 0?[...e]:c5}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function u5(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function A(n,e,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(m){try{h(i.next(m))}catch(g){u(g)}}function f(m){try{h(i.throw(m))}catch(g){u(g)}}function h(m){m.done?o(m.value):r(m.value).then(l,f)}h((i=i.apply(n,e||[])).next())})}function v0(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ii(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof v0=="function"?v0(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(u){return new Promise(function(l,f){u=n[o](u),r(l,f,u.done,u.value)})}}function r(o,u,l,f){Promise.resolve(f).then(function(h){o({value:h,done:l})},u)}}var kl={exports:{}},y0;function d5(){if(y0)return kl.exports;y0=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(R,M,L){return Function.prototype.apply.call(R,M,L)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:t=function(R){return Object.getOwnPropertyNames(R)};function i(x){console&&console.warn&&console.warn(x)}var r=Number.isNaN||function(R){return R!==R};function o(){o.init.call(this)}kl.exports=o,kl.exports.once=w,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function l(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(x){if(typeof x!="number"||x<0||r(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");u=x}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||r(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this};function f(x){return x._maxListeners===void 0?o.defaultMaxListeners:x._maxListeners}o.prototype.getMaxListeners=function(){return f(this)},o.prototype.emit=function(R){for(var M=[],L=1;L<arguments.length;L++)M.push(arguments[L]);var B=R==="error",V=this._events;if(V!==void 0)B=B&&V.error===void 0;else if(!B)return!1;if(B){var P;if(M.length>0&&(P=M[0]),P instanceof Error)throw P;var z=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw z.context=P,z}var W=V[R];if(W===void 0)return!1;if(typeof W=="function")e(W,this,M);else for(var J=W.length,he=E(W,J),L=0;L<J;++L)e(he[L],this,M);return!0};function h(x,R,M,L){var B,V,P;if(l(M),V=x._events,V===void 0?(V=x._events=Object.create(null),x._eventsCount=0):(V.newListener!==void 0&&(x.emit("newListener",R,M.listener?M.listener:M),V=x._events),P=V[R]),P===void 0)P=V[R]=M,++x._eventsCount;else if(typeof P=="function"?P=V[R]=L?[M,P]:[P,M]:L?P.unshift(M):P.push(M),B=f(x),B>0&&P.length>B&&!P.warned){P.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.emitter=x,z.type=R,z.count=P.length,i(z)}return x}o.prototype.addListener=function(R,M){return h(this,R,M,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(R,M){return h(this,R,M,!0)};function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(x,R,M){var L={fired:!1,wrapFn:void 0,target:x,type:R,listener:M},B=m.bind(L);return B.listener=M,L.wrapFn=B,B}o.prototype.once=function(R,M){return l(M),this.on(R,g(this,R,M)),this},o.prototype.prependOnceListener=function(R,M){return l(M),this.prependListener(R,g(this,R,M)),this},o.prototype.removeListener=function(R,M){var L,B,V,P,z;if(l(M),B=this._events,B===void 0)return this;if(L=B[R],L===void 0)return this;if(L===M||L.listener===M)--this._eventsCount===0?this._events=Object.create(null):(delete B[R],B.removeListener&&this.emit("removeListener",R,L.listener||M));else if(typeof L!="function"){for(V=-1,P=L.length-1;P>=0;P--)if(L[P]===M||L[P].listener===M){z=L[P].listener,V=P;break}if(V<0)return this;V===0?L.shift():k(L,V),L.length===1&&(B[R]=L[0]),B.removeListener!==void 0&&this.emit("removeListener",R,z||M)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(R){var M,L,B;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[R]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete L[R]),this;if(arguments.length===0){var V=Object.keys(L),P;for(B=0;B<V.length;++B)P=V[B],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(M=L[R],typeof M=="function")this.removeListener(R,M);else if(M!==void 0)for(B=M.length-1;B>=0;B--)this.removeListener(R,M[B]);return this};function b(x,R,M){var L=x._events;if(L===void 0)return[];var B=L[R];return B===void 0?[]:typeof B=="function"?M?[B.listener||B]:[B]:M?_(B):E(B,B.length)}o.prototype.listeners=function(R){return b(this,R,!0)},o.prototype.rawListeners=function(R){return b(this,R,!1)},o.listenerCount=function(x,R){return typeof x.listenerCount=="function"?x.listenerCount(R):C.call(x,R)},o.prototype.listenerCount=C;function C(x){var R=this._events;if(R!==void 0){var M=R[x];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function E(x,R){for(var M=new Array(R),L=0;L<R;++L)M[L]=x[L];return M}function k(x,R){for(;R+1<x.length;R++)x[R]=x[R+1];x.pop()}function _(x){for(var R=new Array(x.length),M=0;M<R.length;++M)R[M]=x[M].listener||x[M];return R}function w(x,R){return new Promise(function(M,L){function B(P){x.removeListener(R,V),L(P)}function V(){typeof x.removeListener=="function"&&x.removeListener("error",B),M([].slice.call(arguments))}D(x,R,V,{once:!0}),R!=="error"&&O(x,B,{once:!0})})}function O(x,R,M){typeof x.on=="function"&&D(x,"error",R,M)}function D(x,R,M,L){if(typeof x.on=="function")L.once?x.once(R,M):x.on(R,M);else if(typeof x.addEventListener=="function")x.addEventListener(R,function B(V){L.once&&x.removeEventListener(R,B),M(V)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}return kl.exports}var hi=d5();let ak=!0,rk=!0;function _o(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseFloat(i[t],10)}function na(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(u,l){if(u!==e)return r.apply(this,arguments);const f=h=>{const m=t(h);m&&(l.handleEvent?l.handleEvent(m):l(m))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,f),r.apply(this,[u,f])};const o=i.removeEventListener;i.removeEventListener=function(u,l){if(u!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const f=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[u,f])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(u){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),u&&this.addEventListener(e,this["_on"+e]=u)},enumerable:!0,configurable:!0})}function f5(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(ak=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function h5(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(rk=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function ok(){if(typeof window=="object"){if(ak)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Bm(n,e){rk&&console.warn(n+" is deprecated, please use "+e+" instead.")}function m5(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const i=t.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(_o(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(_o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(_o(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=_o(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function b0(n){return Object.prototype.toString.call(n)==="[object Object]"}function ck(n){return b0(n)?Object.keys(n).reduce(function(e,t){const i=b0(n[t]),r=i?ck(n[t]):n[t],o=i&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[t]:r})},{}):n}function Fh(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Fh(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(r=>{Fh(n,n.get(r),t)})}))}function S0(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return n.forEach(u=>{u.type==="track"&&u.trackIdentifier===e.id&&o.push(u)}),o.forEach(u=>{n.forEach(l=>{l.type===i&&l.trackId===u.id&&Fh(n,l,r)})}),r}const C0=ok;function lk(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const f={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const m=typeof l[h]=="object"?l[h]:{ideal:l[h]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const g=function(b,C){return b?b+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(m.ideal!==void 0){f.optional=f.optional||[];let b={};typeof m.ideal=="number"?(b[g("min",h)]=m.ideal,f.optional.push(b),b={},b[g("max",h)]=m.ideal,f.optional.push(b)):(b[g("",h)]=m.ideal,f.optional.push(b))}m.exact!==void 0&&typeof m.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[g("",h)]=m.exact):["min","max"].forEach(b=>{m[b]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[g(b,h)]=m[b])})}),l.advanced&&(f.optional=(f.optional||[]).concat(l.advanced)),f},r=function(l,f){if(e.version>=61)return f(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const h=function(m,g,b){g in m&&!(b in m)&&(m[b]=m[g],delete m[g])};l=JSON.parse(JSON.stringify(l)),h(l.audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const m=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!m)){delete l.video.facingMode;let g;if(h.exact==="environment"||h.ideal==="environment"?g=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(g=["front"]),g)return t.mediaDevices.enumerateDevices().then(b=>{b=b.filter(E=>E.kind==="videoinput");let C=b.find(E=>g.some(k=>E.label.toLowerCase().includes(k)));return!C&&b.length&&g.includes("back")&&(C=b[b.length-1]),C&&(l.video.deviceId=h.exact?{exact:C.deviceId}:{ideal:C.deviceId}),l.video=i(l.video),C0("chrome: "+JSON.stringify(l)),f(l)})}l.video=i(l.video)}return C0("chrome: "+JSON.stringify(l)),f(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},u=function(l,f,h){r(l,m=>{t.webkitGetUserMedia(m,f,g=>{h&&h(o(g))})})};if(t.getUserMedia=u.bind(t),t.mediaDevices.getUserMedia){const l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(f){return r(f,h=>l(h).then(m=>{if(h.audio&&!m.getAudioTracks().length||h.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return m},m=>Promise.reject(o(m))))}}}function uk(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function dk(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.track.id):o={track:r.track};const u=new Event("track");u.track=r.track,u.receiver=o,u.transceiver={receiver:o},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(r=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.id):o={track:r};const u=new Event("track");u.track=r,u.receiver=o,u.transceiver={receiver:o},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else na(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function fk(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(l,f){let h=r.apply(this,arguments);return h||(h=e(this,l),this._senders.push(h)),h};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const f=this._senders.indexOf(l);f!==-1&&this._senders.splice(f,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(u=>{this._senders.push(e(this,u))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(u=>{const l=this._senders.find(f=>f.track===u);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function hk(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(u=>u._pc=this),o});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(u=>S0(u,o.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r}),na(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>S0(o,r.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let r,o,u;return this.getSenders().forEach(l=>{l.track===i&&(r?u=!0:r=l)}),this.getReceivers().forEach(l=>(l.track===i&&(o?u=!0:o=l),l.track===i)),u||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function mk(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(u,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(f)===-1&&this._shimmedLocalStreams[l.id].push(f):this._shimmedLocalStreams[l.id]=[l,f],f};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();t.apply(this,arguments);const f=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[u.id]=[u].concat(f)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],i.apply(this,arguments)};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const f=this._shimmedLocalStreams[l].indexOf(u);f!==-1&&this._shimmedLocalStreams[l].splice(f,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),r.apply(this,arguments)}}function pk(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return mk(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const m=t.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(C=>C.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new n.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}i.apply(this,[m])};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},n.RTCPeerConnection.prototype.addTrack=function(m,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(k=>k===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[g.id];if(E)E.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new n.MediaStream([m]);this._streams[g.id]=k,this._reverseStreams[k.id]=g,this.addStream(k)}return this.getSenders().find(k=>k.track===m)};function o(h,m){let g=m.sdp;return Object.keys(h._reverseStreams||[]).forEach(b=>{const C=h._reverseStreams[b],E=h._streams[C.id];g=g.replace(new RegExp(E.id,"g"),C.id)}),new RTCSessionDescription({type:m.type,sdp:g})}function u(h,m){let g=m.sdp;return Object.keys(h._reverseStreams||[]).forEach(b=>{const C=h._reverseStreams[b],E=h._streams[C.id];g=g.replace(new RegExp(C.id,"g"),E.id)}),new RTCSessionDescription({type:m.type,sdp:g})}["createOffer","createAnswer"].forEach(function(h){const m=n.RTCPeerConnection.prototype[h],g={[h](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[E=>{const k=o(this,E);b[0].apply(null,[k])},E=>{b[1]&&b[1].apply(null,E)},arguments[2]]):m.apply(this,arguments).then(E=>o(this,E))}};n.RTCPeerConnection.prototype[h]=g[h]});const l=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=u(this,arguments[0]),l.apply(this,arguments))};const f=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=f.get.apply(this);return h.type===""?h:o(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(m._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(C=>{this._streams[C].getTracks().find(k=>m.track===k)&&(b=this._streams[C])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function qh(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=r[t]})}function gk(n,e){na(n,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}var k0=Object.freeze({__proto__:null,fixNegotiationNeeded:gk,shimAddTrackRemoveTrack:pk,shimAddTrackRemoveTrackWithNative:mk,shimGetSendersWithDtmf:fk,shimGetUserMedia:lk,shimMediaStream:uk,shimOnTrack:dk,shimPeerConnection:qh,shimSenderReceiverGetStats:hk});function vk(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(r,o,u){Bm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(r).then(o,u)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const r=function(u,l,f){l in u&&!(f in u)&&(u[f]=u[l],delete u[l])},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),r(u.audio,"autoGainControl","mozAutoGainControl"),r(u.audio,"noiseSuppression","mozNoiseSuppression")),o(u)},i&&i.prototype.getSettings){const u=i.prototype.getSettings;i.prototype.getSettings=function(){const l=u.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const u=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[l])}}}}function p5(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function yk(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Hh(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=n.RTCPeerConnection.prototype[r],u={[r](){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[r]=u[r]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[o,u,l]=arguments;return i.apply(this,[o||null]).then(f=>{if(e.version<53&&!u)try{f.forEach(h=>{h.type=t[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;f.forEach((m,g)=>{f.set(g,Object.assign({},m,{type:t[m.type]||m.type}))})}return f}).then(u,l)}}function bk(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=t.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Sk(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),na(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ck(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){Bm("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function kk(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function Tk(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(r){const{sender:u}=o,l=u.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(l).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return o})}function Ek(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function xk(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Rk(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var T0=Object.freeze({__proto__:null,shimAddTransceiver:Tk,shimCreateAnswer:Rk,shimCreateOffer:xk,shimGetDisplayMedia:p5,shimGetParameters:Ek,shimGetUserMedia:vk,shimOnTrack:yk,shimPeerConnection:Hh,shimRTCDataChannel:kk,shimReceiverGetStats:Sk,shimRemoveStream:Ck,shimSenderGetStats:bk});function _k(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},n.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];return o&&o.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const r=t.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function wk(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const u=new Event("addstream");u.stream=o,i.dispatchEvent(u)})}),e.apply(i,arguments)}}}function Mk(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,u=e.addIceCandidate;e.createOffer=function(h,m){const g=arguments.length>=2?arguments[2]:arguments[0],b=t.apply(this,[g]);return m?(b.then(h,m),Promise.resolve()):b},e.createAnswer=function(h,m){const g=arguments.length>=2?arguments[2]:arguments[0],b=i.apply(this,[g]);return m?(b.then(h,m),Promise.resolve()):b};let l=function(f,h,m){const g=r.apply(this,[f]);return m?(g.then(h,m),Promise.resolve()):g};e.setLocalDescription=l,l=function(f,h,m){const g=o.apply(this,[f]);return m?(g.then(h,m),Promise.resolve()):g},e.setRemoteDescription=l,l=function(f,h,m){const g=u.apply(this,[f]);return m?(g.then(h,m),Promise.resolve()):g},e.addIceCandidate=l}function Nk(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=r=>i(Ok(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,o){e.mediaDevices.getUserMedia(i).then(r,o)}).bind(e))}function Ok(n){return n&&n.video!==void 0?Object.assign({},n,{video:ck(n.video)}):n}function Dk(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const o=[];for(let u=0;u<i.iceServers.length;u++){let l=i.iceServers[u];l.urls===void 0&&l.url?(Bm("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(i.iceServers[u])}i.iceServers=o}return new e(i,r)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Ak(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Pk(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Lk(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var E0=Object.freeze({__proto__:null,shimAudioContext:Lk,shimCallbacksAPI:Mk,shimConstraints:Ok,shimCreateOfferLegacy:Pk,shimGetUserMedia:Nk,shimLocalStreamsAPI:_k,shimRTCIceServerUrls:Dk,shimRemoteStreamsAPI:wk,shimTrackEventTransceiver:Ak}),rh={exports:{}},x0;function g5(){return x0||(x0=1,(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(t){return t.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(t){const i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){const i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(t){let i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1]);break}return r},e.writeCandidate=function(t){const i=[];i.push(t.foundation);const r=t.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);const o=t.type;return i.push("typ"),i.push(o),o!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let i=t.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(t){let i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);const r=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(t){const i=t.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const i={};let r;const o=t.substring(t.indexOf(" ")+1).split(";");for(let u=0;u<o.length;u++)r=o[u].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(t){let i="",r=t.payloadType;if(t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const o=[];Object.keys(t.parameters).forEach(u=>{t.parameters[u]!==void 0?o.push(u+"="+t.parameters[u]):o.push(u)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){const i=t.substring(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){let i="",r=t.payloadType;return t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){const i=t.indexOf(" "),r={ssrc:parseInt(t.substring(7,i),10)},o=t.indexOf(":",i);return o>-1?(r.attribute=t.substring(i+1,o),r.value=t.substring(o+1)):r.attribute=t.substring(i+1),r},e.parseSsrcGroup=function(t){const i=t.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(t){const i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(t){const i=t.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:e.matchPrefix(t+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){let r="a=setup:"+i+`\r
`;return t.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(t){const i=t.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const i=t.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){return e.matchPrefix(t+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,i){const r=e.matchPrefix(t+i,"a=ice-ufrag:")[0],o=e.matchPrefix(t+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(t){let i="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(t){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(t)[0].split(" ");i.profile=o[2];for(let l=3;l<o.length;l++){const f=o[l],h=e.matchPrefix(t,"a=rtpmap:"+f+" ")[0];if(h){const m=e.parseRtpMap(h),g=e.matchPrefix(t,"a=fmtp:"+f+" ");switch(m.parameters=g.length?e.parseFmtp(g[0]):{},m.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+f+" ").map(e.parseRtcpFb),i.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(m.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(l=>{i.headerExtensions.push(e.parseExtmap(l))});const u=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(l=>{u.forEach(f=>{l.rtcpFeedback.find(m=>m.type===f.type&&m.parameter===f.parameter)||l.rtcpFeedback.push(f)})}),i},e.writeRtpDescription=function(t,i){let r="";r+="m="+t+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(u=>{r+=e.writeRtpMap(u),r+=e.writeFmtp(u),r+=e.writeRtcpFb(u)});let o=0;return i.codecs.forEach(u=>{u.maxptime>o&&(o=u.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(u=>{r+=e.writeExtmap(u)}),r},e.parseRtpEncodingParameters=function(t){const i=[],r=e.parseRtpParameters(t),o=r.fecMechanisms.indexOf("RED")!==-1,u=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(t,"a=ssrc:").map(b=>e.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),f=l.length>0&&l[0].ssrc;let h;const m=e.matchPrefix(t,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(E=>parseInt(E,10)));m.length>0&&m[0].length>1&&m[0][0]===f&&(h=m[0][1]),r.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let C={ssrc:f,codecPayloadType:parseInt(b.parameters.apt,10)};f&&h&&(C.rtx={ssrc:h}),i.push(C),o&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:f,mechanism:u?"red+ulpfec":"red"},i.push(C))}}),i.length===0&&f&&i.push({ssrc:f});let g=e.matchPrefix(t,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-2e3*8:g=void 0,i.forEach(b=>{b.maxBitrate=g})),i},e.parseRtcpParameters=function(t){const i={},r=e.matchPrefix(t,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const u=e.matchPrefix(t,"a=rtcp-mux");return i.mux=u.length>0,i},e.writeRtcpParameters=function(t){let i="";return t.reducedSize&&(i+=`a=rtcp-rsize\r
`),t.mux&&(i+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(i+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),i},e.parseMsid=function(t){let i;const r=e.matchPrefix(t,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(t,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){const i=e.parseMLine(t),r=e.matchPrefix(t,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const u=e.matchPrefix(t,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const l=e.matchPrefix(t,"a=sctpmap:");if(l.length>0){const f=l[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:o}}},e.writeSctpDescription=function(t,i){let r=[];return t.protocol!=="DTLS/SCTP"?r=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,i,r){let o;const u=i!==void 0?i:2;return t?o=t:o=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,i){const r=e.splitLines(t);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const r=e.splitLines(t)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(t){const r=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const i=e.splitLines(t);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},n.exports=e})(rh)),rh.exports}var jk=g5(),Wa=s5(jk),v5=S3({__proto__:null,default:Wa},[jk]);function Ll(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),o=Wa.parseCandidate(i.candidate);for(const u in o)u in r||Object.defineProperty(r,u,{value:o[u]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,na(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function $h(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||na(n,"icecandidate",e=>{if(e.candidate){const t=Wa.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function jl(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(l){if(!l||!l.sdp)return!1;const f=Wa.splitSections(l.sdp);return f.shift(),f.some(h=>{const m=Wa.parseMLine(h);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},i=function(l){const f=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const h=parseInt(f[1],10);return h!==h?-1:h},r=function(l){let f=65536;return e.browser==="firefox"&&(e.version<57?l===-1?f=16384:f=2147483637:e.version<60?f=e.version===57?65535:65536:f=2147483637),f},o=function(l,f){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const m=Wa.matchPrefix(l.sdp,"a=max-message-size:");return m.length>0?h=parseInt(m[0].substring(19),10):e.browser==="firefox"&&f!==-1&&(h=2147483637),h},u=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const f=i(arguments[0]),h=r(f),m=o(arguments[0],f);let g;h===0&&m===0?g=Number.POSITIVE_INFINITY:h===0||m===0?g=Math.max(h,m):g=Math.min(h,m);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return g}}),this._sctp=b}return u.apply(this,arguments)}}function Il(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const l=arguments[0],f=l.length||l.size||l.byteLength;if(i.readyState==="open"&&r.sctp&&f>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const r=t.apply(this,arguments);return e(r,this),r},na(n,"datachannel",i=>(e(i.channel,i.target),i))}function Kh(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const u=new Event("connectionstatechange",r);o.dispatchEvent(u)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Gh(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(u=>u.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&r instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return t.apply(this,arguments)}}function Ul(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Bl(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return t.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?t.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(u=>t.apply(this,[u]))})}var y5=Object.freeze({__proto__:null,removeExtmapAllowMixed:Gh,shimAddIceCandidateNullOrEmpty:Ul,shimConnectionState:Kh,shimMaxMessageSize:jl,shimParameterlessSetLocalDescription:Bl,shimRTCIceCandidate:Ll,shimRTCIceCandidateRelayProtocol:$h,shimSendThrowTypeError:Il});function b5(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=ok,i=m5(n),r={browserDetails:i,commonShim:y5,extractVersion:_o,disableLog:f5,disableWarnings:h5,sdp:v5};switch(i.browser){case"chrome":if(!k0||!qh||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),r;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),r;t("adapter.js shimming chrome."),r.browserShim=k0,Ul(n,i),Bl(n),lk(n,i),uk(n),qh(n,i),dk(n),pk(n,i),fk(n),hk(n),gk(n,i),Ll(n),$h(n),Kh(n),jl(n,i),Il(n),Gh(n,i);break;case"firefox":if(!T0||!Hh||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),r;t("adapter.js shimming firefox."),r.browserShim=T0,Ul(n,i),Bl(n),vk(n,i),Hh(n,i),yk(n),Ck(n),bk(n),Sk(n),kk(n),Tk(n),Ek(n),xk(n),Rk(n),Ll(n),Kh(n),jl(n,i),Il(n);break;case"safari":if(!E0||!e.shimSafari)return t("Safari shim is not included in this adapter release."),r;t("adapter.js shimming safari."),r.browserShim=E0,Ul(n,i),Bl(n),Dk(n),Pk(n),Mk(n),_k(n),wk(n),Ak(n),Nk(n),Lk(n),Ll(n),$h(n),jl(n,i),Il(n),Gh(n,i);break;default:t("Unsupported browser!");break}return r}b5({window:typeof window>"u"?void 0:window});var Yh,Ik;class Qt extends(Ik=Promise){constructor(e){super(e)}catch(e){return super.catch(e)}static reject(e){return super.reject(e)}static all(e){return super.all(e)}static race(e){return super.race(e)}}Yh=Qt;Qt.resolve=n=>Reflect.get(Ik,"resolve",Yh).call(Yh,n);const S5=/version\/(\d+(\.?_?\d+)+)/i;let oh;function pn(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const t=navigator.userAgent.toLowerCase();if(oh===void 0||e){const i=C5.find(r=>{let{test:o}=r;return o.test(t)});oh=i?.describe(t)}return oh}const C5=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:zl(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:ch(n)}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:zl(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0,osVersion:ch(n)}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:zl(S5,n),os:n.includes("mobile/")?"iOS":"macOS",osVersion:ch(n)}}}];function zl(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(n);return i&&i.length>=t&&i[t]||""}function ch(n){return n.includes("mac os")?zl(/\(.+?(\d+_\d+(:?_\d+)?)/,n,1).replace(/_/g,"."):void 0}var k5="2.17.1";const T5=k5,E5=16;class ws extends Error{constructor(e,t,i){super(t||"an error has occurred"),this.name="LiveKitError",this.code=e,typeof i?.cause<"u"&&(this.cause=i?.cause)}}class zm extends ws{}var st;(function(n){n[n.NotAllowed=0]="NotAllowed",n[n.ServerUnreachable=1]="ServerUnreachable",n[n.InternalError=2]="InternalError",n[n.Cancelled=3]="Cancelled",n[n.LeaveRequest=4]="LeaveRequest",n[n.Timeout=5]="Timeout",n[n.WebSocket=6]="WebSocket",n[n.ServiceNotFound=7]="ServiceNotFound"})(st||(st={}));class ke extends zm{constructor(e,t,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=t,this.context=r,this.reasonName=st[t]}static notAllowed(e,t,i){return new ke(e,st.NotAllowed,t,i)}static timeout(e){return new ke(e,st.Timeout)}static leaveRequest(e,t){return new ke(e,st.LeaveRequest,void 0,t)}static internal(e,t){return new ke(e,st.InternalError,void 0,t)}static cancelled(e){return new ke(e,st.Cancelled)}static serverUnreachable(e,t){return new ke(e,st.ServerUnreachable,t)}static websocket(e,t,i){return new ke(e,st.WebSocket,t,i)}static serviceNotFound(e,t){return new ke(e,st.ServiceNotFound,void 0,t)}}class Vm extends ws{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ui extends ws{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class x5 extends ws{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Tt extends ws{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Za extends ws{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class R0 extends ws{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class _0 extends zm{constructor(e,t){super(15,e),this.name="SignalRequestError",this.reason=t,this.reasonName=typeof t=="string"?t:Um[t]}}var en;(function(n){n[n.AlreadyOpened=0]="AlreadyOpened",n[n.AbnormalEnd=1]="AbnormalEnd",n[n.DecodeFailed=2]="DecodeFailed",n[n.LengthExceeded=3]="LengthExceeded",n[n.Incomplete=4]="Incomplete",n[n.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",n[n.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(en||(en={}));class zn extends zm{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=en[t]}}class Ka extends ws{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Fo;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(Fo||(Fo={}));(function(n){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(Fo||(Fo={}));class Kt{}Kt.setTimeout=function(){return setTimeout(...arguments)};Kt.setInterval=function(){return setInterval(...arguments)};Kt.clearTimeout=function(){return clearTimeout(...arguments)};Kt.clearInterval=function(){return clearInterval(...arguments)};var X;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.Moved="moved",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.ParticipantAttributesChanged="participantAttributesChanged",n.ParticipantActive="participantActive",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.VideoPlaybackStatusChanged="videoPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged",n.ChatMessage="chatMessage",n.LocalTrackSubscribed="localTrackSubscribed",n.MetricsReceived="metricsReceived"})(X||(X={}));var ie;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackCpuConstrained="localTrackCpuConstrained",n.LocalSenderCreated="localSenderCreated",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.TrackCpuConstrained="trackCpuConstrained",n.MediaDevicesError="mediaDevicesError",n.AudioStreamAcquired="audioStreamAcquired",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded",n.AttributesChanged="attributesChanged",n.LocalTrackSubscribed="localTrackSubscribed",n.ChatMessage="chatMessage",n.Active="active"})(ie||(ie={}));var ue;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",n.RemoteMute="remoteMute",n.SubscribedQualityUpdate="subscribedQualityUpdate",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackSubscribed="localTrackSubscribed",n.Offline="offline",n.SignalRequestResponse="signalRequestResponse",n.SignalConnected="signalConnected",n.RoomMoved="roomMoved"})(ue||(ue={}));var ce;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.CpuConstrained="cpuConstrained",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.VideoPlaybackStarted="videoPlaybackStarted",n.VideoPlaybackFailed="videoPlaybackFailed",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed",n.TrackProcessorUpdate="trackProcessorUpdate",n.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",n.TranscriptionReceived="transcriptionReceived",n.TimeSyncUpdate="timeSyncUpdate",n.PreConnectBufferFlushed="preConnectBufferFlushed"})(ce||(ce={}));function R5(n){return typeof n>"u"?n:typeof structuredClone=="function"?typeof n=="object"&&n!==null?structuredClone(Object.assign({},n)):structuredClone(n):JSON.parse(JSON.stringify(n))}class tt{constructor(e,t,i,r,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(t!==void 0&&i!==void 0)this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:i,maxFramerate:r,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const _5=["vp8","h264"],w5=["vp8","h264","vp9","av1","h265"];function M5(n){return!!_5.find(e=>e===n)}const N5=M5;var w0;(function(n){n[n.PREFER_REGRESSION=0]="PREFER_REGRESSION",n[n.SIMULCAST=1]="SIMULCAST",n[n.REGRESSION=2]="REGRESSION"})(w0||(w0={}));var Jh;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:24e3},n.music={maxBitrate:48e3},n.musicStereo={maxBitrate:64e3},n.musicHighQuality={maxBitrate:96e3},n.musicHighQualityStereo={maxBitrate:128e3}})(Jh||(Jh={}));const qo={h90:new tt(160,90,9e4,20),h180:new tt(320,180,16e4,20),h216:new tt(384,216,18e4,20),h360:new tt(640,360,45e4,20),h540:new tt(960,540,8e5,25),h720:new tt(1280,720,17e5,30),h1080:new tt(1920,1080,3e6,30),h1440:new tt(2560,1440,5e6,30),h2160:new tt(3840,2160,8e6,30)},Qh={h120:new tt(160,120,7e4,20),h180:new tt(240,180,125e3,20),h240:new tt(320,240,14e4,20),h360:new tt(480,360,33e4,20),h480:new tt(640,480,5e5,20),h540:new tt(720,540,6e5,25),h720:new tt(960,720,13e5,30),h1080:new tt(1440,1080,23e5,30),h1440:new tt(1920,1440,38e5,30)},Fm={h360fps3:new tt(640,360,2e5,3,"medium"),h360fps15:new tt(640,360,4e5,15,"medium"),h720fps5:new tt(1280,720,8e5,5,"medium"),h720fps15:new tt(1280,720,15e5,15,"medium"),h720fps30:new tt(1280,720,2e6,30,"medium"),h1080fps15:new tt(1920,1080,25e5,15,"medium"),h1080fps30:new tt(1920,1080,5e6,30,"medium"),original:new tt(0,0,7e6,30,"medium")};function Uk(n,e,t){var i,r,o,u;const{optionsWithoutProcessor:l,audioProcessor:f,videoProcessor:h}=Vk(n??{}),m=e?.processor,g=t?.processor,b=l??{};return b.audio===!0&&(b.audio={}),b.video===!0&&(b.video={}),b.audio&&(Xh(b.audio,e),(i=(o=b.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(f||m)&&(b.audio.processor=f??m)),b.video&&(Xh(b.video,t),(r=(u=b.video).deviceId)!==null&&r!==void 0||(u.deviceId={ideal:"default"}),(h||g)&&(b.video.processor=h??g)),b}function Xh(n,e){return Object.keys(e).forEach(t=>{n[t]===void 0&&(n[t]=e[t])}),n}function qm(n){var e,t,i,r;const o={};if(n.video)if(typeof n.video=="object"){const u={},l=u,f=n.video;Object.keys(f).forEach(h=>{h==="resolution"?Xh(l,f.resolution):l[h]=f[h]}),o.video=u,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=n.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return n.audio?typeof n.audio=="object"?(o.audio=n.audio,(t=(r=o.audio).deviceId)!==null&&t!==void 0||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function Bk(n){return A(this,arguments,void 0,function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=zk();if(i){const r=i.createAnalyser();r.fftSize=2048;const o=r.frequencyBinCount,u=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Gt(t),r.getByteTimeDomainData(u);const f=u.some(h=>h!==128&&h!==0);return i.close(),!f}return!1})()})}function zk(){var n;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const t=new e({latencyHint:"interactive"});if(t.state==="suspended"&&typeof window<"u"&&(!((n=window.document)===null||n===void 0)&&n.body)){const i=()=>A(this,void 0,void 0,function*(){var r;try{t.state==="suspended"&&(yield t.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});t.addEventListener("statechange",()=>{var r;t.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return t}}function O5(n){return n==="audioinput"?ee.Source.Microphone:n==="videoinput"?ee.Source.Camera:ee.Source.Unknown}function Wh(n){return n===ee.Source.Microphone?"audioinput":n===ee.Source.Camera?"videoinput":void 0}function D5(n){var e,t;let i=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&n.resolution.width>0&&n.resolution.height>0&&(i=typeof i=="boolean"?{}:i,ta()?i=Object.assign(Object.assign({},i),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(t=n.audio)!==null&&t!==void 0?t:!1,video:i,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio,preferCurrentTab:n.preferCurrentTab}}function Ao(n){return n.split("/")[1].toLowerCase()}function A5(n){const e=[];return n.forEach(t=>{t.track!==void 0&&e.push(new Am({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function Ie(n){return"mediaStreamTrack"in n?{trackID:n.sid,source:n.source,muted:n.isMuted,enabled:n.mediaStreamTrack.enabled,kind:n.kind,streamID:n.mediaStreamID,streamTrackID:n.mediaStreamTrack.id}:{trackID:n.trackSid,enabled:n.isEnabled,muted:n.isMuted,trackInfo:Object.assign({mimeType:n.mimeType,name:n.trackName,encrypted:n.isEncrypted,kind:n.kind,source:n.source},n.track?Ie(n.track):{})}}function P5(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function L5(n,e){var t;n===void 0&&(n={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(n)],r={};for(const o of i)n[o]!==e[o]&&(r[o]=(t=e[o])!==null&&t!==void 0?t:"");return r}function Vk(n){const e=Object.assign({},n);let t,i;return typeof e.audio=="object"&&e.audio.processor&&(t=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:t,videoProcessor:i,optionsWithoutProcessor:R5(e)}}function j5(n){switch(n){case At.CAMERA:return ee.Source.Camera;case At.MICROPHONE:return ee.Source.Microphone;case At.SCREEN_SHARE:return ee.Source.ScreenShare;case At.SCREEN_SHARE_AUDIO:return ee.Source.ScreenShareAudio;default:return ee.Source.Unknown}}function M0(n,e){return n.width*n.height<e.width*e.height}function I5(n,e){var t;return(t=n.layers)===null||t===void 0?void 0:t.find(i=>i.quality===e)}const U5=5e3,bo=[];var Rn;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH"})(Rn||(Rn={}));class ee extends hi.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=ee.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=De,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),U5):this.handleAppVisibilityChanged()},this.log=Vi((r=i.loggerName)!==null&&r!==void 0?r:ei.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=ee.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ie(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===ee.Kind.Video&&(t="video"),this.attachedElements.length===0&&this.kind===ee.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(bo.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&bo.splice(bo.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ya(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(r?ce.AudioPlaybackStarted:ce.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(r?ce.AudioPlaybackFailed:ce.VideoPlaybackFailed,o):o.name==="AbortError"?De.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):De.warn("could not playback ".concat(r?"audio":"video"),o),r&&e&&i.some(u=>u.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ce.ElementAttached,e),e}detach(e){try{if(e){er(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(ce.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(i=>{er(this.mediaStreamTrack,i),t.push(i),this.recycleElement(i),this.emit(ce.ElementDetached,i)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Vi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),bo.forEach(i=>{i.parentElement||(t=!1)}),t&&bo.push(e)}}handleAppVisibilityChanged(){return A(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===ee.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){mn()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){mn()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ya(n,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let i;n.kind==="audio"?i=t.getAudioTracks():i=t.getVideoTracks(),i.includes(n)||(i.forEach(r=>{t.removeTrack(r)}),t.addTrack(n)),(!ta()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(ta()||ea())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function er(n,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(n),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(n){let e;(function(h){h.Audio="audio",h.Video="video",h.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let t;(function(h){h.Camera="camera",h.Microphone="microphone",h.ScreenShare="screen_share",h.ScreenShareAudio="screen_share_audio",h.Unknown="unknown"})(t=n.Source||(n.Source={}));let i;(function(h){h.Active="active",h.Paused="paused",h.Unknown="unknown"})(i=n.StreamState||(n.StreamState={}));function r(h){switch(h){case e.Audio:return Yn.AUDIO;case e.Video:return Yn.VIDEO;default:return Yn.DATA}}n.kindToProto=r;function o(h){switch(h){case Yn.AUDIO:return e.Audio;case Yn.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=o;function u(h){switch(h){case t.Camera:return At.CAMERA;case t.Microphone:return At.MICROPHONE;case t.ScreenShare:return At.SCREEN_SHARE;case t.ScreenShareAudio:return At.SCREEN_SHARE_AUDIO;default:return At.UNKNOWN}}n.sourceToProto=u;function l(h){switch(h){case At.CAMERA:return t.Camera;case At.MICROPHONE:return t.Microphone;case At.SCREEN_SHARE:return t.ScreenShare;case At.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}n.sourceFromProto=l;function f(h){switch(h){case Bh.ACTIVE:return i.Active;case Bh.PAUSED:return i.Paused;default:return i.Unknown}}n.streamStateFromProto=f})(ee||(ee={}));const B5="|",N0="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function z5(n){const e=n.split(B5);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function Gt(n){return new Qt(e=>Kt.setTimeout(e,n))}function Zh(){return"addTransceiver"in RTCPeerConnection.prototype}function em(){return"addTrack"in RTCPeerConnection.prototype}function V5(){if(!("getCapabilities"in RTCRtpSender)||ta()||ea())return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function F5(){if(!("getCapabilities"in RTCRtpSender)||ea())return!1;if(ta()){const t=pn();if(t?.version&&di(t.version,"16")<0||t?.os==="iOS"&&t?.osVersion&&di(t.osVersion,"16")<0)return!1}const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Qn(n){return n==="av1"||n==="vp9"}function tm(n){return!document||Ho()?!1:(n||(n=document.createElement("audio")),"setSinkId"in n)}function q5(){return typeof RTCPeerConnection>"u"?!1:Zh()||em()}function ea(){var n;return((n=pn())===null||n===void 0?void 0:n.name)==="Firefox"}function O0(){const n=pn();return!!n&&n.name==="Chrome"&&n.os!=="iOS"}function ta(){var n;return((n=pn())===null||n===void 0?void 0:n.name)==="Safari"}function Ho(){const n=pn();return n?.name==="Safari"||n?.os==="iOS"}function H5(){const n=pn();return n?.name==="Safari"&&n.version.startsWith("17.")||n?.os==="iOS"&&!!n?.osVersion&&di(n.osVersion,"17")>=0}function $5(n){return n||(n=pn()),n?.name==="Safari"&&di(n.version,"18.3")>0||n?.os==="iOS"&&!!n?.osVersion&&di(n.osVersion,"18.3")>0}function Fk(){var n,e;return mn()?(e=(n=navigator.userAgentData)===null||n===void 0?void 0:n.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function K5(){const n=pn(),e="17.2";if(n)return n.name!=="Safari"&&n.os!=="iOS"||n.os==="iOS"&&n.osVersion&&di(n.osVersion,e)>=0?!0:n.name==="Safari"&&di(n.version,e)>=0}function mn(){return typeof document<"u"}function ui(){return navigator.product=="ReactNative"}function cr(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function lh(n){return cr(n)?n.hostname.split(".")[0]:null}function qk(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Hk(){if(!ui())return;let n=qk();if(n)return n.platform}function D0(){if(mn())return window.devicePixelRatio;if(ui()){let n=qk();if(n)return n.devicePixelRatio}return 1}function di(n,e){const t=n.split("."),i=e.split("."),r=Math.min(t.length,i.length);for(let o=0;o<r;++o){const u=parseInt(t[o],10),l=parseInt(i[o],10);if(u>l)return 1;if(u<l)return-1;if(o===r-1&&u===l)return 0}return n===""&&e!==""?-1:e===""?1:t.length==i.length?0:t.length<i.length?-1:1}function G5(n){for(const e of n)e.target.handleResize(e)}function Y5(n){for(const e of n)e.target.handleVisibilityChanged(e)}let uh=null;const A0=()=>(uh||(uh=new ResizeObserver(G5)),uh);let dh=null;const P0=()=>(dh||(dh=new IntersectionObserver(Y5,{root:null,rootMargin:"0px"})),dh);function J5(){var n;const e=new zC({sdk:VC.JS,protocol:E5,version:T5});return ui()&&(e.os=(n=Hk())!==null&&n!==void 0?n:""),e}function L0(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=n,r.height=e;const o=r.getContext("2d");o?.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(n/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const u=r.captureStream(),[l]=u.getTracks();if(!l)throw Error("Could not get empty media stream video track");return l.enabled=t,l}let So;function fh(){if(!So){const n=new AudioContext,e=n.createOscillator(),t=n.createGain();t.gain.setValueAtTime(0,0);const i=n.createMediaStreamDestination();if(e.connect(t),t.connect(i),e.start(),[So]=i.stream.getAudioTracks(),!So)throw Error("Could not get empty media stream audio track");So.enabled=!1}return So.clone()}class Fn{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise((i,r)=>A(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function Q5(n){return w5.includes(n)}function Ts(n){if(typeof n=="string"||typeof n=="number")return n;if(Array.isArray(n))return n[0];if(n.exact!==void 0)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal!==void 0)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function X5(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function $o(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}function W5(n,e){return n.segments.map(t=>{let{id:i,text:r,language:o,startTime:u,endTime:l,final:f}=t;var h;const m=(h=e.get(i))!==null&&h!==void 0?h:Date.now(),g=Date.now();return f?e.delete(i):e.set(i,m),{id:i,text:r,startTime:Number.parseInt(u.toString()),endTime:Number.parseInt(l.toString()),final:f,language:o,firstReceivedTime:m,lastReceivedTime:g}})}function Z5(n){const{id:e,timestamp:t,message:i,editTimestamp:r}=n;return{id:e,timestamp:Number.parseInt(t.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function j0(n){switch(n.reason){case st.LeaveRequest:return n.context;case st.Cancelled:return Wn.CLIENT_INITIATED;case st.NotAllowed:return Wn.USER_REJECTED;case st.ServerUnreachable:return Wn.JOIN_FAILURE;default:return Wn.UNKNOWN_REASON}}function Vl(n){return n!==void 0?Number(n):void 0}function Qs(n){return n!==void 0?BigInt(n):void 0}function tr(n){return!!n&&!(n instanceof MediaStreamTrack)&&n.isLocal}function ci(n){return!!n&&n.kind==ee.Kind.Audio}function Ms(n){return!!n&&n.kind==ee.Kind.Video}function ys(n){return tr(n)&&Ms(n)}function Ai(n){return tr(n)&&ci(n)}function nm(n){return!!n&&!n.isLocal}function eB(n){return!!n&&!n.isLocal}function hh(n){return nm(n)&&Ms(n)}function tB(n){return n.isLocal}function nB(n,e){const t=[];let i=new TextEncoder().encode(n);for(;i.length>e;){let r=e;for(;r>0;){const o=i[r];if(o!==void 0&&(o&192)!==128)break;r--}t.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&t.push(i),t}function iB(n){var e;const t=n.get("Cache-Control");if(t){const i=(e=t.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function sB(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=aB(n,e);return t?i:Hm(i,"v1")}function aB(n,e){const t=new URL(X5(n));return e.forEach((i,r)=>{t.searchParams.set(r,i)}),Hm(t,"rtc")}function rB(n){const e=new URL($o(n));return Hm(e,"validate")}function $k(n){return n.endsWith("/")?n:"".concat(n,"/")}function Hm(n,e){return n.pathname="".concat($k(n.pathname)).concat(e),n}function I0(n){if(typeof n=="string")return p0.fromJson(JSON.parse(n),{ignoreUnknownFields:!0});if(n instanceof ArrayBuffer)return p0.fromBinary(new Uint8Array(n));throw new Error("could not decode websocket message: ".concat(typeof n))}function oB(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(n instanceof AbortSignal))return e;const t=n.reason;switch(typeof t){case"string":return t;case"object":return t instanceof Error?t.message:e;default:return"toString"in t?t.toString():e}}const cB=10,Co="lk_e2ee",lB="LKFrameEncryptionKey",uB={sharedKey:!1,ratchetSalt:lB,ratchetWindowSize:8,failureTolerance:cB,keyringSize:16};var Es;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(Es||(Es={}));var U0;(function(n){n.KeyRatcheted="keyRatcheted"})(U0||(U0={}));var Cs;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(Cs||(Cs={}));var B0;(function(n){n.Error="cryptorError"})(B0||(B0={}));function dB(){return fB()||im()}function im(){return typeof window.RTCRtpScriptTransform<"u"}function fB(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function hB(n){var e,t,i,r,o;if(((e=n.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((t=n.value)===null||t===void 0?void 0:t.case)!=="metrics"&&((i=n.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=n.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((o=n.value)===null||o===void 0?void 0:o.case)!=="encryptedPacket")return new AC({value:n.value})}class f9 extends hi.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,i,r)=>{De.debug("key ratcheted event received",{ratchetResult:t,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},uB),e),this.on(Es.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,i){const r={key:e,participantIdentity:t,keyIndex:i};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(i??0),r),this.emit(Es.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(Es.RatchetRequest,e,t)}}var z0;(function(n){n[n.InvalidKey=0]="InvalidKey",n[n.MissingKey=1]="MissingKey",n[n.InternalError=2]="InternalError"})(z0||(z0={}));class mB extends hi.EventEmitter{constructor(e,t){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,o;const{kind:u,data:l}=i.data;switch(u){case"error":if(De.error(l.error.message),l.uuid){const m=this.decryptDataRequests.get(l.uuid);if(m?.reject){m.reject(l.error);break}const g=this.encryptDataRequests.get(l.uuid);if(g?.reject){g.reject(l.error);break}}this.emit(Cs.EncryptionError,l.error,l.participantIdentity);break;case"initAck":l.enabled&&this.keyProvider.getKeys().forEach(m=>{this.postKey(m)});break;case"enable":if(l.enabled&&this.keyProvider.getKeys().forEach(m=>{this.postKey(m)}),this.encryptionEnabled!==l.enabled&&l.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Cs.ParticipantEncryptionStatusChanged,l.enabled,this.room.localParticipant),this.encryptionEnabled=l.enabled;else if(l.participantIdentity){const m=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(l.participantIdentity);if(!m)throw TypeError("couldn't set encryption status, participant not found".concat(l.participantIdentity));this.emit(Cs.ParticipantEncryptionStatusChanged,l.enabled,m)}break;case"ratchetKey":this.keyProvider.emit(Es.KeyRatcheted,l.ratchetResult,l.participantIdentity,l.keyIndex);break;case"decryptDataResponse":const f=this.decryptDataRequests.get(l.uuid);f?.resolve&&f.resolve(l);break;case"encryptDataResponse":const h=this.encryptDataRequests.get(l.uuid);h?.resolve&&h.resolve(l);break}},this.onWorkerError=i=>{De.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Cs.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=t}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!dB())throw new Vm("tried to setup end-to-end encryption on an unsupported browser");if(De.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:o5.getLevel()}};this.worker&&(De.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){De.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?De.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(ue.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(X.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==_t.NONE,r.identity)),e.on(X.ConnectionStateChanged,i=>{i===Ve.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==_t.NONE,r.identity)})})}).on(X.TrackUnsubscribed,(i,r,o)=>{var u;const l={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(u=this.worker)===null||u===void 0||u.postMessage(l)}).on(X.TrackSubscribed,(i,r,o)=>{this.setupE2EEReceiver(i,o.identity,r.trackInfo)}).on(X.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ie.LocalSenderCreated,(i,r)=>A(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(ie.LocalTrackPublished,i=>{if(!Ms(i.track)||!Ho())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Ao(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),t.on(Es.SetKey,i=>this.postKey(i)).on(Es.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return A(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const t=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:t,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Fn;return r.onFinally=()=>{this.encryptDataRequests.delete(t)},this.encryptDataRequests.set(t,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,t,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),u={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:t,participantIdentity:i,keyIndex:r}},l=new Fn;return l.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,l),this.worker.postMessage(u),l.promise}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(i)}postKey(e){let{key:t,participantIdentity:i,keyIndex:r}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const u={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:t,keyIndex:r}};this.worker.postMessage(u)}postEnable(e,t){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,i){if(e.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?Ao(i.mimeType):void 0)}}setupE2EESender(e,t){if(!tr(e)||!t){t||De.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,i,r){return A(this,void 0,void 0,function*(){if(this.worker){if(im()&&!O0()){const o={kind:"decode",participantIdentity:i,trackId:t,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Co in e&&r){const f={kind:"updateCodec",data:{trackId:t,codec:r,participantIdentity:i}};this.worker.postMessage(f);return}let o=e.writableStream,u=e.readableStream;if(!o||!u){const f=e.createEncodedStreams();e.writableStream=f.writable,o=f.writable,e.readableStream=f.readable,u=f.readable}const l={kind:"decode",data:{readableStream:u,writableStream:o,trackId:t,codec:r,participantIdentity:i,isReuse:Co in e}};this.worker.postMessage(l,[u,o])}e[Co]=!0}})}handleSender(e,t,i){var r;if(!(Co in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(im()&&!O0()){De.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{De.info("initialize encoded streams");const o=e.createEncodedStreams(),u={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(u,[o.readable,o.writable])}e[Co]=!0}}}const pB=500,gB=15e3;class nr{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new nr),this._instance}addFailedConnectionAttempt(e){var t;const i=new URL(e),r=lh(i);if(!r)return;let o=(t=this.failedConnectionAttempts.get(r))!==null&&t!==void 0?t:0;this.failedConnectionAttempts.set(r,o+1),this.backOffPromises.set(r,Gt(Math.min(pB*Math.pow(2,o),gB)))}getBackOffPromise(e){const t=new URL(e),i=t&&lh(t);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const t=new URL(e),i=t&&lh(t);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}nr._instance=null;const mh="default";class zt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new zt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return A(this,arguments,void 0,function(t){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=zt.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){De.debug("awaiting getUserMedia promise");try{t?yield zt.userMediaPromiseMap.get(t):yield Promise.all(zt.userMediaPromiseMap.values())}catch{De.warn("error waiting for media permissons")}}let u=yield navigator.mediaDevices.enumerateDevices();if(r&&!(ta()&&i.hasDeviceInUse(t))&&(u.filter(f=>f.kind===t).length===0||u.some(f=>{const h=f.label==="",m=t?f.kind===t:!0;return h&&m}))){const f={video:t!=="audioinput"&&t!=="audiooutput",audio:t!=="videoinput"&&{deviceId:{ideal:"default"}}},h=yield navigator.mediaDevices.getUserMedia(f);u=yield navigator.mediaDevices.enumerateDevices(),h.getTracks().forEach(m=>{m.stop()})}return i._previousDevices=u,t&&(u=u.filter(l=>l.kind===t)),u})()})}normalizeDeviceId(e,t,i){return A(this,void 0,void 0,function*(){if(t!==mh)return t;const r=yield this.getDevices(e),o=r.find(l=>l.deviceId===mh);if(!o){De.warn("could not reliably determine default device");return}const u=r.find(l=>l.deviceId!==mh&&l.groupId===(i??o.groupId));if(!u){De.warn("could not reliably determine default device");return}return u?.deviceId})}hasDeviceInUse(e){return e?zt.userMediaPromiseMap.has(e):zt.userMediaPromiseMap.size>0}}zt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];zt.userMediaPromiseMap=new Map;var Po;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})(Po||(Po={}));class vB{constructor(){this.pendingTasks=new Map,this.taskMutex=new nn,this.nextTaskIndex=0}run(e){return A(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Po.WAITING};this.pendingTasks.set(t.id,t);const i=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Po.RUNNING,yield e()}finally{t.status=Po.COMPLETED,this.pendingTasks.delete(t.id),i()}})}flush(){return A(this,void 0,void 0,function*(){return this.run(()=>A(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class yB{get readyState(){return this.ws.readyState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=t.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,(r=t.protocols)!==null&&r!==void 0?r:[]);o.binaryType="arraybuffer",this.ws=o;const u=function(){let{closeCode:l,reason:f}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.close(l,f)};this.opened=new Qt((l,f)=>{const h=()=>{f(ke.websocket("Encountered websocket error during connection establishment"))};o.onopen=()=>{l({readable:new ReadableStream({start(m){o.onmessage=g=>{let{data:b}=g;return m.enqueue(b)},o.onerror=g=>m.error(g)},cancel:u}),writable:new WritableStream({write(m){o.send(m)},abort(){o.close()},close:u}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",h)},o.addEventListener("error",h)}),this.closed=new Qt((l,f)=>{const h=()=>A(this,void 0,void 0,function*(){const m=new Qt(b=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",C=>{b(C)},{once:!0})}),g=yield Qt.race([Gt(250),m]);g?l(g):f(ke.websocket("Encountered unspecified websocket error without a timely close event"))});o.onclose=m=>{let{code:g,reason:b}=m;l({closeCode:g,reason:b}),o.removeEventListener("error",h)},o.addEventListener("error",h)}),t.signal&&(t.signal.onabort=()=>o.close()),this.close=u}}const bB=["syncState","trickle","offer","answer","simulate","leave"];function SB(n){const e=bB.indexOf(n.case)>=0;return De.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}var it;(function(n){n[n.CONNECTING=0]="CONNECTING",n[n.CONNECTED=1]="CONNECTED",n[n.RECONNECTING=2]="RECONNECTING",n[n.DISCONNECTING=3]="DISCONNECTING",n[n.DISCONNECTED=4]="DISCONNECTED"})(it||(it={}));const CB=250;class $m{get currentState(){return this.state}get isDisconnected(){return this.state===it.DISCONNECTING||this.state===it.DISCONNECTED}get isEstablishingConnection(){return this.state===it.CONNECTING||this.state===it.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=it.DISCONNECTED,this.log=De,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Vi((i=t.loggerName)!==null&&i!==void 0?i:ei.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new vB,this.queuedRequests=[],this.closingLock=new nn,this.connectionLock=new nn,this.state=it.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,i,r){return A(this,arguments,void 0,function(o,u,l,f){var h=this;let m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){return h.state=it.CONNECTING,h.options=l,yield h.connect(o,u,l,f,m)})()})}reconnect(e,t,i,r){return A(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=it.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}),void 0,this.useV0SignalPath)})}connect(e,t,i,r){return A(this,arguments,void 0,function(o,u,l,f){var h=this;let m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){const g=yield h.connectionLock.lock();h.connectOptions=l,h.useV0SignalPath=m;const b=J5(),C=m?kB(u,b,l):TB(u,b,l),E=sB(o,C,m).toString(),k=rB(E).toString();return new Promise((_,w)=>A(h,void 0,void 0,function*(){var O,D;try{let x=!1;const R=P=>A(this,void 0,void 0,function*(){if(x)return;x=!0;const z=P instanceof Event?P.currentTarget:P,W=oB(z,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(W)).catch(J=>{this.log.error(J),this.close()}):this.close(),M(),w(ke.cancelled(W))});f?.addEventListener("abort",R);const M=()=>{clearTimeout(L),f?.removeEventListener("abort",R)},L=setTimeout(()=>{R(ke.timeout("room connection has timed out (signal)"))},l.websocketTimeout),B=(P,z)=>{this.handleSignalConnected(P,L,z)},V=new URL(E);V.searchParams.has("access_token")&&V.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(V),Object.assign({reconnect:l.reconnect,reconnectReason:l.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new yB(E);try{this.ws.closed.then(H=>{var re;this.isEstablishingConnection&&w(ke.internal("Websocket got closed during a (re)connection attempt: ".concat(H.reason))),H.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:H.reason,code:H.closeCode,wasClean:H.closeCode===1e3,state:this.state})),this.state===it.CONNECTED&&this.handleOnClose((re=H.reason)!==null&&re!==void 0?re:"Unexpected WS error"))}).catch(H=>{this.isEstablishingConnection&&w(ke.internal("Websocket error during a (re)connection attempt: ".concat(H)))});const P=yield this.ws.opened.catch(H=>A(this,void 0,void 0,function*(){if(this.state!==it.CONNECTED){this.state=it.DISCONNECTED,clearTimeout(L);const re=yield this.handleConnectionError(H,k);w(re);return}this.handleWSError(H),w(H)}));if(clearTimeout(L),!P)return;const z=P.readable.getReader();this.streamWriter=P.writable.getWriter();const W=yield z.read();if(z.releaseLock(),!W.value)throw ke.internal("no message received as first message");const J=I0(W.value),he=this.validateFirstMessage(J,(O=l.reconnect)!==null&&O!==void 0?O:!1);if(!he.isValid){w(he.error);return}((D=J.message)===null||D===void 0?void 0:D.case)==="join"&&(this.pingTimeoutDuration=J.message.value.pingTimeout,this.pingIntervalDuration=J.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const we=he.shouldProcessFirstMessage?J:void 0;B(P,we),_(he.response)}catch(P){w(P)}finally{M()}}finally{g()}}))})()})}startReadingLoop(e,t){return A(this,void 0,void 0,function*(){for(t&&this.handleSignalResponse(t);;){this.signalLatency&&(yield Gt(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const o=I0(r);this.handleSignalResponse(o)}})}close(){return A(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([it.DISCONNECTING||it.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=it.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const o=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([o,Gt(CB)])}}catch(o){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:o}))}finally{t&&(e.state=it.DISCONNECTED),r()}})()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Ja(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Ja(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new bu({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new Su({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return A(this,arguments,void 0,function(i,r){var o=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const l=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new Lm({requestId:l,metadata:i,name:r,attributes:u})}),l})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new XC({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new ek({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ut.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new ik({timestamp:ut.parse(Date.now()),rtt:ut.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new Pm({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new ku({reason:Wn.CLIENT_INITIATED,action:Xa.DISCONNECT})})}sendRequest(e){return A(this,arguments,void 0,function(t){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!SB(t)&&i.state===it.RECONNECTING){i.queuedRequests.push(()=>A(i,void 0,void 0,function*(){yield this.sendRequest(t,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Gt(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(t.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(t?.case),i.logContext);return}const u=new _4({message:t});try{i.useJSON?yield i.streamWriter.write(u.toJsonString()):yield i.streamWriter.write(u.toBinary())}catch(l){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:l}))}})()})}handleSignalResponse(e){var t,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(r.case==="answer"){const u=V0(r.value);this.onAnswer&&this.onAnswer(u,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const u=V0(r.value);this.onOffer&&this.onOffer(u,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const u=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(u,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=r.value.participants)!==null&&t!==void 0?t:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return A(this,void 0,void 0,function*(){if(this.state===it.DISCONNECTED)return;const t=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Kt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Kt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Kt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Kt.clearInterval(this.pingInterval)}handleSignalConnected(e,t,i){this.state=it.CONNECTED,clearTimeout(t),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,t){var i,r,o,u,l;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===it.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((o=e.message)===null||o===void 0?void 0:o.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((u=e.message)===null||u===void 0?void 0:u.case)==="leave"?{isValid:!1,error:ke.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:t?{isValid:!1,error:ke.internal("Unexpected first message")}:{isValid:!1,error:ke.internal("did not receive join response, got ".concat((l=e.message)===null||l===void 0?void 0:l.case," instead"))}}handleConnectionError(e,t){return A(this,void 0,void 0,function*(){try{const i=yield fetch(t);switch(i.status){case 404:return ke.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const r=yield i.text();return ke.notAllowed(r,i.status);default:break}return e instanceof ke?e:ke.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof ke?i:ke.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function V0(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function Ja(n,e){return new Rs({sdp:n.sdp,type:n.type,id:e})}function kB(n,e,t){var i;const r=new URLSearchParams;return r.set("access_token",n),t.reconnect&&(r.set("reconnect","1"),t.sid&&r.set("sid",t.sid)),r.set("auto_subscribe",t.autoSubscribe?"1":"0"),r.set("sdk",ui()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),t.adaptiveStream&&r.set("adaptive_stream","1"),t.reconnectReason&&r.set("reconnect_reason",t.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function TB(n,e,t){const i=new URLSearchParams;i.set("access_token",n);const r=new e5({clientInfo:e,connectionSettings:new sk({autoSubscribe:!!t.autoSubscribe,adaptiveStream:!!t.adaptiveStream}),reconnect:!!t.reconnect,participantSid:t.sid?t.sid:void 0});t.reconnectReason&&(r.reconnectReason=t.reconnectReason);const o=new t5({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(o.toBinary()))),i}class F0{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class EB{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:t,expiresAt:r}),this}get(e){const t=this._map.get(e);if(t){if(t.expiresAt<Date.now()){this._map.delete(e);return}return t.value}}has(e){const t=this._map.get(e);return t?t.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,i]of this._map.entries())i.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],i=this.asValueMap();for(const[r,o]of i.entries())t.push(e(o,r,i));return t}asValueMap(){const e=new Map;for(const[t,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(t,i.value);return e}}var Kn={},ph={},gh={exports:{}},q0;function Km(){if(q0)return gh.exports;q0=1;var n=gh.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),gh.exports}var H0;function xB(){return H0||(H0=1,(function(n){var e=function(l){return String(Number(l))===l?Number(l):l},t=function(l,f,h,m){if(m&&!h)f[m]=e(l[1]);else for(var g=0;g<h.length;g+=1)l[g+1]!=null&&(f[h[g]]=e(l[g+1]))},i=function(l,f,h){var m=l.name&&l.names;l.push&&!f[l.push]?f[l.push]=[]:m&&!f[l.name]&&(f[l.name]={});var g=l.push?{}:m?f[l.name]:f;t(h.match(l.reg),g,l.names,l.name),l.push&&f[l.push].push(g)},r=Km(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(l){var f={},h=[],m=f;return l.split(/(\r\n|\r|\n)/).filter(o).forEach(function(g){var b=g[0],C=g.slice(2);b==="m"&&(h.push({rtp:[],fmtp:[]}),m=h[h.length-1]);for(var E=0;E<(r[b]||[]).length;E+=1){var k=r[b][E];if(k.reg.test(C))return i(k,m,C)}}),f.media=h,f};var u=function(l,f){var h=f.split(/=(.+)/,2);return h.length===2?l[h[0]]=e(h[1]):h.length===1&&f.length>1&&(l[h[0]]=void 0),l};n.parseParams=function(l){return l.split(/;\s?/).reduce(u,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(l){return l.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(l){for(var f=[],h=l.split(" ").map(e),m=0;m<h.length;m+=3)f.push({component:h[m],ip:h[m+1],port:h[m+2]});return f},n.parseImageAttributes=function(l){return l.split(" ").map(function(f){return f.substring(1,f.length-1).split(",").reduce(u,{})})},n.parseSimulcastStreamList=function(l){return l.split(";").map(function(f){return f.split(",").map(function(h){var m,g=!1;return h[0]!=="~"?m=e(h):(m=e(h.substring(1,h.length)),g=!0),{scid:m,paused:g}})})}})(ph)),ph}var vh,$0;function RB(){if($0)return vh;$0=1;var n=Km(),e=/%[sdv%]/g,t=function(u){var l=1,f=arguments,h=f.length;return u.replace(e,function(m){if(l>=h)return m;var g=f[l];switch(l+=1,m){case"%%":return"%";case"%s":return String(g);case"%d":return Number(g);case"%v":return""}})},i=function(u,l,f){var h=l.format instanceof Function?l.format(l.push?f:f[l.name]):l.format,m=[u+"="+h];if(l.names)for(var g=0;g<l.names.length;g+=1){var b=l.names[g];l.name?m.push(f[l.name][b]):m.push(f[l.names[g]])}else m.push(f[l.name]);return t.apply(null,m)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return vh=function(u,l){l=l||{},u.version==null&&(u.version=0),u.name==null&&(u.name=" "),u.media.forEach(function(g){g.payloads==null&&(g.payloads="")});var f=l.outerOrder||r,h=l.innerOrder||o,m=[];return f.forEach(function(g){n[g].forEach(function(b){b.name in u&&u[b.name]!=null?m.push(i(g,b,u)):b.push in u&&u[b.push]!=null&&u[b.push].forEach(function(C){m.push(i(g,b,C))})})}),u.media.forEach(function(g){m.push(i("m",n.m[0],g)),h.forEach(function(b){n[b].forEach(function(C){C.name in g&&g[C.name]!=null?m.push(i(b,C,g)):C.push in g&&g[C.push]!=null&&g[C.push].forEach(function(E){m.push(i(b,C,E))})})})}),m.join(`\r
`)+`\r
`},vh}var K0;function _B(){if(K0)return Kn;K0=1;var n=xB(),e=RB(),t=Km();return Kn.grammar=t,Kn.write=e,Kn.parse=n.parse,Kn.parseParams=n.parseParams,Kn.parseFmtpConfig=n.parseFmtpConfig,Kn.parsePayloads=n.parsePayloads,Kn.parseRemoteCandidates=n.parseRemoteCandidates,Kn.parseImageAttributes=n.parseImageAttributes,Kn.parseSimulcastStreamList=n.parseSimulcastStreamList,Kn}var bs=_B();function Gm(n,e,t){var i,r,o;e===void 0&&(e=50),t===void 0&&(t={});var u=(i=t.isImmediate)!=null&&i,l=(r=t.callback)!=null&&r,f=t.maxWait,h=Date.now(),m=[];function g(){if(f!==void 0){var C=Date.now()-h;if(C+e>=f)return f-C}return e}var b=function(){var C=[].slice.call(arguments),E=this;return new Promise(function(k,_){var w=u&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,h=Date.now(),!u){var D=n.apply(E,C);l&&l(D),m.forEach(function(x){return(0,x.resolve)(D)}),m=[]}},g()),w){var O=n.apply(E,C);return l&&l(O),k(O)}m.push({resolve:k,reject:_})})};return b.cancel=function(C){o!==void 0&&clearTimeout(o),m.forEach(function(E){return(0,E.reject)(C)}),m=[]},b}const wB=.7,MB=20,ir={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class G0 extends hi.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=De,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Gm(r=>A(this,void 0,void 0,function*(){this.emit(ir.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(r)r(o);else throw o}}),MB),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Vi((i=t.loggerName)!==null&&i!==void 0?i:ei.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new nn}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var i;t.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,t.candidate))},e.onicecandidateerror=t=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,t)},e.ontrack=t=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return A(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return A(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:u}=NB(e);this.remoteStereoMids=o,this.remoteNackMids=u}else if(e.type==="answer"){const o=bs.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(u=>{const l=Ym(u.mid);u.type==="audio"&&this.trackBitrates.some(f=>{if(!f.transceiver||l!=f.transceiver.mid)return!1;let h=0;if(u.rtp.some(g=>g.codec.toUpperCase()===f.codec.toUpperCase()?(h=g.payload,!0):!1),h===0)return!0;let m=!1;for(const g of u.fmtp)if(g.payload===h){g.config=g.config.split(";").filter(b=>!b.includes("maxaveragebitrate")).join(";"),f.maxbr>0&&(g.config+=";maxaveragebitrate=".concat(f.maxbr*1e3)),m=!0;break}return m||f.maxbr>0&&u.fmtp.push({payload:h,config:"maxaveragebitrate=".concat(f.maxbr*1e3)}),!0})}),r=bs.write(o)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(ir.NegotiationComplete),e.sdp&&bs.parse(e.sdp).media.forEach(u=>{u.type==="video"&&this.emit(ir.RTPVideoPayloadTypes,u.rtp)})),!0})}createAndSendOffer(e){return A(this,void 0,void 0,function*(){var t;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const l=this._pc.remoteDescription;if(e?.iceRestart&&l)yield this._pc.setRemoteDescription(l);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const u=bs.parse((t=o.sdp)!==null&&t!==void 0?t:"");if(u.media.forEach(l=>{J0(l),l.type==="audio"?Y0(l,["all"],[]):l.type==="video"&&this.trackBitrates.some(f=>{if(!l.msid||!f.cid||!l.msid.includes(f.cid))return!1;let h=0;if(l.rtp.some(g=>g.codec.toUpperCase()===f.codec.toUpperCase()?(h=g.payload,!0):!1),h===0||(Qn(f.codec)&&!ta()&&this.ensureVideoDDExtensionForSVC(l,u),!Qn(f.codec)))return!0;const m=Math.round(f.maxbr*wB);for(const g of l.fmtp)if(g.payload===h){g.config.includes("x-google-start-bitrate")||(g.config+=";x-google-start-bitrate=".concat(m));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(o,bs.write(u)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return A(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),i=bs.parse((e=t.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{J0(r),r.type==="audio"&&Y0(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,bs.write(i)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTransceiverOfKind(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new Tt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new Tt("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return A(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(l=>{switch(l.type){case"transport":t=l.selectedCandidatePairId;break;case"candidate-pair":t===""&&l.selected&&(t=l.id),i.set(l.id,l);break;case"remote-candidate":r.set(l.id,"".concat(l.address,":").concat(l.port));break}}),t==="")return;const u=(e=i.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(u!==void 0)return r.get(u)})}setMungedSDP(e,t,i){return A(this,void 0,void 0,function*(){if(t){const r=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:t})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let o="unknown error";r instanceof Error?o=r.message:typeof r=="string"&&(o=r);const u={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(u.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:u})),new Za(o)}})}ensureVideoDDExtensionForSVC(e,t){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(u=>u.uri===N0))){if(this.ddExtID===0){let u=0;t.media.forEach(l=>{var f;l.type==="video"&&((f=l.ext)===null||f===void 0||f.forEach(h=>{h.value>u&&(u=h.value)}))}),this.ddExtID=u+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:N0})}}}function Y0(n,e,t){const i=Ym(n.mid);let r=0;n.rtp.some(o=>o.codec==="opus"?(r=o.payload,!0):!1),r>0&&(n.rtcpFb||(n.rtcpFb=[]),t.includes(i)&&!n.rtcpFb.some(o=>o.payload===r&&o.type==="nack")&&n.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&n.fmtp.some(o=>o.payload===r?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function NB(n){var e;const t=[],i=[],r=bs.parse((e=n.sdp)!==null&&e!==void 0?e:"");let o=0;return r.media.forEach(u=>{var l;const f=Ym(u.mid);u.type==="audio"&&(u.rtp.some(h=>h.codec==="opus"?(o=h.payload,!0):!1),!((l=u.rtcpFb)===null||l===void 0)&&l.some(h=>h.payload===o&&h.type==="nack")&&i.push(f),u.fmtp.some(h=>h.payload===o?(h.config.includes("sprop-stereo=1")&&t.push(f),!0):!1))}),{stereoMids:t,nackMids:i}}function J0(n){if(n.connection){const e=n.connection.ip.indexOf(":")>=0;(n.connection.version===4&&e||n.connection.version===6&&!e)&&(n.connection.ip="0.0.0.0",n.connection.version=4)}}function Ym(n){return typeof n=="number"?n.toFixed(0):n}const sm="vp8",OB={audioPreset:Jh.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Fm.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:sm,backupCodec:!0,preConnectBuffer:!1},Kk={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Gk={deviceId:{ideal:"default"},resolution:qo.h720.resolution},DB={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new l5,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},Jm={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var gt;(function(n){n[n.NEW=0]="NEW",n[n.CONNECTING=1]="CONNECTING",n[n.CONNECTED=2]="CONNECTED",n[n.FAILED=3]="FAILED",n[n.CLOSING=4]="CLOSING",n[n.CLOSED=5]="CLOSED"})(gt||(gt={}));class AB{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(e,t,i){var r;this.peerConnectionTimeout=Jm.peerConnectionTimeout,this.log=De,this.updateState=()=>{var o,u;const l=this.state,f=this.requiredTransports.map(h=>h.getConnectionState());f.every(h=>h==="connected")?this.state=gt.CONNECTED:f.some(h=>h==="failed")?this.state=gt.FAILED:f.some(h=>h==="connecting")?this.state=gt.CONNECTING:f.every(h=>h==="closed")?this.state=gt.CLOSED:f.some(h=>h==="closed")?this.state=gt.CLOSING:f.every(h=>h==="new")&&(this.state=gt.NEW),l!==this.state&&(this.log.debug("pc state change: from ".concat(gt[l]," to ").concat(gt[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),(u=this.subscriber)===null||u===void 0?void 0:u.getConnectionState()))},this.log=Vi((r=i.loggerName)!==null&&r!==void 0?r:ei.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=t!=="subscriber-primary",this.isSubscriberConnectionRequired=t==="subscriber-primary",this.publisher=new G0(e,i),this._mode=t,t!=="publisher-only"&&(this.subscriber=new G0(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=o=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,o,Jn.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var u;(u=this.onDataChannel)===null||u===void 0||u.call(this,o)},this.subscriber.onTrack=o=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,o)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,o,Jn.PUBLISHER)},this.publisher.onTrack=o=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,o)},this.publisher.onOffer=(o,u)=>{var l;(l=this.onPublisherOffer)===null||l===void 0||l.call(this,o,u)},this.state=gt.NEW,this.connectionLock=new nn,this.remoteOfferLock=new nn}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return A(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const t=this.publisher;for(const i of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return A(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return A(this,void 0,void 0,function*(){var i;t===Jn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return A(this,void 0,void 0,function*(){var i,r,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const u=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,t))?yield(o=this.subscriber)===null||o===void 0?void 0:o.createAndSetAnswer():void 0}finally{u()}})}updateConfiguration(e,t){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return A(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,t)))}finally{r()}})}negotiate(e){return A(this,void 0,void 0,function*(){return new Qt((t,i)=>A(this,void 0,void 0,function*(){const r=setTimeout(()=>{i(new Za("negotiation timed out"))},this.peerConnectionTimeout),o=()=>{clearTimeout(r),i(new Za("negotiation aborted"))};e.signal.addEventListener("abort",o),this.publisher.once(ir.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(ir.NegotiationComplete,()=>{clearTimeout(r),t()})}),yield this.publisher.negotiate(u=>{clearTimeout(r),u instanceof Error?i(u):i(new Error(String(u)))})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTransceiverOfKind(e,t){return this.publisher.addTransceiverOfKind(e,t)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Jn.PUBLISHER?this.publisher.getConnectedAddress():e===Jn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return A(this,arguments,void 0,function(i,r){var o=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((f,h)=>A(o,void 0,void 0,function*(){const m=()=>{this.log.warn("abort transport connection",this.logContext),Kt.clearTimeout(g),h(ke.cancelled("room connection has been cancelled"))};r?.signal.aborted&&m(),r?.signal.addEventListener("abort",m);const g=Kt.setTimeout(()=>{r?.signal.removeEventListener("abort",m),h(ke.internal("could not establish pc connection"))},u);for(;this.state!==gt.CONNECTED;)if(yield Gt(50),r?.signal.aborted){h(ke.cancelled("room connection has been cancelled"));return}Kt.clearTimeout(g),r?.signal.removeEventListener("abort",m),f()}))})()})}}const Yk=5e3,PB=3e4;class qe{static fetchRegionSettings(e,t,i){return A(this,void 0,void 0,function*(){const r=yield qe.fetchLock.lock();try{const o=yield fetch("".concat(LB(e),"/regions"),{headers:{authorization:"Bearer ".concat(t)},signal:i});if(o.ok){const u=iB(o.headers),l=u?u*1e3:Yk;return{regionSettings:yield o.json(),updatedAtInMs:Date.now(),maxAgeInMs:l}}else throw o.status===401?ke.notAllowed("Could not fetch region settings: ".concat(o.statusText),o.status):ke.internal("Could not fetch region settings: ".concat(o.statusText))}catch(o){throw o instanceof ke?o:i?.aborted?ke.cancelled("Region fetching was aborted"):ke.serverUnreachable("Could not fetch region settings, ".concat(o instanceof Error?"".concat(o.name,": ").concat(o.message):o))}finally{r()}})}static scheduleRefetch(e,t,i){return A(this,void 0,void 0,function*(){const r=qe.settingsTimeouts.get(e.hostname);clearTimeout(r),qe.settingsTimeouts.set(e.hostname,setTimeout(()=>A(this,void 0,void 0,function*(){try{const o=yield qe.fetchRegionSettings(e,t);qe.updateCachedRegionSettings(e,t,o)}catch(o){if(o instanceof ke&&o.reason===st.NotAllowed){De.debug("token is not valid, cancelling auto region refresh");return}De.debug("auto refetching of region settings failed",{error:o}),qe.scheduleRefetch(e,t,i)}}),i))})}static updateCachedRegionSettings(e,t,i){qe.cache.set(e.hostname,i),qe.scheduleRefetch(e,t,i.maxAgeInMs)}static stopRefetch(e){const t=qe.settingsTimeouts.get(e);t&&(clearTimeout(t),qe.settingsTimeouts.delete(e))}static scheduleCleanup(e){let t=qe.connectionTrackers.get(e);t&&(t.cleanupTimeout&&clearTimeout(t.cleanupTimeout),t.cleanupTimeout=setTimeout(()=>{const i=qe.connectionTrackers.get(e);i&&i.connectionCount===0&&(De.debug("stopping region refetch after disconnect delay",{hostname:e}),qe.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},PB))}static cancelCleanup(e){const t=qe.connectionTrackers.get(e);t?.cleanupTimeout&&(clearTimeout(t.cleanupTimeout),t.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let t=qe.connectionTrackers.get(e);t||(t={connectionCount:0},qe.connectionTrackers.set(e,t)),t.connectionCount++,qe.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,t=qe.connectionTrackers.get(e);t&&(t.connectionCount=Math.max(0,t.connectionCount-1),t.connectionCount===0&&qe.scheduleCleanup(e))}constructor(e,t){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return cr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return A(this,void 0,void 0,function*(){return qe.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return A(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let t=qe.cache.get(this.serverUrl.hostname);(!t||Date.now()-t.updatedAtInMs>t.maxAgeInMs)&&(t=yield this.fetchRegionSettings(e),qe.updateCachedRegionSettings(this.serverUrl,this.token,t));const i=t.regionSettings.regions.filter(r=>!this.attemptedRegions.find(o=>o.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),De.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){qe.updateCachedRegionSettings(this.serverUrl,this.token,e)}}qe.cache=new Map;qe.settingsTimeouts=new Map;qe.connectionTrackers=new Map;qe.fetchLock=new nn;function LB(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}class yt extends Error{constructor(e,t,i){super(t),this.code=e,this.message=Q0(t,yt.MAX_MESSAGE_BYTES),this.data=i?Q0(i,yt.MAX_DATA_BYTES):void 0}static fromProto(e){return new yt(e.code,e.message,e.data)}toProto(){return new jC({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new yt(yt.ErrorCode[e],yt.ErrorMessage[e],t)}}yt.MAX_MESSAGE_BYTES=256;yt.MAX_DATA_BYTES=15360;yt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};yt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Jk=15360;function Qm(n){return new TextEncoder().encode(n).length}function Q0(n,e){if(Qm(n)<=e)return n;let t=0,i=n.length;const r=new TextEncoder;for(;t<i;){const o=Math.floor((t+i+1)/2);r.encode(n.slice(0,o)).length<=e?t=o:i=o-1}return n.slice(0,t)}const Xm=2e3;function Eu(n,e){if(!e)return 0;let t,i;return"bytesReceived"in n?(t=n.bytesReceived,i=e.bytesReceived):"bytesSent"in n&&(t=n.bytesSent,i=e.bytesSent),t===void 0||i===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(t-i)*8*1e3/(n.timestamp-e.timestamp)}const Wm=typeof MediaRecorder<"u";class jB{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const IB=Wm?MediaRecorder:jB;class UB extends IB{constructor(e,t){if(!Wm)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),t);let i,r;const o=()=>r===void 0,u=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",u),this.removeEventListener("error",l),r?.close(),r=void 0},l=f=>{r?.error(f),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",u),this.removeEventListener("error",l),r=void 0};this.byteStream=new ReadableStream({start:f=>{r=f,i=h=>A(this,void 0,void 0,function*(){let m;if(h.data.arrayBuffer){const g=yield h.data.arrayBuffer();m=new Uint8Array(g)}else if(h.data.byteArray)m=h.data.byteArray;else throw new Error("no data available!");o()||f.enqueue(m)}),this.addEventListener("dataavailable",i)},cancel:()=>{u()}}),this.addEventListener("stop",u),this.addEventListener("error",l)}}function BB(){return Wm}const zB=1e3,VB=1e4;class Qk extends ee{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,t,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Gm(()=>A(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>A(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ce.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new nn,this.pauseUpstreamLock=new nn,this.trackChangeLock=new nn,this.trackChangeLock.lock().then(u=>A(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{u()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==ee.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return A(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{er(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ya(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{Ya(r??e,o)}))})}waitForDimensions(){return A(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:zB;return(function*(){var i;if(e.kind===ee.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=pn())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Gt(10));const r=Date.now();for(;Date.now()-r<t;){const o=e.dimensions;if(o)return o;yield Gt(50)}throw new Ui("unable to get track dimensions after timeout")})()})}setDeviceId(e){return A(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Ts(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Ts(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return A(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===ee.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),o=e.kind===ee.Kind.Audio?"audioinput":"videoinput";return t?zt.getInstance().normalizeDeviceId(o,i,r):i})()})}mute(){return A(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return A(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return A(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Ui("unable to replace an unpublished track");let r,o;return typeof t=="boolean"?r=t:t!==void 0&&(r=t.userProvidedTrack,o=t.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return A(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,o=u5(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const u={audio:!1,video:!1};this.kind===ee.Kind.Video?u.video=i||r?{deviceId:i,facingMode:r}:!0:u.audio=i?Object.assign({deviceId:i},o):!0,this.attachedElements.forEach(h=>{er(this.mediaStreamTrack,h)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const f=(yield navigator.mediaDevices.getUserMedia(u)).getTracks()[0];return this.kind===ee.Kind.Video&&(yield f.applyConstraints(o)),f.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(f),this._constraints=e,this.emit(ce.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ce.Muted:ce.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return A(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Fk()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return A(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ce.UpstreamPaused,this);const i=pn();if(i?.name==="Safari"&&di(i.version,"12.0")<0)throw new Vm("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return A(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ce.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return A(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return A(this,arguments,void 0,function(t){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const u=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const l=document.createElement(i.kind),f={kind:i.kind,track:i._mediaStreamTrack,element:l,audioContext:i.audioContext};if(yield t.init(f),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Ya(i._mediaStreamTrack,l),l.muted=!0,l.play().catch(h=>{h instanceof DOMException&&h.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:h})),setTimeout(()=>{l.play().catch(m=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:m}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:h}))}),i.processor=t,i.processorElement=l,i.processor.processedTrack){for(const h of i.attachedElements)h!==i.processorElement&&r&&(er(i._mediaStreamTrack,h),Ya(i.processor.processedTrack,h));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(ce.TrackProcessorUpdate,i.processor)}finally{u()}})()})}getProcessor(){return this.processor}stopProcessor(){return A(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{i()}})()})}internalStopProcessor(){return A(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,t||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(ce.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!BB()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let t="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(t)||(t="video/mp4"),this.localTrackRecorder=new UB(this,{mimeType:t})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},VB)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class nu extends Qk{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,ee.Kind.Audio,t,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>A(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let u;try{u=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}u&&this.prevStats&&(this._currentBitrate=Eu(u,this.prevStats)),this.prevStats=u}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ce.AudioTrackFeatureUpdate,this,Bt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ce.AudioTrackFeatureUpdate,this,Bt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return A(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ee.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return A(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Ts(this._constraints.deviceId);return this.source===ee.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return A(this,void 0,void 0,function*(){let t;if(e){const i=qm({audio:e});typeof i.audio!="boolean"&&(t=i.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return A(this,void 0,void 0,function*(){const i=yield t.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){mn()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Xm)))}setProcessor(e){return A(this,void 0,void 0,function*(){var t;const i=yield this.trackChangeLock.lock();try{if(!ui()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ce.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return A(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let i;return t.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return A(this,void 0,void 0,function*(){const e=yield Bk(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ce.AudioSilenceDetected)),e})}}function FB(n,e,t){switch(n.kind){case"audio":return new nu(n,e,!1,void 0,t);case"video":return new iu(n,e,!1,t);default:throw new Ui("unsupported track type: ".concat(n.kind))}}const qB=Object.values(qo),HB=Object.values(Qh),$B=Object.values(Fm),KB=[qo.h180,qo.h360],GB=[Qh.h180,Qh.h360],YB=n=>[{scaleResolutionDownBy:2,fps:n.encoding.maxFramerate}].map(t=>{var i,r;return new tt(Math.floor(n.width/t.scaleResolutionDownBy),Math.floor(n.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((i=n.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=t.fps)!==null&&r!==void 0?r:30))))),t.fps,n.encoding.priority)}),am=["q","h","f"];function rm(n,e,t,i){var r,o;let u=i?.videoEncoding;n&&(u=i?.screenShareEncoding);const l=i?.simulcast,f=i?.scalabilityMode,h=i?.videoCodec;if(!u&&!l&&!f||!e||!t)return[{}];u||(u=QB(n,e,t,h),De.debug("using video encoding",u));const m=u.maxFramerate,g=new tt(e,t,u.maxBitrate,u.maxFramerate,u.priority);if(f&&Qn(h)){const E=new Xk(f),k=[];if(E.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(f));const _=pn();if(Ho()||ui()||_?.name==="Chrome"&&di(_?.version,"113")<0){const w=E.suffix=="h"?2:3,O=$5(_);for(let D=0;D<E.spatial;D+=1)k.push({rid:am[2-D],maxBitrate:u.maxBitrate/Math.pow(w,D),maxFramerate:g.encoding.maxFramerate,scaleResolutionDownBy:O?Math.pow(2,D):void 0});k[0].scalabilityMode=f}else k.push({maxBitrate:u.maxBitrate,maxFramerate:g.encoding.maxFramerate,scalabilityMode:f});return g.encoding.priority&&(k[0].priority=g.encoding.priority,k[0].networkPriority=g.encoding.priority),De.debug("using svc encoding",{encodings:k}),k}if(!l)return[u];let b=[];n?b=(r=W0(i?.screenShareSimulcastLayers))!==null&&r!==void 0?r:X0(n,g):b=(o=W0(i?.videoSimulcastLayers))!==null&&o!==void 0?o:X0(n,g);let C;if(b.length>0){const E=b[0];b.length>1&&([,C]=b);const k=Math.max(e,t);if(k>=960&&C)return yh(e,t,[E,C,g],m);if(k>=480)return yh(e,t,[E,g],m)}return yh(e,t,[g])}function JB(n,e,t){var i,r,o,u;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&De.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const l=n.mediaStreamTrack.getSettings(),f=(i=l.width)!==null&&i!==void 0?i:(r=n.dimensions)===null||r===void 0?void 0:r.width,h=(o=l.height)!==null&&o!==void 0?o:(u=n.dimensions)===null||u===void 0?void 0:u.height;return n.source===ee.Source.ScreenShare&&t.simulcast&&(t.simulcast=!1),rm(n.source===ee.Source.ScreenShare,f,h,t)}function QB(n,e,t,i){const r=XB(n,e,t);let{encoding:o}=r[0];const u=Math.max(e,t);for(let l=0;l<r.length;l+=1){const f=r[l];if(o=f.encoding,f.width>=u)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function XB(n,e,t){if(n)return $B;const i=e>t?e/t:t/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?qB:HB}function X0(n,e){if(n)return YB(e);const{width:t,height:i}=e,r=t>i?t/i:i/t;return Math.abs(r-16/9)<Math.abs(r-4/3)?KB:GB}function yh(n,e,t,i){const r=[];if(t.forEach((o,u)=>{if(u>=am.length)return;const l=Math.min(n,e),h={rid:am[u],scaleResolutionDownBy:Math.max(1,l/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},m=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;m&&(h.maxFramerate=m);const g=ea()||u===0;o.encoding.priority&&g&&(h.priority=o.encoding.priority,h.networkPriority=o.encoding.priority),r.push(h)}),ui()&&Hk()==="ios"){let o;r.forEach(l=>{o?l.maxFramerate&&l.maxFramerate>o&&(o=l.maxFramerate):o=l.maxFramerate});let u=!0;r.forEach(l=>{var f;l.maxFramerate!=o&&(u&&(u=!1,De.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),De.info('Setting framerate of encoding "'.concat((f=l.rid)!==null&&f!==void 0?f:"",'" to ').concat(o)),l.maxFramerate=o)})}return r}function W0(n){if(n)return n.sort((e,t)=>{const{encoding:i}=e,{encoding:r}=t;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class Xk{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function WB(n){return n.source===ee.Source.ScreenShare||n.constraints.height&&Ts(n.constraints.height)>=1080?"maintain-resolution":"balanced"}const ZB=5e3;class iu extends Qk{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,ee.Kind.Video,t,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>A(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(f){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:f}));return}const u=new Map(o.map(f=>[f.rid,f])),l=o.some(f=>f.qualityLimitationReason==="cpu");if(l!==this.isCpuConstrained&&(this.isCpuConstrained=l,this.isCpuConstrained&&this.emit(ce.CpuConstrained)),this.prevStats){let f=0;u.forEach((h,m)=>{var g;const b=(g=this.prevStats)===null||g===void 0?void 0:g.get(m);f+=Eu(h,b)}),this._currentBitrate=f}this.prevStats=u}),this.senderLock=new nn}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!mn())return;const i=(t=this.sender)===null||t===void 0?void 0:t.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Xm))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return A(this,void 0,void 0,function*(){var t,i,r,o,u;yield e.pauseUpstream.call(this);try{for(var l=!0,f=Ii(this.simulcastCodecs.values()),h;h=yield f.next(),t=h.done,!t;l=!0)o=h.value,l=!1,yield(u=o.sender)===null||u===void 0?void 0:u.replaceTrack(null)}catch(m){i={error:m}}finally{try{!l&&!t&&(r=f.return)&&(yield r.call(f))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return A(this,void 0,void 0,function*(){var t,i,r,o,u;yield e.resumeUpstream.call(this);try{for(var l=!0,f=Ii(this.simulcastCodecs.values()),h;h=yield f.next(),t=h.done,!t;l=!0){o=h.value,l=!1;const m=o;yield(u=m.sender)===null||u===void 0?void 0:u.replaceTrack(m.mediaStreamTrack)}}catch(m){i={error:m}}finally{try{!l&&!t&&(r=f.return)&&(yield r.call(f))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return A(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ee.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return A(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===ee.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return A(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],i=yield this.sender.getStats();return i.forEach(r=>{var o;if(r.type==="outbound-rtp"){const u={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(o=r.rid)!==null&&o!==void 0?o:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},l=i.get(r.remoteId);l&&(u.jitter=l.jitter,u.packetsLost=l.packetsLost,u.roundTripTime=l.roundTripTime),t.push(u)}}),t.sort((r,o)=>{var u,l;return((u=o.frameWidth)!==null&&u!==void 0?u:0)-((l=r.frameWidth)!==null&&l!==void 0?l:0)}),t})}setPublishingQuality(e){const t=[];for(let i=Rn.LOW;i<=Rn.HIGH;i+=1)t.push(new jm({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Qn(this.codec),t)}restartTrack(e){return A(this,void 0,void 0,function*(){var t,i,r,o,u;let l;if(e){const g=qm({video:e});typeof g.video!="boolean"&&(l=g.video)}yield this.restart(l),this.isCpuConstrained=!1;try{for(var f=!0,h=Ii(this.simulcastCodecs.values()),m;m=yield h.next(),t=m.done,!t;f=!0){o=m.value,f=!1;const g=o;g.sender&&((u=g.sender.transport)===null||u===void 0?void 0:u.state)!=="closed"&&(g.mediaStreamTrack=this.mediaStreamTrack.clone(),yield g.sender.replaceTrack(g.mediaStreamTrack))}}catch(g){i={error:g}}finally{try{!f&&!t&&(r=h.return)&&(yield r.call(h))}finally{if(i)throw i.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return A(this,arguments,void 0,function(i){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var u,l,f,h,m,g;if(yield t.setProcessor.call(r,i,o),!((m=r.processor)===null||m===void 0)&&m.processedTrack)try{for(var b=!0,C=Ii(r.simulcastCodecs.values()),E;E=yield C.next(),u=E.done,!u;b=!0)h=E.value,b=!1,yield(g=h.sender)===null||g===void 0?void 0:g.replaceTrack(r.processor.processedTrack)}catch(k){l={error:k}}finally{try{!b&&!u&&(f=C.return)&&(yield f.call(C))}finally{if(l)throw l.error}}})()})}setDegradationPreference(e){return A(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,t){const i=this.simulcastCodecs.get(e);i&&(i.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},ZB))}setPublishingCodecs(e){return A(this,void 0,void 0,function*(){var t,i,r,o,u,l,f;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Qn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const h=[];try{for(t=!0,i=Ii(e);r=yield i.next(),o=r.done,!o;t=!0){f=r.value,t=!1;const m=f;if(!this.codec||this.codec===m.codec)yield this.setPublishingLayers(Qn(m.codec),m.qualities);else{const g=this.simulcastCodecs.get(m.codec);if(this.log.debug("try setPublishingCodec for ".concat(m.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:g})),!g||!g.sender){for(const b of m.qualities)if(b.enabled){h.push(m.codec);break}}else g.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(m.codec),this.logContext),yield Z0(g.sender,g.encodings,m.qualities,this.senderLock,Qn(m.codec),this.log,this.logContext))}}}catch(m){u={error:m}}finally{try{!t&&!o&&(l=i.return)&&(yield l.call(i))}finally{if(u)throw u.error}}return h})}setPublishingLayers(e,t){return A(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),!(!this.sender||!this.encodings)&&(yield Z0(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return A(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const t=this.sender.getParameters();t.encodings=t.encodings.map((i,r)=>{var o;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:r===0&&Qn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:t.encodings})),this.encodings=t.encodings,yield this.sender.setParameters(t)}catch(t){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:t})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return A(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Fk()&&this.isInBackground&&this.source===ee.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Z0(n,e,t,i,r,o,u){return A(this,void 0,void 0,function*(){const l=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},u),{sender:n,qualities:t,senderEncodings:e}));try{const f=n.getParameters(),{encodings:h}=f;if(!h)return;if(h.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},u),{encodings:h,senderEncodings:e}));return}let m=!1;!1&&h[0].scalabilityMode||(r&&t.some(C=>C.enabled)&&t.forEach(C=>C.enabled=!0),h.forEach((b,C)=>{var E;let k=(E=b.rid)!==null&&E!==void 0?E:"";k===""&&(k="q");const _=Wk(k),w=t.find(O=>O.quality===_);w&&b.active!==w.enabled&&(m=!0,b.active=w.enabled,o.debug("setting layer ".concat(w.quality," to ").concat(b.active?"enabled":"disabled"),u),ea()&&(w.enabled?(b.scaleResolutionDownBy=e[C].scaleResolutionDownBy,b.maxBitrate=e[C].maxBitrate,b.maxFrameRate=e[C].maxFrameRate):(b.scaleResolutionDownBy=4,b.maxBitrate=10,b.maxFrameRate=2)))})),m&&(f.encodings=h,o.debug("setting encodings",Object.assign(Object.assign({},u),{encodings:f.encodings})),yield n.setParameters(f))}finally{l()}})}function Wk(n){switch(n){case"f":return Rn.HIGH;case"h":return Rn.MEDIUM;case"q":return Rn.LOW;default:return Rn.HIGH}}function eS(n,e,t,i){if(!t)return[new ks({quality:Rn.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(i){const r=t[0].scalabilityMode,o=new Xk(r),u=[],l=o.suffix=="h"?1.5:2,f=o.suffix=="h"?2:3;for(let h=0;h<o.spatial;h+=1)u.push(new ks({quality:Math.min(Rn.HIGH,o.spatial-1)-h,width:Math.ceil(n/Math.pow(l,h)),height:Math.ceil(e/Math.pow(l,h)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(f,h)):0,ssrc:0}));return u}return t.map(r=>{var o,u,l;const f=(o=r.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let h=Wk((u=r.rid)!==null&&u!==void 0?u:"");return new ks({quality:h,width:Math.ceil(n/f),height:Math.ceil(e/f),bitrate:(l=r.maxBitrate)!==null&&l!==void 0?l:0,ssrc:0})})}const tS="_lossy",nS="_reliable",e6=2*1e3,bh="leave-reconnect",t6=3e4,n6=8*1024,i6=256*1024;var Bn;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(Bn||(Bn={}));class s6 extends hi.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Jm.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Bn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=De,this.reliableDataSequence=1,this.reliableMessageBuffer=new F0,this.reliableReceivedState=new EB(t6),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>A(this,[i],void 0,function(r){var o=this;let{channel:u}=r;return(function*(){if(u){if(u.label===nS)o.reliableDCSub=u;else if(u.label===tS)o.lossyDCSub=u;else return;o.log.debug("on data channel ".concat(u.id,", ").concat(u.label),o.logContext),u.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=i=>A(this,void 0,void 0,function*(){var r,o,u,l,f;const h=yield this.dataProcessLock.lock();try{let m;if(i.data instanceof ArrayBuffer)m=i.data;else if(i.data instanceof Blob)m=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const g=tn.fromBinary(new Uint8Array(m));if(g.sequence>0&&g.participantSid!==""){const b=this.reliableReceivedState.get(g.participantSid);if(b&&g.sequence<=b)return;this.reliableReceivedState.set(g.participantSid,g.sequence)}if(((r=g.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(ue.ActiveSpeakersUpdate,g.value.value.speakers);else if(((o=g.value)===null||o===void 0?void 0:o.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const b=yield(u=this.e2eeManager)===null||u===void 0?void 0:u.handleEncryptedData(g.value.value.encryptedValue,g.value.value.iv,g.participantIdentity,g.value.value.keyIndex),C=AC.fromBinary(b.payload),E=new tn({value:C.value,participantIdentity:g.participantIdentity,participantSid:g.participantSid});((l=E.value)===null||l===void 0?void 0:l.case)==="user"&&iS(E,E.value.value),this.emit(ue.DataPacketReceived,E,g.value.value.encryptionType)}else((f=g.value)===null||f===void 0?void 0:f.case)==="user"&&iS(g,g.value.value),this.emit(ue.DataPacketReceived,g,_t.NONE)}finally{h()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:u}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:u}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?Ae.LOSSY:Ae.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=f=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(f,"ms. giving up"),this.logContext),this.emit(ue.Disconnected),this.close()},u=Date.now()-this.reconnectStart;let l=this.getNextRetryDelay({elapsedMs:u,retryCount:this.reconnectAttempts});if(l===null){o(u);return}i===bh&&(l=0),this.log.debug("reconnecting in ".concat(l,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Kt.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),l)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Bn.Connected&&i();const o=()=>{this.off(ue.Disconnected,u),i()},u=()=>{this.off(ue.Restarted,o),r()};this.once(ue.Restarted,o),this.once(ue.Disconnected,u)}),this.updateAndEmitDCBufferStatus=i=>{if(i===Ae.RELIABLE){const o=this.dataChannelForKind(i);o&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(ue.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>A(this,void 0,void 0,function*(){!this.url||!(yield fetch($o(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===it.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===it.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Js.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>A(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch($o(this.url),{method:"HEAD"}),Gt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Vi((t=e.loggerName)!==null&&t!==void 0?t:ei.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new $m(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new nn,this.dataProcessLock=new nn,this.dcBufferStatus=new Map([[Ae.LOSSY,!0],[Ae.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(ue.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(ue.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(ue.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(ue.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(ue.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(ue.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(ue.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(ue.SignalRequestResponse,i)}get logContext(){var e,t,i,r,o,u;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(u=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||u===void 0?void 0:u.identity,pID:this.participantSid}}join(e,t,i,r){return A(this,arguments,void 0,function(o,u,l,f){var h=this;let m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){h.url=o,h.token=u,h.signalOpts=l,h.maxJoinAttempts=l.maxRetries;try{h.joinAttempts+=1,h.setupSignalClientCallbacks();const g=yield h.client.join(o,u,l,f,m);return h._isClosed=!1,h.latestJoinResponse=g,h.subscriberPrimary=g.subscriberPrimary,h.pcManager||(yield h.configure(g,!m)),(!h.subscriberPrimary||g.fastPublish)&&h.negotiate().catch(b=>{De.error(b,h.logContext)}),h.registerOnLineListener(),h.clientConfiguration=g.clientConfiguration,h.emit(ue.SignalConnected,g),g}catch(g){if(g instanceof ke){if(g.reason===st.ServerUnreachable){if(h.log.warn("Couldn't connect to server, attempt ".concat(h.joinAttempts," of ").concat(h.maxJoinAttempts),h.logContext),h.joinAttempts<h.maxJoinAttempts)return h.join(o,u,l,f,m)}else if(g.reason===st.ServiceNotFound)return h.log.warn("Initial connection failed: ".concat(g.message,"  Retrying")),h.join(o,u,l,f,!0)}throw g}})()})}close(){return A(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(ue.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return A(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new F0,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return A(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ui("a track with the same ID has already been published");return new Promise((t,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(ke.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(r),t(o)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return A(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e,t){return A(this,void 0,void 0,function*(){var i,r;if(this.pcManager&&this.pcManager.currentState!==gt.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const o=this.makeRTCConfiguration(e);this.pcManager=new AB(o,t?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(ue.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(u,l)=>{this.client.sendIceCandidate(u,l)},this.pcManager.onPublisherOffer=(u,l)=>{this.client.sendOffer(u,l)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(u,l,f)=>A(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(u),this.logContext),["closed","disconnected","failed"].includes(l)&&(this.publisherConnectionPromise=void 0),u===gt.CONNECTED){const g=this.pcState===Bn.New;this.pcState=Bn.Connected,g&&this.emit(ue.Connected,e)}else u===gt.FAILED&&(this.pcState===Bn.Connected||this.pcState===Bn.Reconnecting)&&(this.pcState=Bn.Disconnected,this.handleDisconnect("peerconnection failed",f==="failed"?Js.RR_SUBSCRIBER_FAILED:Js.RR_PUBLISHER_FAILED));const h=this.client.isDisconnected||this.client.currentState===it.RECONNECTING,m=[gt.FAILED,gt.CLOSING,gt.CLOSED].includes(u);h&&m&&!this._isClosed&&this.emit(ue.Offline)}),this.pcManager.onTrack=u=>{u.streams.length!==0&&this.emit(ue.MediaTrackAdded,u.track,u.streams[0],u.receiver)},a6((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t,i)=>A(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t,i)=>A(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);r&&this.client.sendAnswer(r,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(ue.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(ue.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var t;this.token=e,(t=this.regionUrlProvider)===null||t===void 0||t.updateToken(e)},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(ue.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(ue.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(ue.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var t,i;const r={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)(t=this.pcManager)===null||t===void 0||t.addPublisherTransceiverOfKind("audio",r);for(let o=0;o<e.numVideos;o++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Js.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Yk,regionSettings:e.regions})),e.action){case Xa.DISCONNECT:this.emit(ue.Disconnected,e?.reason),this.close();break;case Xa.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(bh);break;case Xa.RESUME:this.handleDisconnect(bh)}}}makeRTCConfiguration(e){var t;const i=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(o=>{const u={urls:o.urls};o.username&&(u.username=o.username),o.credential&&(u.credential=o.credential),r.push(u)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Bo.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(tS,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(nS,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(Ae.LOSSY);if(e){const t=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(t,n6),i6)}},1e3))}createSender(e,t,i){return A(this,void 0,void 0,function*(){if(Zh())return yield this.createTransceiverRTCRtpSender(e,t,i);if(em())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Tt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,i,r){return A(this,void 0,void 0,function*(){if(Zh())return this.createSimulcastTransceiverSender(e,t,i,r);if(em())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Tt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,i){return A(this,void 0,void 0,function*(){if(!this.pcManager)throw new Tt("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Ms(e)&&(e.codec=t.videoCodec);const o={direction:"sendonly",streams:r};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,t,i,r){return A(this,void 0,void 0,function*(){if(!this.pcManager)throw new Tt("publisher is closed");const o={direction:"sendonly"};r&&(o.sendEncodings=r);const u=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,u.sender),u.sender})}createRTCRtpSender(e){return A(this,void 0,void 0,function*(){if(!this.pcManager)throw new Tt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return A(this,void 0,void 0,function*(){var t,i,r;if(!this._isClosed){if(this.attemptingReconnect){De.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===Bo.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:gt.NEW)===gt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let u=!0;o instanceof Tt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),u=!1):o instanceof Ka||(this.fullReconnectOnNext=!0),u?this.handleDisconnect("reconnect",Js.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(ue.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return A(this,void 0,void 0,function*(){var t,i,r;try{if(!this.url||!this.token)throw new Tt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(ue.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Ka;o=yield this.join(e??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(u){throw u instanceof ke&&u.reason===st.NotAllowed?new Tt("could not reconnect, token might be expired"):new Ka}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(ue.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==it.CONNECTED)throw new Ka("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(ue.Restarted)}catch(o){const u=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(u){yield this.restartConnection(u);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),o}})}resumeConnection(e){return A(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new Tt("could not reconnect, url or token not saved");if(!this.pcManager)throw new Tt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(ue.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let o="";throw r instanceof Error&&(o=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof ke&&r.reason===st.NotAllowed?new Tt("could not reconnect, token might be expired"):r instanceof ke&&r.reason===st.LeaveRequest?r:new Ka(o)}if(this.emit(ue.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==it.CONNECTED)throw new Ka("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(ue.Resumed)})}waitForPCInitialConnection(e,t){return A(this,void 0,void 0,function*(){if(!this.pcManager)throw new Tt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return A(this,void 0,void 0,function*(){this.pcState=Bn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Gt(e6),!this.pcManager)throw new Tt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Bn.Connected}catch(e){throw this.pcState=Bn.Disconnected,ke.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,t,i,r){return A(this,void 0,void 0,function*(){const o=new tn({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcResponse",value:new Dm({requestId:t,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,Ae.RELIABLE)})}publishRpcAck(e,t){return A(this,void 0,void 0,function*(){const i=new tn({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcAck",value:new Om({requestId:t})}});yield this.sendDataPacket(i,Ae.RELIABLE)})}sendDataPacket(e,t){return A(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(t),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const o=hB(e);if(o){const u=yield this.e2eeManager.encryptData(o.toBinary());e.value={case:"encryptedPacket",value:new DC({encryptedValue:u.payload,iv:u.iv,keyIndex:u.keyIndex})}}}t===Ae.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(t);if(r){if(t===Ae.RELIABLE)yield this.waitForBufferStatusLow(t),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(t)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return A(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Ae.RELIABLE);const t=this.dataChannelForKind(Ae.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{t.send(i.data)})),this.updateAndEmitDCBufferStatus(Ae.RELIABLE)})}waitForBufferStatusLow(e){return new Qt((t,i)=>A(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const r=()=>i(new Tt("engine closed"));for(this.once(ue.Closing,r);!this.dcBufferStatus.get(e);)yield Gt(10);this.off(ue.Closing,r),t()}}))}ensureDataTransportConnected(e){return A(this,arguments,void 0,function(t){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!i.pcManager)throw new Tt("PC manager is closed");const u=r?i.pcManager.subscriber:i.pcManager.publisher,l=r?"Subscriber":"Publisher";if(!u)throw ke.internal("".concat(l," connection not set"));let f=!1;!r&&!i.dataChannelForKind(t,r)&&(i.createDataChannels(),f=!0),!f&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(f=!0),f&&i.negotiate().catch(g=>{De.error(g,i.logContext)});const h=i.dataChannelForKind(t,r);if(h?.readyState==="open")return;const m=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<m;){if(u.isICEConnected&&((o=i.dataChannelForKind(t,r))===null||o===void 0?void 0:o.readyState)==="open")return;yield Gt(50)}throw ke.internal("could not establish ".concat(l," connection, state: ").concat(u.getICEConnectionState()))})()})}ensurePublisherConnected(e){return A(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==gt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return A(this,void 0,void 0,function*(){return new Qt((e,t)=>A(this,void 0,void 0,function*(){if(!this.pcManager){t(new Za("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t(new Za("cannot negotiate on closed engine")),this.on(ue.Closing,r),this.pcManager.publisher.once(ir.RTPVideoPayloadTypes,o=>{const u=new Map;o.forEach(l=>{const f=l.codec.toLowerCase();Q5(f)&&u.set(l.payload,f)}),this.emit(ue.RTPVideoMapUpdate,u)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof Za&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Js.RR_UNKNOWN),o instanceof Error?t(o):t(new Error(String(o)))}finally{this.off(ue.Closing,r)}}))})}dataChannelForKind(e,t){if(t){if(e===Ae.LOSSY)return this.lossyDCSub;if(e===Ae.RELIABLE)return this.reliableDCSub}else{if(e===Ae.LOSSY)return this.lossyDC;if(e===Ae.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var i,r,o,u;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const l=this.pcManager.publisher.getLocalDescription(),f=this.pcManager.publisher.getRemoteDescription(),h=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),m=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),g=(u=(o=this.signalOpts)===null||o===void 0?void 0:o.autoSubscribe)!==null&&u!==void 0?u:!0,b=new Array,C=new Array;e.forEach(E=>{E.isDesired!==g&&b.push(E.trackSid),E.isEnabled||C.push(E.trackSid)}),this.client.sendSyncState(new Im({answer:this.pcManager.mode==="publisher-only"?f?Ja({sdp:f.sdp,type:f.type}):void 0:m?Ja({sdp:m.sdp,type:m.type}):void 0,offer:this.pcManager.mode==="publisher-only"?l?Ja({sdp:l.sdp,type:l.type}):void 0:h?Ja({sdp:h.sdp,type:h.type}):void 0,subscription:new Cu({trackSids:b,subscribe:!g,participantTracks:[]}),publishTracks:A5(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:C,datachannelReceiveStates:this.reliableReceivedState.map((E,k)=>new tk({publisherSid:k,lastSeq:E}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(i,r)=>{i?.id!==void 0&&i.id!==null&&e.push(new nk({label:i.label,id:i.id,target:r}))};return t(this.dataChannelForKind(Ae.LOSSY),Jn.PUBLISHER),t(this.dataChannelForKind(Ae.RELIABLE),Jn.PUBLISHER),t(this.dataChannelForKind(Ae.LOSSY,!0),Jn.SUBSCRIBER),t(this.dataChannelForKind(Ae.RELIABLE,!0),Jn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Kt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){mn()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){mn()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var t;const i=(t=this.pcManager)===null||t===void 0?void 0:t.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(o=>{let[u]=o;return u===i});if(r)return r[1]}}}function a6(n){return n!==void 0&&n>13}function iS(n,e){const t=n.participantIdentity?n.participantIdentity:e.participantIdentity;n.participantIdentity=t,e.participantIdentity=t;const i=n.destinationIdentities.length!==0?n.destinationIdentities:e.destinationIdentities;n.destinationIdentities=i,e.destinationIdentities=i}class Zk{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new zn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),en.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new zn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),en.LengthExceeded)}}constructor(e,t,i,r){this.reader=t,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class r6 extends Zk{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new Fn,i=null,r=null;if(this.signal){const u=this.signal;r=()=>{var l;(l=t.reject)===null||l===void 0||l.call(t,u.reason)},u.addEventListener("abort",r),i=u}const o=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>A(this,void 0,void 0,function*(){var u,l;try{const{done:f,value:h}=yield Promise.race([e.read(),t.promise,(l=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);return f?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(h),{done:!1,value:h.content})}catch(f){throw o(),f}}),return(){return A(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return A(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,u;let l=new Set;const f=t.signal?e.withAbortSignal(t.signal):e;try{for(var h=!0,m=Ii(f),g;g=yield m.next(),i=g.done,!i;h=!0){u=g.value,h=!1;const b=u;l.add(b)}}catch(b){r={error:b}}finally{try{!h&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(r)throw r.error}}return Array.from(l)})()})}}class o6 extends Zk{constructor(e,t,i,r){super(e,t,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var t;const i=Vl(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let i=new Fn,r=null,o=null;if(this.signal){const l=this.signal;o=()=>{var f;(f=i.reject)===null||f===void 0||f.call(i,l.reason)},l.addEventListener("abort",o),r=l}const u=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>A(this,void 0,void 0,function*(){var l,f;try{const{done:h,value:m}=yield Promise.race([e.read(),i.promise,(f=(l=this.outOfBandFailureRejectingFuture)===null||l===void 0?void 0:l.promise)!==null&&f!==void 0?f:new Promise(()=>{})]);if(h)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(m);let g;try{g=t.decode(m.content)}catch(b){throw new zn("Cannot decode datastream chunk ".concat(m.chunkIndex," as text: ").concat(b),en.DecodeFailed)}return{done:!1,value:g}}}catch(h){throw u(),h}}),return(){return A(this,void 0,void 0,function*(){return u(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return A(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,u;let l="";const f=t.signal?e.withAbortSignal(t.signal):e;try{for(var h=!0,m=Ii(f),g;g=yield m.next(),i=g.done,!i;h=!0)u=g.value,h=!1,l+=u}catch(b){r={error:b}}finally{try{!h&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(r)throw r.error}}return l})()})}}class c6{constructor(){this.log=De,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new zn('A text stream handler for topic "'.concat(e,'" has already been set.'),en.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new zn('A byte stream handler for topic "'.concat(e,'" has already been set.'),en.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,i,r,o;const u=Array.from(this.textStreamControllers.entries()).filter(f=>f[1].sendingParticipantIdentity===e),l=Array.from(this.byteStreamControllers.entries()).filter(f=>f[1].sendingParticipantIdentity===e);if(u.length>0||l.length>0){const f=new zn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),en.AbnormalEnd);for(const[h,m]of l)(i=(t=m.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(t,f),this.byteStreamControllers.delete(h);for(const[h,m]of u)(o=(r=m.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(r,f),this.textStreamControllers.delete(h)}}handleDataStreamPacket(e,t){return A(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,t);case"streamChunk":return this.handleStreamChunk(e.value.value,t);case"streamTrailer":return this.handleStreamTrailer(e.value.value,t);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,t,i){return A(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let u;const l=new Fn;l.promise.catch(m=>{this.log.error(m)});const f={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Vl(e.timestamp),attributes:e.attributes,encryptionType:i},h=new ReadableStream({start:m=>{if(u=m,this.textStreamControllers.has(e.streamId))throw new zn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),en.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:f,controller:u,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:l})}});o(new r6(f,h,Vl(e.totalLength),l),{identity:t})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let u;const l=new Fn;l.promise.catch(m=>{this.log.error(m)});const f={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i,attachedStreamIds:e.contentHeader.value.attachedStreamIds},h=new ReadableStream({start:m=>{if(u=m,this.textStreamControllers.has(e.streamId))throw new zn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),en.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:f,controller:u,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:l})}});o(new o6(f,h,Vl(e.totalLength),l),{identity:t})}})}handleStreamChunk(e,t){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?(i.controller.error(new zn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),en.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==t?(r.controller.error(new zn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(r.info.encryptionType),en.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,t){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?i.controller.error(new zn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),en.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==t?r.controller.error(new zn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(r.info.encryptionType),en.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class eT{constructor(e,t,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return A(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class l6 extends eT{}class u6 extends eT{}const sS=15e3;class d6{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return A(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),u=new TextEncoder().encode(e).byteLength,l=(i=t?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),f=new Array(l?l.length+1:1).fill(0),h=(g,b)=>{var C;f[b]=g;const E=f.reduce((k,_)=>k+_,0);(C=t?.onProgress)===null||C===void 0||C.call(t,E)},m=yield this.streamText({streamId:r,totalSize:u,destinationIdentities:t?.destinationIdentities,topic:t?.topic,attachedStreamIds:l,attributes:t?.attributes});return yield m.write(e),h(1,0),yield m.close(),t?.attachments&&l&&(yield Promise.all(t.attachments.map((g,b)=>A(this,void 0,void 0,function*(){return this._sendFile(l[b],g,{topic:t.topic,mimeType:g.type,onProgress:C=>{h(C,b+1)}})})))),m.info})}streamText(e){return A(this,void 0,void 0,function*(){var t,i,r;const o=(t=e?.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),u={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e?.topic)!==null&&i!==void 0?i:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?_t.GCM:_t.NONE,attachedStreamIds:e?.attachedStreamIds},l=new Zl({streamId:o,mimeType:u.mimeType,topic:u.topic,timestamp:Qs(u.timestamp),totalLength:Qs(e?.totalSize),attributes:u.attributes,contentHeader:{case:"textHeader",value:new HC({version:e?.version,attachedStreamIds:u.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?Uh.UPDATE:Uh.CREATE})}}),f=e?.destinationIdentities,h=new tn({destinationIdentities:f,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(h,Ae.RELIABLE);let m=0;const g=this.engine,b=new WritableStream({write(k){return A(this,void 0,void 0,function*(){for(const _ of nB(k,sS)){const w=new eu({content:_,streamId:o,chunkIndex:Qs(m)}),O=new tn({destinationIdentities:f,value:{case:"streamChunk",value:w}});yield g.sendDataPacket(O,Ae.RELIABLE),m+=1}})},close(){return A(this,void 0,void 0,function*(){const k=new tu({streamId:o}),_=new tn({destinationIdentities:f,value:{case:"streamTrailer",value:k}});yield g.sendDataPacket(_,Ae.RELIABLE)})},abort(k){console.log("Sink error:",k)}});let C=()=>A(this,void 0,void 0,function*(){yield E.close()});g.once(ue.Closing,C);const E=new l6(b,u,()=>this.engine.off(ue.Closing,C));return E})}sendFile(e,t){return A(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,t),{id:i}})}_sendFile(e,t,i){return A(this,void 0,void 0,function*(){var r;const o=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:(r=i?.mimeType)!==null&&r!==void 0?r:t.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),u=t.stream().getReader();for(;;){const{done:l,value:f}=yield u.read();if(l)break;yield o.write(f)}return yield o.close(),o.info})}streamBytes(e){return A(this,void 0,void 0,function*(){var t,i,r,o,u,l;const f=(t=e?.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),h=e?.destinationIdentities,m={id:f,mimeType:(i=e?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e?.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(o=e?.name)!==null&&o!==void 0?o:"unknown",encryptionType:!((u=this.engine.e2eeManager)===null||u===void 0)&&u.isDataChannelEncryptionEnabled?_t.GCM:_t.NONE},g=new Zl({totalLength:Qs((l=m.size)!==null&&l!==void 0?l:0),mimeType:m.mimeType,streamId:f,topic:m.topic,timestamp:Qs(Date.now()),attributes:m.attributes,contentHeader:{case:"byteHeader",value:new $C({name:m.name})}}),b=new tn({destinationIdentities:h,value:{case:"streamHeader",value:g}});yield this.engine.sendDataPacket(b,Ae.RELIABLE);let C=0;const E=new nn,k=this.engine,_=this.log,w=new WritableStream({write(D){return A(this,void 0,void 0,function*(){const x=yield E.lock();let R=0;try{for(;R<D.byteLength;){const M=D.slice(R,R+sS),L=new tn({destinationIdentities:h,value:{case:"streamChunk",value:new eu({content:M,streamId:f,chunkIndex:Qs(C)})}});yield k.sendDataPacket(L,Ae.RELIABLE),C+=1,R+=M.byteLength}}finally{x()}})},close(){return A(this,void 0,void 0,function*(){const D=new tu({streamId:f}),x=new tn({destinationIdentities:h,value:{case:"streamTrailer",value:D}});yield k.sendDataPacket(x,Ae.RELIABLE)})},abort(D){_.error("Sink error:",D)}});return new u6(w,m)})}}class tT extends ee{constructor(e,t,i,r,o){super(e,i,o),this.sid=t,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ce.Muted:ce.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ce.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return A(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Xm)),P5()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(t=this.receiver)===null||t===void 0?void 0:t.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(ce.TimeSyncUpdate,{timestamp:r,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class nT extends tT{constructor(e,t,i,r,o,u){super(e,t,ee.Kind.Audio,i,u),this.monitorReceiver=()=>A(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=Eu(l,this.prevStats)),this.prevStats=l}),this.audioContext=r,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var t;for(const i of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):i.volume=e;ui()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ui())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return A(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(tm(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&tm(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(ce.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(ce.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return A(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(i=>{i.type==="inbound-rtp"&&(t={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),t})}}const Sh=100;class f6 extends tT{constructor(e,t,i,r,o){super(e,t,ee.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>A(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=Eu(u,this.prevStats)),this.prevStats=u}),this.debouncedHandleResize=Gm(()=>{this.updateDimensions()},Sh),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===ee.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?er(this._mediaStreamTrack,t):Ya(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new h6(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(i=>i===e);for(const i of t)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const i of t)this.stopObservingElement(i);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return A(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,i="",r=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,t={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&r.set(o.id,o)}),t&&i!==""&&r.get(i)&&(t.mimeType=r.get(i).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(i=>i.element===e);for(const i of t)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return A(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var t,i;const r=this.elementInfos.reduce((f,h)=>Math.max(f,h.visibilityChangedAt||0),0),o=!((i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,u=this.elementInfos.some(f=>f.pictureInPicture),l=this.elementInfos.some(f=>f.visible)&&!o||u;if(!(this.lastVisible===l&&!e)){if(!l&&Date.now()-r<Sh){Kt.setTimeout(()=>{this.updateVisibility()},Sh);return}this.lastVisible=l,this.emit(ce.VisibilityChanged,l,this)}}updateDimensions(){var e,t;let i=0,r=0;const o=this.getPixelDensity();for(const u of this.elementInfos){const l=u.width()*o,f=u.height()*o;l+f>i+r&&(i=l,r=f)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===r||(this.lastDimensions={width:i,height:r},this.emit(ce.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?D0():t||(D0()>2?2:1)}}class h6{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=i=>{var r;const{target:o,isIntersecting:u}=i;o===this.element&&(this.isIntersecting=u,this.isPiP=ko(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,o;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=ko(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=ko(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=t??om(e),this.isPiP=mn()&&ko(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,i;this.isIntersecting=om(this.element),this.isPiP=ko(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,P0().observe(this.element),A0().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,i,r,o;(e=P0())===null||e===void 0||e.unobserve(this.element),(t=A0())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function ko(n){var e,t;return document.pictureInPictureElement===n?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?om(n,(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window):!1}function om(n,e){const t=e||window;let i=n.offsetTop,r=n.offsetLeft;const o=n.offsetWidth,u=n.offsetHeight,{hidden:l}=n,{display:f}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,i+=n.offsetTop,r+=n.offsetLeft;return i<t.pageYOffset+t.innerHeight&&r<t.pageXOffset+t.innerWidth&&i+u>t.pageYOffset&&r+o>t.pageXOffset&&!l&&f!=="none"}class Pi extends hi.EventEmitter{constructor(e,t,i,r){var o;super(),this.metadataMuted=!1,this.encryption=_t.NONE,this.log=De,this.handleMuted=()=>{this.emit(ce.Muted)},this.handleUnmuted=()=>{this.emit(ce.Unmuted)},this.log=Vi((o=r?.loggerName)!==null&&o!==void 0?o:ei.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=i,this.source=ee.Source.Unknown}setTrack(e){this.track&&(this.track.off(ce.Muted,this.handleMuted),this.track.off(ce.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ce.Muted,this.handleMuted),e.on(ce.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ie(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==_t.NONE}get audioTrack(){if(ci(this.track))return this.track}get videoTrack(){if(Ms(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=ee.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===ee.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(n.PermissionStatus||(n.PermissionStatus={}))})(Pi||(Pi={}));class cm extends Pi{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,i,r){super(e,t.sid,t.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ce.Ended)},this.handleCpuConstrained=()=>{this.track&&Ms(this.track)&&this.emit(ce.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(ce.Ended,this.handleTrackEnded),this.track.off(ce.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(ce.Ended,this.handleTrackEnded),e.on(ce.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return A(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return A(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return A(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return A(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ci(this.track)){const t=this.track.getSourceTrackSettings(),i=new Set;return t.autoGainControl&&i.add(Bt.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&i.add(Bt.TF_ECHO_CANCELLATION),t.noiseSuppression&&i.add(Bt.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&i.add(Bt.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Bt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Bt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function xu(n,e){return A(this,void 0,void 0,function*(){n??(n={});let t=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=Vk(n);let u=o.audio,l=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),r&&typeof o.video=="object"&&(o.video.processor=r),n.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const g=o.audio.deviceId;o.audio.deviceId={exact:g},t=!0,u=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:g}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const g=o.video.deviceId;o.video.deviceId={exact:g},t=!0,l=Object.assign(Object.assign({},o.video),{deviceId:{ideal:g}})}o.audio===!0?o.audio={deviceId:"default"}:typeof o.audio=="object"&&o.audio!==null&&(o.audio=Object.assign(Object.assign({},o.audio),{deviceId:o.audio.deviceId||"default"})),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const f=Uk(o,Kk,Gk),h=qm(f),m=navigator.mediaDevices.getUserMedia(h);o.audio&&(zt.userMediaPromiseMap.set("audioinput",m),m.catch(()=>zt.userMediaPromiseMap.delete("audioinput"))),o.video&&(zt.userMediaPromiseMap.set("videoinput",m),m.catch(()=>zt.userMediaPromiseMap.delete("videoinput")));try{const g=yield m;return yield Promise.all(g.getTracks().map(b=>A(this,void 0,void 0,function*(){const C=b.kind==="audio";let E=C?f.audio:f.video;(typeof E=="boolean"||!E)&&(E={});let k;const _=C?h.audio:h.video;typeof _!="boolean"&&(k=_);const w=b.getSettings().deviceId;k?.deviceId&&Ts(k.deviceId)!==w?k.deviceId=w:k||(k={deviceId:w});const O=FB(b,k,e);return O.kind===ee.Kind.Video?O.source=ee.Source.Camera:O.kind===ee.Kind.Audio&&(O.source=ee.Source.Microphone),O.mediaStream=g,ci(O)&&i?yield O.setProcessor(i):Ms(O)&&r&&(yield O.setProcessor(r)),O})))}catch(g){if(!t)throw g;return xu(Object.assign(Object.assign({},n),{audio:u,video:l}),e)}})}function m6(n){return A(this,void 0,void 0,function*(){return(yield xu({audio:!1,video:!0}))[0]})}function p6(n){return A(this,void 0,void 0,function*(){return(yield xu({audio:!0,video:!1}))[0]})}var Ss;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Lost="lost",n.Unknown="unknown"})(Ss||(Ss={}));function g6(n){switch(n){case Ro.EXCELLENT:return Ss.Excellent;case Ro.GOOD:return Ss.Good;case Ro.POOR:return Ss.Poor;case Ro.LOST:return Ss.Lost;default:return Ss.Unknown}}class iT extends hi.EventEmitter{get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===zo.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Qa.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,i,r,o,u){let l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:zo.STANDARD;var f;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ss.Unknown,this.log=De,this.log=Vi((f=u?.loggerName)!==null&&f!==void 0?f:ei.Participant),this.loggerOptions=u,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=l,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Fn,this.once(ie.Active,()=>{var e,t;(t=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||t===void 0||t.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(ee.Source.Camera);return!(!((e=t?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(ee.Source.Microphone);return!(!((e=t?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(ee.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var t;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Qa.ACTIVE&&((t=this.participantInfo)===null||t===void 0?void 0:t.state)!==Qa.ACTIVE&&this.emit(ie.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,i=this.metadata;this.metadata=e,t&&this.emit(ie.ParticipantMetadataChanged,i)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ie.ParticipantNameChanged,e)}_setAttributes(e){const t=L5(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(ie.AttributesChanged,t)}setPermissions(e){var t,i,r,o,u,l;const f=this.permissions,h=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((u=this.permissions)===null||u===void 0?void 0:u.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((m,g)=>{var b;return m!==((b=this.permissions)===null||b===void 0?void 0:b.canPublishSources[g])})||e.canSubscribeMetrics!==((l=this.permissions)===null||l===void 0?void 0:l.canSubscribeMetrics);return this.permissions=e,h&&this.emit(ie.ParticipantPermissionsChanged,f),h}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ie.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=g6(e),t!==this._connectionQuality&&this.emit(ie.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&((t=(e=this.activeFuture).reject)===null||t===void 0||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>ci(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(ce.Muted,()=>{this.emit(ie.TrackMuted,e)}),e.on(ce.Unmuted,()=>{this.emit(ie.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case ee.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case ee.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function v6(n){var e,t,i;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new ZC({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=n.participantSid)!==null&&t!==void 0?t:"",allTracks:(i=n.allowAll)!==null&&i!==void 0?i:!1,trackSids:n.allowedTrackSids||[]})}class y6 extends iT{constructor(e,t,i,r,o,u){super(e,t,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=_t.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Fn)},this.handleReconnected=()=>{var l,f;(f=(l=this.reconnectFuture)===null||l===void 0?void 0:l.resolve)===null||f===void 0||f.call(l),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var l,f,h,m,g,b;this.reconnectFuture&&(this.reconnectFuture.promise.catch(C=>this.log.warn(C.message,this.logContext)),(f=(l=this.reconnectFuture)===null||l===void 0?void 0:l.reject)===null||f===void 0||f.call(l,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((m=(h=this.signalConnectedFuture).reject)===null||m===void 0||m.call(h,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(b=(g=this.activeAgentFuture)===null||g===void 0?void 0:g.reject)===null||b===void 0||b.call(g,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=l=>{var f,h;l.participant&&this.updateInfo(l.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Fn),(h=(f=this.signalConnectedFuture).resolve)===null||h===void 0||h.call(f)},this.handleSignalRequestResponse=l=>{const{requestId:f,reason:h,message:m}=l,g=this.pendingSignalRequests.get(f);g&&(h!==Um.OK&&g.reject(new _0(m,h)),this.pendingSignalRequests.delete(f))},this.handleDataPacket=l=>{switch(l.value.case){case"rpcResponse":let f=l.value.value,h=null,m=null;f.value.case==="payload"?h=f.value.value:f.value.case==="error"&&(m=yt.fromProto(f.value.value)),this.handleIncomingRpcResponse(f.requestId,h,m);break;case"rpcAck":let g=l.value.value;this.handleIncomingRpcAck(g.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(l=>v6(l)))},this.onTrackUnmuted=l=>{this.onTrackMuted(l,l.isUpstreamPaused)},this.onTrackMuted=(l,f)=>{if(f===void 0&&(f=!0),!l.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Ie(l)));return}this.engine.updateMuteStatus(l.sid,f)},this.onTrackUpstreamPaused=l=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Ie(l))),this.onTrackMuted(l,!0)},this.onTrackUpstreamResumed=l=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Ie(l))),this.onTrackMuted(l,l.isMuted)},this.onTrackFeatureUpdate=l=>{const f=this.audioTrackPublications.get(l.sid);if(!f){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(l.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(f.trackSid,f.getTrackFeatures())},this.onTrackCpuConstrained=(l,f)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Ie(f))),this.emit(ie.LocalTrackCpuConstrained,l,f)},this.handleSubscribedQualityUpdate=l=>A(this,void 0,void 0,function*(){var f,h,m,g,b;if(!(!((b=this.roomOptions)===null||b===void 0)&&b.dynacast))return;const C=this.videoTrackPublications.get(l.trackSid);if(!C){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}if(!C.videoTrack)return;const E=yield C.videoTrack.setPublishingCodecs(l.subscribedCodecs);try{for(var k=!0,_=Ii(E),w;w=yield _.next(),f=w.done,!f;k=!0){g=w.value,k=!1;const O=g;N5(O)&&(this.log.debug("publish ".concat(O," for ").concat(C.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Ie(C))),yield this.publishAdditionalCodecForTrack(C.videoTrack,O,C.options))}}catch(O){h={error:O}}finally{try{!k&&!f&&(m=_.return)&&(yield m.call(_))}finally{if(h)throw h.error}}}),this.handleLocalTrackUnpublished=l=>{const f=this.trackPublications.get(l.trackSid);if(!f){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}this.unpublishTrack(f.track)},this.handleTrackEnded=l=>A(this,void 0,void 0,function*(){if(l.source===ee.Source.ScreenShare||l.source===ee.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Ie(l))),this.unpublishTrack(l);else if(l.isUserProvided)yield l.mute();else if(Ai(l)||ys(l))try{if(mn())try{const f=yield navigator?.permissions.query({name:l.source===ee.Source.Camera?"camera":"microphone"});if(f&&f.state==="denied")throw this.log.warn("user has revoked access to ".concat(l.source),Object.assign(Object.assign({},this.logContext),Ie(l))),f.onchange=()=>{f.state!=="denied"&&(l.isMuted||l.restartTrack(),f.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}l.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Ie(l))),Ai(l)?yield l.restartTrack({deviceId:"default"}):yield l.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Ie(l))),yield l.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=u}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==_t.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(ue.RemoteMute,(i,r)=>{const o=this.trackPublications.get(i);!o||!o.track||(r?o.mute():o.unmute())}),!((t=this.signalConnectedFuture)===null||t===void 0)&&t.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(ue.Connected,this.handleReconnected).on(ue.SignalConnected,this.handleSignalConnected).on(ue.SignalRestarted,this.handleReconnected).on(ue.SignalResumed,this.handleReconnected).on(ue.Restarting,this.handleReconnecting).on(ue.Resuming,this.handleReconnecting).on(ue.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(ue.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(ue.Closing,this.handleClosing).on(ue.SignalRequestResponse,this.handleSignalRequestResponse).on(ue.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return A(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return A(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return A(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return A(this,arguments,void 0,function(t){var i=this;let{metadata:r,name:o,attributes:u}=t;return(function*(){return new Qt((l,f)=>A(i,void 0,void 0,function*(){var h,m;try{let g=!1;const b=yield this.engine.client.sendUpdateLocalMetadata((h=r??this.metadata)!==null&&h!==void 0?h:"",(m=o??this.name)!==null&&m!==void 0?m:"",u),C=performance.now();for(this.pendingSignalRequests.set(b,{resolve:l,reject:E=>{f(E),g=!0},values:{name:o,metadata:r,attributes:u}});performance.now()-C<5e3&&!g;){if((!o||this.name===o)&&(!r||this.metadata===r)&&(!u||Object.entries(u).every(E=>{let[k,_]=E;return this.attributes[k]===_||_===""&&!this.attributes[k]}))){this.pendingSignalRequests.delete(b),l();return}yield Gt(50)}f(new _0("Request to update local metadata timed out","TimeoutError"))}catch(g){g instanceof Error?f(g):f(new Error(String(g)))}}))})()})}setCameraEnabled(e,t,i){return this.setTrackEnabled(ee.Source.Camera,e,t,i)}setMicrophoneEnabled(e,t,i){return this.setTrackEnabled(ee.Source.Microphone,e,t,i)}setScreenShareEnabled(e,t,i){return this.setTrackEnabled(ee.Source.ScreenShare,e,t,i)}setE2EEEnabled(e){return A(this,void 0,void 0,function*(){this.encryptionType=e?_t.GCM:_t.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,i,r){return A(this,void 0,void 0,function*(){var o,u;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let l=this.getTrackPublication(e);if(t)if(l)yield l.unmute();else{let f;if(this.pendingPublishing.has(e)){const h=yield this.waitForPendingPublicationOfSource(e);return h||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield h?.unmute(),h}this.pendingPublishing.add(e);try{switch(e){case ee.Source.Camera:f=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case ee.Source.Microphone:f=yield this.createTracks({audio:(u=i)!==null&&u!==void 0?u:!0});break;case ee.Source.ScreenShare:f=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Ui(e)}}catch(h){throw f?.forEach(m=>{m.stop()}),h instanceof Error&&this.emit(ie.MediaDevicesError,h,Wh(e)),this.pendingPublishing.delete(e),h}for(const h of f){const m=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===ee.Source.Microphone&&ci(h)&&m.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),h.startPreConnectBuffer())}try{const h=[];for(const g of f)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Ie(g))),h.push(this.publishTrack(g,r));[l]=yield Promise.all(h)}catch(h){throw f?.forEach(m=>{m.stop()}),h}finally{this.pendingPublishing.delete(e)}}else if(!l?.track&&this.pendingPublishing.has(e)&&(l=yield this.waitForPendingPublicationOfSource(e),l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),l&&l.track)if(e===ee.Source.ScreenShare){l=yield this.unpublishTrack(l.track);const f=this.getTrackPublication(ee.Source.ScreenShareAudio);f&&f.track&&this.unpublishTrack(f.track)}else yield l.mute();return l})}enableCameraAndMicrophone(){return A(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(ee.Source.Camera)||this.pendingPublishing.has(ee.Source.Microphone))){this.pendingPublishing.add(ee.Source.Camera),this.pendingPublishing.add(ee.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(ee.Source.Camera),this.pendingPublishing.delete(ee.Source.Microphone)}}})}createTracks(e){return A(this,void 0,void 0,function*(){var t,i;e??(e={});const r=Uk(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield xu(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(l=>(ci(l)&&(this.microphoneError=void 0,l.setAudioContext(this.audioContext),l.source=ee.Source.Microphone,this.emit(ie.AudioStreamAcquired)),Ms(l)&&(this.cameraError=void 0,l.source=ee.Source.Camera),l))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return A(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Vm("getDisplayMedia not supported");e.resolution===void 0&&!H5()&&(e.resolution=Fm.h1080fps30.resolution);const t=D5(e),i=yield navigator.mediaDevices.getDisplayMedia(t),r=i.getVideoTracks();if(r.length===0)throw new Ui("no video track found");const o=new iu(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=ee.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const u=[o];if(i.getAudioTracks().length>0){this.emit(ie.AudioStreamAcquired);const l=new nu(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=ee.Source.ScreenShareAudio,u.push(l)}return u})}publishTrack(e,t){return A(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return A(this,arguments,void 0,function(i,r){var o=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var l,f,h,m;Ai(i)&&i.setAudioContext(o.audioContext),yield(l=o.reconnectFuture)===null||l===void 0?void 0:l.promise,o.republishPromise&&!u&&(yield o.republishPromise),tr(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let g;if(i instanceof MediaStreamTrack)g=i.getConstraints();else{g=i.constraints;let w;switch(i.source){case ee.Source.Microphone:w="audioinput";break;case ee.Source.Camera:w="videoinput"}w&&o.activeDeviceMap.has(w)&&(g=Object.assign(Object.assign({},g),{deviceId:o.activeDeviceMap.get(w)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new nu(i,g,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new iu(i,g,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new Ui("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let b;if(o.trackPublications.forEach(w=>{w.track&&w.track===i&&(b=w)}),b)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),Ie(b))),b;const C=Object.assign(Object.assign({},o.roomOptions.publishDefaults),r),E="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,k=(f=C.forceStereo)!==null&&f!==void 0?f:E;k&&(C.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),Ie(i))),C.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(h=C.dtx)!==null&&h!==void 0||(C.dtx=!1),(m=C.red)!==null&&m!==void 0||(C.red=!1)),!K5()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),C.simulcast=!1),C.source&&(i.source=C.source);const _=new Promise((w,O)=>A(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==it.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Ie(i)}));let D=!1;const x=setTimeout(()=>{D=!0,i.stop(),O(new R0("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(x),D)return;const R=yield this.publish(i,C,k);w(R)}else try{const D=yield this.publish(i,C,k);w(D)}catch(D){O(D)}}catch(D){O(D)}}));o.pendingPublishPromises.set(i,_);try{return yield _}catch(w){throw w}finally{o.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Fn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Ie(e))),!1;const{canPublish:t,canPublishSources:i}=this.permissions;return t&&(i.length===0||i.map(r=>j5(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Ie(e))),!1)}publish(e,t,i){return A(this,void 0,void 0,function*(){var r,o,u,l,f,h,m,g,b,C;if(!this.hasPermissionsToPublish(e))throw new R0("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(V=>tr(e)&&V.source===e.source)&&e.source!==ee.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Ie(e))),t.stopMicTrackOnMute&&ci(e)&&(e.stopOnMute=!0),e.source===ee.Source.ScreenShare&&ea()&&(t.simulcast=!1),t.videoCodec==="av1"&&!V5()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!F5()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=sm),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(V=>t.videoCodec===Ao(V.mime))||(t.videoCodec=Ao(this.enabledPublishVideoCodecs[0].mime)));const k=t.videoCodec;e.on(ce.Muted,this.onTrackMuted),e.on(ce.Unmuted,this.onTrackUnmuted),e.on(ce.Ended,this.handleTrackEnded),e.on(ce.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ce.UpstreamResumed,this.onTrackUpstreamResumed),e.on(ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const _=[],w=!(!((r=t.dtx)!==null&&r!==void 0)||r),O=e.getSourceTrackSettings();O.autoGainControl&&_.push(Bt.TF_AUTO_GAIN_CONTROL),O.echoCancellation&&_.push(Bt.TF_ECHO_CANCELLATION),O.noiseSuppression&&_.push(Bt.TF_NOISE_SUPPRESSION),O.channelCount&&O.channelCount>1&&_.push(Bt.TF_STEREO),w&&_.push(Bt.TF_NO_DTX),Ai(e)&&e.hasPreConnectBuffer&&_.push(Bt.TF_PRECONNECT_BUFFER);const D=new Vo({cid:e.mediaStreamTrack.id,name:t.name,type:ee.kindToProto(e.kind),muted:e.isMuted,source:ee.sourceToProto(e.source),disableDtx:w,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=t.red)!==null&&o!==void 0)||o),stream:t?.stream,backupCodecPolicy:t?.backupCodecPolicy,audioFeatures:_});let x;if(e.kind===ee.Kind.Video){let V={width:0,height:0};try{V=yield e.waitForDimensions()}catch{const z=(l=(u=this.roomOptions.videoCaptureDefaults)===null||u===void 0?void 0:u.resolution)!==null&&l!==void 0?l:qo.h720.resolution;V={width:z.width,height:z.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Ie(e)),{dims:V}))}D.width=V.width,D.height=V.height,ys(e)&&(Qn(k)&&(e.source===ee.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Ie(e))))),t.scalabilityMode=(f=t.scalabilityMode)!==null&&f!==void 0?f:"L3T3_KEY"),D.simulcastCodecs=[new zh({codec:k,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:sm}),t.backupCodec&&k!==t.backupCodec.codec&&D.encryption===_t.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),D.simulcastCodecs.push(new zh({codec:t.backupCodec.codec,cid:""})))),x=rm(e.source===ee.Source.ScreenShare,D.width,D.height,t),D.layers=eS(D.width,D.height,x,Qn(t.videoCodec))}else e.kind===ee.Kind.Audio&&(x=[{maxBitrate:(h=t.audioPreset)===null||h===void 0?void 0:h.maxBitrate,priority:(g=(m=t.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&g!==void 0?g:"high",networkPriority:(C=(b=t.audioPreset)===null||b===void 0?void 0:b.priority)!==null&&C!==void 0?C:"high"}]);if(!this.engine||this.engine.isClosed)throw new Tt("cannot publish track when not connected");const R=()=>A(this,void 0,void 0,function*(){var V,P,z;if(!this.engine.pcManager)throw new Tt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,x),this.emit(ie.LocalSenderCreated,e.sender,e),ys(e)&&((V=t.degradationPreference)!==null&&V!==void 0||(t.degradationPreference=WB(e)),e.setDegradationPreference(t.degradationPreference)),x)if(ea()&&e.kind===ee.Kind.Audio){let W;for(const J of this.engine.pcManager.publisher.getTransceivers())if(J.sender===e.sender){W=J;break}W&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:W,codec:"opus",maxbr:!((P=x[0])===null||P===void 0)&&P.maxBitrate?x[0].maxBitrate/1e3:0})}else e.codec&&Qn(e.codec)&&(!((z=x[0])===null||z===void 0)&&z.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:D.cid,codec:e.codec,maxbr:x[0].maxBitrate/1e3});yield this.engine.negotiate()});let M;const L=new Promise((V,P)=>A(this,void 0,void 0,function*(){var z;try{M=yield this.engine.addTrack(D),V(M)}catch(W){e.sender&&(!((z=this.engine.pcManager)===null||z===void 0)&&z.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(J=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Ie(e)),{error:J}))})),P(W)}}));if(this.enabledPublishVideoCodecs.length>0)M=(yield Promise.all([L,R()]))[0];else{M=yield L;let V;if(M.codecs.forEach(P=>{V===void 0&&(V=P.mimeType)}),V&&e.kind===ee.Kind.Video){const P=Ao(V);P!==k&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Ie(e)),{codec:P})),t.videoCodec=P,x=rm(e.source===ee.Source.ScreenShare,D.width,D.height,t))}yield R()}const B=new cm(e.kind,M,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(B.on(ce.CpuConstrained,V=>this.onTrackCpuConstrained(V,B)),B.options=t,e.sid=M.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:x,trackInfo:M})),ys(e)?e.startMonitor(this.engine.client):Ai(e)&&e.startMonitor(),this.addTrackPublication(B),this.emit(ie.LocalTrackPublished,B),Ai(e)&&M.audioFeatures.includes(Bt.TF_PRECONNECT_BUFFER)){const V=e.getPreConnectBuffer(),P=e.getPreConnectBufferMimeType();this.on(ie.LocalTrackSubscribed,z=>{if(z.trackSid===M.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Ie(e))),e.stopPreConnectBuffer()}}),V&&new Promise((W,J)=>A(this,void 0,void 0,function*(){var he,we,H,re,fe,Re;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Ie(e)));const oe=setTimeout(()=>{J(new Error("agent not active within 10 seconds"))},1e4),de=yield this.waitUntilActiveAgentPresent();clearTimeout(oe),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Ie(e)));const se=yield this.streamBytes({name:"preconnect-buffer",mimeType:P,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[de.identity],attributes:{trackId:B.trackSid,sampleRate:String((fe=O.sampleRate)!==null&&fe!==void 0?fe:"48000"),channels:String((Re=O.channelCount)!==null&&Re!==void 0?Re:"1")}});try{for(var Me=!0,I=Ii(V),Q;Q=yield I.next(),he=Q.done,!he;Me=!0){re=Q.value,Me=!1;const pe=re;yield se.write(pe)}}catch(pe){we={error:pe}}finally{try{!Me&&!he&&(H=I.return)&&(yield H.call(I))}finally{if(we)throw we.error}}yield se.close(),W()}catch(oe){J(oe)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Ie(e)))}).catch(W=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Ie(e)),{error:W}))})}return B})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,i){return A(this,void 0,void 0,function*(){var r;if(this.encryptionType!==_t.NONE)return;let o;if(this.trackPublications.forEach(C=>{C.track&&C.track===e&&(o=C)}),!o)throw new Ui("track is not published");if(!ys(e))throw new Ui("track is not a video track");const u=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),l=JB(e,t,u);if(!l){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Ie(e)));return}const f=e.addSimulcastTrack(t,l);if(!f)return;const h=new Vo({cid:f.mediaStreamTrack.id,type:ee.kindToProto(e.kind),muted:e.isMuted,source:ee.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:u.videoCodec,cid:f.mediaStreamTrack.id}]});if(h.layers=eS(h.width,h.height,l),!this.engine||this.engine.isClosed)throw new Tt("cannot publish track when not connected");const m=()=>A(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,f,u,l),yield this.engine.negotiate()}),b=(yield Promise.all([this.engine.addTrack(h),m()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:l,trackInfo:b}))})}unpublishTrack(e,t){return A(this,void 0,void 0,function*(){var i,r;if(tr(e)){const h=this.pendingPublishPromises.get(e);h&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Ie(e))),yield h)}const o=this.getPublicationForTrack(e),u=o?Ie(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),u)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),u));return}e=o.track,e.off(ce.Muted,this.onTrackMuted),e.off(ce.Unmuted,this.onTrackUnmuted),e.off(ce.Ended,this.handleTrackEnded),e.off(ce.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ce.UpstreamResumed,this.onTrackUpstreamResumed),e.off(ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),t===void 0&&(t=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),t?e.stop():e.stopMonitor();let l=!1;const f=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<gt.FAILED&&f)try{for(const h of this.engine.pcManager.publisher.getTransceivers())h.sender===f&&(h.direction="inactive",l=!0);if(this.engine.removeTrack(f)&&(l=!0),ys(e)){for(const[,h]of e.simulcastCodecs)h.sender&&(this.engine.removeTrack(h.sender)&&(l=!0),h.sender=void 0);e.simulcastCodecs.clear()}}catch(h){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),u),{error:h}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case ee.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case ee.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(ie.LocalTrackUnpublished,o),o.setTrack(void 0),l&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return A(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return A(this,arguments,void 0,function(t){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Qt((o,u)=>A(i,void 0,void 0,function*(){try{const l=[];this.trackPublications.forEach(f=>{f.track&&(t&&(f.options=Object.assign(Object.assign({},f.options),t)),l.push(f))}),yield Promise.all(l.map(f=>A(this,void 0,void 0,function*(){const h=f.track;yield this.unpublishTrack(h,!1),r&&!h.isMuted&&h.source!==ee.Source.ScreenShare&&h.source!==ee.Source.ScreenShareAudio&&(Ai(h)||ys(h))&&!h.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:f.trackSid})),yield h.restartTrack()),yield this.publishOrRepublishTrack(h,f.options,!0)}))),o()}catch(l){l instanceof Error?u(l):u(new Error(String(l)))}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return A(this,arguments,void 0,function(t){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=r.reliable?Ae.RELIABLE:Ae.LOSSY,u=r.destinationIdentities,l=r.topic;let f=new Mm({participantIdentity:i.identity,payload:t,destinationIdentities:u,topic:l});const h=new tn({kind:o,value:{case:"user",value:f}});yield i.engine.sendDataPacket(h,o)})()})}publishDtmf(e,t){return A(this,void 0,void 0,function*(){const i=new tn({kind:Ae.RELIABLE,value:{case:"sipDtmf",value:new LC({code:e,digit:t})}});yield this.engine.sendDataPacket(i,Ae.RELIABLE)})}sendChatMessage(e,t){return A(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:t?.attachments},r=new tn({value:{case:"chatMessage",value:new Wl(Object.assign(Object.assign({},i),{timestamp:ut.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,Ae.RELIABLE),this.emit(ie.ChatMessage,i),i})}editChatMessage(e,t){return A(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),r=new tn({value:{case:"chatMessage",value:new Wl(Object.assign(Object.assign({},i),{timestamp:ut.parse(i.timestamp),editTimestamp:ut.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Ae.RELIABLE),this.emit(ie.ChatMessage,i),i})}sendText(e,t){return A(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)})}streamText(e){return A(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,t){return A(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)})}streamBytes(e){return A(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){let{destinationIdentity:t,method:i,payload:r,responseTimeout:o=15e3}=e;const u=7e3,l=u+1e3;return new Qt((f,h)=>A(this,void 0,void 0,function*(){var m,g,b,C;if(Qm(r)>Jk){h(yt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((g=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||g===void 0)&&g.version&&di((C=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||C===void 0?void 0:C.version,"1.8.0")<0){h(yt.builtIn("UNSUPPORTED_SERVER"));return}const E=Math.max(o,l),k=crypto.randomUUID();yield this.publishRpcRequest(t,k,i,r,E);const _=setTimeout(()=>{this.pendingAcks.delete(k),h(yt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(k),clearTimeout(w)},u);this.pendingAcks.set(k,{resolve:()=>{clearTimeout(_)},participantIdentity:t});const w=setTimeout(()=>{this.pendingResponses.delete(k),h(yt.builtIn("RESPONSE_TIMEOUT"))},o);this.pendingResponses.set(k,{resolve:(O,D)=>{clearTimeout(w),this.pendingAcks.has(k)&&(this.log.warn("RPC response received before ack",k),this.pendingAcks.delete(k),clearTimeout(_)),D?h(D):f(O??"")},participantIdentity:t})}))}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,i){const r=this.pendingResponses.get(e);r?(r.resolve(t,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,i,r,o){return A(this,void 0,void 0,function*(){const u=new tn({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcRequest",value:new Nm({id:t,method:i,payload:r,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(u,Ae.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,yt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(t=>t.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(t=>{var i,r;const o=this.trackPublications.get(t.sid);if(o){const u=o.isMuted||((r=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);u!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Ie(o)),{mutedOnServer:u})),this.engine.client.sendMuteTrack(t.sid,u))}}),!0):!1}setActiveAgent(e){var t,i,r,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(t=this.activeAgentFuture)===null||t===void 0?void 0:t.resolve)===null||i===void 0||i.call(t,e):(o=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||o===void 0||o.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Fn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Ai(r)||ys(r))&&r.mediaStreamTrack===e&&(t=i):e===r&&(t=i))}),t}waitForPendingPublicationOfSource(e){return A(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[u]=o;return u.source===e});if(r)return r[1];yield Gt(20)}})}}class su extends Pi{constructor(e,t,i,r){super(e,t.sid,t.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(ce.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Cu({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new IC({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ce.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Pi.SubscriptionStatus.Unsubscribed:super.isSubscribed?Pi.SubscriptionStatus.Subscribed:Pi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Pi.PermissionStatus.Allowed:Pi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,i;this.isManualOperationAllowed()&&(((t=this.requestedVideoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(hh(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&hh(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Rn.HIGH}setTrack(e){const t=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(ce.VisibilityChanged,this.handleVisibilityChange),r.off(ce.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(ce.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ce.VisibilityChanged,this.handleVisibilityChange),e.on(ce.Ended,this.handleEnded),this.emit(ce.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(ce.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?ce.Muted:ce.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(ce.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ce.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return hh(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new JC({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===ee.Kind.Video){let t=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(t)M0(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=I5(this.trackInfo,this.requestedMaxQuality);i&&M0(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Rn.HIGH})),e.quality=Rn.HIGH)}this.emit(ce.UpdateSettings,e)}}class au extends iT{static fromParticipantInfo(e,t,i){return new au(e,t.sid,t.identity,t.name,t.metadata,t.attributes,i,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,i,r,o,u,l){let f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:zo.STANDARD;super(t,i||"",r,o,u,l,f),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ce.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Ie(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(ce.UpdateSubscription,t=>{t.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(ce.SubscriptionPermissionChanged,t=>{this.emit(ie.TrackSubscriptionPermissionChanged,e,t)}),e.on(ce.SubscriptionStatusChanged,t=>{this.emit(ie.TrackSubscriptionStatusChanged,e,t)}),e.on(ce.Subscribed,t=>{this.emit(ie.TrackSubscribed,t,e)}),e.on(ce.Unsubscribed,t=>{this.emit(ie.TrackUnsubscribed,t,e)}),e.on(ce.SubscriptionFailed,t=>{this.emit(ie.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ee.Source.Microphone;this.volumeMap.set(t,e);const i=this.getTrackPublication(t);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ee.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,i,r,o,u){let l=this.getTrackPublicationBySid(t);if(l||t.startsWith("TR")||this.trackPublications.forEach(m=>{!l&&e.kind===m.kind.toString()&&(l=m)}),!l){if(u===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(ie.TrackSubscriptionFailed,t);return}u===void 0&&(u=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,i,r,o,u-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Ie(l))),this.emit(ie.TrackSubscriptionFailed,t);return}const f=e.kind==="video";let h;return f?h=new f6(e,t,r,o):h=new nT(e,t,r,this.audioContext,this.audioOutput),h.source=l.source,h.isMuted=l.isMuted,h.setMediaStream(i),h.start(),l.setTrack(h),this.volumeMap.has(l.source)&&nm(h)&&ci(h)&&h.setVolume(this.volumeMap.get(l.source)),l}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,i=new Map;return e.tracks.forEach(r=>{var o,u;let l=this.getTrackPublicationBySid(r.sid);if(l)l.updateInfo(r);else{const f=ee.kindFromProto(r.type);if(!f)return;l=new su(f,r,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(u=this.loggerOptions)===null||u===void 0?void 0:u.loggerName}),l.updateInfo(r),i.set(r.sid,l);const h=Array.from(this.trackPublications.values()).find(m=>m.source===l?.source);h&&l.source!==ee.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Ie(h),newTrack:Ie(l)})),this.addTrackPublication(l)}t.set(r.sid,l)}),this.trackPublications.forEach(r=>{t.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Ie(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(ie.TrackPublished,r)}),!0}unpublishTrack(e,t){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case ee.Kind.Audio:this.audioTrackPublications.delete(e);break;case ee.Kind.Video:this.videoTrackPublications.delete(e);break}t&&this.emit(ie.TrackUnpublished,i)}setAudioOutput(e){return A(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(i=>{var r;ci(i.track)&&nm(i.track)&&t.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Ve;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting"})(Ve||(Ve={}));const b6=4*1e3;class lr extends hi.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var t,i,r,o,u;if(super(),t=this,this.state=Ve.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=De,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(l,f,h)=>A(this,void 0,void 0,function*(){var m;if(!q5())throw ui()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const g=yield this.disconnectLock.lock();if(this.state===Ve.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),g(),Promise.resolve();if(this.connectFuture)return g(),this.connectFuture.promise;this.setAndEmitConnectionState(Ve.Connecting),((m=this.regionUrlProvider)===null||m===void 0?void 0:m.getServerUrl().toString())!==$k(l)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),cr(new URL(l))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new qe(l,f):this.regionUrlProvider.updateToken(f),this.regionUrlProvider.fetchRegionSettings().then(E=>{var k;(k=this.regionUrlProvider)===null||k===void 0||k.setServerReportedRegions(E)}).catch(E=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:E}))}));const b=(E,k,_)=>A(this,void 0,void 0,function*(){var w,O;this.abortController&&this.abortController.abort();const D=new AbortController;this.abortController=D,g?.();try{if(yield nr.getInstance().getBackOffPromise(l),D.signal.aborted)throw ke.cancelled("Connection attempt aborted");yield this.attemptConnection(_??l,f,h,D),this.abortController=void 0,E()}catch(x){if(this.regionUrlProvider&&x instanceof ke&&x.reason!==st.Cancelled&&x.reason!==st.NotAllowed){let R=null;try{this.log.debug("Fetching next region"),R=yield this.regionUrlProvider.getNextBestRegionUrl((w=this.abortController)===null||w===void 0?void 0:w.signal)}catch(M){if(M instanceof ke&&(M.status===401||M.reason===st.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),k(M);return}}[st.InternalError,st.ServerUnreachable,st.Timeout].includes(x.reason)&&(this.log.debug("Adding failed connection attempt to back off"),nr.getInstance().addFailedConnectionAttempt(l)),R&&!(!((O=this.abortController)===null||O===void 0)&&O.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(x.message,". Retrying with another region: ").concat(R),this.logContext),this.recreateEngine(),yield b(E,k,R)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,j0(x)),k(x))}else{let R=Wn.UNKNOWN_REASON;x instanceof ke&&(R=j0(x)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,R),k(x)}}}),C=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Fn((E,k)=>{b(E,k,C)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(l,f,h,m,g,b)=>A(this,void 0,void 0,function*(){var C,E,k;const _=yield h.join(l,f,{autoSubscribe:m.autoSubscribe,adaptiveStream:typeof g.adaptiveStream=="object"?!0:g.adaptiveStream,maxRetries:m.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:m.websocketTimeout},b.signal,!g.singlePeerConnection);let w=_.serverInfo;if(w||(w={version:_.serverVersion,region:_.serverRegion}),this.serverInfo=w,this.log.debug("connected to Livekit Server ".concat(Object.entries(w).map(O=>{let[D,x]=O;return"".concat(D,": ").concat(x)}).join(", ")),{room:(C=_.room)===null||C===void 0?void 0:C.name,roomSid:(E=_.room)===null||E===void 0?void 0:E.sid,identity:(k=_.participant)===null||k===void 0?void 0:k.identity}),!w.version)throw new x5("unknown server version");return w.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),g.dynacast=!1),_}),this.applyJoinResponse=l=>{const f=l.participant;if(this.localParticipant.sid=f.sid,this.localParticipant.identity=f.identity,this.localParticipant.setEnabledPublishCodecs(l.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(l.sifTrailer)}catch(h){this.log.error(h instanceof Error?h.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:h}))}this.handleParticipantUpdates([f,...l.otherParticipants]),l.room&&this.handleRoomUpdate(l.room)},this.attemptConnection=(l,f,h,m)=>A(this,void 0,void 0,function*(){var g,b;this.state===Ve.Reconnecting||this.isResuming||!((g=this.engine)===null||g===void 0)&&g.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((b=this.regionUrlProvider)===null||b===void 0)&&b.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Jm),h),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const C=yield this.connectSignal(l,f,this.engine,this.connOptions,this.options,m);this.applyJoinResponse(C),this.setupLocalParticipantEvents(),this.emit(X.SignalConnected)}catch(C){yield this.engine.close(),this.recreateEngine();const E=m.signal.aborted?ke.cancelled("Signal connection aborted"):ke.serverUnreachable("could not establish signal connection");throw C instanceof Error&&(E.message="".concat(E.message,": ").concat(C.message)),C instanceof ke&&(E.reason=C.reason,E.status=C.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:C})),E}if(m.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),ke.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,m)}catch(C){throw yield this.engine.close(),this.recreateEngine(),C}mn()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),mn()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ve.Connected),this.emit(X.Connected),nr.getInstance().resetFailedConnectionAttempts(l),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var l=arguments.length,f=new Array(l),h=0;h<l;h++)f[h]=arguments[h];return A(t,[...f],void 0,function(){var m=this;let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var b,C,E;const k=yield m.disconnectLock.lock();try{if(m.state===Ve.Disconnected){m.log.debug("already disconnected",m.logContext);return}if(m.log.info("disconnect from room",Object.assign({},m.logContext)),m.state===Ve.Connecting||m.state===Ve.Reconnecting||m.isResuming){const _="Abort connection attempt due to user initiated disconnect";m.log.warn(_,m.logContext),(b=m.abortController)===null||b===void 0||b.abort(_),(E=(C=m.connectFuture)===null||C===void 0?void 0:C.reject)===null||E===void 0||E.call(C,ke.cancelled("Client initiated disconnect")),m.connectFuture=void 0}m.engine&&(m.engine.client.isDisconnected||(yield m.engine.client.sendLeave()),yield m.engine.close()),m.handleDisconnect(g,Wn.CLIENT_INITIATED),m.engine=void 0}finally{k()}})()})},this.onPageLeave=()=>A(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>A(this,void 0,void 0,function*(){const l=[],f=pn();if(f&&f.os==="iOS"){const h="livekit-dummy-audio-el";let m=document.getElementById(h);if(!m){m=document.createElement("audio"),m.id=h,m.autoplay=!0,m.hidden=!0;const g=fh();g.enabled=!0;const b=new MediaStream([g]);m.srcObject=b,document.addEventListener("visibilitychange",()=>{m&&(m.srcObject=document.hidden?null:b,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(m),this.once(X.Disconnected,()=>{m?.remove(),m=null})}l.push(m)}this.remoteParticipants.forEach(h=>{h.audioTrackPublications.forEach(m=>{m.track&&m.track.attachedElements.forEach(g=>{l.push(g)})})});try{yield Promise.all([this.acquireAudioContext(),...l.map(h=>(h.muted=!1,h.play()))]),this.handleAudioPlaybackStarted()}catch(h){throw this.handleAudioPlaybackFailed(h),h}}),this.startVideo=()=>A(this,void 0,void 0,function*(){const l=[];for(const f of this.remoteParticipants.values())f.videoTrackPublications.forEach(h=>{var m;(m=h.track)===null||m===void 0||m.attachedElements.forEach(g=>{l.includes(g)||l.push(g)})});yield Promise.all(l.map(f=>f.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(f=>{f.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const l of this.remoteParticipants.values())this.handleParticipantDisconnected(l.identity,l);this.setAndEmitConnectionState(Ve.Reconnecting)&&this.emit(X.Reconnecting)},this.handleSignalRestarted=l=>A(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(l.serverRegion),Object.assign(Object.assign({},this.logContext),{region:l.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(l);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(f){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:f}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:l.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ve.Connected),this.emit(X.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=l=>{l.forEach(f=>{var h;if(f.identity===this.localParticipant.identity){this.localParticipant.updateInfo(f);return}f.identity===""&&(f.identity=(h=this.sidToIdentity.get(f.sid))!==null&&h!==void 0?h:"");let m=this.remoteParticipants.get(f.identity);f.state===Qa.DISCONNECTED?this.handleParticipantDisconnected(f.identity,m):m=this.getOrCreateParticipant(f.identity,f)})},this.handleActiveSpeakersUpdate=l=>{const f=[],h={};l.forEach(m=>{if(h[m.sid]=!0,m.sid===this.localParticipant.sid)this.localParticipant.audioLevel=m.level,this.localParticipant.setIsSpeaking(!0),f.push(this.localParticipant);else{const g=this.getRemoteParticipantBySid(m.sid);g&&(g.audioLevel=m.level,g.setIsSpeaking(!0),f.push(g))}}),h[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(m=>{h[m.sid]||(m.audioLevel=0,m.setIsSpeaking(!1))}),this.activeSpeakers=f,this.emitWhenConnected(X.ActiveSpeakersChanged,f)},this.handleSpeakersChanged=l=>{const f=new Map;this.activeSpeakers.forEach(m=>{const g=this.remoteParticipants.get(m.identity);g&&g.sid!==m.sid||f.set(m.sid,m)}),l.forEach(m=>{let g=this.getRemoteParticipantBySid(m.sid);m.sid===this.localParticipant.sid&&(g=this.localParticipant),g&&(g.audioLevel=m.level,g.setIsSpeaking(m.active),m.active?f.set(m.sid,g):f.delete(m.sid))});const h=Array.from(f.values());h.sort((m,g)=>g.audioLevel-m.audioLevel),this.activeSpeakers=h,this.emitWhenConnected(X.ActiveSpeakersChanged,h)},this.handleStreamStateUpdate=l=>{l.streamStates.forEach(f=>{const h=this.getRemoteParticipantBySid(f.participantSid);if(!h)return;const m=h.getTrackPublicationBySid(f.trackSid);if(!m||!m.track)return;const g=ee.streamStateFromProto(f.state);m.track.setStreamState(g),g!==m.track.streamState&&(h.emit(ie.TrackStreamStateChanged,m,m.track.streamState),this.emitWhenConnected(X.TrackStreamStateChanged,m,m.track.streamState,h))})},this.handleSubscriptionPermissionUpdate=l=>{const f=this.getRemoteParticipantBySid(l.participantSid);if(!f)return;const h=f.getTrackPublicationBySid(l.trackSid);h&&h.setAllowed(l.allowed)},this.handleSubscriptionError=l=>{const f=Array.from(this.remoteParticipants.values()).find(m=>m.trackPublications.has(l.trackSid));if(!f)return;const h=f.getTrackPublicationBySid(l.trackSid);h&&h.setSubscriptionError(l.err)},this.handleDataPacket=(l,f)=>{const h=this.remoteParticipants.get(l.participantIdentity);if(l.value.case==="user")this.handleUserPacket(h,l.value.value,l.kind,f);else if(l.value.case==="transcription")this.handleTranscription(h,l.value.value);else if(l.value.case==="sipDtmf")this.handleSipDtmf(h,l.value.value);else if(l.value.case==="chatMessage")this.handleChatMessage(h,l.value.value);else if(l.value.case==="metrics")this.handleMetrics(l.value.value,h);else if(l.value.case==="streamHeader"||l.value.case==="streamChunk"||l.value.case==="streamTrailer")this.handleDataStream(l,f);else if(l.value.case==="rpcRequest"){const m=l.value.value;this.handleIncomingRpcRequest(l.participantIdentity,m.id,m.method,m.payload,m.responseTimeoutMs,m.version)}},this.handleUserPacket=(l,f,h,m)=>{this.emit(X.DataReceived,f.payload,l,h,f.topic,m),l?.emit(ie.DataReceived,f.payload,h,m)},this.handleSipDtmf=(l,f)=>{this.emit(X.SipDTMFReceived,f,l),l?.emit(ie.SipDTMFReceived,f)},this.handleTranscription=(l,f)=>{const h=f.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(f.transcribedParticipantIdentity),m=h?.trackPublications.get(f.trackId),g=W5(f,this.transcriptionReceivedTimes);m?.emit(ce.TranscriptionReceived,g),h?.emit(ie.TranscriptionReceived,g,m),this.emit(X.TranscriptionReceived,g,h,m)},this.handleChatMessage=(l,f)=>{const h=Z5(f);this.emit(X.ChatMessage,h,l)},this.handleMetrics=(l,f)=>{this.emit(X.MetricsReceived,l,f)},this.handleDataStream=(l,f)=>{this.incomingDataStreamManager.handleDataStreamPacket(l,f)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(X.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=l=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:l})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(X.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(X.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(X.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>A(this,void 0,void 0,function*(){var l;((l=pn())===null||l===void 0?void 0:l.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(X.MediaDevicesChanged)}),this.handleRoomUpdate=l=>{const f=this.roomInfo;this.roomInfo=l,f&&f.metadata!==l.metadata&&this.emitWhenConnected(X.RoomMetadataChanged,l.metadata),f?.activeRecording!==l.activeRecording&&this.emitWhenConnected(X.RecordingStatusChanged,l.activeRecording)},this.handleConnectionQualityUpdate=l=>{l.updates.forEach(f=>{if(f.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(f.quality);return}const h=this.getRemoteParticipantBySid(f.participantSid);h&&h.setConnectionQuality(f.quality)})},this.onLocalParticipantMetadataChanged=l=>{this.emit(X.ParticipantMetadataChanged,l,this.localParticipant)},this.onLocalParticipantNameChanged=l=>{this.emit(X.ParticipantNameChanged,l,this.localParticipant)},this.onLocalAttributesChanged=l=>{this.emit(X.ParticipantAttributesChanged,l,this.localParticipant)},this.onLocalTrackMuted=l=>{this.emit(X.TrackMuted,l,this.localParticipant)},this.onLocalTrackUnmuted=l=>{this.emit(X.TrackUnmuted,l,this.localParticipant)},this.onTrackProcessorUpdate=l=>{var f;(f=l?.onPublish)===null||f===void 0||f.call(l,this)},this.onLocalTrackPublished=l=>A(this,void 0,void 0,function*(){var f,h,m,g,b,C;(f=l.track)===null||f===void 0||f.on(ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=l.track)===null||h===void 0||h.on(ce.Restarted,this.onLocalTrackRestarted),(b=(g=(m=l.track)===null||m===void 0?void 0:m.getProcessor())===null||g===void 0?void 0:g.onPublish)===null||b===void 0||b.call(g,this),this.emit(X.LocalTrackPublished,l,this.localParticipant),Ai(l.track)&&(yield l.track.checkForSilence())&&this.emit(X.LocalAudioSilenceDetected,l);const E=yield(C=l.track)===null||C===void 0?void 0:C.getDeviceId(!1),k=Wh(l.source);k&&E&&E!==this.localParticipant.activeDeviceMap.get(k)&&(this.localParticipant.activeDeviceMap.set(k,E),this.emit(X.ActiveDeviceChanged,k,E))}),this.onLocalTrackUnpublished=l=>{var f,h;(f=l.track)===null||f===void 0||f.off(ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=l.track)===null||h===void 0||h.off(ce.Restarted,this.onLocalTrackRestarted),this.emit(X.LocalTrackUnpublished,l,this.localParticipant)},this.onLocalTrackRestarted=l=>A(this,void 0,void 0,function*(){const f=yield l.getDeviceId(!1),h=Wh(l.source);h&&f&&f!==this.localParticipant.activeDeviceMap.get(h)&&(this.log.debug("local track restarted, setting ".concat(h," ").concat(f," active"),this.logContext),this.localParticipant.activeDeviceMap.set(h,f),this.emit(X.ActiveDeviceChanged,h,f))}),this.onLocalConnectionQualityChanged=l=>{this.emit(X.ConnectionQualityChanged,l,this.localParticipant)},this.onMediaDevicesError=(l,f)=>{this.emit(X.MediaDevicesError,l,f)},this.onLocalParticipantPermissionsChanged=l=>{this.emit(X.ParticipantPermissionsChanged,l,this.localParticipant)},this.onLocalChatMessageSent=l=>{this.emit(X.ChatMessage,l,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},DB),e),this.log=Vi((i=this.options.loggerName)!==null&&i!==void 0?i:ei.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Kk),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Gk),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},OB),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new c6,this.outgoingDataStreamManager=new d6(this.engine,this.log),this.disconnectLock=new nn,this.localParticipant=new y6("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Ts(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Ts(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",Ts(this.options.audioOutput.deviceId)).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),mn()){const l=new AbortController;(u=(o=navigator.mediaDevices)===null||o===void 0?void 0:o.addEventListener)===null||u===void 0||u.call(o,"devicechange",this.handleDeviceChange,{signal:l.signal}),lr.cleanupRegistry&&lr.cleanupRegistry.register(this,()=>{l.abort()})}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return A(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const t=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=t):this.e2eeManager=new mB(i,t),this.e2eeManager.on(Cs.ParticipantEncryptionStatusChanged,(r,o)=>{tB(o)&&(this.isE2EEEnabled=r),this.emit(X.ParticipantEncryptionStatusChanged,r,o)}),this.e2eeManager.on(Cs.EncryptionError,(r,o)=>{const u=o?this.getParticipantByIdentity(o):void 0;this.emit(X.EncryptionError,r,u)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}getSid(){return this.state===Ve.Disconnected?Qt.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?Qt.resolve(this.roomInfo.sid):new Qt((e,t)=>{const i=r=>{r.sid!==""&&(this.engine.off(ue.RoomUpdate,i),e(r.sid))};this.engine.on(ue.RoomUpdate,i),this.once(X.Disconnected,()=>{this.engine.off(ue.RoomUpdate,i),t(new Tt("Room disconnected before room server id was available"))})})}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new s6(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(ue.ParticipantUpdate,this.handleParticipantUpdates).on(ue.RoomUpdate,this.handleRoomUpdate).on(ue.SpeakersChanged,this.handleSpeakersChanged).on(ue.StreamStateChanged,this.handleStreamStateUpdate).on(ue.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(ue.SubscriptionError,this.handleSubscriptionError).on(ue.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(ue.MediaTrackAdded,(e,t,i)=>{this.onTrackAdded(e,t,i)}).on(ue.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(ue.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(ue.DataPacketReceived,this.handleDataPacket).on(ue.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ve.SignalReconnecting)&&this.emit(X.SignalReconnecting)}).on(ue.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ve.Connected)&&this.emit(X.Reconnected)}).on(ue.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ve.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(ue.Restarting,this.handleRestarting).on(ue.SignalRestarted,this.handleSignalRestarted).on(ue.Offline,()=>{this.setAndEmitConnectionState(Ve.Reconnecting)&&this.emit(X.Reconnecting)}).on(ue.DCBufferStatusChanged,(e,t)=>{this.emit(X.DCBufferStatusChanged,e,t)}).on(ue.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!t){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ie.LocalTrackSubscribed,t),this.emitWhenConnected(X.LocalTrackSubscribed,t,this.localParticipant)}).on(ue.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((t,i)=>{this.handleParticipantDisconnected(i,t)}),this.emit(X.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return zt.getInstance().getDevices(e,t)}prepareConnection(e,t){return A(this,void 0,void 0,function*(){if(this.state===Ve.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(cr(new URL(e))&&t){this.regionUrlProvider=new qe(e,t);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Ve.Disconnected&&(this.regionUrl=i,yield fetch($o(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch($o(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return A(this,void 0,void 0,function*(){let i=()=>A(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new ai({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new ai({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new ai({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new ai({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>A(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new ai({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>A(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new ai({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new ai({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>A(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new ku({reason:Wn.CLIENT_INITIATED,action:Xa.RECONNECT}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new ai({scenario:{case:"subscriberBandwidth",value:Qs(t)}});break;case"leave-full-reconnect":r=new ai({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return A(this,arguments,void 0,function(i,r){var o=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var l,f,h,m,g,b,C;let E=!0,k=!1;const _=u?{exact:r}:r;if(i==="audioinput"){k=o.localParticipant.audioTrackPublications.size===0;const w=(l=o.getActiveDevice(i))!==null&&l!==void 0?l:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=_;const O=Array.from(o.localParticipant.audioTrackPublications.values()).filter(x=>x.source===ee.Source.Microphone);try{E=(yield Promise.all(O.map(x=>{var R;return(R=x.audioTrack)===null||R===void 0?void 0:R.setDeviceId(_)}))).every(x=>x===!0)}catch(x){throw o.options.audioCaptureDefaults.deviceId=w,x}const D=O.some(x=>{var R,M;return(M=(R=x.track)===null||R===void 0?void 0:R.isMuted)!==null&&M!==void 0?M:!1});E&&D&&(k=!0)}else if(i==="videoinput"){k=o.localParticipant.videoTrackPublications.size===0;const w=(f=o.getActiveDevice(i))!==null&&f!==void 0?f:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=_;const O=Array.from(o.localParticipant.videoTrackPublications.values()).filter(x=>x.source===ee.Source.Camera);try{E=(yield Promise.all(O.map(x=>{var R;return(R=x.videoTrack)===null||R===void 0?void 0:R.setDeviceId(_)}))).every(x=>x===!0)}catch(x){throw o.options.videoCaptureDefaults.deviceId=w,x}const D=O.some(x=>{var R,M;return(M=(R=x.track)===null||R===void 0?void 0:R.isMuted)!==null&&M!==void 0?M:!1});E&&D&&(k=!0)}else if(i==="audiooutput"){if(k=!0,!tm()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(r=(h=yield zt.getInstance().normalizeDeviceId("audiooutput",r))!==null&&h!==void 0?h:""),(m=(C=o.options).audioOutput)!==null&&m!==void 0||(C.audioOutput={});const w=(g=o.getActiveDevice(i))!==null&&g!==void 0?g:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=r;try{o.options.webAudioMix&&((b=o.audioContext)===null||b===void 0||b.setSinkId(r)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(O=>O.setAudioOutput({deviceId:r})))}catch(O){throw o.options.audioOutput.deviceId=w,O}}return k&&(o.localParticipant.activeDeviceMap.set(i,r),o.emit(X.ActiveDeviceChanged,i,r)),E})()})}setupLocalParticipantEvents(){this.localParticipant.on(ie.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ie.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ie.AttributesChanged,this.onLocalAttributesChanged).on(ie.TrackMuted,this.onLocalTrackMuted).on(ie.TrackUnmuted,this.onLocalTrackUnmuted).on(ie.LocalTrackPublished,this.onLocalTrackPublished).on(ie.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ie.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ie.MediaDevicesError,this.onMediaDevicesError).on(ie.AudioStreamAcquired,this.startAudio).on(ie.ChatMessage,this.onLocalChatMessageSent).on(ie.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,i){if(this.state===Ve.Connecting||this.state===Ve.Reconnecting){const g=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:t.id,tracksInStream:t.getTracks().map(C=>C.id)}),this.onTrackAdded(e,t,i),b()},b=()=>{this.off(X.Reconnected,g),this.off(X.Connected,g),this.off(X.Disconnected,b)};this.once(X.Reconnected,g),this.once(X.Connected,g),this.once(X.Disconnected,b);return}if(this.state===Ve.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=z5(t.id),o=r[0];let u=r[1],l=e.id;if(u&&u.startsWith("TR")&&(l=u),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const f=Array.from(this.remoteParticipants.values()).find(g=>g.sid===o);if(!f){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}if(!l.startsWith("TR")){const g=this.engine.getTrackIdForReceiver(i);if(!g){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);return}l=g}l.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(u,", trackId: ").concat(l),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:u,trackId:l}));let h;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?h=this.options.adaptiveStream:h={});const m=f.addSubscribedMediaTrack(e,l,t,i,h);m?.isEncrypted&&!this.e2eeManager&&this.emit(X.EncryptionError,new Error("Encrypted ".concat(m.source," track received from participant ").concat(f.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var i,r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Ve.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(o=>{o.trackPublications.forEach(u=>{o.unpublishTrack(u.trackSid)})}),this.localParticipant.trackPublications.forEach(o=>{var u,l,f;o.track&&this.localParticipant.unpublishTrack(o.track,e),e?((u=o.track)===null||u===void 0||u.detach(),(l=o.track)===null||l===void 0||l.stop()):(f=o.track)===null||f===void 0||f.stopMonitor()}),this.localParticipant.off(ie.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ie.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ie.AttributesChanged,this.onLocalAttributesChanged).off(ie.TrackMuted,this.onLocalTrackMuted).off(ie.TrackUnmuted,this.onLocalTrackUnmuted).off(ie.LocalTrackPublished,this.onLocalTrackPublished).off(ie.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ie.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ie.MediaDevicesError,this.onMediaDevicesError).off(ie.AudioStreamAcquired,this.startAudio).off(ie.ChatMessage,this.onLocalChatMessageSent).off(ie.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),mn()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||r===void 0||r.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ve.Disconnected),this.emit(X.Disconnected,t)}}}handleParticipantDisconnected(e,t){var i;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach(r=>{t.unpublishTrack(r.trackSid,!0)}),this.emit(X.ParticipantDisconnected,t),t.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,i,r,o,u){return A(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),u!==1){yield this.engine.publishRpcResponse(e,t,null,yt.builtIn("UNSUPPORTED_VERSION"));return}const l=this.rpcHandlers.get(i);if(!l){yield this.engine.publishRpcResponse(e,t,null,yt.builtIn("UNSUPPORTED_METHOD"));return}let f=null,h=null;try{const m=yield l({requestId:t,callerIdentity:e,payload:r,responseTimeout:o});Qm(m)>Jk?(f=yt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):h=m}catch(m){m instanceof yt?f=m:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),m),f=yt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,h,f)})}selectDefaultDevices(){return A(this,void 0,void 0,function*(){var e,t,i;const r=zt.getInstance().previousDevices,o=yield zt.getInstance().getDevices(void 0,!1),u=pn();if(u?.name==="Chrome"&&u.os!=="iOS")for(let f of o){const h=r.find(m=>m.deviceId===f.deviceId);h&&h.label!==""&&h.kind===f.kind&&h.label!==f.label&&this.getActiveDevice(f.kind)==="default"&&this.emit(X.ActiveDeviceChanged,f.kind,f.deviceId)}const l=["audiooutput","audioinput","videoinput"];for(let f of l){const h=O5(f),m=this.localParticipant.getTrackPublication(h);if(m&&(!((e=m.track)===null||e===void 0)&&e.isUserProvided))continue;const g=o.filter(C=>C.kind===f),b=this.getActiveDevice(f);if(b===((t=r.filter(C=>C.kind===f)[0])===null||t===void 0?void 0:t.deviceId)&&g.length>0&&((i=g[0])===null||i===void 0?void 0:i.deviceId)!==b){yield this.switchActiveDevice(f,g[0].deviceId);continue}f==="audioinput"&&!Ho()||f==="videoinput"||g.length>0&&!g.find(C=>C.deviceId===this.getActiveDevice(f))&&(f!=="audiooutput"||!Ho())&&(yield this.switchActiveDevice(f,g[0].deviceId))}})}acquireAudioContext(){return A(this,void 0,void 0,function*(){var e,t;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=zk())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Gt(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(X.AudioPlaybackStatusChanged,i))})}createParticipant(e,t){var i;let r;return t?r=au.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new au(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),r}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return t&&r.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),r}const i=this.createParticipant(e,t);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(X.ParticipantConnected,i),i.on(ie.TrackPublished,r=>{this.emitWhenConnected(X.TrackPublished,r,i)}).on(ie.TrackSubscribed,(r,o)=>{r.kind===ee.Kind.Audio?(r.on(ce.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(ce.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===ee.Kind.Video&&(r.on(ce.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(ce.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(X.TrackSubscribed,r,o,i)}).on(ie.TrackUnpublished,r=>{this.emit(X.TrackUnpublished,r,i)}).on(ie.TrackUnsubscribed,(r,o)=>{this.emit(X.TrackUnsubscribed,r,o,i)}).on(ie.TrackMuted,r=>{this.emitWhenConnected(X.TrackMuted,r,i)}).on(ie.TrackUnmuted,r=>{this.emitWhenConnected(X.TrackUnmuted,r,i)}).on(ie.ParticipantMetadataChanged,r=>{this.emitWhenConnected(X.ParticipantMetadataChanged,r,i)}).on(ie.ParticipantNameChanged,r=>{this.emitWhenConnected(X.ParticipantNameChanged,r,i)}).on(ie.AttributesChanged,r=>{this.emitWhenConnected(X.ParticipantAttributesChanged,r,i)}).on(ie.ConnectionQualityChanged,r=>{this.emitWhenConnected(X.ConnectionQualityChanged,r,i)}).on(ie.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(X.ParticipantPermissionsChanged,r,i)}).on(ie.TrackSubscriptionStatusChanged,(r,o)=>{this.emitWhenConnected(X.TrackSubscriptionStatusChanged,r,o,i)}).on(ie.TrackSubscriptionFailed,(r,o)=>{this.emit(X.TrackSubscriptionFailed,r,i,o)}).on(ie.TrackSubscriptionPermissionChanged,(r,o)=>{this.emitWhenConnected(X.TrackSubscriptionPermissionChanged,r,o,i)}).on(ie.Active,()=>{this.emitWhenConnected(X.ParticipantActive,i),i.kind===zo.AGENT&&this.localParticipant.setActiveAgent(i)}),t&&i.updateInfo(t),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&eB(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Kt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Wn.STATE_MISMATCH))):e=0},b6)}clearConnectionReconcile(){this.connectionReconcileInterval&&Kt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(X.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,i]=e;this.emit(t,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];if(this.state===Ve.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Ve.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return A(this,void 0,void 0,function*(){var t,i,r,o;const u=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),l=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new yu({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ut.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Zs({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(X.SignalConnected),this.emit(X.Connected),this.setAndEmitConnectionState(Ve.Connected),u.video){const f=new cm(ee.Kind.Video,new Ga({source:At.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Yn.AUDIO,name:"video-dummy"}),new iu(u.useRealTracks&&(!((t=window.navigator.mediaDevices)===null||t===void 0)&&t.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:L0(160*((i=l.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(f),this.localParticipant.emit(ie.LocalTrackPublished,f)}if(u.audio){const f=new cm(ee.Kind.Audio,new Ga({source:At.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Yn.AUDIO}),new nu(u.useRealTracks&&(!((r=navigator.mediaDevices)===null||r===void 0)&&r.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:fh(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(f),this.localParticipant.emit(ie.LocalTrackPublished,f)}for(let f=0;f<l.count-1;f+=1){let h=new Zs({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(f),state:Qa.ACTIVE,tracks:[],joinedAt:ut.parse(Date.now())});const m=this.getOrCreateParticipant(h.identity,h);if(l.video){const g=L0(160*((o=l.aspectRatios[f%l.aspectRatios.length])!==null&&o!==void 0?o:1),160,!1,!0),b=new Ga({source:At.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Yn.AUDIO});m.addSubscribedMediaTrack(g,b.sid,new MediaStream([g]),new RTCRtpReceiver),h.tracks=[...h.tracks,b]}if(l.audio){const g=fh(),b=new Ga({source:At.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Yn.AUDIO});m.addSubscribedMediaTrack(g,b.sid,new MediaStream([g]),new RTCRtpReceiver),h.tracks=[...h.tracks,b]}m.updateInfo(h)}})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];if(e!==X.ActiveSpeakersChanged&&e!==X.TranscriptionReceived){const o=sT(i).filter(u=>u!==void 0);(e===X.TrackSubscribed||e===X.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}lr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(n=>{n()});function sT(n){return n.map(e=>{if(e)return Array.isArray(e)?sT(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Gn;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(Gn||(Gn={}));class Ns extends hi.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Gn.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new lr(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return A(this,void 0,void 0,function*(){if(this.status!==Gn.IDLE)throw Error("check is running already");this.setStatus(Gn.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==Gn.SKIPPED&&this.setStatus(this.isSuccess()?Gn.SUCCESS:Gn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return A(this,void 0,void 0,function*(){return this.room.state===Ve.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return A(this,void 0,void 0,function*(){this.room&&this.room.state!==Ve.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Gn.SKIPPED)}switchProtocol(e){return A(this,void 0,void 0,function*(){let t=!1,i=!1;if(this.room.on(X.Reconnecting,()=>{t=!0}),this.room.once(X.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!t)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Gt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class S6 extends Ns{get description(){return"Cloud regions"}perform(){return A(this,void 0,void 0,function*(){const e=new qe(this.url,this.token);if(!e.isCloud()){this.skip();return}const t=[],i=new Set;for(let o=0;o<3;o++){const u=yield e.getNextBestRegionUrl();if(!u)break;if(i.has(u))continue;i.add(u);const l=yield this.checkCloudRegion(u);this.appendMessage("".concat(l.region," RTT: ").concat(l.rtt,"ms, duration: ").concat(l.duration,"ms")),t.push(l)}t.sort((o,u)=>(o.duration-u.duration)*.5+(o.rtt-u.rtt)*.5);const r=t[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return A(this,void 0,void 0,function*(){var t,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(t=this.room.serverInfo)===null||t===void 0?void 0:t.region;if(!r)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),u=1e3,f=1e6/u,h="A".repeat(u),m=Date.now();for(let E=0;E<f;E++)yield o.write(h);yield o.close();const g=Date.now(),b=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),C={region:r,rtt:1e4,duration:g-m};return b?.forEach(E=>{E.type==="candidate-pair"&&E.nominated&&(C.rtt=E.currentRoundTripTime*1e3)}),yield this.disconnect(),C})}}const Ch=1e4;class C6 extends Ns{get description(){return"Connection via UDP vs TCP"}perform(){return A(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(Ch/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(Ch/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return A(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const i=t.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const o=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,t.width,t.height),requestAnimationFrame(o)};o();const l=t.captureStream(30).getVideoTracks()[0],h=(yield this.room.localParticipant.publishTrack(l,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,m={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},g=setInterval(()=>A(this,void 0,void 0,function*(){const b=yield h.getRTCStatsReport();b?.forEach(C=>{C.type==="outbound-rtp"?(m.packetsSent=C.packetsSent,m.qualityLimitationDurations=C.qualityLimitationDurations,m.bitrateTotal+=C.targetBitrate,m.count++):C.type==="remote-inbound-rtp"&&(m.packetsLost=C.packetsLost,m.rttTotal+=C.roundTripTime,m.jitterTotal+=C.jitter)})}),1e3);return yield new Promise(b=>setTimeout(b,Ch)),clearInterval(g),l.stop(),t.remove(),yield this.disconnect(),m})}}class k6 extends Ns{get description(){return"Can publish audio"}perform(){return A(this,void 0,void 0,function*(){var e;const t=yield this.connect(),i=yield p6();if(yield Bk(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(i),yield new Promise(l=>setTimeout(l,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let u=0;if(o.forEach(l=>{l.type==="outbound-rtp"&&(l.kind==="audio"||!l.kind&&l.mediaType==="audio")&&(u=l.packetsSent)}),u===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(u," audio packets"))})}}class T6 extends Ns{get description(){return"Can publish video"}perform(){return A(this,void 0,void 0,function*(){var e;const t=yield this.connect(),i=yield m6();yield this.checkForVideo(i.mediaStreamTrack),t.localParticipant.publishTrack(i),yield new Promise(u=>setTimeout(u,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="video"||!u.kind&&u.mediaType==="video")&&(o+=u.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return A(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const i=document.createElement("video");i.srcObject=t,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var o,u,l,f;const h=document.createElement("canvas"),m=e.getSettings(),g=(u=(o=m.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&u!==void 0?u:1280,b=(f=(l=m.height)!==null&&l!==void 0?l:i.videoHeight)!==null&&f!==void 0?f:720;h.width=g,h.height=b;const C=h.getContext("2d");C.drawImage(i,0,0);const k=C.getImageData(0,0,h.width,h.height).data;let _=!0;for(let w=0;w<k.length;w+=4)if(k[w]!==0||k[w+1]!==0||k[w+2]!==0){_=!1;break}_?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),t.getTracks().forEach(r=>r.stop()),i.remove()})}}class E6 extends Ns{get description(){return"Resuming connection after interruption"}perform(){return A(this,void 0,void 0,function*(){var e;const t=yield this.connect();let i=!1,r=!1,o;const u=new Promise(h=>{setTimeout(h,5e3),o=h}),l=()=>{i=!0};t.on(X.SignalReconnecting,l).on(X.Reconnecting,l).on(X.Reconnected,()=>{r=!0,o(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const f=t.engine.client.onClose;if(f&&f(""),yield u,i){if(!r||t.state!==Ve.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class x6 extends Ns{get description(){return"Can connect via TURN"}perform(){return A(this,void 0,void 0,function*(){var e,t,i;cr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new qe(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new $m,o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let u=!1,l=!1,f=!1;for(let h of o.iceServers)for(let m of h.urls)m.startsWith("turn:")?(l=!0,f=!0):m.startsWith("turns:")&&(l=!0,f=!0,u=!0),m.startsWith("stun:")&&(f=!0);f?l&&!u&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(t=this.connectOptions)===null||t===void 0?void 0:t.rtcConfig)===null||i===void 0)&&i.iceServers||l?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(h=>setTimeout(h,0)))})}}class R6 extends Ns{get description(){return"Establishing WebRTC connection"}perform(){return A(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(X.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,u)=>{if(o.candidate){const l=new RTCIceCandidate(o);let f="".concat(l.protocol," ").concat(l.address,":").concat(l.port," ").concat(l.type);l.address&&(_6(l.address)?f+=" (private)":l.protocol==="tcp"&&l.tcpType==="passive"?(e=!0,f+=" (passive)"):l.protocol==="udp"&&(t=!0)),this.appendMessage(f)}r&&r(o,u)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),De.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function _6(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class w6 extends Ns{get description(){return"Connecting to signal connection via WebSocket"}perform(){return A(this,void 0,void 0,function*(){var e,t,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new $m,o;try{o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(u){if(cr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(u.message,". Retrying with region fallback"));const f=yield new qe(this.url,this.token).getNextBestRegionUrl();f&&(o=yield r.join(f,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}o?(this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===BC.Cloud&&(!((t=o.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class h9 extends hi.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Gn.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Gn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return A(this,void 0,void 0,function*(){const t=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=u=>{this.updateCheck(t,u)};i.on("update",r);const o=yield i.run();return i.off("update",r),o})}checkWebsocket(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(w6)})}checkWebRTC(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(R6)})}checkTURN(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(x6)})}checkReconnect(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(E6)})}checkPublishAudio(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(k6)})}checkPublishVideo(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(T6)})}checkConnectionProtocol(){return A(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(C6);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(S6)})}}function Ue(n,e,t){return(e=N6(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function M6(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function N6(n){var e=M6(n,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class an extends Error{constructor(e,t){var i;super(e,t),Ue(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}Ue(an,"code","ERR_JOSE_GENERIC");class O6 extends an{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:t}}),Ue(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Ue(this,"claim",void 0),Ue(this,"reason",void 0),Ue(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=t}}Ue(O6,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class D6 extends an{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:t}}),Ue(this,"code","ERR_JWT_EXPIRED"),Ue(this,"claim",void 0),Ue(this,"reason",void 0),Ue(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=t}}Ue(D6,"code","ERR_JWT_EXPIRED");class A6 extends an{constructor(){super(...arguments),Ue(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Ue(A6,"code","ERR_JOSE_ALG_NOT_ALLOWED");class P6 extends an{constructor(){super(...arguments),Ue(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Ue(P6,"code","ERR_JOSE_NOT_SUPPORTED");class L6 extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ue(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Ue(L6,"code","ERR_JWE_DECRYPTION_FAILED");class j6 extends an{constructor(){super(...arguments),Ue(this,"code","ERR_JWE_INVALID")}}Ue(j6,"code","ERR_JWE_INVALID");class I6 extends an{constructor(){super(...arguments),Ue(this,"code","ERR_JWS_INVALID")}}Ue(I6,"code","ERR_JWS_INVALID");class U6 extends an{constructor(){super(...arguments),Ue(this,"code","ERR_JWT_INVALID")}}Ue(U6,"code","ERR_JWT_INVALID");class B6 extends an{constructor(){super(...arguments),Ue(this,"code","ERR_JWK_INVALID")}}Ue(B6,"code","ERR_JWK_INVALID");class z6 extends an{constructor(){super(...arguments),Ue(this,"code","ERR_JWKS_INVALID")}}Ue(z6,"code","ERR_JWKS_INVALID");class V6 extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ue(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Ue(V6,"code","ERR_JWKS_NO_MATCHING_KEY");class F6 extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ue(this,Symbol.asyncIterator,void 0),Ue(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Ue(F6,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class q6 extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ue(this,"code","ERR_JWKS_TIMEOUT")}}Ue(q6,"code","ERR_JWKS_TIMEOUT");class H6 extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",t=arguments.length>1?arguments[1]:void 0;super(e,t),Ue(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Ue(H6,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");var aS;(function(n){n[n.Reserved=0]="Reserved",n[n.TooLarge=1]="TooLarge"})(aS||(aS={}));var rS;(function(n){n[n.TooShort=0]="TooShort",n[n.HeaderOverrun=1]="HeaderOverrun",n[n.MissingExtWords=2]="MissingExtWords",n[n.UnsupportedVersion=3]="UnsupportedVersion",n[n.InvalidHandle=4]="InvalidHandle",n[n.MalformedExt=5]="MalformedExt"})(rS||(rS={}));var oS;(function(n){n[n.TooSmallForHeader=0]="TooSmallForHeader",n[n.TooSmallForPayload=1]="TooSmallForPayload"})(oS||(oS={}));var ru;(function(n){n[n.UserTimestamp=2]="UserTimestamp",n[n.E2ee=1]="E2ee"})(ru||(ru={}));ru.UserTimestamp;ru.E2ee;var cS;(function(n){n[n.Start=0]="Start",n[n.Inter=1]="Inter",n[n.Final=2]="Final",n[n.Single=3]="Single"})(cS||(cS={}));var Tl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aT(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var lm={exports:{}},$6=lm.exports,lS;function K6(){return lS||(lS=1,(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})($6,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},u=null;function l(k,_){var w=k[_];if(typeof w.bind=="function")return w.bind(k);try{return Function.prototype.bind.call(w,k)}catch{return function(){return Function.prototype.apply.apply(w,[k,arguments])}}}function f(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function h(k){return k==="debug"&&(k="log"),typeof console===t?!1:k==="trace"&&i?f:console[k]!==void 0?l(console,k):console.log!==void 0?l(console,"log"):e}function m(){for(var k=this.getLevel(),_=0;_<r.length;_++){var w=r[_];this[w]=_<k?e:this.methodFactory(w,k,this.name)}if(this.log=this.debug,typeof console===t&&k<this.levels.SILENT)return"No console available for logging"}function g(k){return function(){typeof console!==t&&(m.call(this),this[k].apply(this,arguments))}}function b(k,_,w){return h(k)||g.apply(this,arguments)}function C(k,_){var w=this,O,D,x,R="loglevel";typeof k=="string"?R+=":"+k:typeof k=="symbol"&&(R=void 0);function M(z){var W=(r[z]||"silent").toUpperCase();if(!(typeof window===t||!R)){try{window.localStorage[R]=W;return}catch{}try{window.document.cookie=encodeURIComponent(R)+"="+W+";"}catch{}}}function L(){var z;if(!(typeof window===t||!R)){try{z=window.localStorage[R]}catch{}if(typeof z===t)try{var W=window.document.cookie,J=encodeURIComponent(R),he=W.indexOf(J+"=");he!==-1&&(z=/^([^;]+)/.exec(W.slice(he+J.length+1))[1])}catch{}return w.levels[z]===void 0&&(z=void 0),z}}function B(){if(!(typeof window===t||!R)){try{window.localStorage.removeItem(R)}catch{}try{window.document.cookie=encodeURIComponent(R)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function V(z){var W=z;if(typeof W=="string"&&w.levels[W.toUpperCase()]!==void 0&&(W=w.levels[W.toUpperCase()]),typeof W=="number"&&W>=0&&W<=w.levels.SILENT)return W;throw new TypeError("log.setLevel() called with invalid level: "+z)}w.name=k,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=_||b,w.getLevel=function(){return x??D??O},w.setLevel=function(z,W){return x=V(z),W!==!1&&M(x),m.call(w)},w.setDefaultLevel=function(z){D=V(z),L()||w.setLevel(z,!1)},w.resetLevel=function(){x=null,B(),m.call(w)},w.enableAll=function(z){w.setLevel(w.levels.TRACE,z)},w.disableAll=function(z){w.setLevel(w.levels.SILENT,z)},w.rebuild=function(){if(u!==w&&(O=V(u.getLevel())),m.call(w),u===w)for(var z in o)o[z].rebuild()},O=V(u?u.getLevel():"WARN");var P=L();P!=null&&(x=V(P)),m.call(w)}u=new C,u.getLogger=function(k){if(typeof k!="symbol"&&typeof k!="string"||k==="")throw new TypeError("You must supply a name when creating a logger.");var _=o[k];return _||(_=o[k]=new C(k,u.methodFactory)),_};var E=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=E),u},u.getLoggers=function(){return o},u.default=u,u})})(lm)),lm.exports}var G6=K6();const Y6=aT(G6);var um=function(n,e){return um=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])},um(n,e)};function qi(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");um(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function J6(n,e,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(m){try{h(i.next(m))}catch(g){u(g)}}function f(m){try{h(i.throw(m))}catch(g){u(g)}}function h(m){m.done?o(m.value):r(m.value).then(l,f)}h((i=i.apply(n,[])).next())})}function rT(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return u.next=l(0),u.throw=l(1),u.return=l(2),typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(h){return function(m){return f([h,m])}}function f(h){if(i)throw new TypeError("Generator is already executing.");for(;u&&(u=0,h[0]&&(t=0)),t;)try{if(i=1,r&&(o=h[0]&2?r.return:h[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,h[1])).done)return o;switch(r=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,r=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){t.label=h[1];break}if(h[0]===6&&t.label<o[1]){t.label=o[1],o=h;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(h);break}o[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(n,t)}catch(m){h=[6,m],r=0}finally{i=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function ur(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ou(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,o=[],u;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(l){u={error:l}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(u)throw u.error}}return o}function cu(n,e,t){if(arguments.length===2)for(var i=0,r=e.length,o;i<r;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return n.concat(o||Array.prototype.slice.call(e))}function sr(n){return this instanceof sr?(this.v=n,this):new sr(n)}function Q6(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",u),r[Symbol.asyncIterator]=function(){return this},r;function u(C){return function(E){return Promise.resolve(E).then(C,g)}}function l(C,E){i[C]&&(r[C]=function(k){return new Promise(function(_,w){o.push([C,k,_,w])>1||f(C,k)})},E&&(r[C]=E(r[C])))}function f(C,E){try{h(i[C](E))}catch(k){b(o[0][3],k)}}function h(C){C.value instanceof sr?Promise.resolve(C.value.v).then(m,g):b(o[0][2],C)}function m(C){f("next",C)}function g(C){f("throw",C)}function b(C,E){C(E),o.shift(),o.length&&f(o[0][0],o[0][1])}}function X6(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof ur=="function"?ur(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(u){return new Promise(function(l,f){u=n[o](u),r(l,f,u.done,u.value)})}}function r(o,u,l,f){Promise.resolve(f).then(function(h){o({value:h,done:l})},u)}}function jt(n){return typeof n=="function"}function Zm(n){var e=function(i){Error.call(i),i.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var kh=Zm(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,i){return i+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function lu(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Yo=(function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,i,r,o;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var l=ur(u),f=l.next();!f.done;f=l.next()){var h=f.value;h.remove(this)}}catch(k){e={error:k}}finally{try{f&&!f.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}else u.remove(this);var m=this.initialTeardown;if(jt(m))try{m()}catch(k){o=k instanceof kh?k.errors:[k]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var b=ur(g),C=b.next();!C.done;C=b.next()){var E=C.value;try{uS(E)}catch(k){o=o??[],k instanceof kh?o=cu(cu([],ou(o)),ou(k.errors)):o.push(k)}}}catch(k){i={error:k}}finally{try{C&&!C.done&&(r=b.return)&&r.call(b)}finally{if(i)throw i.error}}}if(o)throw new kh(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)uS(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&lu(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&lu(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=(function(){var e=new n;return e.closed=!0,e})(),n})(),oT=Yo.EMPTY;function cT(n){return n instanceof Yo||n&&"closed"in n&&jt(n.remove)&&jt(n.add)&&jt(n.unsubscribe)}function uS(n){jt(n)?n():n.unsubscribe()}var W6={Promise:void 0},Z6={setTimeout:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setTimeout.apply(void 0,cu([n,e],ou(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function lT(n){Z6.setTimeout(function(){throw n})}function dS(){}function Fl(n){n()}var ep=(function(n){qi(e,n);function e(t){var i=n.call(this)||this;return i.isStopped=!1,t?(i.destination=t,cT(t)&&t.add(i)):i.destination=n8,i}return e.create=function(t,i,r){return new dm(t,i,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Yo),e8=(function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(i){El(i)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(i){El(i)}else El(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){El(t)}},n})(),dm=(function(n){qi(e,n);function e(t,i,r){var o=n.call(this)||this,u;return jt(t)||!t?u={next:t??void 0,error:i??void 0,complete:r??void 0}:u=t,o.destination=new e8(u),o}return e})(ep);function El(n){lT(n)}function t8(n){throw n}var n8={closed:!0,next:dS,error:t8,complete:dS},tp=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function uT(n){return n}function i8(n){return n.length===0?uT:n.length===1?n[0]:function(e){return n.reduce(function(t,i){return i(t)},e)}}var Xt=(function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,i){var r=this,o=a8(e)?e:new dm(e,t,i);return Fl(function(){var u=r,l=u.operator,f=u.source;o.add(l?l.call(o,f):f?r._subscribe(o):r._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var i=this;return t=fS(t),new t(function(r,o){var u=new dm({next:function(l){try{e(l)}catch(f){o(f),u.unsubscribe()}},error:o,complete:r});i.subscribe(u)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[tp]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i8(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=fS(e),new e(function(i,r){var o;t.subscribe(function(u){return o=u},function(u){return r(u)},function(){return i(o)})})},n.create=function(e){return new n(e)},n})();function fS(n){var e;return(e=n??W6.Promise)!==null&&e!==void 0?e:Promise}function s8(n){return n&&jt(n.next)&&jt(n.error)&&jt(n.complete)}function a8(n){return n&&n instanceof ep||s8(n)&&cT(n)}function r8(n){return jt(n?.lift)}function Jo(n){return function(e){if(r8(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function uu(n,e,t,i,r){return new o8(n,e,t,i,r)}var o8=(function(n){qi(e,n);function e(t,i,r,o,u,l){var f=n.call(this,t)||this;return f.onFinalize=u,f.shouldUnsubscribe=l,f._next=i?function(h){try{i(h)}catch(m){t.error(m)}}:n.prototype._next,f._error=o?function(h){try{o(h)}catch(m){t.error(m)}finally{this.unsubscribe()}}:n.prototype._error,f._complete=r?function(){try{r()}catch(h){t.error(h)}finally{this.unsubscribe()}}:n.prototype._complete,f}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;n.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e})(ep),c8=Zm(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),dT=(function(n){qi(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new hS(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new c8},e.prototype.next=function(t){var i=this;Fl(function(){var r,o;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var u=ur(i.currentObservers),l=u.next();!l.done;l=u.next()){var f=l.value;f.next(t)}}catch(h){r={error:h}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}}})},e.prototype.error=function(t){var i=this;Fl(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var r=i.observers;r.length;)r.shift().error(t)}})},e.prototype.complete=function(){var t=this;Fl(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,r=this,o=r.hasError,u=r.isStopped,l=r.observers;return o||u?oT:(this.currentObservers=null,l.push(t),new Yo(function(){i.currentObservers=null,lu(l,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,r=i.hasError,o=i.thrownError,u=i.isStopped;r?t.error(o):u&&t.complete()},e.prototype.asObservable=function(){var t=new Xt;return t.source=this,t},e.create=function(t,i){return new hS(t,i)},e})(Xt),hS=(function(n){qi(e,n);function e(t,i){var r=n.call(this)||this;return r.destination=t,r.source=i,r}return e.prototype.next=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,t)},e.prototype.error=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&r!==void 0?r:oT},e})(dT);(function(n){qi(e,n);function e(t){var i=n.call(this)||this;return i._value=t,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var i=n.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},e.prototype.getValue=function(){var t=this,i=t.hasError,r=t.thrownError,o=t._value;if(i)throw r;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e})(dT);var l8={now:function(){return Date.now()}},u8=(function(n){qi(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e})(Yo),mS={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setInterval.apply(void 0,cu([n,e],ou(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},d8=(function(n){qi(e,n);function e(t,i){var r=n.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(t,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var o=this.id,u=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(u,o,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(u,this.id,i),this},e.prototype.requestAsyncId=function(t,i,r){return r===void 0&&(r=0),mS.setInterval(t.flush.bind(t,this),r)},e.prototype.recycleAsyncId=function(t,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&mS.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var r=!1,o;try{this.work(t)}catch(u){r=!0,o=u||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,r=t.scheduler,o=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,lu(o,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e})(u8),pS=(function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=l8.now,n})(),f8=(function(n){qi(e,n);function e(t,i){i===void 0&&(i=pS.now);var r=n.call(this,t,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var r;this._active=!0;do if(r=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,r){for(;t=i.shift();)t.unsubscribe();throw r}},e})(pS);new f8(d8);function h8(n){return n&&jt(n.schedule)}function m8(n){return n[n.length-1]}function fT(n){return h8(m8(n))?n.pop():void 0}var hT=(function(n){return n&&typeof n.length=="number"&&typeof n!="function"});function mT(n){return jt(n?.then)}function pT(n){return jt(n[tp])}function gT(n){return Symbol.asyncIterator&&jt(n?.[Symbol.asyncIterator])}function vT(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function p8(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var yT=p8();function bT(n){return jt(n?.[yT])}function ST(n){return Q6(this,arguments,function(){var e,t,i,r;return rT(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,sr(e.read())];case 3:return t=o.sent(),i=t.value,r=t.done,r?[4,sr(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,sr(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function CT(n){return jt(n?.getReader)}function Qo(n){if(n instanceof Xt)return n;if(n!=null){if(pT(n))return g8(n);if(hT(n))return v8(n);if(mT(n))return y8(n);if(gT(n))return kT(n);if(bT(n))return b8(n);if(CT(n))return S8(n)}throw vT(n)}function g8(n){return new Xt(function(e){var t=n[tp]();if(jt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function v8(n){return new Xt(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function y8(n){return new Xt(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,lT)})}function b8(n){return new Xt(function(e){var t,i;try{for(var r=ur(n),o=r.next();!o.done;o=r.next()){var u=o.value;if(e.next(u),e.closed)return}}catch(l){t={error:l}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}e.complete()})}function kT(n){return new Xt(function(e){C8(n,e).catch(function(t){return e.error(t)})})}function S8(n){return kT(ST(n))}function C8(n,e){var t,i,r,o;return J6(this,void 0,void 0,function(){var u,l;return rT(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,11]),t=X6(n),f.label=1;case 1:return[4,t.next()];case 2:if(i=f.sent(),!!i.done)return[3,4];if(u=i.value,e.next(u),e.closed)return[2];f.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=f.sent(),r={error:l},[3,11];case 6:return f.trys.push([6,,9,10]),i&&!i.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Xs(n,e,t,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var o=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function TT(n,e){return e===void 0&&(e=0),Jo(function(t,i){t.subscribe(uu(i,function(r){return Xs(i,n,function(){return i.next(r)},e)},function(){return Xs(i,n,function(){return i.complete()},e)},function(r){return Xs(i,n,function(){return i.error(r)},e)}))})}function ET(n,e){return e===void 0&&(e=0),Jo(function(t,i){i.add(n.schedule(function(){return t.subscribe(i)},e))})}function k8(n,e){return Qo(n).pipe(ET(e),TT(e))}function T8(n,e){return Qo(n).pipe(ET(e),TT(e))}function E8(n,e){return new Xt(function(t){var i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function x8(n,e){return new Xt(function(t){var i;return Xs(t,e,function(){i=n[yT](),Xs(t,e,function(){var r,o,u;try{r=i.next(),o=r.value,u=r.done}catch(l){t.error(l);return}u?t.complete():t.next(o)},0,!0)}),function(){return jt(i?.return)&&i.return()}})}function xT(n,e){if(!n)throw new Error("Iterable cannot be null");return new Xt(function(t){Xs(t,e,function(){var i=n[Symbol.asyncIterator]();Xs(t,e,function(){i.next().then(function(r){r.done?t.complete():t.next(r.value)})},0,!0)})})}function R8(n,e){return xT(ST(n),e)}function _8(n,e){if(n!=null){if(pT(n))return k8(n,e);if(hT(n))return E8(n,e);if(mT(n))return T8(n,e);if(gT(n))return xT(n,e);if(bT(n))return x8(n,e);if(CT(n))return R8(n,e)}throw vT(n)}function w8(n,e){return e?_8(n,e):Qo(n)}Zm(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function mr(n,e){return Jo(function(t,i){var r=0;t.subscribe(uu(i,function(o){i.next(n.call(e,o,r++))}))})}function M8(n,e,t,i,r,o,u,l){var f=[],h=0,m=0,g=!1,b=function(){g&&!f.length&&!h&&e.complete()},C=function(k){return h<i?E(k):f.push(k)},E=function(k){h++;var _=!1;Qo(t(k,m++)).subscribe(uu(e,function(w){e.next(w)},function(){_=!0},void 0,function(){if(_)try{h--;for(var w=function(){var O=f.shift();u||E(O)};f.length&&h<i;)w();b()}catch(O){e.error(O)}}))};return n.subscribe(uu(e,C,function(){g=!0,b()})),function(){}}function RT(n,e,t){return t===void 0&&(t=1/0),jt(e)?RT(function(i,r){return mr(function(o,u){return e(i,o,r,u)})(Qo(n(i,r)))},t):(typeof e=="number"&&(t=e),Jo(function(i,r){return M8(i,r,n,t)}))}function N8(n){return RT(uT,n)}function O8(){return N8(1)}function gS(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return O8()(w8(n,fT(n)))}function pr(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=fT(n);return Jo(function(i,r){(t?gS(n,i,t):gS(n,i)).subscribe(r)})}var D8="lk";function np(n){return typeof n>"u"?!1:A8(n)||P8(n)}function A8(n){var e;return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("track")&&typeof((e=n.publication)==null?void 0:e.track)<"u":!1}function P8(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("publication")&&typeof n.publication<"u":!1}function L8(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&typeof n.publication>"u":!1}function j8(n){if(typeof n=="string"||typeof n=="number")return`${n}`;if(L8(n))return`${n.participant.identity}_${n.source}_placeholder`;if(np(n))return`${n.participant.identity}_${n.publication.source}_${n.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${n}`)}var I8=[X.ConnectionStateChanged,X.RoomMetadataChanged,X.ActiveSpeakersChanged,X.ConnectionQualityChanged,X.ParticipantConnected,X.ParticipantDisconnected,X.ParticipantPermissionsChanged,X.ParticipantMetadataChanged,X.ParticipantNameChanged,X.ParticipantAttributesChanged,X.TrackMuted,X.TrackUnmuted,X.TrackPublished,X.TrackUnpublished,X.TrackStreamStateChanged,X.TrackSubscriptionFailed,X.TrackSubscriptionPermissionChanged,X.TrackSubscriptionStatusChanged],_T=[...I8,X.LocalTrackPublished,X.LocalTrackUnpublished];ie.TrackPublished,ie.TrackUnpublished,ie.TrackMuted,ie.TrackUnmuted,ie.TrackStreamStateChanged,ie.TrackSubscribed,ie.TrackUnsubscribed,ie.TrackSubscriptionPermissionChanged,ie.TrackSubscriptionFailed,ie.LocalTrackPublished,ie.LocalTrackUnpublished;var U8=[ie.ConnectionQualityChanged,ie.IsSpeakingChanged,ie.ParticipantMetadataChanged,ie.ParticipantPermissionsChanged,ie.TrackMuted,ie.TrackUnmuted,ie.TrackPublished,ie.TrackUnpublished,ie.TrackStreamStateChanged,ie.TrackSubscriptionFailed,ie.TrackSubscriptionPermissionChanged,ie.TrackSubscriptionStatusChanged];[...U8,ie.LocalTrackPublished,ie.LocalTrackUnpublished];var Jt=Y6.getLogger("lk-components-js");Jt.setDefaultLevel("WARN");var wT=(n=>(n.AgentState="lk.agent.state",n.PublishOnBehalf="lk.publish_on_behalf",n.TranscriptionFinal="lk.transcription_final",n.TranscriptionSegmentId="lk.segment_id",n.TranscribedTrackId="lk.transcribed_track_id",n))(wT||{});function MT(n){return typeof n=="object"}function NT(n){return Array.isArray(n)&&n.filter(MT).length>0}function B8(n){return`${D8}-${n}`}function z8(n){const e=fm(n),t=DT(n.participant).pipe(mr(()=>fm(n)),pr(e));return{className:B8(n.source===ee.Source.Camera||n.source===ee.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:t}}function fm(n){if(np(n))return n.publication;{const{source:e,name:t,participant:i}=n;if(e&&t)return i.getTrackPublications().find(r=>r.source===e&&r.trackName===t);if(t)return i.getTrackPublicationByName(t);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function OT(n,...e){return new Xt(t=>{const i=()=>{t.next(n)};return e.forEach(r=>{n.on(r,i)}),()=>{e.forEach(r=>{n.off(r,i)})}}).pipe(pr(n))}function V8(n,e){return new Xt(t=>{const i=(...r)=>{t.next(r)};return n.on(e,i),()=>{n.off(e,i)}})}function F8(n){return V8(n,X.ConnectionStateChanged).pipe(mr(([e])=>e),pr(n.state))}function q8(n,...e){return new Xt(t=>{const i=()=>{t.next(n)};return e.forEach(r=>{n.on(r,i)}),()=>{e.forEach(r=>{n.off(r,i)})}}).pipe(pr(n))}function DT(n){return q8(n,ie.TrackMuted,ie.TrackUnmuted,ie.ParticipantPermissionsChanged,ie.TrackPublished,ie.TrackUnpublished,ie.LocalTrackPublished,ie.LocalTrackUnpublished,ie.MediaDevicesError,ie.TrackSubscriptionStatusChanged).pipe(mr(e=>{const{isMicrophoneEnabled:t,isCameraEnabled:i,isScreenShareEnabled:r}=e,o=e.getTrackPublication(ee.Source.Microphone),u=e.getTrackPublication(ee.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:t,isScreenShareEnabled:r,cameraTrack:u,microphoneTrack:o,participant:e}}))}function H8(n,e){return new Xt(t=>{const i=(...r)=>{t.next(r)};return n.on(e,i),()=>{n.off(e,i)}})}function $8(n){return H8(n,ie.IsSpeakingChanged).pipe(mr(([e])=>e))}function K8(n,e={}){var t;let i;const r=new Xt(f=>(i=f,()=>l.unsubscribe())).pipe(pr(Array.from(n.remoteParticipants.values()))),o=(t=e.additionalRoomEvents)!=null?t:_T,u=Array.from(new Set([X.ParticipantConnected,X.ParticipantDisconnected,X.ConnectionStateChanged,...o])),l=OT(n,...u).subscribe(f=>i?.next(Array.from(f.remoteParticipants.values())));return n.remoteParticipants.size>0&&i?.next(Array.from(n.remoteParticipants.values())),r}function G8(){return{className:"lk-room-container"}}function vS(n,e,t=!0){const i=[n.localParticipant,...Array.from(n.remoteParticipants.values())],r=[];return i.forEach(o=>{e.forEach(u=>{const l=Array.from(o.trackPublications.values()).filter(f=>f.source===u&&(!t||f.track)).map(f=>({participant:o,publication:f,source:f.source}));r.push(...l)})}),{trackReferences:r,participants:i}}function Y8(n,e,t){var i,r;const o=(i=t.additionalRoomEvents)!=null?i:_T,u=(r=t.onlySubscribed)!=null?r:!0,l=Array.from(new Set([X.ParticipantConnected,X.ParticipantDisconnected,X.ConnectionStateChanged,X.LocalTrackPublished,X.LocalTrackUnpublished,X.TrackPublished,X.TrackUnpublished,X.TrackSubscriptionStatusChanged,...o]).values());return OT(n,...l).pipe(mr(f=>{const h=vS(f,e,u);return Jt.debug(`TrackReference[] was updated. (length ${h.trackReferences.length})`,h),h}),pr(vS(n,e,u)))}T.createContext(void 0);const J8=T.createContext(void 0);function AT(){return T.useContext(J8)}function PT(n){const e=AT(),t=n??e;if(!t)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return t}const Q8=T.createContext(void 0);function X8(){return T.useContext(Q8)}function W8(n){const e=X8(),t=AT(),i=n??e??t?.participant;if(!i)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return i}const ip=T.createContext(void 0);function Z8(){const n=T.useContext(ip);if(!n)throw Error("tried to access room context outside of livekit room component");return n}function ez(){return T.useContext(ip)}function Ru(n){const e=ez(),t=n??e;if(!t)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return t}T.createContext(void 0);const tz=T.createContext(void 0);function LT(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=LT(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function nz(){for(var n,e,t=0,i="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=LT(n))&&(i&&(i+=" "),i+=e);return i}function iz(...n){return(...e)=>{for(const t of n)if(typeof t=="function")try{t(...e)}catch(i){console.error(i)}}}function jT(...n){const e={...n[0]};for(let t=1;t<n.length;t++){const i=n[t];for(const r in i){const o=e[r],u=i[r];typeof o=="function"&&typeof u=="function"&&r[0]==="o"&&r[1]==="n"&&r.charCodeAt(2)>=65&&r.charCodeAt(2)<=90?e[r]=iz(o,u):(r==="className"||r==="UNSAFE_className")&&typeof o=="string"&&typeof u=="string"?e[r]=nz(o,u):e[r]=u!==void 0?u:o}}return e}function sz(n){return n!==void 0}function az(...n){return jT(...n.filter(sz))}function rz(n,e){return n==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:n==="e2ee"&&e?"e2ee-enabled":e}const oz={connect:!0,audio:!1,video:!1};function cz(n){const{token:e,serverUrl:t,options:i,room:r,connectOptions:o,connect:u,audio:l,video:f,screen:h,onConnected:m,onDisconnected:g,onError:b,onMediaDeviceFailure:C,onEncryptionError:E,simulateParticipants:k,..._}={...oz,...n};i&&r&&Jt.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[w,O]=T.useState(),D=T.useRef(u);T.useEffect(()=>{O(r??new lr(i))},[r,JSON.stringify(i,rz)]);const x=T.useMemo(()=>{const{className:R}=G8();return jT(_,{className:R})},[_]);return T.useEffect(()=>{if(!w)return;const R=()=>{const P=w.localParticipant;Jt.debug("trying to publish local tracks"),Promise.all([P.setMicrophoneEnabled(!!l,typeof l!="boolean"?l:void 0),P.setCameraEnabled(!!f,typeof f!="boolean"?f:void 0),P.setScreenShareEnabled(!!h,typeof h!="boolean"?h:void 0)]).catch(z=>{Jt.warn(z),b?.(z)})},M=(P,z)=>{const W=Fo.getFailure(P);C?.(W,z)},L=P=>{E?.(P)},B=P=>{g?.(P)},V=()=>{m?.()};return w.on(X.SignalConnected,R).on(X.MediaDevicesError,M).on(X.EncryptionError,L).on(X.Disconnected,B).on(X.Connected,V),()=>{w.off(X.SignalConnected,R).off(X.MediaDevicesError,M).off(X.EncryptionError,L).off(X.Disconnected,B).off(X.Connected,V)}},[w,l,f,h,b,E,C,m,g]),T.useEffect(()=>{if(w){if(k){w.simulateParticipants({participants:{count:k},publish:{audio:!0,useRealTracks:!0}});return}if(u){if(D.current=!0,Jt.debug("connecting"),!e){Jt.debug("no token yet");return}if(!t){Jt.warn("no livekit url provided"),b?.(Error("no livekit url provided"));return}w.connect(t,e,o).catch(R=>{Jt.warn(R),D.current===!0&&b?.(R)})}else Jt.debug("disconnecting because connect is false"),D.current=!1,w.disconnect()}},[u,e,JSON.stringify(o),w,b,t,k]),T.useEffect(()=>{if(w)return()=>{Jt.info("disconnecting on onmount"),w.disconnect()}},[w]),{room:w,htmlProps:x}}const lz=T.forwardRef(function(n,e){const{room:t,htmlProps:i}=cz(n);return T.createElement("div",{ref:e,...i},t&&T.createElement(ip.Provider,{value:t},T.createElement(tz.Provider,{value:n.featureFlags},n.children)))});function IT(n,e,t=!0){const[i,r]=T.useState(e);return T.useEffect(()=>{if(t&&r(e),typeof window>"u"||!n)return;const o=n.subscribe(r);return()=>o.unsubscribe()},[n,t]),i}function uz(n){const e=Ru(n),t=T.useMemo(()=>F8(e),[e]);return IT(t,e.state)}function dz(n){const e=W8(n),t=T.useMemo(()=>$8(e),[e]);return IT(t,e.isSpeaking)}function UT(n={}){const e=Ru(n.room),[t,i]=T.useState(e.localParticipant),[r,o]=T.useState(t.isMicrophoneEnabled),[u,l]=T.useState(t.isCameraEnabled),[f,h]=T.useState(t.isScreenShareEnabled),[m,g]=T.useState(t.lastMicrophoneError),[b,C]=T.useState(t.lastCameraError),[E,k]=T.useState(void 0),[_,w]=T.useState(void 0),O=D=>{l(D.isCameraEnabled),o(D.isMicrophoneEnabled),h(D.isScreenShareEnabled),w(D.cameraTrack),k(D.microphoneTrack),g(D.participant.lastMicrophoneError),C(D.participant.lastCameraError),i(D.participant)};return T.useEffect(()=>{const D=DT(e.localParticipant).subscribe(O);return()=>D.unsubscribe()},[e]),{isMicrophoneEnabled:r,isScreenShareEnabled:f,isCameraEnabled:u,microphoneTrack:E,cameraTrack:_,lastMicrophoneError:m,lastCameraError:b,localParticipant:t}}function fz(n={}){const e=Ru(n.room),[t,i]=T.useState([]);return T.useEffect(()=>{const r=K8(e,{additionalRoomEvents:n.updateOnlyOn}).subscribe(i);return()=>r.unsubscribe()},[e,JSON.stringify(n.updateOnlyOn)]),t}function hz(n={}){const e=fz(n),{localParticipant:t}=UT(n);return T.useMemo(()=>[t,...e],[t,e])}function sp(n=[ee.Source.Camera,ee.Source.Microphone,ee.Source.ScreenShare,ee.Source.ScreenShareAudio,ee.Source.Unknown],e={}){const t=Ru(e.room),[i,r]=T.useState([]),[o,u]=T.useState([]),l=T.useMemo(()=>n.map(f=>MT(f)?f.source:f),[JSON.stringify(n)]);return T.useEffect(()=>{const f=Y8(t,l,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:h,participants:m})=>{Jt.debug("setting track bundles",h,m),r(h),u(m)});return()=>f.unsubscribe()},[t,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(n)]),T.useMemo(()=>{if(NT(n)){const f=pz(n,o),h=Array.from(i);return o.forEach(m=>{f.has(m.identity)&&(f.get(m.identity)??[]).forEach(g=>{if(i.find(({participant:C,publication:E})=>m.identity===C.identity&&E.source===g))return;Jt.debug(`Add ${g} placeholder for participant ${m.identity}.`);const b={participant:m,source:g};h.push(b)})}),h}else return i},[i,o,n])}function mz(n,e){const t=new Set(n);for(const i of e)t.delete(i);return t}function pz(n,e){const t=new Map;if(NT(n)){const i=n.filter(r=>r.withPlaceholder).map(r=>r.source);e.forEach(r=>{const o=r.getTrackPublications().map(l=>{var f;return(f=l.track)==null?void 0:f.source}).filter(l=>l!==void 0),u=Array.from(mz(new Set(i),new Set(o)));u.length>0&&t.set(r.identity,u)})}return t}wT.AgentState;var xl={exports:{}},yS;function gz(){if(yS)return xl.exports;yS=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(x,R,M){return Function.prototype.apply.call(x,R,M)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:t=function(x){return Object.getOwnPropertyNames(x)};function i(x){console&&console.warn&&console.warn(x)}var r=Number.isNaN||function(x){return x!==x};function o(){o.init.call(this)}xl.exports=o,xl.exports.once=w,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function l(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(x){if(typeof x!="number"||x<0||r(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");u=x}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||r(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function f(x){return x._maxListeners===void 0?o.defaultMaxListeners:x._maxListeners}o.prototype.getMaxListeners=function(){return f(this)},o.prototype.emit=function(x){for(var R=[],M=1;M<arguments.length;M++)R.push(arguments[M]);var L=x==="error",B=this._events;if(B!==void 0)L=L&&B.error===void 0;else if(!L)return!1;if(L){var V;if(R.length>0&&(V=R[0]),V instanceof Error)throw V;var P=new Error("Unhandled error."+(V?" ("+V.message+")":""));throw P.context=V,P}var z=B[x];if(z===void 0)return!1;if(typeof z=="function")e(z,this,R);else for(var W=z.length,J=E(z,W),M=0;M<W;++M)e(J[M],this,R);return!0};function h(x,R,M,L){var B,V,P;if(l(M),V=x._events,V===void 0?(V=x._events=Object.create(null),x._eventsCount=0):(V.newListener!==void 0&&(x.emit("newListener",R,M.listener?M.listener:M),V=x._events),P=V[R]),P===void 0)P=V[R]=M,++x._eventsCount;else if(typeof P=="function"?P=V[R]=L?[M,P]:[P,M]:L?P.unshift(M):P.push(M),B=f(x),B>0&&P.length>B&&!P.warned){P.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.emitter=x,z.type=R,z.count=P.length,i(z)}return x}o.prototype.addListener=function(x,R){return h(this,x,R,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(x,R){return h(this,x,R,!0)};function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(x,R,M){var L={fired:!1,wrapFn:void 0,target:x,type:R,listener:M},B=m.bind(L);return B.listener=M,L.wrapFn=B,B}o.prototype.once=function(x,R){return l(R),this.on(x,g(this,x,R)),this},o.prototype.prependOnceListener=function(x,R){return l(R),this.prependListener(x,g(this,x,R)),this},o.prototype.removeListener=function(x,R){var M,L,B,V,P;if(l(R),L=this._events,L===void 0)return this;if(M=L[x],M===void 0)return this;if(M===R||M.listener===R)--this._eventsCount===0?this._events=Object.create(null):(delete L[x],L.removeListener&&this.emit("removeListener",x,M.listener||R));else if(typeof M!="function"){for(B=-1,V=M.length-1;V>=0;V--)if(M[V]===R||M[V].listener===R){P=M[V].listener,B=V;break}if(B<0)return this;B===0?M.shift():k(M,B),M.length===1&&(L[x]=M[0]),L.removeListener!==void 0&&this.emit("removeListener",x,P||R)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(x){var R,M,L;if(M=this._events,M===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete M[x]),this;if(arguments.length===0){var B=Object.keys(M),V;for(L=0;L<B.length;++L)V=B[L],V!=="removeListener"&&this.removeAllListeners(V);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(R=M[x],typeof R=="function")this.removeListener(x,R);else if(R!==void 0)for(L=R.length-1;L>=0;L--)this.removeListener(x,R[L]);return this};function b(x,R,M){var L=x._events;if(L===void 0)return[];var B=L[R];return B===void 0?[]:typeof B=="function"?M?[B.listener||B]:[B]:M?_(B):E(B,B.length)}o.prototype.listeners=function(x){return b(this,x,!0)},o.prototype.rawListeners=function(x){return b(this,x,!1)},o.listenerCount=function(x,R){return typeof x.listenerCount=="function"?x.listenerCount(R):C.call(x,R)},o.prototype.listenerCount=C;function C(x){var R=this._events;if(R!==void 0){var M=R[x];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function E(x,R){for(var M=new Array(R),L=0;L<R;++L)M[L]=x[L];return M}function k(x,R){for(;R+1<x.length;R++)x[R]=x[R+1];x.pop()}function _(x){for(var R=new Array(x.length),M=0;M<R.length;++M)R[M]=x[M].listener||x[M];return R}function w(x,R){return new Promise(function(M,L){function B(P){x.removeListener(R,V),L(P)}function V(){typeof x.removeListener=="function"&&x.removeListener("error",B),M([].slice.call(arguments))}D(x,R,V,{once:!0}),R!=="error"&&O(x,B,{once:!0})})}function O(x,R,M){typeof x.on=="function"&&D(x,"error",R,M)}function D(x,R,M,L){if(typeof x.on=="function")L.once?x.once(R,M):x.on(R,M);else if(typeof x.addEventListener=="function")x.addEventListener(R,function B(V){L.once&&x.removeEventListener(R,B),M(V)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}return xl.exports}gz();function BT(n,e={}){const[t,i]=T.useState(fm(n)),[r,o]=T.useState(t?.isMuted),[u,l]=T.useState(t?.isSubscribed),[f,h]=T.useState(t?.track),[m,g]=T.useState("landscape"),b=T.useRef(),{className:C,trackObserver:E}=T.useMemo(()=>z8(n),[n.participant.sid??n.participant.identity,n.source,np(n)&&n.publication.trackSid]);return T.useEffect(()=>{const k=E.subscribe(_=>{Jt.debug("update track",_),i(_),o(_?.isMuted),l(_?.isSubscribed),h(_?.track)});return()=>k?.unsubscribe()},[E]),T.useEffect(()=>{var k,_;return f&&(b.current&&f.detach(b.current),(k=e.element)!=null&&k.current&&!(n.participant.isLocal&&f?.kind==="audio")&&f.attach(e.element.current)),b.current=(_=e.element)==null?void 0:_.current,()=>{b.current&&f?.detach(b.current)}},[f,e.element]),T.useEffect(()=>{var k,_;if(typeof((k=t?.dimensions)==null?void 0:k.width)=="number"&&typeof((_=t?.dimensions)==null?void 0:_.height)=="number"){const w=t.dimensions.width>t.dimensions.height?"landscape":"portrait";g(w)}},[t]),{publication:t,isMuted:r,isSubscribed:u,track:f,elementProps:az(e.props,{className:C,"data-lk-local-participant":n.participant.isLocal,"data-lk-source":t?.source,...t?.kind==="video"&&{"data-lk-orientation":m}})}}var Th,bS;function vz(){if(bS)return Th;bS=1;var n="Expected a function",e=NaN,t="[object Symbol]",i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt,f=typeof Tl=="object"&&Tl&&Tl.Object===Object&&Tl,h=typeof self=="object"&&self&&self.Object===Object&&self,m=f||h||Function("return this")(),g=Object.prototype,b=g.toString,C=Math.max,E=Math.min,k=function(){return m.Date.now()};function _(R,M,L){var B,V,P,z,W,J,he=0,we=!1,H=!1,re=!0;if(typeof R!="function")throw new TypeError(n);M=x(M)||0,w(L)&&(we=!!L.leading,H="maxWait"in L,P=H?C(x(L.maxWait)||0,M):P,re="trailing"in L?!!L.trailing:re);function fe(ve){var Ye=B,Ke=V;return B=V=void 0,he=ve,z=R.apply(Ke,Ye),z}function Re(ve){return he=ve,W=setTimeout(Q,M),we?fe(ve):z}function Me(ve){var Ye=ve-J,Ke=ve-he,wn=M-Ye;return H?E(wn,P-Ke):wn}function I(ve){var Ye=ve-J,Ke=ve-he;return J===void 0||Ye>=M||Ye<0||H&&Ke>=P}function Q(){var ve=k();if(I(ve))return oe(ve);W=setTimeout(Q,Me(ve))}function oe(ve){return W=void 0,re&&B?fe(ve):(B=V=void 0,z)}function de(){W!==void 0&&clearTimeout(W),he=0,B=J=V=W=void 0}function se(){return W===void 0?z:oe(k())}function pe(){var ve=k(),Ye=I(ve);if(B=arguments,V=this,J=ve,Ye){if(W===void 0)return Re(J);if(H)return W=setTimeout(Q,M),fe(J)}return W===void 0&&(W=setTimeout(Q,M)),z}return pe.cancel=de,pe.flush=se,pe}function w(R){var M=typeof R;return!!R&&(M=="object"||M=="function")}function O(R){return!!R&&typeof R=="object"}function D(R){return typeof R=="symbol"||O(R)&&b.call(R)==t}function x(R){if(typeof R=="number")return R;if(D(R))return e;if(w(R)){var M=typeof R.valueOf=="function"?R.valueOf():R;R=w(M)?M+"":M}if(typeof R!="string")return R===0?R:+R;R=R.replace(i,"");var L=o.test(R);return L||u.test(R)?l(R.slice(2),L?2:8):r.test(R)?e:+R}return Th=_,Th}var yz=vz();const SS=aT(yz);function bz(n){const e=T.useRef(n);e.current=n,T.useEffect(()=>()=>{e.current()},[])}function Sz(n,e=500,t){const i=T.useRef();bz(()=>{i.current&&i.current.cancel()});const r=T.useMemo(()=>{const o=SS(n,e,t),u=(...l)=>o(...l);return u.cancel=()=>{o.cancel()},u.isPending=()=>!!i.current,u.flush=()=>o.flush(),u},[n,e,t]);return T.useEffect(()=>{i.current=SS(n,e,t)},[n,e,t]),r}function Cz(n,e,t){const i=((h,m)=>h===m),r=n instanceof Function?n():n,[o,u]=T.useState(r),l=T.useRef(r),f=Sz(u,e,t);return i(l.current,r)||(f(r),l.current=r),[o,f]}function kz({threshold:n=0,root:e=null,rootMargin:t="0%",freezeOnceVisible:i=!1,initialIsIntersecting:r=!1,onChange:o}={}){var u;const[l,f]=T.useState(null),[h,m]=T.useState(()=>({isIntersecting:r,entry:void 0})),g=T.useRef();g.current=o;const b=((u=h.entry)==null?void 0:u.isIntersecting)&&i;T.useEffect(()=>{if(!l||!("IntersectionObserver"in window)||b)return;const k=new IntersectionObserver(_=>{const w=Array.isArray(k.thresholds)?k.thresholds:[k.thresholds];_.forEach(O=>{const D=O.isIntersecting&&w.some(x=>O.intersectionRatio>=x);m({isIntersecting:D,entry:O}),g.current&&g.current(D,O)})},{threshold:n,root:e,rootMargin:t});return k.observe(l),()=>{k.disconnect()}},[l,JSON.stringify(n),e,t,b,i]);const C=T.useRef(null);T.useEffect(()=>{var k;!l&&(k=h.entry)!=null&&k.target&&!i&&!b&&C.current!==h.entry.target&&(C.current=h.entry.target,m({isIntersecting:r,entry:void 0}))},[l,h.entry,i,b,r]);const E=[f,!!h.isIntersecting,h.entry];return E.ref=E[0],E.isIntersecting=E[1],E.entry=E[2],E}const Tz=T.forwardRef(function({onTrackClick:n,onClick:e,onSubscriptionStatusChanged:t,trackRef:i,manageSubscription:r,...o},u){const l=PT(i),f=T.useRef(null);T.useImperativeHandle(u,()=>f.current);const h=kz({root:f.current}),[m]=Cz(h,3e3);T.useEffect(()=>{r&&l.publication instanceof su&&m?.isIntersecting===!1&&h?.isIntersecting===!1&&l.publication.setSubscribed(!1)},[m,l,r]),T.useEffect(()=>{r&&l.publication instanceof su&&h?.isIntersecting===!0&&l.publication.setSubscribed(!0)},[h,l,r]);const{elementProps:g,publication:b,isSubscribed:C}=BT(l,{element:f,props:o});T.useEffect(()=>{t?.(!!C)},[C,t]);const E=k=>{e?.(k),n?.({participant:l?.participant,track:b})};return T.createElement("video",{ref:f,...g,muted:!0,onClick:E})}),Ez=T.forwardRef(function({trackRef:n,onSubscriptionStatusChanged:e,volume:t,...i},r){const o=PT(n),u=T.useRef(null);T.useImperativeHandle(r,()=>u.current);const{elementProps:l,isSubscribed:f,track:h,publication:m}=BT(o,{element:u,props:i});return T.useEffect(()=>{e?.(!!f)},[f,e]),T.useEffect(()=>{h===void 0||t===void 0||(h instanceof nT?h.setVolume(t):Jt.warn("Volume can only be set on remote audio tracks."))},[t,h]),T.useEffect(()=>{m===void 0||i.muted===void 0||(m instanceof su?m.setEnabled(!i.muted):Jt.warn("Can only call setEnabled on remote track publications."))},[i.muted,m,h]),T.createElement("audio",{ref:u,...l})});function xz({room:n,volume:e,muted:t}){const i=sp([ee.Source.Microphone,ee.Source.ScreenShareAudio,ee.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0,room:n}).filter(r=>!r.participant.isLocal&&r.publication.kind===ee.Kind.Audio);return T.createElement("div",{style:{display:"none"}},i.map(r=>T.createElement(Ez,{key:j8(r),trackRef:r,volume:e,muted:t})))}function CS({participant:n,compact:e=!1}){const t=dz(n),i=be(P=>P.currentVoiceChannelId),r=be(P=>P.voiceStates),o=be(P=>P.userVolumes),u=be(P=>P.setUserVolume),l=at(P=>P.user?.id),[f,h]=T.useState(!1),[m,g]=T.useState({x:0,y:0}),b=T.useRef(null),E=(i?r[i]??[]:[]).find(P=>P.user_id===n.identity),k=n.name||n.identity,_=k.charAt(0).toUpperCase(),w=E?.is_muted??!1,O=E?.is_deafened??!1,D=n.identity===l,x=o[n.identity]??100,R=`voice-participant-avatar${t?" speaking":""}`,M=T.useCallback(P=>{D||(P.preventDefault(),g({x:P.clientX,y:P.clientY}),h(!0))},[D]);T.useEffect(()=>{if(!f)return;function P(W){b.current&&!b.current.contains(W.target)&&h(!1)}function z(W){W.key==="Escape"&&h(!1)}return requestAnimationFrame(()=>{document.addEventListener("mousedown",P),document.addEventListener("keydown",z)}),()=>{document.removeEventListener("mousedown",P),document.removeEventListener("keydown",z)}},[f]),T.useEffect(()=>{if(!f||!b.current)return;const P=b.current,z=P.getBoundingClientRect(),W=window.innerWidth,J=window.innerHeight;let he=m.x,we=m.y;he+z.width>W-8&&(he=W-z.width-8),we+z.height>J-8&&(we=J-z.height-8),P.style.left=`${he}px`,P.style.top=`${we}px`},[f,m]);const L=T.useCallback(P=>{u(n.identity,Number(P.target.value))},[n.identity,u]),B=w||O?y.jsx("div",{className:"voice-participant-overlay",children:O?y.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728A9 9 0 015.636 5.636"})}):y.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:[y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}):null,V=f?y.jsxs("div",{ref:b,className:"vp-vol-popup",style:{position:"fixed",left:m.x,top:m.y,zIndex:9999},children:[y.jsx("div",{className:"vp-vol-header",children:k}),y.jsxs("div",{className:"vp-vol-slider",children:[y.jsx("svg",{style:{width:14,height:14,flexShrink:0},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072M17.95 6.05a8 8 0 010 11.9M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})}),y.jsx("input",{type:"range",min:0,max:200,value:x,onChange:L,className:"vp-vol-range",style:{background:`linear-gradient(to right, var(--primary) ${x/200*100}%, var(--bg-5) ${x/200*100}%)`}}),y.jsxs("span",{className:"vp-vol-value",children:[x,"%"]})]})]}):null;return e?y.jsxs(y.Fragment,{children:[y.jsxs("div",{className:"voice-participant-compact",onContextMenu:M,children:[y.jsxs("div",{className:R,children:[_,B]}),y.jsx("span",{className:"voice-participant-name",children:k})]}),V]}):y.jsxs(y.Fragment,{children:[y.jsxs("div",{className:"voice-participant",onContextMenu:M,children:[y.jsxs("div",{className:R,children:[_,B]}),y.jsx("span",{className:"voice-participant-name",children:k})]}),V]})}function Rz(){const{t:n}=Te("voice"),e=hz(),i=sp([{source:ee.Source.ScreenShare,withPlaceholder:!1}],{onlySubscribed:!0}).length>0;return e.length===0?i?null:y.jsx("div",{className:"voice-room-loading",children:y.jsx("p",{children:n("noOneInVoice")})}):i?y.jsx("div",{className:"voice-grid-strip",children:e.map(r=>y.jsx(CS,{participant:r,compact:!0},r.identity))}):y.jsx("div",{className:"voice-room-grid",children:e.map(r=>y.jsx(CS,{participant:r},r.identity))})}function _z({setMicEnabled:n}){const e=be(o=>o.inputMode),t=be(o=>o.pttKey),i=be(o=>o.currentVoiceChannelId),r=T.useRef(!1);T.useEffect(()=>{if(e!=="push_to_talk"||!i)return;function o(h){if(!h)return!1;const m=h.tagName;return!!(m==="INPUT"||m==="TEXTAREA"||h.isContentEditable)}function u(h){h.repeat||h.code===t&&(o(document.activeElement)||r.current||(r.current=!0,n(!0)))}function l(h){h.code===t&&r.current&&(r.current=!1,n(!1))}function f(){r.current&&(r.current=!1,n(!1))}return document.addEventListener("keydown",u),document.addEventListener("keyup",l),window.addEventListener("blur",f),()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",l),window.removeEventListener("blur",f),r.current&&(r.current=!1,n(!1))}},[e,t,i,n])}function wz(){const n=Z8(),{localParticipant:e}=UT(),t=be(g=>g.isMuted),i=be(g=>g.isStreaming),r=be(g=>g.inputMode),o=be(g=>g.userVolumes),u=be(g=>g.masterVolume),l=be(g=>g.isDeafened),f=T.useRef(!1),h=T.useCallback(g=>{e.setMicrophoneEnabled(g).catch(b=>{console.error("[VoiceStateManager] PTT mic toggle failed:",b)})},[e]);_z({setMicEnabled:h}),T.useEffect(()=>{f.current&&e.setMicrophoneEnabled(!t).catch(g=>{console.error("[VoiceStateManager] Failed to toggle microphone:",g)})},[t,e]),T.useEffect(()=>{f.current&&e.setScreenShareEnabled(i).catch(g=>{console.error("[VoiceStateManager] Failed to toggle screen share:",g)})},[i,e]),T.useEffect(()=>{function g(){console.log("[VoiceStateManager] Connected to LiveKit room");const{isMuted:b,inputMode:C}=be.getState(),E=C==="push_to_talk"?!1:!b;e.setMicrophoneEnabled(E).catch(k=>{console.error("[VoiceStateManager] Failed to set initial mic state:",k)}),f.current=!0}return n.state===Ve.Connected&&g(),n.on(X.Connected,g),()=>{n.off(X.Connected,g),f.current=!1}},[n,e]),T.useEffect(()=>{if(f.current)if(r==="push_to_talk")e.setMicrophoneEnabled(!1).catch(g=>{console.error("[VoiceStateManager] Failed to mute on PTT switch:",g)});else{const g=be.getState().isMuted;e.setMicrophoneEnabled(!g).catch(b=>{console.error("[VoiceStateManager] Failed to restore mic on VA switch:",b)})}},[r,e]);const m=T.useRef({userVolumes:o,masterVolume:u,isDeafened:l});return m.current={userVolumes:o,masterVolume:u,isDeafened:l},T.useEffect(()=>{n.remoteParticipants.forEach(g=>{const b=o[g.identity]??100,C=l?0:b/100*(u/100);g.setVolume(C)})},[o,u,l,n]),T.useEffect(()=>{function g(b,C,E){if(b.kind!==ee.Kind.Audio)return;const{userVolumes:k,masterVolume:_,isDeafened:w}=m.current,O=k[E.identity]??100,D=w?0:O/100*(_/100);E.setVolume(D)}return n.on(X.TrackSubscribed,g),()=>{n.off(X.TrackSubscribed,g)}},[n]),null}function Mz(){const{t:n}=Te("voice"),e=uz();if(e===Ve.Connected)return null;const i={[Ve.Connecting]:{message:n("connectingToVoice"),dotClass:"voice-connection-dot connecting",textClass:"voice-connection-text warning"},[Ve.Reconnecting]:{message:n("reconnectingToVoice"),dotClass:"voice-connection-dot connecting",textClass:"voice-connection-text warning"},[Ve.Disconnected]:{message:n("voiceDisconnected"),dotClass:"voice-connection-dot error",textClass:"voice-connection-text error"}}[e]??{message:e,dotClass:"voice-connection-dot",textClass:"voice-connection-text muted"};return y.jsxs("div",{className:"voice-connection-status",children:[y.jsx("span",{className:i.dotClass}),y.jsx("span",{className:i.textClass,children:i.message})]})}function Eh({trackRef:n}){const{t:e}=Te("voice"),t=T.useRef(null),[i,r]=T.useState(!1);T.useEffect(()=>{function l(){r(document.fullscreenElement===t.current)}return document.addEventListener("fullscreenchange",l),()=>{document.removeEventListener("fullscreenchange",l)}},[]);const o=T.useCallback(()=>{t.current&&(document.fullscreenElement?document.exitFullscreen().catch(l=>{console.error("[ScreenSharePanel] Failed to exit fullscreen:",l)}):t.current.requestFullscreen().catch(l=>{console.error("[ScreenSharePanel] Failed to enter fullscreen:",l)}))},[]),u=n.participant.name||n.participant.identity;return y.jsxs("div",{ref:t,className:"screen-share-panel",children:[n.publication&&y.jsx(Tz,{trackRef:n}),y.jsxs("div",{className:"screen-share-panel-overlay",children:[y.jsx("span",{className:"screen-share-panel-label",children:u}),y.jsx("button",{onClick:o,className:"screen-share-panel-btn",title:e(i?"exitFullscreen":"fullscreen"),children:i?y.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}):y.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})})})]})]})}function Nz({direction:n,onResize:e}){const t=T.useRef(0),i=T.useRef(!1),r=T.useCallback(f=>{f.currentTarget.setPointerCapture(f.pointerId),i.current=!0,t.current=n==="vertical"?f.clientY:f.clientX,f.preventDefault()},[n]),o=T.useCallback(f=>{if(!i.current)return;const h=n==="vertical"?f.clientY:f.clientX,m=h-t.current;t.current=h,m!==0&&e(m)},[n,e]),u=T.useCallback(f=>{i.current=!1,f.currentTarget.releasePointerCapture(f.pointerId)},[]),l=`screen-share-resize ${n}`;return y.jsx("div",{className:l,onPointerDown:r,onPointerMove:o,onPointerUp:u,style:{touchAction:"none"},children:y.jsx("div",{className:"screen-share-resize-line"})})}const Oz=20,Dz=80,kS=50;function Az(){const{t:n}=Te("voice"),e=sp([{source:ee.Source.ScreenShare,withPlaceholder:!1}],{onlySubscribed:!0}),[t,i]=T.useState("vertical"),[r,o]=T.useState(kS),u=T.useRef(null);T.useEffect(()=>{e.length<2&&o(kS)},[e.length]);const l=T.useCallback(g=>{if(!u.current)return;const b=t==="vertical"?u.current.clientHeight:u.current.clientWidth;if(b===0)return;const C=g/b*100;o(E=>Math.max(Oz,Math.min(Dz,E+C)))},[t]),f=T.useCallback(()=>{i(g=>g==="vertical"?"horizontal":"vertical")},[]);if(e.length===0)return null;if(e.length===1)return y.jsx("div",{className:"screen-share-view",children:y.jsx(Eh,{trackRef:e[0]})});const h=t==="vertical",m=`screen-share-split ${h?"vertical":"horizontal"}`;return y.jsxs("div",{className:"screen-share-view",children:[y.jsx("button",{onClick:f,className:"screen-share-toggle",title:n("toggleLayout"),children:h?y.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v18M3.75 3h16.5a.75.75 0 01.75.75v16.5a.75.75 0 01-.75.75H3.75a.75.75 0 01-.75-.75V3.75A.75.75 0 013.75 3z"})}):y.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h18M3.75 3h16.5a.75.75 0 01.75.75v16.5a.75.75 0 01-.75.75H3.75a.75.75 0 01-.75-.75V3.75A.75.75 0 013.75 3z"})})}),y.jsxs("div",{ref:u,className:m,children:[y.jsx("div",{style:{flex:r},className:"screen-share-pane",children:y.jsx(Eh,{trackRef:e[0]})}),y.jsx(Nz,{direction:t,onResize:l}),y.jsx("div",{style:{flex:100-r},className:"screen-share-pane",children:y.jsx(Eh,{trackRef:e[1]})})]})]})}function Pz(){const{t:n}=Te("voice"),e=be(l=>l.livekitUrl),t=be(l=>l.livekitToken),i=be(l=>l.leaveVoiceChannel),r=be(l=>l.inputDevice),o=T.useCallback(l=>{console.log("[VoiceRoom] Disconnected from LiveKit. Reason:",l),i()},[i]),u=T.useMemo(()=>({noiseSuppression:!0,autoGainControl:!0,echoCancellation:!0,...r?{deviceId:r}:{}}),[r]);return!e||!t?y.jsx("div",{className:"voice-room-loading",children:y.jsx("p",{children:n("connectingToVoice")})}):y.jsxs(lz,{serverUrl:e,token:t,connect:!0,audio:!0,video:!1,options:{audioCaptureDefaults:u,webAudioMix:!0},onDisconnected:o,onError:l=>{console.error("[VoiceRoom] LiveKit error:",l)},style:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:[y.jsx(xz,{}),y.jsx(wz,{}),y.jsxs("div",{className:"voice-room",children:[y.jsx(Mz,{}),y.jsx(Az,{}),y.jsx(Rz,{})]})]})}function Lz(){return xe("/dms")}function jz(n){return xe("/dms",{method:"POST",body:{user_id:n}})}function TS(n,e,t=50){const i=new URLSearchParams;return e&&i.set("before",e),i.set("limit",String(t)),xe(`/dms/${n}/messages?${i}`)}function Iz(n,e){return xe(`/dms/${n}/messages`,{method:"POST",body:{content:e}})}function Uz(n,e){return xe(`/dms/messages/${n}`,{method:"PATCH",body:{content:e}})}function Bz(n){return xe(`/dms/messages/${n}`,{method:"DELETE"})}const zz=[],Vz=[],lt=Wt((n,e)=>({channels:zz,selectedDMId:null,messagesByChannel:{},hasMoreByChannel:{},dmUnreadCounts:{},isLoading:!1,isLoadingMessages:!1,fetchChannels:async()=>{n({isLoading:!0});const t=await Lz();t.success&&t.data?n({channels:t.data,isLoading:!1}):n({isLoading:!1})},selectDM:t=>{n({selectedDMId:t})},createOrGetChannel:async t=>{const i=await jz(t);return i.success&&i.data?(n(r=>r.channels.some(u=>u.id===i.data.id)?r:{channels:[i.data,...r.channels]}),i.data.id):null},fetchMessages:async t=>{if(e().messagesByChannel[t])return;n({isLoadingMessages:!0});const i=await TS(t,void 0,50);i.success&&i.data?n(r=>({messagesByChannel:{...r.messagesByChannel,[t]:i.data.messages},hasMoreByChannel:{...r.hasMoreByChannel,[t]:i.data.has_more},isLoadingMessages:!1})):n({isLoadingMessages:!1})},fetchOlderMessages:async t=>{const i=e().messagesByChannel[t];if(!i||i.length===0||!e().hasMoreByChannel[t])return;const r=i[0].id,o=await TS(t,r,50);o.success&&o.data&&n(u=>({messagesByChannel:{...u.messagesByChannel,[t]:[...o.data.messages,...u.messagesByChannel[t]]},hasMoreByChannel:{...u.hasMoreByChannel,[t]:o.data.has_more}}))},sendMessage:async(t,i)=>(await Iz(t,i)).success,editMessage:async(t,i)=>(await Uz(t,i)).success,deleteMessage:async t=>(await Bz(t)).success,incrementDMUnread:t=>{n(i=>({dmUnreadCounts:{...i.dmUnreadCounts,[t]:(i.dmUnreadCounts[t]??0)+1}}))},clearDMUnread:t=>{n(i=>{if(!i.dmUnreadCounts[t])return i;const r={...i.dmUnreadCounts};return delete r[t],{dmUnreadCounts:r}})},getTotalDMUnread:()=>{const t=e().dmUnreadCounts;return Object.values(t).reduce((i,r)=>i+r,0)},handleDMChannelCreate:t=>{n(i=>i.channels.some(r=>r.id===t.id)?i:{channels:[t,...i.channels]})},handleDMMessageCreate:t=>{n(i=>{const r=i.messagesByChannel[t.dm_channel_id];return!r||r.some(o=>o.id===t.id)?i:{messagesByChannel:{...i.messagesByChannel,[t.dm_channel_id]:[...r,t]}}})},handleDMMessageUpdate:t=>{n(i=>{const r=i.messagesByChannel[t.dm_channel_id];return r?{messagesByChannel:{...i.messagesByChannel,[t.dm_channel_id]:r.map(o=>o.id===t.id?t:o)}}:i})},handleDMMessageDelete:t=>{n(i=>{const r=i.messagesByChannel[t.dm_channel_id];return r?{messagesByChannel:{...i.messagesByChannel,[t.dm_channel_id]:r.filter(o=>o.id!==t.id)}}:i})},getMessagesForChannel:t=>e().messagesByChannel[t]??Vz}));function Fz({channelId:n}){const{t:e}=Te("chat"),t=at(J=>J.user),i=lt(J=>J.fetchMessages),r=lt(J=>J.messagesByChannel[n]??qz),o=lt(J=>J.isLoadingMessages),u=lt(J=>J.sendMessage),l=lt(J=>J.editMessage),f=lt(J=>J.deleteMessage),h=lt(J=>J.channels),m=lt(J=>J.selectDM),g=lt(J=>J.clearDMUnread),[b,C]=T.useState(""),[E,k]=T.useState(!1),[_,w]=T.useState(null),[O,D]=T.useState(""),x=T.useRef(null),R=T.useRef(null),M=h.find(J=>J.id===n)?.other_user;T.useEffect(()=>{i(n)},[n,i]),T.useEffect(()=>(m(n),g(n),()=>{m(null)}),[n,m,g]),T.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[r.length]);const L=T.useCallback(async()=>{if(!b.trim()||E)return;k(!0),await u(n,b.trim())&&(C(""),R.current&&(R.current.style.height="auto")),k(!1)},[n,b,E,u]);function B(J){J.key==="Enter"&&!J.shiftKey&&(J.preventDefault(),L())}function V(J){C(J.target.value),R.current&&(R.current.style.height="auto",R.current.style.height=`${Math.min(R.current.scrollHeight,200)}px`)}async function P(J){O.trim()&&await l(J,O.trim()),w(null)}function z(J){return new Date(J).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function W(J,he){return!J||J.user_id!==he.user_id?!1:new Date(he.created_at).getTime()-new Date(J.created_at).getTime()<300*1e3}return o&&r.length===0?y.jsx("div",{className:"chat-area",children:y.jsx("div",{className:"dm-loading",children:e("loading",{ns:"common"})})}):y.jsxs("div",{className:"chat-area",children:[y.jsxs("div",{className:"dm-header",children:[y.jsx(li,{name:M?.display_name??M?.username??"?",avatarUrl:M?.avatar_url??void 0,size:24}),y.jsx("span",{className:"dm-header-name",children:M?.display_name??M?.username??"DM"})]}),y.jsxs("div",{className:"messages-scroll",children:[r.map((J,he)=>{const we=W(r[he-1],J),H=t?.id===J.user_id,re=J.author?.display_name??J.author?.username??"Unknown";return y.jsxs("div",{className:`msg${we?" grouped":" first-of-group"}`,children:[y.jsx("span",{className:"msg-gtime",children:z(J.created_at)}),y.jsxs("div",{className:"msg-row",children:[y.jsx("div",{className:"msg-avatar",children:y.jsx(li,{name:re,avatarUrl:J.author?.avatar_url??void 0,size:30})}),y.jsxs("div",{className:"msg-body",children:[y.jsxs("div",{className:"msg-meta",children:[y.jsx("span",{className:"msg-name name-default",children:re}),y.jsx("span",{className:"msg-time",children:z(J.created_at)})]}),_===J.id?y.jsxs("div",{className:"msg-edit-area",children:[y.jsx("textarea",{value:O,onChange:fe=>D(fe.target.value),onKeyDown:fe=>{fe.key==="Enter"&&!fe.shiftKey&&(fe.preventDefault(),P(J.id)),fe.key==="Escape"&&w(null)},className:"msg-edit-textarea",rows:2,autoFocus:!0}),y.jsxs("p",{className:"msg-edit-hint",children:["escape = ",e("editCancel"),", enter = ",e("editSave")]})]}):y.jsxs("div",{className:"msg-text",children:[J.content,J.edited_at&&y.jsx("span",{className:"msg-edited",children:e("edited")})]})]})]}),H&&_!==J.id&&y.jsxs("div",{className:"msg-hover-actions",children:[y.jsx("button",{onClick:()=>{D(J.content??""),w(J.id)},title:e("editMessage"),children:y.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),y.jsx("button",{onClick:()=>f(J.id),title:e("deleteMessage"),children:y.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},J.id)}),y.jsx("div",{ref:x})]}),y.jsx("div",{className:"input-area",children:y.jsxs("div",{className:"input-box",children:[y.jsx("textarea",{ref:R,value:b,onChange:V,onKeyDown:B,placeholder:e("dmPlaceholder",{user:M?.username??"DM"}),rows:1,disabled:E}),y.jsx("button",{className:"send-btn",onClick:L,children:y.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:y.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]})})]})}const qz=[],Hz=["left","right","top","bottom","center"];function xh(n,e,t){const i=(n-t.left)/t.width,r=(e-t.top)/t.height,o=i,u=1-i,l=r,f=1-r,h=Math.min(o,u,l,f);return h>=.25?"center":h===o?"left":h===u?"right":h===l?"top":"bottom"}function $z({activeZone:n}){return n?y.jsx("div",{className:"drop-zone-overlay active",children:Hz.map(e=>y.jsx("div",{className:`drop-zone drop-zone-${e}${n===e?" highlight":""}`},e))}):null}function Kz({panelId:n,sendTyping:e}){const{t}=Te("chat"),i=Xe(x=>x.panels[n]),r=Xe(x=>x.setActivePanel),o=Xe(x=>x.splitPanel),u=Xe(x=>x.moveTab),l=Xe(x=>Object.keys(x.panels).length),f=xt(x=>x.categories),h=i?.tabs.find(x=>x.id===i.activeTabId),m=h?f.flatMap(x=>x.channels).find(x=>x.id===h.channelId):null,[g,b]=T.useState(null),C=T.useRef(null),E=T.useRef(0),k=T.useCallback(()=>{r(n)},[n,r]),_=T.useCallback(x=>{if(x.dataTransfer.types.includes("text/tab-id")&&(x.preventDefault(),E.current+=1,E.current===1&&C.current)){const R=C.current.getBoundingClientRect();b(xh(x.clientX,x.clientY,R))}},[]),w=T.useCallback(x=>{if(!x.dataTransfer.types.includes("text/tab-id")||(x.preventDefault(),x.dataTransfer.dropEffect="move",!C.current))return;const R=C.current.getBoundingClientRect();b(xh(x.clientX,x.clientY,R))},[]),O=T.useCallback(x=>{x.preventDefault(),E.current-=1,E.current<=0&&(E.current=0,b(null))},[]),D=T.useCallback(x=>{x.preventDefault(),E.current=0,b(null);const R=x.dataTransfer.getData("text/tab-id"),M=x.dataTransfer.getData("text/panel-id");if(!R||!M||!C.current)return;const L=C.current.getBoundingClientRect(),B=xh(x.clientX,x.clientY,L);if(!(M===n&&(B==="center"||!i||i.tabs.length<2)))switch(B){case"center":u(M,n,R);break;case"left":o(n,"horizontal",R,"before");break;case"right":o(n,"horizontal",R,"after");break;case"top":o(n,"vertical",R,"before");break;case"bottom":o(n,"vertical",R,"after");break}},[n,i,o,u]);return i?y.jsxs("div",{ref:C,className:"split-pane",style:{flex:1,position:"relative"},onClick:k,onDragEnter:_,onDragOver:w,onDragLeave:O,onDrop:D,children:[y.jsx($z,{activeZone:g}),l>1&&i.tabs.length>1&&y.jsx(LU,{panelId:n}),h?h.type==="text"?y.jsx(b3,{channelId:h.channelId,channel:m??null,sendTyping:e}):h.type==="dm"?y.jsx(Fz,{channelId:h.channelId}):y.jsxs("div",{className:"voice-room",children:[m&&y.jsxs("div",{className:"channel-bar",children:[y.jsx("span",{className:"ch-hash",children:h.type==="voice"?"":""}),y.jsx("span",{className:"ch-name",children:m.name})]}),y.jsx(Pz,{})]}):y.jsx("div",{className:"no-channel",children:t("noChannel")})]}):null}function hm({node:n,path:e=[],sendTyping:t}){if(n.type==="leaf")return y.jsx(Kz,{panelId:n.panelId,sendTyping:t});const i=n.direction==="vertical";return y.jsxs("div",{className:`split-container${i?" vertical":""}`,children:[y.jsx("div",{className:"split-pane",style:{flex:n.ratio},children:y.jsx(hm,{node:n.children[0],path:[...e,0],sendTyping:t})}),y.jsx(Gz,{direction:n.direction,path:e,ratio:n.ratio}),y.jsx("div",{className:"split-pane",style:{flex:1-n.ratio},children:y.jsx(hm,{node:n.children[1],path:[...e,1],sendTyping:t})})]})}function Gz({direction:n,path:e}){const t=Xe(h=>h.setSplitRatio),[i,r]=T.useState(!1),o=T.useRef(null),u=n==="horizontal",l=T.useCallback(h=>{h.preventDefault(),r(!0);const m=o.current?.parentElement;if(!m)return;const g=m.getBoundingClientRect();function b(E){const k=u?(E.clientX-g.left)/g.width:(E.clientY-g.top)/g.height;t(e,k)}function C(){r(!1),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",C)}document.addEventListener("mousemove",b),document.addEventListener("mouseup",C)},[u,e,t]),f=`split-handle ${u?"horizontal":"vertical"}${i?" active":""}`;return y.jsx("div",{ref:o,className:f,onMouseDown:l,children:y.jsx("div",{className:"split-handle-dot"})})}const ql=Wt((n,e)=>({options:null,resolver:null,open:t=>new Promise(i=>{n({options:t,resolver:i})}),confirm:()=>{const{resolver:t}=e();t&&t(!0),n({options:null,resolver:null})},cancel:()=>{const{resolver:t}=e();t&&t(!1),n({options:null,resolver:null})}}));function Xo(){const n=ql(e=>e.open);return T.useCallback(e=>n(e),[n])}function Yz({role:n}){return y.jsxs("span",{className:"role-badge",children:[y.jsx("span",{className:"role-badge-dot",style:{backgroundColor:n.color||"#99AAB5"}}),n.name]})}function Jz({member:n,position:e,onClose:t}){const{t:i}=Te("common"),r=Xo(),o=T.useRef(null),u=at(w=>w.user),f=Et(w=>w.members.find(O=>O.id===u?.id))?.effective_permissions??0,h=u?.id===n.id,m=!h&&Vn(f,Pe.KickMembers),g=!h&&Vn(f,Pe.BanMembers);T.useEffect(()=>{let w;function O(D){o.current&&!o.current.contains(D.target)&&t()}return w=requestAnimationFrame(()=>{document.addEventListener("mousedown",O)}),()=>{cancelAnimationFrame(w),document.removeEventListener("mousedown",O)}},[t]);const b=[...n.roles].sort((w,O)=>O.position-w.position),C=new Date(n.created_at).toLocaleDateString();async function E(){await r({message:i("confirmKick",{username:n.username}),confirmLabel:i("kick"),danger:!0})&&(await uC(n.id),t())}async function k(){await r({message:i("confirmBan",{username:n.username}),confirmLabel:i("ban"),danger:!0})&&(await dC(n.id,""),t())}async function _(){const w=await lt.getState().createOrGetChannel(n.id);if(w){const O=n.display_name??n.username;Xe.getState().openTab(w,"dm",O)}t()}return y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"member-card-backdrop",onClick:t}),y.jsxs("div",{ref:o,className:"member-card",style:{top:e.top,left:e.left},children:[y.jsx("div",{className:"member-card-banner",style:b[0]?.color?{background:`linear-gradient(135deg, ${b[0].color}, #0088a3)`}:void 0}),y.jsx("div",{className:"member-card-avatar",children:y.jsx("div",{className:"avatar av-default avatar-round",style:{width:64,height:64,fontSize:24},children:n.username.charAt(0).toUpperCase()})}),y.jsxs("div",{className:"member-card-body",children:[y.jsx("div",{className:"member-card-name",children:n.display_name??n.username}),n.display_name&&y.jsx("div",{className:"member-card-username",children:n.username}),n.custom_status&&y.jsx("div",{className:"member-card-username",style:{marginTop:4},children:n.custom_status}),y.jsx("div",{className:"member-card-divider"}),y.jsx("div",{className:"member-card-section-title",children:i("roles")}),y.jsx("div",{className:"member-card-roles",children:b.length>0?b.map(w=>y.jsx(Yz,{role:w},w.id)):y.jsx("span",{className:"member-card-joined",children:i("noRoles")})}),y.jsx("div",{className:"member-card-divider"}),y.jsx("div",{className:"member-card-joined",children:i("joinedAt",{date:C})}),y.jsxs("div",{className:"member-card-actions",children:[!h&&y.jsx("button",{className:"member-card-btn member-card-btn-dm",onClick:_,children:i("sendMessage")}),m&&y.jsx("button",{className:"member-card-btn member-card-btn-kick",onClick:E,children:i("kick")}),g&&y.jsx("button",{className:"member-card-btn member-card-btn-ban",onClick:k,children:i("ban")})]})]})]})]})}function zT(n){return n.roles.length===0?null:n.roles.reduce((e,t)=>t.position>e.position?t:e)}function Qz(n){const e=zT(n);if(!e)return null;const t=e.name.toLowerCase();return t.includes("admin")||t.includes("owner")?"admin":t.includes("mod")?"mod":null}function Xz(n){switch(n){case"online":return"status-on";case"idle":return"status-idle";case"dnd":return"status-dnd";default:return"status-off"}}function Rh({member:n,isOnline:e}){const{t}=Te("common"),{menuState:i,openMenu:r,closeMenu:o}=Tm(),u=Xo(),l=at(x=>x.user),f=Et(x=>x.members),[h,m]=T.useState(!1),[g,b]=T.useState({top:0,left:0}),C=T.useRef(null),E=zT(n),k=Qz(n),_=E?.color||void 0,w=n.display_name??n.username,O=T.useCallback(x=>{const R=l?.id===n.id,L=f.find(z=>z.id===l?.id)?.effective_permissions??0,B=Vn(L,Pe.KickMembers),V=Vn(L,Pe.BanMembers),P=[];R||P.push({label:t("sendMessage"),onClick:async()=>{const z=await lt.getState().createOrGetChannel(n.id);z&&(lt.getState().selectDM(z),Xe.getState().openTab(z,"dm",n.display_name??n.username))}}),P.push({label:"Copy ID",onClick:()=>navigator.clipboard.writeText(n.id),separator:!R}),B&&!R&&P.push({label:t("kick"),onClick:async()=>{await u({message:t("confirmKick",{username:n.username}),confirmLabel:t("kick"),danger:!0})&&await uC(n.id)},danger:!0,separator:!0}),V&&!R&&P.push({label:t("ban"),onClick:async()=>{await u({message:t("confirmBan",{username:n.username}),confirmLabel:t("ban"),danger:!0})&&await dC(n.id,"")},danger:!0}),r(x,P)},[l,n,f,r,u,t]),D=T.useCallback(()=>{if(h){m(!1);return}if(C.current){const x=C.current.getBoundingClientRect(),R=288,M=8;let L=x.top;const B=350;L+B>window.innerHeight&&(L=window.innerHeight-B-16),L<8&&(L=8),b({top:L,left:x.left-R-M})}m(!0)},[h]);return y.jsxs(y.Fragment,{children:[y.jsxs("div",{ref:C,onClick:D,onContextMenu:O,className:`member${e?"":" offline"}`,children:[y.jsxs("div",{className:"member-av-wrap",children:[y.jsx(li,{name:n.username,role:k,avatarUrl:n.avatar_url??void 0,size:28}),y.jsx("span",{className:`member-status ${Xz(n.status)}`})]}),y.jsxs("div",{className:"member-info",children:[y.jsx("span",{className:"member-name",style:_?{color:_}:void 0,children:w}),n.custom_status&&y.jsx("span",{className:"member-activity",children:n.custom_status})]})]}),y.jsx(Em,{state:i,onClose:o}),h&&KS.createPortal(y.jsx(Jz,{member:n,position:g,onClose:()=>m(!1)}),document.body)]})}function Wz(n){return n.roles.length===0?null:n.roles.reduce((e,t)=>t.position>e.position?t:e)}function Zz(n){const e=new Map;for(const i of n){const r=Wz(i);if(!r)continue;const o=e.get(r.id);o?o.members.push(i):e.set(r.id,{role:r,members:[i]})}const t=Array.from(e.values()).sort((i,r)=>r.role.position-i.role.position);for(const i of t)i.members.sort((r,o)=>{const u=r.display_name??r.username,l=o.display_name??o.username;return u.localeCompare(l)});return t}function eV(){const{t:n}=Te("common"),e=Et(g=>g.members),t=Et(g=>g.isLoading),i=Et(g=>g.onlineUserIds),r=Xe(g=>g.toggleMembers),o=Xe(g=>g.membersOpen),u=e.filter(g=>i.has(g.id)),l=e.filter(g=>!i.has(g.id)),f=Zz(u),h=u.filter(g=>g.roles.length===0),m=[...l].sort((g,b)=>{const C=g.display_name??g.username,E=b.display_name??b.username;return C.localeCompare(E)});return y.jsx("div",{className:`members-panel${o?" open":""}`,children:y.jsxs("div",{className:"members-inner",children:[y.jsxs("div",{className:"members-header",children:[y.jsx("h3",{children:n("members")}),y.jsx("button",{onClick:r,children:""})]}),y.jsxs("div",{className:"members-list",children:[t&&e.length===0&&y.jsx(ZU,{count:8}),f.map(g=>y.jsxs("div",{children:[y.jsxs("div",{className:"member-label",children:[g.role.name,"  ",g.members.length]}),g.members.map(b=>y.jsx(Rh,{member:b,isOnline:!0},b.id))]},g.role.id)),h.length>0&&y.jsxs("div",{children:[y.jsxs("div",{className:"member-label",children:[n("online"),"  ",h.length]}),h.map(g=>y.jsx(Rh,{member:g,isOnline:!0},g.id))]}),m.length>0&&y.jsxs("div",{children:[y.jsxs("div",{className:"member-label",children:[n("offline"),"  ",m.length]}),m.map(g=>y.jsx(Rh,{member:g,isOnline:!1},g.id))]})]})]})})}const tV="modulepreload",nV=function(n){return"/"+n},ES={},iV=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){let h=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var u=h;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),f=l?.nonce||l?.getAttribute("nonce");r=h(t.map(m=>{if(m=nV(m),m in ES)return;ES[m]=!0;const g=m.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${b}`))return;const C=document.createElement("link");if(C.rel=g?"stylesheet":tV,g||(C.as="script"),C.crossOrigin="",C.href=m,f&&C.setAttribute("nonce",f),document.head.appendChild(C),g)return new Promise((E,k)=>{C.addEventListener("load",E),C.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(l){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=l,window.dispatchEvent(f),!f.defaultPrevented)throw l}return r.then(l=>{for(const f of l||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})},ar=Wt(n=>({isOpen:!1,activeTab:"profile",openSettings:(e="profile")=>n({isOpen:!0,activeTab:e}),closeSettings:()=>n({isOpen:!1}),setActiveTab:e=>n({activeTab:e})}));function sV(n,e){return xe(`/channels/${n}/read`,{method:"POST",body:{message_id:e}})}function aV(){return xe("/channels/unread")}const rr=Wt(n=>({unreadCounts:{},fetchUnreadCounts:async()=>{const e=await aV();e.success&&e.data&&n(t=>{const i={...t.unreadCounts};for(const r of e.data)i[r.channel_id]=Math.max(r.unread_count,i[r.channel_id]??0);return{unreadCounts:i}})},markAsRead:(e,t)=>{n(i=>{if(!i.unreadCounts[e])return i;const r={...i.unreadCounts};return delete r[e],{unreadCounts:r}}),sV(e,t)},incrementUnread:e=>{n(t=>({unreadCounts:{...t.unreadCounts,[e]:(t.unreadCounts[e]??0)+1}}))},clearUnread:e=>{n(t=>{if(!t.unreadCounts[e])return t;const i={...t.unreadCounts};return delete i[e],{unreadCounts:i}})}}));function rV({onClose:n}){const{t:e}=Te("chat"),t=lt(l=>l.channels),i=lt(l=>l.isLoading),r=lt(l=>l.dmUnreadCounts),o=Xe(l=>l.openTab);function u(l,f){o(l,"dm",f),n()}return T.useEffect(()=>{let l;function f(h){const m=h.target;!m.closest(".dm-list-popup")&&!m.closest(".dock-item")&&n()}return l=requestAnimationFrame(()=>{document.addEventListener("mousedown",f)}),()=>{cancelAnimationFrame(l),document.removeEventListener("mousedown",f)}},[n]),y.jsxs("div",{className:"dm-list-popup",children:[y.jsx("div",{className:"dm-list-header",children:y.jsx("span",{children:e("directMessages")})}),y.jsxs("div",{className:"dm-list-items",children:[i&&t.length===0&&y.jsx("div",{className:"dm-list-empty",children:e("loading",{ns:"common"})}),!i&&t.length===0&&y.jsx("div",{className:"dm-list-empty",children:e("noDMs")}),t.map(l=>{const f=l.other_user,h=f?.display_name??f?.username??"?",m=r[l.id]??0;return y.jsxs("button",{className:`dm-list-item${m>0?" has-unread":""}`,onClick:()=>u(l.id,h),children:[y.jsx("div",{className:"dm-list-avatar",children:y.jsx(li,{name:h,avatarUrl:f?.avatar_url??void 0,size:28})}),y.jsx("div",{className:"dm-list-info",children:y.jsx("span",{className:"dm-list-name",children:h})}),m>0&&y.jsx("span",{className:"dm-unread-badge",children:m>99?"99+":m})]},l.id)})]})]})}const To=new Map,xS=5,oV=4e3,cV=300,Fi=Wt((n,e)=>({toasts:[],addToast:(t,i,r=oV)=>{const o=crypto.randomUUID(),u={id:o,type:t,message:i,duration:r,isExiting:!1};n(f=>{const h=[...f.toasts,u];if(h.length>xS){const m=h.splice(0,h.length-xS);for(const g of m){const b=To.get(g.id);b&&(clearTimeout(b),To.delete(g.id))}}return{toasts:h}});const l=setTimeout(()=>{e().removeToast(o)},r);To.set(o,l)},removeToast:t=>{const i=To.get(t);i&&(clearTimeout(i),To.delete(t)),n(r=>({toasts:r.toasts.map(o=>o.id===t?{...o,isExiting:!0}:o)})),setTimeout(()=>{n(r=>({toasts:r.toasts.filter(o=>o.id!==t)}))},cV)}}));function lV(n,e,t){if(!n||!e||!t)return"";const i=16,r={l:n.left-t.left,r:n.right-t.left,t:n.top-t.top,b:n.bottom-t.top},o={l:e.left-t.left,r:e.right-t.left,t:e.top-t.top,b:e.bottom-t.top},u=2,l=r.r-o.r,f=o.l-r.l,h=Math.abs(l),m=Math.abs(f),g=14,b=Math.min(g,h*.7),C=Math.min(g,m*.7);let E="";if(E+=`M ${o.l+i} ${o.t}`,E+=` H ${o.r-i}`,E+=` Q ${o.r} ${o.t} ${o.r} ${o.t+i}`,l>u)E+=` V ${o.b-b}`,E+=` Q ${o.r} ${o.b} ${o.r+b} ${o.b}`,E+=` H ${r.r-i}`,E+=` Q ${r.r} ${o.b} ${r.r} ${o.b+i}`;else if(l<-u)E+=` V ${o.b-i}`,E+=` Q ${o.r} ${o.b} ${o.r-i} ${o.b}`,E+=` H ${r.r+b}`,E+=` Q ${r.r} ${o.b} ${r.r} ${o.b+b}`;else{const k=Math.max(o.r,r.r);E+=` V ${o.b}`,E+=` H ${k}`}if(E+=` V ${r.b-i}`,E+=` Q ${r.r} ${r.b} ${r.r-i} ${r.b}`,E+=` H ${r.l+i}`,E+=` Q ${r.l} ${r.b} ${r.l} ${r.b-i}`,f>u)E+=` V ${o.b+i}`,E+=` Q ${r.l} ${o.b} ${r.l+i} ${o.b}`,E+=` H ${o.l-C}`,E+=` Q ${o.l} ${o.b} ${o.l} ${o.b-C}`;else if(f<-u)E+=` V ${o.b+C}`,E+=` Q ${r.l} ${o.b} ${r.l-C} ${o.b}`,E+=` H ${o.l+i}`,E+=` Q ${o.l} ${o.b} ${o.l} ${o.b-i}`;else{const k=Math.min(o.l,r.l);E+=` V ${o.b}`,E+=` H ${k}`}return E+=` V ${o.t+i}`,E+=` Q ${o.l} ${o.t} ${o.l+i} ${o.t}`,E+=" Z",E}function uV({onJoinVoice:n}){const{t:e}=Te("common"),{t}=Te("channels"),{menuState:i,openMenu:r,closeMenu:o}=Tm(),u=xt(le=>le.categories),l=xt(le=>le.selectedChannelId),f=xt(le=>le.selectChannel),h=Xe(le=>le.openTab),m=at(le=>le.user),g=ar(le=>le.openSettings),b=rr(le=>le.unreadCounts),C=lt(le=>le.dmUnreadCounts),E=Et(le=>le.members),k=xt(le=>le.reorderChannels),_=xt(le=>le.isLoading),O=E.find(le=>le.id===m?.id)?.effective_permissions??0,D=Vn(O,Pe.ManageChannels),x=Object.values(C).reduce((le,Se)=>le+Se,0),R=u.flatMap(le=>le.channels),M=R.filter(le=>le.type==="text"),L=R.filter(le=>le.type==="voice"),B=T.useRef(null),[V,P]=T.useState(null),z=T.useRef(!1),W=T.useRef(new Map),J=T.useCallback((le,Se)=>{if(!D||le.button!==0)return;const ft=Se.type==="text"?M:L,Pt=ft.map(bt=>{const wt=W.current.get(bt.id);if(!wt)return{id:bt.id,left:0,width:0,centerX:0};const St=wt.getBoundingClientRect();return{id:bt.id,left:St.left,width:St.width,centerX:St.left+St.width/2}});B.current={channelId:Se.id,groupType:Se.type,startX:le.clientX,pointerId:le.pointerId,itemRects:Pt,originalOrder:ft.map(bt=>bt.id),currentOrder:ft.map(bt=>bt.id),activated:!1},le.currentTarget.setPointerCapture(le.pointerId)},[D,M,L]),he=T.useCallback(le=>{const Se=B.current;if(!Se)return;const ft=le.clientX-Se.startX;if(!Se.activated&&Math.abs(ft)<8)return;Se.activated||(Se.activated=!0,P(Se.channelId));const bt=Se.itemRects.find(gn=>gn.id===Se.channelId).centerX+ft,wt=Se.itemRects.filter(gn=>gn.id!==Se.channelId);let St=wt.length;for(let gn=0;gn<wt.length;gn++)if(bt<wt[gn].centerX){St=gn;break}const Zo=wt.map(gn=>gn.id);Zo.splice(St,0,Se.channelId),Se.currentOrder=Zo,dV(Se,ft)},[]),we=T.useCallback(le=>{const Se=B.current;if(Se){if(le.currentTarget.releasePointerCapture(Se.pointerId),Se.activated){if(RS(Se),!Se.originalOrder.every((Pt,bt)=>Pt===Se.currentOrder[bt])){const Pt=Se.currentOrder.map((bt,wt)=>({id:bt,position:wt}));k(Pt)}z.current=!0}B.current=null,P(null)}},[k]),H=T.useCallback(le=>{const Se=B.current;Se&&(le.currentTarget.releasePointerCapture(Se.pointerId),Se.activated&&RS(Se),B.current=null,P(null))},[]),[re,fe]=T.useState(!1),Re=Fi(le=>le.addToast),Me=Xo(),[I,Q]=T.useState(null),[oe,de]=T.useState(""),[se,pe]=T.useState(!1);async function ve(){const le=oe.trim();if(!le||se||!I)return;const ft=R.find(bt=>bt.type===I)?.category_id??void 0;pe(!0),(await km({name:le,type:I,category_id:ft})).success?(Re("success",t("channelCreated")),de(""),Q(null)):Re("error",t("channelCreateError")),pe(!1)}const Ye=T.useRef(null),Ke=T.useRef(null),wn=T.useRef(null),[ia,gr]=T.useState(""),[vr,mi]=T.useState({w:0,h:0});T.useEffect(()=>{const le=requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!Ye.current||!Ke.current||!wn.current)return;const Se=Ye.current.getBoundingClientRect(),ft=Ke.current.getBoundingClientRect(),Pt=wn.current.getBoundingClientRect();mi({w:Se.width+4,h:Se.height+4}),gr(lV(ft,Pt,Se))})});return()=>cancelAnimationFrame(le)},[R.length]);const yr=T.useCallback((le,Se)=>{if(B.current?.activated){le.preventDefault();return}const ft=[];ft.push({label:"Copy #"+Se.name,onClick:()=>navigator.clipboard.writeText(Se.name)}),D&&ft.push({label:t("editChannel"),onClick:()=>{g("channels")},separator:!0}),D&&ft.push({label:t("deleteChannel"),onClick:async()=>{if(await Me({message:t("deleteConfirm",{name:Se.name}),confirmLabel:t("deleteChannel"),danger:!0})){const{deleteChannel:bt}=await iV(async()=>{const{deleteChannel:wt}=await Promise.resolve().then(()=>PU);return{deleteChannel:wt}},[]);await bt(Se.id)}},danger:!0}),r(le,ft)},[D,g,r,t]),br=T.useCallback(le=>{if(z.current){z.current=!1;return}le.type==="voice"?(n(le.id),f(le.id),h(le.id,"voice",le.name)):(f(le.id),h(le.id,"text",le.name))},[n,f,h]);function Wo(le,Se){const ft=l===le.id,Pt=Se?0:b[le.id]??0,bt=V===le.id;return y.jsxs("button",{"data-channel-drag-id":le.id,ref:wt=>{wt?W.current.set(le.id,wt):W.current.delete(le.id)},className:`dock-ch-item${Se?" voice":""}${ft?" active":""}${Pt>0?" has-unread":""}${bt?" dragging":""}`,onClick:()=>br(le),onContextMenu:wt=>yr(wt,le),onPointerDown:wt=>J(wt,le),onPointerMove:he,onPointerUp:we,onPointerCancel:H,children:[y.jsx("span",{className:"dock-ch-icon",children:Se?"":"#"}),y.jsx("span",{className:"dock-ch-name",children:le.name}),!Se&&Pt>0&&y.jsx("span",{className:"dock-unread-badge",children:Pt>99?"99+":Pt})]},le.id)}return y.jsxs("div",{className:"dock-area",children:[y.jsxs("div",{className:"dock-container",ref:Ye,children:[y.jsx("svg",{className:"dock-svg",width:vr.w,height:vr.h,style:{left:-2,top:-2},children:y.jsx("path",{d:ia,className:"dock-svg-path"})}),y.jsxs("div",{className:"dock-ch-row",ref:wn,children:[_&&R.length===0&&y.jsx(e3,{count:4}),M.map(le=>Wo(le,!1)),D&&y.jsx("button",{className:"dock-ch-add",onClick:()=>{Q("text"),de("")},title:t("createChannel")+" (Text)",children:"+"}),(M.length>0||D)&&L.length>0&&y.jsx("div",{className:"dock-ch-sep"}),L.map(le=>Wo(le,!0)),D&&y.jsx("button",{className:"dock-ch-add voice",onClick:()=>{Q("voice"),de("")},title:t("createChannel")+" (Voice)",children:"+"})]}),y.jsxs("div",{className:"dock-srv-row",ref:Ke,children:[y.jsxs("button",{className:"dock-item dock-srv active",children:[y.jsx("span",{className:"dock-tooltip",children:e("server")}),y.jsx("img",{src:"/mqvi-icon.svg",alt:"mqvi",className:"dock-srv-icon"}),y.jsx("span",{className:"dock-dot"})]}),y.jsxs("button",{className:"dock-item dock-add",children:[y.jsx("span",{className:"dock-tooltip",children:e("addServer")}),"+"]}),y.jsx("div",{className:"dock-separator"}),y.jsxs("button",{className:"dock-item",onClick:()=>fe(le=>!le),children:[y.jsx("span",{className:"dock-tooltip",children:e("messages")}),y.jsx("span",{className:"dock-util-icon",children:""}),x>0&&y.jsx("span",{className:"dock-unread-badge dm-badge",children:x>99?"99+":x})]}),y.jsxs("button",{className:"dock-item",children:[y.jsx("span",{className:"dock-tooltip",children:e("files")}),y.jsx("span",{className:"dock-util-icon",children:""})]}),y.jsxs("button",{className:"dock-item",children:[y.jsx("span",{className:"dock-tooltip",children:e("search")}),y.jsx("span",{className:"dock-util-icon",children:""})]}),y.jsxs("button",{className:"dock-item",onClick:()=>g(),children:[y.jsx("span",{className:"dock-tooltip",children:e("settings")}),y.jsx("span",{className:"dock-util-icon",children:""})]}),y.jsx("div",{className:"dock-separator"}),y.jsx("button",{className:"dock-item dock-profile",title:m?.display_name??m?.username??"Profile",children:y.jsx(li,{name:m?.username??"?",avatarUrl:m?.avatar_url??void 0,size:32,isCircle:!0})})]})]}),I&&y.jsxs("div",{className:"dock-create-popover",children:[y.jsxs("span",{className:"dock-create-label",children:[I==="text"?"# ":" ",t("createChannel")]}),y.jsx("input",{className:"dock-create-input",placeholder:t("channelName"),value:oe,onChange:le=>de(le.target.value),onKeyDown:le=>{le.key==="Enter"&&ve(),le.key==="Escape"&&Q(null)},autoFocus:!0,disabled:se}),y.jsxs("div",{className:"dock-create-actions",children:[y.jsx("button",{className:"dock-create-btn",onClick:ve,disabled:!oe.trim()||se,children:se?"...":t("createChannel")}),y.jsx("button",{className:"dock-create-btn secondary",onClick:()=>Q(null),children:t("cancel")})]})]}),y.jsx(Em,{state:i,onClose:o}),re&&y.jsx(rV,{onClose:()=>fe(!1)})]})}function dV(n,e){let i=n.itemRects[0]?.left??0;const r=new Map;for(const o of n.currentOrder){r.set(o,i);const u=n.itemRects.find(l=>l.id===o);i+=u.width+2}for(const o of n.itemRects){const u=document.querySelector(`[data-channel-drag-id="${o.id}"]`);if(u)if(o.id===n.channelId)u.style.transform=`translateX(${e}px)`,u.style.transition="none",u.style.zIndex="10",u.style.opacity="0.7";else{const f=r.get(o.id)-o.left;u.style.transform=f!==0?`translateX(${f}px)`:"",u.style.transition="transform 200ms ease",u.style.zIndex="",u.style.opacity=""}}}function RS(n){for(const e of n.itemRects){const t=document.querySelector(`[data-channel-drag-id="${e.id}"]`);t&&(t.style.transform="",t.style.transition="",t.style.zIndex="",t.style.opacity="")}}function fV({onToggleMute:n,onToggleDeafen:e,onToggleScreenShare:t,onDisconnect:i}){const{t:r}=Te("voice"),o=be(R=>R.currentVoiceChannelId),u=be(R=>R.isMuted),l=be(R=>R.isDeafened),f=be(R=>R.isStreaming),h=be(R=>R.voiceStates),m=xt(R=>R.categories),[g,b]=T.useState(!1),[C,E]=T.useState(!0),[k,_]=T.useState({x:null,y:70}),w=T.useRef(null),O=o?m.flatMap(R=>R.channels).find(R=>R.id===o)?.name??"":"",D=o?h[o]??[]:[],x=T.useCallback(R=>{if(R.target.tagName==="BUTTON")return;if(g){b(!1);return}const M=w.current?.getBoundingClientRect();if(!M)return;const L=R.clientX,B=R.clientY,V=M.left,P=M.top;function z(J){_({x:V+J.clientX-L,y:P+J.clientY-B})}function W(){document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",W)}document.addEventListener("mousemove",z),document.addEventListener("mouseup",W)},[g]);return!o||!C?null:y.jsxs("div",{ref:w,className:`voice-popup${g?" vp-mini":""}`,style:{top:k.y,...k.x!==null?{left:k.x,right:"auto"}:{right:20}},children:[y.jsxs("div",{className:"vp-bar",onMouseDown:x,children:[y.jsxs("div",{className:"vp-mini-icon",children:["",y.jsx("span",{className:"vp-mini-ring"})]}),y.jsxs("div",{className:"vp-bar-main",children:[y.jsx("span",{className:"vp-pulse"}),y.jsx("span",{className:"vp-title",children:r("voiceConnected")}),y.jsx("span",{className:"vp-ch",children:O})]}),y.jsxs("div",{className:"vp-btns",children:[y.jsx("button",{onClick:()=>b(!g),children:""}),y.jsx("button",{onClick:()=>E(!1),children:""})]})]}),y.jsxs("div",{className:"vp-body",children:[y.jsxs("div",{className:"vp-controls",children:[y.jsx("button",{className:`vp-ctrl${u?" active":""}`,onClick:n,title:r("mute"),children:""}),y.jsx("button",{className:`vp-ctrl${l?" active":""}`,onClick:e,title:r("deafen"),children:""}),y.jsx("button",{className:`vp-ctrl${f?" active":""}`,onClick:t,title:r("screenShare"),children:""}),y.jsx("button",{className:"vp-ctrl vp-end",onClick:i,title:r("endCall"),children:""})]}),y.jsx("div",{className:"vp-users",children:D.map(R=>y.jsxs("div",{className:`vp-user${R.is_muted?"":" speaking"}`,children:[y.jsx(li,{name:R.username,size:20}),y.jsx("span",{className:"vp-uname",children:R.username}),!R.is_muted&&y.jsx("span",{className:"vp-speak-dot"})]},R.user_id))})]})]})}function hV({id:n,type:e,message:t,isExiting:i,onDismiss:r}){const o=T.useCallback(()=>{r(n)},[n,r]),u=`toast toast-${e} toast-border-${e}${i?" toast-exiting":""}`;return y.jsxs("div",{className:u,role:"alert",children:[y.jsx("div",{className:"toast-icon",children:y.jsx(mV,{type:e})}),y.jsx("span",{className:"toast-message",children:t}),y.jsx("button",{onClick:o,className:"toast-close","aria-label":"Close",children:""})]})}function mV({type:n}){switch(n){case"success":return y.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"error":return y.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"warning":return y.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})});case"info":return y.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})}}function pV(){const n=Fi(t=>t.toasts),e=Fi(t=>t.removeToast);return n.length===0?null:y.jsx("div",{className:"toast-container",children:n.map(t=>y.jsx(hV,{id:t.id,type:t.type,message:t.message,isExiting:t.isExiting,onDismiss:e},t.id))})}function gV(){const{t:n}=Te("common"),e=ql(l=>l.options),t=ql(l=>l.confirm),i=ql(l=>l.cancel),r=T.useCallback(l=>{l.key==="Escape"&&i()},[i]);if(T.useEffect(()=>{if(e)return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[e,r]),!e)return null;const o=e.confirmLabel??n("confirm"),u=e.cancelLabel??n("cancel");return y.jsx("div",{className:"modal-backdrop",onClick:i,children:y.jsxs("div",{className:"modal-card",onClick:l=>l.stopPropagation(),children:[e.title&&y.jsx("div",{className:"modal-header",children:y.jsx("h2",{className:"modal-title",children:e.title})}),y.jsx("p",{className:"modal-text",children:e.message}),y.jsxs("div",{className:"modal-actions",children:[y.jsx("button",{className:"settings-btn settings-btn-secondary",onClick:i,children:u}),y.jsx("button",{className:`settings-btn${e.danger?" settings-btn-danger":""}`,onClick:t,autoFocus:!0,children:o})]})]})})}const vV=[{id:"profile",labelKey:"profile"},{id:"appearance",labelKey:"appearance"},{id:"voice",labelKey:"voiceSettings"}],yV=[{id:"server-general",labelKey:"general"},{id:"channels",labelKey:"channels"},{id:"roles",labelKey:"roles"},{id:"members",labelKey:"members"},{id:"invites",labelKey:"invites"}];function bV(){const{t:n}=Te("settings"),e=ar(h=>h.activeTab),t=ar(h=>h.setActiveTab),i=at(h=>h.logout),r=at(h=>h.user),l=Et(h=>h.members).find(h=>h.id===r?.id)?.effective_permissions??0,f=Vn(l,Pe.Admin)||Vn(l,Pe.ManageChannels)||Vn(l,Pe.ManageRoles)||Vn(l,Pe.KickMembers)||Vn(l,Pe.BanMembers);return y.jsxs("nav",{className:"settings-nav",children:[y.jsx("h3",{className:"settings-nav-label",children:n("userSettings")}),vV.map(h=>y.jsx("button",{className:`settings-nav-item${e===h.id?" active":""}`,onClick:()=>t(h.id),children:n(h.labelKey)},h.id)),f&&y.jsxs(y.Fragment,{children:[y.jsx("div",{style:{height:1,background:"var(--b1)",margin:"8px 0"}}),y.jsx("h3",{className:"settings-nav-label",children:n("serverSettings")}),yV.map(h=>y.jsx("button",{className:`settings-nav-item${e===h.id?" active":""}`,onClick:()=>t(h.id),children:n(h.labelKey)},h.id))]}),y.jsx("div",{style:{marginTop:"auto",borderTop:"1px solid var(--b1)",paddingTop:8},children:y.jsx("button",{className:"settings-nav-item",onClick:i,style:{color:"var(--red)"},children:n("logOut")})}),y.jsx("p",{style:{marginTop:8,padding:"0 8px",fontSize:11,color:"var(--t3)"},children:"mqvi v0.1.0"})]})}async function SV(){return xe("/roles")}async function CV(n){return xe("/roles",{method:"POST",body:n})}async function kV(n,e){return xe(`/roles/${n}`,{method:"PATCH",body:e})}async function TV(n){return xe(`/roles/${n}`,{method:"DELETE"})}const Lo=Wt((n,e)=>({roles:[],selectedRoleId:null,isLoading:!1,fetchRoles:async()=>{n({isLoading:!0});const t=await SV();if(t.data){const i=[...t.data].sort((r,o)=>o.position-r.position);n({roles:i,isLoading:!1}),!e().selectedRoleId&&i.length>0&&n({selectedRoleId:i[0].id})}else n({isLoading:!1})},selectRole:t=>{n({selectedRoleId:t})},createRole:async t=>{const i=await CV(t);if(i.data){const r=i.data;return n(o=>o.roles.some(u=>u.id===r.id)?{selectedRoleId:r.id}:{roles:[r,...o.roles].sort((u,l)=>l.position-u.position),selectedRoleId:r.id}),!0}return!1},updateRole:async(t,i)=>{const r=await kV(t,i);return r.data?(n(o=>({roles:o.roles.map(u=>u.id===t?r.data:u)})),!0):!1},deleteRole:async t=>(await TV(t)).data?(n(r=>{const o=r.roles.filter(u=>u.id!==t);return{roles:o,selectedRoleId:r.selectedRoleId===t?o[0]?.id??null:r.selectedRoleId}}),!0):!1,handleRoleCreate:t=>{n(i=>i.roles.some(r=>r.id===t.id)?i:{roles:[...i.roles,t].sort((r,o)=>o.position-r.position)})},handleRoleUpdate:t=>{n(i=>({roles:i.roles.map(r=>r.id===t.id?t:r)}))},handleRoleDelete:t=>{n(i=>{const r=i.roles.filter(o=>o.id!==t);return{roles:r,selectedRoleId:i.selectedRoleId===t?r[0]?.id??null:i.selectedRoleId}})}}));function EV({permBit:n,labelKey:e,descKey:t,isChecked:i,onChange:r,warningKey:o}){const{t:u}=Te("settings");return y.jsxs("div",{className:"permission-toggle",children:[y.jsx("button",{onClick:()=>r(n,!i),className:`permission-toggle-checkbox${i?" checked":""}`,children:i&&y.jsx("svg",{className:"permission-toggle-check",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),y.jsxs("div",{style:{flex:1,minWidth:0},children:[y.jsx("p",{className:"permission-toggle-label",children:u(e)}),y.jsx("p",{className:"permission-toggle-desc",children:u(t)}),o&&i&&y.jsx("p",{className:"permission-toggle-warn",children:u(o)})]})]})}const xV=["#1ABC9C","#2ECC71","#3498DB","#9B59B6","#E91E63","#F1C40F","#E67E22","#E74C3C","#95A5A6","#607D8B","#11806A","#1F8B4C","#206694","#71368A","#AD1457","#C27C0E","#A84300","#992D22","#979C9F","#546E7A"];function RV({value:n,onChange:e}){return y.jsxs("div",{children:[y.jsx("div",{className:"color-picker",children:xV.map(t=>y.jsx("button",{onClick:()=>e(t),className:`color-swatch${n.toUpperCase()===t?" selected":""}`,style:{backgroundColor:t}},t))}),y.jsxs("div",{className:"color-hex-row",children:[y.jsx("div",{className:"color-hex-preview",style:{backgroundColor:n||"var(--t1)"}}),y.jsx("input",{type:"text",value:n,onChange:t=>e(t.target.value),placeholder:"#99AAB5",maxLength:7,className:"color-hex-input"})]})]})}const _V=[{bit:Pe.Admin,label:"permAdmin",desc:"permAdminDesc",warning:"permAdminWarning"},{bit:Pe.ManageChannels,label:"permManageChannels",desc:"permManageChannelsDesc"},{bit:Pe.ManageRoles,label:"permManageRoles",desc:"permManageRolesDesc"},{bit:Pe.KickMembers,label:"permKickMembers",desc:"permKickMembersDesc"},{bit:Pe.BanMembers,label:"permBanMembers",desc:"permBanMembersDesc"},{bit:Pe.ManageMessages,label:"permManageMessages",desc:"permManageMessagesDesc"},{bit:Pe.SendMessages,label:"permSendMessages",desc:"permSendMessagesDesc"},{bit:Pe.ReadMessages,label:"permReadMessages",desc:"permReadMessagesDesc"},{bit:Pe.ConnectVoice,label:"permConnect",desc:"permConnectDesc"},{bit:Pe.Speak,label:"permSpeak",desc:"permSpeakDesc"},{bit:Pe.Stream,label:"permStream",desc:"permStreamDesc"},{bit:Pe.ManageInvites,label:"permManageInvites",desc:"permManageInvitesDesc"}];function wV(){const{t:n}=Te("settings"),{roles:e,selectedRoleId:t,isLoading:i,fetchRoles:r,selectRole:o,createRole:u,updateRole:l,deleteRole:f}=Lo(),h=Fi(B=>B.addToast),m=Xo(),g=e.find(B=>B.id===t),[b,C]=T.useState(""),[E,k]=T.useState(""),[_,w]=T.useState(0),[O,D]=T.useState(!1);T.useEffect(()=>{r()},[r]),T.useEffect(()=>{g&&(C(g.name),k(g.color),w(g.permissions),D(!1))},[g]);function x(B,V){w(P=>V?P|B:P&~B),D(!0)}async function R(){if(!t||!O)return;const B={};b!==g?.name&&(B.name=b),E!==g?.color&&(B.color=E),_!==g?.permissions&&(B.permissions=_),await l(t,B)?(D(!1),h("success",n("roleSaved"))):h("error",n("roleSaveError"))}async function M(){await u({name:"New Role",color:"#99AAB5",permissions:Pe.SendMessages|Pe.ReadMessages|Pe.ConnectVoice|Pe.Speak})?h("success",n("roleCreated")):h("error",n("roleSaveError"))}async function L(){if(!g||!await m({message:n("confirmDeleteRole",{name:g.name}),confirmLabel:n("deleteRole"),danger:!0}))return;await f(g.id)?h("success",n("roleDeleted")):h("error",n("roleSaveError"))}return i?y.jsx("div",{className:"no-channel",children:n("loading",{ns:"common"})}):y.jsxs("div",{className:"channel-settings-wrapper",children:[y.jsxs("div",{className:"role-list",children:[y.jsxs("div",{className:"channel-settings-header",children:[y.jsx("span",{className:"channel-settings-header-label",children:n("roles")}),y.jsx("button",{onClick:M,className:"settings-btn channel-settings-header-btn",children:n("createRole")})]}),y.jsx("div",{className:"channel-settings-ch-list",children:e.map(B=>y.jsxs("div",{onClick:()=>o(B.id),className:`role-list-item${B.id===t?" active":""}`,children:[y.jsx("span",{className:"role-list-dot",style:{backgroundColor:B.color||"#99AAB5"}}),y.jsx("span",{className:"role-list-name",children:B.name})]},B.id))})]}),y.jsx("div",{className:"settings-content channel-settings-right",children:g?y.jsxs("div",{className:"channel-perm-section",children:[y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{className:"settings-label",children:n("roleName")}),y.jsx("input",{type:"text",value:b,onChange:B=>{C(B.target.value),D(!0)},className:"settings-input"})]}),y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{className:"settings-label",children:n("roleColor")}),y.jsx(RV,{value:E,onChange:B=>{k(B),D(!0)}})]}),g.is_default&&y.jsx("div",{style:{background:"var(--bg-4)",borderRadius:8,padding:12,fontSize:12,color:"var(--t2)",marginBottom:16},children:n("defaultRoleWarning")}),y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{className:"settings-label",children:n("permissions")}),y.jsx("div",{style:{background:"var(--bg-1)",borderRadius:8,overflow:"hidden"},children:_V.map(B=>y.jsx(EV,{permBit:B.bit,labelKey:B.label,descKey:B.desc,isChecked:(_&B.bit)!==0,onChange:x,warningKey:"warning"in B?B.warning:void 0},B.bit))})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[O&&y.jsx("button",{onClick:R,className:"settings-btn",children:n("saveChanges")}),!g.is_default&&y.jsx("button",{onClick:L,className:"settings-btn settings-btn-danger",children:n("deleteRole")})]}),O&&y.jsx("p",{style:{marginTop:8,fontSize:12,color:"var(--primary)"},children:n("unsavedChanges")})]}):y.jsx("div",{className:"no-channel",children:n("noRoleSelected")})})]})}async function MV(n){return xe("/users/me/profile",{method:"PATCH",body:n})}async function NV(n){const e=new FormData;return e.append("file",n),xe("/users/me/avatar",{method:"POST",body:e})}const OV="image/jpeg,image/png,image/gif,image/webp",DV=8*1024*1024;function VT({currentUrl:n,previewUrl:e,fallbackText:t,onUpload:i,isCircle:r=!0}){const{t:o}=Te("settings"),[u,l]=T.useState(!1),f=T.useRef(null),h=t.charAt(0).toUpperCase();async function m(g){const b=g.target.files?.[0];if(b&&!(b.size>DV)){l(!0);try{await i(b)}finally{l(!1),f.current&&(f.current.value="")}}}return y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12,marginBottom:24},children:[y.jsxs("button",{type:"button",onClick:()=>f.current?.click(),className:"avatar-upload",disabled:u,style:{width:80,height:80,borderRadius:r?"999px":12,background:"linear-gradient(135deg, var(--primary), #0088a3)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",position:"relative"},children:[e??n?y.jsx("img",{src:e??n,alt:t,style:{width:"100%",height:"100%",objectFit:"cover"}}):y.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#fff",fontFamily:"var(--f-d)"},children:h}),y.jsx("div",{className:"avatar-upload-overlay",style:{borderRadius:r?"999px":12},children:u?y.jsx("div",{className:"spinner",style:{width:24,height:24}}):y.jsxs("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})})]}),y.jsxs("div",{style:{textAlign:"center"},children:[y.jsx("p",{style:{fontSize:11,color:"var(--t2)"},children:o("avatarUpload")}),y.jsx("p",{style:{fontSize:11,color:"var(--t3)",marginTop:2},children:o("avatarMaxSize")})]}),y.jsx("input",{ref:f,type:"file",accept:OV,onChange:m,style:{display:"none"}})]})}const AV=[{code:"en",labelKey:"english"},{code:"tr",labelKey:"turkish"}];function PV({currentLanguage:n,onChange:e}){const{t}=Te("settings");return y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{className:"settings-label",children:t("language")}),y.jsx("p",{style:{fontSize:11,color:"var(--t2)",marginBottom:6},children:t("languageDescription")}),y.jsx("select",{value:n,onChange:i=>e(i.target.value),className:"settings-select",children:AV.map(i=>y.jsx("option",{value:i.code,children:t(i.labelKey)},i.code))})]})}function LV(){const{t:n}=Te("settings"),{i18n:e}=Te(),t=at(M=>M.user),i=at(M=>M.updateUser),r=Fi(M=>M.addToast),[o,u]=T.useState(t?.display_name??""),[l,f]=T.useState(t?.custom_status??""),[h,m]=T.useState(t?.language??"en"),[g,b]=T.useState(null),[C,E]=T.useState(null),[k,_]=T.useState(!1),w=T.useRef(null);T.useEffect(()=>{u(t?.display_name??""),f(t?.custom_status??""),m(t?.language??"en"),b(null),w.current&&(URL.revokeObjectURL(w.current),w.current=null),E(null)},[t?.display_name,t?.custom_status,t?.language,t?.avatar_url]),T.useEffect(()=>()=>{w.current&&URL.revokeObjectURL(w.current)},[]);const O=o!==(t?.display_name??"")||l!==(t?.custom_status??"")||g!==null||h!==(t?.language??"en");async function D(M){w.current&&URL.revokeObjectURL(w.current);const L=URL.createObjectURL(M);w.current=L,b(M),E(L)}function x(M){m(M)}async function R(){if(!(!O||k)){_(!0);try{if(g){const L=await NV(g);if(L.success&&L.data)i({avatar_url:L.data.avatar_url});else{r("error",L.error??n("avatarUploadError")),_(!1);return}}if(o!==(t?.display_name??"")||l!==(t?.custom_status??"")||h!==(t?.language??"en")){const L=await MV({display_name:o||null,custom_status:l||null,language:h});if(L.success&&L.data)h!==(t?.language??"en")&&e.changeLanguage(h),i({display_name:L.data.display_name,custom_status:L.data.custom_status,language:h});else{r("error",L.error??n("profileSaveError")),_(!1);return}}b(null),w.current&&(URL.revokeObjectURL(w.current),w.current=null),E(null),r("success",n("profileSaved"))}catch{r("error",n("profileSaveError"))}finally{_(!1)}}}return t?y.jsxs("div",{className:"settings-section",children:[y.jsx("h2",{className:"settings-section-title",children:n("profile")}),y.jsx(VT,{currentUrl:t.avatar_url,previewUrl:C,fallbackText:t.display_name??t.username,onUpload:D}),y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{htmlFor:"displayName",className:"settings-label",children:n("displayName")}),y.jsx("input",{id:"displayName",type:"text",value:o,onChange:M=>u(M.target.value),placeholder:n("displayNamePlaceholder"),maxLength:32,className:"settings-input"})]}),y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{htmlFor:"customStatus",className:"settings-label",children:n("customStatus")}),y.jsx("input",{id:"customStatus",type:"text",value:l,onChange:M=>f(M.target.value),placeholder:n("customStatusPlaceholder"),maxLength:128,className:"settings-input"})]}),y.jsx(PV,{currentLanguage:h,onChange:x}),y.jsx("div",{style:{height:1,background:"var(--b1)",margin:"24px 0"}}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[y.jsx("button",{onClick:R,disabled:!O||k,className:"settings-btn",children:k?n("saveChanges")+"...":n("saveChanges")}),O&&y.jsx("span",{style:{fontSize:13,color:"var(--primary)"},children:n("unsavedChanges")})]})]}):null}function jV(){const{t:n}=Te("settings"),e=Fi(k=>k.addToast),[t,i]=T.useState(null),[r,o]=T.useState(""),[u,l]=T.useState(!1),[f,h]=T.useState(!1),[m,g]=T.useState(!1);T.useEffect(()=>{async function k(){const _=await iC();_.success&&_.data&&(i(_.data),o(_.data.name),l(_.data.invite_required)),g(!0)}k()},[]);const b=t!==null&&(r!==t.name||u!==t.invite_required);async function C(){if(!(!b||f)){h(!0);try{const k=await xU({name:r,invite_required:u});k.success&&k.data?(i(k.data),l(k.data.invite_required),e("success",n("serverSaved"))):e("error",k.error??n("serverSaveError"))}catch{e("error",n("serverSaveError"))}finally{h(!1)}}}async function E(k){try{const _=await RU(k);_.success&&_.data?(i(_.data),e("success",n("serverSaved"))):e("error",_.error??n("serverSaveError"))}catch{e("error",n("serverSaveError"))}}return m?t?y.jsxs("div",{className:"settings-section",children:[y.jsx("h2",{className:"settings-section-title",children:n("general")}),y.jsx(VT,{currentUrl:t.icon_url,fallbackText:t.name,onUpload:E,isCircle:!1}),y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{htmlFor:"serverName",className:"settings-label",children:n("serverName")}),y.jsx("input",{id:"serverName",type:"text",value:r,onChange:k=>o(k.target.value),maxLength:100,className:"settings-input"})]}),y.jsxs("div",{className:"settings-field",style:{display:"flex",alignItems:"center",gap:12},children:[y.jsx("input",{id:"inviteRequired",type:"checkbox",checked:u,onChange:k=>l(k.target.checked),style:{width:16,height:16,accentColor:"var(--primary)",cursor:"pointer"}}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"inviteRequired",style:{fontSize:13,fontWeight:600,color:"var(--t0)",cursor:"pointer"},children:n("inviteRequired")}),y.jsx("p",{style:{fontSize:11,color:"var(--t2)",marginTop:2},children:n("inviteRequiredDesc")})]})]}),y.jsx("div",{style:{height:1,background:"var(--b1)",margin:"24px 0"}}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[y.jsx("button",{onClick:C,disabled:!b||f,className:"settings-btn",children:f?n("saveChanges")+"...":n("saveChanges")}),b&&y.jsx("span",{style:{fontSize:13,color:"var(--primary)"},children:n("unsavedChanges")})]})]}):y.jsx("div",{className:"no-channel",children:n("serverSaveError")}):y.jsx("div",{className:"no-channel",children:n("loading",{ns:"common"})})}async function IV(){return xe("/invites")}async function UV(n){return xe("/invites",{method:"POST",body:n})}async function BV(n){return xe(`/invites/${n}`,{method:"DELETE"})}const zV=[],Eo=Wt((n,e)=>({invites:zV,isLoading:!1,fetchInvites:async()=>{n({isLoading:!0});const t=await IV();t.success&&t.data?n({invites:t.data,isLoading:!1}):n({isLoading:!1})},createInvite:async(t,i)=>{const r=await UV({max_uses:t,expires_in:i});return r.success&&r.data?(await e().fetchInvites(),r.data):null},deleteInvite:async t=>(await BV(t)).success?(n(r=>({invites:r.invites.filter(o=>o.code!==t)})),!0):!1})),VV=[{value:30,labelKey:"expiry30min"},{value:60,labelKey:"expiry1h"},{value:360,labelKey:"expiry6h"},{value:720,labelKey:"expiry12h"},{value:1440,labelKey:"expiry1d"},{value:10080,labelKey:"expiry7d"},{value:0,labelKey:"expiryNever"}],FV=[{value:0,labelKey:"usesNoLimit"},{value:1,labelKey:"uses1"},{value:5,labelKey:"uses5"},{value:10,labelKey:"uses10"},{value:25,labelKey:"uses25"},{value:50,labelKey:"uses50"},{value:100,labelKey:"uses100"}];function qV(){const{t:n}=Te("settings"),e=Eo(_=>_.invites),t=Eo(_=>_.isLoading),i=Eo(_=>_.fetchInvites),r=Eo(_=>_.createInvite),o=Eo(_=>_.deleteInvite),u=Fi(_=>_.addToast),[l,f]=T.useState(1440),[h,m]=T.useState(0),[g,b]=T.useState(!1);T.useEffect(()=>{i()},[i]);const C=T.useCallback(async()=>{if(g)return;b(!0);const _=await r(h,l);if(_){u("success",n("inviteCreated"));try{await navigator.clipboard.writeText(_.code),u("success",n("inviteCopied"))}catch{}}else u("error",n("inviteCreateError"));b(!1)},[g,r,h,l,u,n]),E=T.useCallback(async _=>{try{await navigator.clipboard.writeText(_),u("success",n("inviteCopied"))}catch{u("error",n("inviteCopyError"))}},[u,n]),k=T.useCallback(async _=>{await o(_)?u("success",n("inviteDeleted")):u("error",n("inviteDeleteError"))},[o,u,n]);return y.jsxs("div",{className:"settings-section",children:[y.jsx("h2",{className:"settings-section-title",children:n("invites")}),y.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-end",marginBottom:24},children:[y.jsxs("div",{className:"settings-field",style:{marginBottom:0},children:[y.jsx("label",{className:"settings-label",children:n("inviteExpiry")}),y.jsx("select",{value:l,onChange:_=>f(Number(_.target.value)),className:"settings-select",style:{maxWidth:180},children:VV.map(_=>y.jsx("option",{value:_.value,children:n(_.labelKey)},_.value))})]}),y.jsxs("div",{className:"settings-field",style:{marginBottom:0},children:[y.jsx("label",{className:"settings-label",children:n("inviteMaxUses")}),y.jsx("select",{value:h,onChange:_=>m(Number(_.target.value)),className:"settings-select",style:{maxWidth:160},children:FV.map(_=>y.jsx("option",{value:_.value,children:n(_.labelKey)},_.value))})]}),y.jsx("button",{onClick:C,disabled:g,className:"settings-btn",children:n(g?"inviteCreating":"inviteCreate")})]}),y.jsx("div",{style:{height:1,background:"var(--b1)",marginBottom:16}}),t?y.jsx("p",{style:{fontSize:13,color:"var(--t2)"},children:n("loading")}):e.length===0?y.jsx("p",{style:{fontSize:13,color:"var(--t2)"},children:n("noInvites")}):y.jsx("div",{className:"invite-list",children:e.map(_=>y.jsx(HV,{invite:_,onCopy:E,onDelete:k},_.code))})]})}function HV({invite:n,onCopy:e,onDelete:t}){const{t:i}=Te("settings"),r=n.expires_at!==null&&new Date(n.expires_at)<new Date,o=n.max_uses>0&&n.uses>=n.max_uses,u=r||o,l=n.creator_display_name??n.creator_username;function f(){if(!n.expires_at)return i("expiryNever");if(r)return i("inviteExpired");const h=new Date(n.expires_at).getTime()-Date.now(),m=Math.floor(h/(1e3*60*60)),g=Math.floor(h%(1e3*60*60)/(1e3*60));if(m>24){const b=Math.floor(m/24);return i("inviteExpiresInDays",{count:b})}return m>0?i("inviteExpiresInHours",{count:m}):i("inviteExpiresInMinutes",{count:g})}return y.jsxs("div",{className:"invite-item",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:u?"var(--red-s)":"var(--bg-3)",borderRadius:8,marginBottom:6,opacity:u?.6:1},children:[y.jsxs("div",{style:{minWidth:0},children:[y.jsx("div",{style:{fontFamily:"var(--f-m)",fontSize:14,fontWeight:500,color:"var(--t0)",letterSpacing:"0.02em"},children:n.code}),y.jsxs("div",{style:{fontSize:11,color:"var(--t2)",marginTop:2,display:"flex",gap:12},children:[y.jsx("span",{children:l}),y.jsxs("span",{children:[n.uses,n.max_uses>0?` / ${n.max_uses}`:""," ",i("inviteUsesLabel")]}),y.jsx("span",{children:f()})]})]}),y.jsxs("div",{style:{display:"flex",gap:6,flexShrink:0},children:[y.jsx("button",{onClick:()=>e(n.code),className:"settings-btn settings-btn-secondary",style:{height:28,padding:"0 10px",fontSize:11},children:i("inviteCopy")}),y.jsx("button",{onClick:()=>t(n.code),className:"settings-btn settings-btn-danger",style:{height:28,padding:"0 10px",fontSize:11},children:i("inviteDelete")})]})]})}function $V(n){return n.startsWith("Key")?n.slice(3):n.startsWith("Digit")?n.slice(5):{Space:"Space",ControlLeft:"Left Ctrl",ControlRight:"Right Ctrl",ShiftLeft:"Left Shift",ShiftRight:"Right Shift",AltLeft:"Left Alt",AltRight:"Right Alt",Tab:"Tab",CapsLock:"Caps Lock",Backquote:"`",Backslash:"\\",BracketLeft:"[",BracketRight:"]",Semicolon:";",Quote:"'",Comma:",",Period:".",Slash:"/",Minus:"-",Equal:"="}[n]??n}function _S(n,e){const t=n/e*100;return{background:`linear-gradient(to right, var(--primary) ${t}%, var(--bg-5) ${t}%)`}}function KV(){const{t:n}=Te("settings"),e=be(M=>M.inputMode),t=be(M=>M.pttKey),i=be(M=>M.micSensitivity),r=be(M=>M.inputDevice),o=be(M=>M.outputDevice),u=be(M=>M.masterVolume),l=be(M=>M.soundsEnabled),f=be(M=>M.setInputMode),h=be(M=>M.setPTTKey),m=be(M=>M.setMicSensitivity),g=be(M=>M.setInputDevice),b=be(M=>M.setOutputDevice),C=be(M=>M.setMasterVolume),E=be(M=>M.setSoundsEnabled),[k,_]=T.useState([]),[w,O]=T.useState([]),[D,x]=T.useState(!1);T.useEffect(()=>{async function M(){try{await navigator.mediaDevices.getUserMedia({audio:!0}).then(P=>{P.getTracks().forEach(z=>z.stop())}).catch(()=>{});const L=await navigator.mediaDevices.enumerateDevices(),B=L.filter(P=>P.kind==="audioinput").map((P,z)=>({deviceId:P.deviceId,label:P.label||`${n("inputDevice")} ${z+1}`})),V=L.filter(P=>P.kind==="audiooutput").map((P,z)=>({deviceId:P.deviceId,label:P.label||`${n("outputDevice")} ${z+1}`}));_(B),O(V)}catch{}}M()},[n]),T.useEffect(()=>{if(!D)return;function M(L){if(L.preventDefault(),L.stopPropagation(),L.code==="Escape"){x(!1);return}h(L.code),x(!1)}return document.addEventListener("keydown",M,{capture:!0}),()=>{document.removeEventListener("keydown",M,{capture:!0})}},[D,h]);const R=T.useCallback(M=>{f(M)},[f]);return y.jsxs("div",{className:"voice-settings",children:[y.jsx("h2",{className:"settings-section-title",children:n("voiceSettings")}),y.jsxs("div",{className:"vs-section",children:[y.jsx("div",{className:"vs-label",children:n("voiceInputMode")}),y.jsxs("div",{className:"vs-radio-group",children:[y.jsxs("button",{className:`vs-radio${e==="voice_activity"?" active":""}`,onClick:()=>R("voice_activity"),children:[y.jsx("div",{className:"vs-radio-dot"}),y.jsxs("div",{children:[y.jsx("div",{className:"vs-radio-title",children:n("voiceActivity")}),y.jsx("div",{className:"vs-desc",children:n("voiceActivityDesc")})]})]}),y.jsxs("button",{className:`vs-radio${e==="push_to_talk"?" active":""}`,onClick:()=>R("push_to_talk"),children:[y.jsx("div",{className:"vs-radio-dot"}),y.jsxs("div",{children:[y.jsx("div",{className:"vs-radio-title",children:n("pushToTalk")}),y.jsx("div",{className:"vs-desc",children:n("pushToTalkDesc")})]})]})]})]}),e==="push_to_talk"&&y.jsxs("div",{className:"vs-section",children:[y.jsx("div",{className:"vs-label",children:n("pttKey")}),y.jsx("button",{className:`vs-keybind${D?" listening":""}`,onClick:()=>x(!0),children:D?n("pttListening"):$V(t)}),y.jsx("div",{className:"vs-desc",children:n("pttKeyHint")})]}),e==="voice_activity"&&y.jsxs("div",{className:"vs-section",children:[y.jsx("div",{className:"vs-label",children:n("micSensitivity")}),y.jsxs("div",{className:"vs-slider-row",children:[y.jsx("input",{type:"range",min:0,max:100,value:i,onChange:M=>m(Number(M.target.value)),className:"vs-range",style:_S(i,100)}),y.jsxs("span",{className:"vs-slider-value",children:[i,"%"]})]})]}),y.jsxs("div",{className:"vs-section",children:[y.jsx("div",{className:"vs-label",children:n("inputDevice")}),y.jsxs("select",{className:"vs-select",value:r,onChange:M=>g(M.target.value),children:[y.jsx("option",{value:"",children:n("defaultDevice")}),k.map(M=>y.jsx("option",{value:M.deviceId,children:M.label},M.deviceId))]})]}),y.jsxs("div",{className:"vs-section",children:[y.jsx("div",{className:"vs-label",children:n("outputDevice")}),y.jsxs("select",{className:"vs-select",value:o,onChange:M=>b(M.target.value),children:[y.jsx("option",{value:"",children:n("defaultDevice")}),w.map(M=>y.jsx("option",{value:M.deviceId,children:M.label},M.deviceId))]})]}),y.jsxs("div",{className:"vs-section",children:[y.jsx("div",{className:"vs-label",children:n("masterVolume")}),y.jsxs("div",{className:"vs-slider-row",children:[y.jsx("input",{type:"range",min:0,max:100,value:u,onChange:M=>C(Number(M.target.value)),className:"vs-range",style:_S(u,100)}),y.jsxs("span",{className:"vs-slider-value",children:[u,"%"]})]})]}),y.jsx("div",{className:"vs-section",children:y.jsxs("div",{className:"vs-toggle-row",children:[y.jsxs("div",{children:[y.jsx("div",{className:"vs-label",children:n("joinLeaveSounds")}),y.jsx("div",{className:"vs-desc",children:n("joinLeaveSoundsDesc")})]}),y.jsxs("label",{className:"vs-switch",children:[y.jsx("input",{type:"checkbox",checked:l,onChange:M=>E(M.target.checked)}),y.jsx("span",{className:"vs-switch-slider"})]})]})})]})}function GV({permBit:n,labelKey:e,descKey:t,state:i,onChange:r}){const{t:o}=Te("settings");return y.jsxs("div",{className:"perm-tri",children:[y.jsxs("div",{className:"perm-tri-info",children:[y.jsx("p",{className:"perm-tri-label",children:o(e)}),y.jsx("p",{className:"perm-tri-desc",children:o(t)})]}),y.jsxs("div",{className:"perm-tri-controls",children:[y.jsx("button",{className:`perm-tri-btn deny${i==="deny"?" active":""}`,onClick:()=>r(n,i==="deny"?"inherit":"deny"),title:o("permOverrideDeny"),children:y.jsx("svg",{width:"14",height:"14",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),y.jsx("button",{className:`perm-tri-btn inherit${i==="inherit"?" active":""}`,onClick:()=>r(n,"inherit"),title:o("permOverrideInherit"),children:y.jsx("svg",{width:"14",height:"14",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:y.jsx("path",{strokeLinecap:"round",d:"M6 12h12"})})}),y.jsx("button",{className:`perm-tri-btn allow${i==="allow"?" active":""}`,onClick:()=>r(n,i==="allow"?"inherit":"allow"),title:o("permOverrideAllow"),children:y.jsx("svg",{width:"14",height:"14",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]})]})}const YV=[{bit:Pe.SendMessages,label:"permSendMessages",desc:"permSendMessagesDesc"},{bit:Pe.ReadMessages,label:"permReadMessages",desc:"permReadMessagesDesc"},{bit:Pe.ManageMessages,label:"permManageMessages",desc:"permManageMessagesDesc"}],JV=[{bit:Pe.ConnectVoice,label:"permConnect",desc:"permConnectDesc"},{bit:Pe.Speak,label:"permSpeak",desc:"permSpeakDesc"},{bit:Pe.Stream,label:"permStream",desc:"permStreamDesc"}];function QV({channel:n}){const{t:e}=Te("settings"),{roles:t,fetchRoles:i}=Lo(),{fetchOverrides:r,getOverrides:o,setOverride:u}=Uo(),l=Fi(_=>_.addToast),[f,h]=T.useState("");T.useEffect(()=>{i(),r(n.id)},[i,r,n.id]),T.useEffect(()=>{!f&&t.length>0&&h(t[0].id)},[f,t]);const m=o(n.id),g=n.type==="voice"?JV:YV,b=m.find(_=>_.role_id===f),C=T.useCallback(_=>b?(b.allow&_)!==0?"allow":(b.deny&_)!==0?"deny":"inherit":"inherit",[b]);async function E(_,w){if(!f)return;let O=b?.allow??0,D=b?.deny??0;O&=~_,D&=~_,w==="allow"&&(O|=_),w==="deny"&&(D|=_),await u(n.id,f,O,D)?l("success",e("channelPermSaved")):l("error",e("channelPermSaveError"))}const k=t.find(_=>_.id===f);return y.jsxs("div",{children:[y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{className:"settings-label",children:e("roles")}),y.jsxs("div",{className:"perm-tri-role-select",children:[k&&y.jsx("span",{className:"role-list-dot",style:{backgroundColor:k.color||"#99AAB5"}}),y.jsx("select",{className:"settings-input perm-tri-role-dropdown",value:f,onChange:_=>h(_.target.value),children:t.map(_=>y.jsx("option",{value:_.id,children:_.name},_.id))})]})]}),y.jsx("p",{className:"perm-tri-section-desc",children:e("channelPermDesc")}),y.jsxs("div",{className:"settings-field",children:[y.jsx("label",{className:"settings-label",children:n.type==="voice"?e("voicePermissions"):e("textPermissions")}),y.jsx("div",{className:"perm-tri-container",children:g.map(_=>y.jsx(GV,{permBit:_.bit,labelKey:_.label,descKey:_.desc,state:C(_.bit),onChange:E},_.bit))})]})]})}function XV(){const{t:n}=Te("channels"),{t:e}=Te("settings"),t=xt(O=>O.categories),i=Fi(O=>O.addToast),r=Xo(),o=t.flatMap(O=>O.channels).sort((O,D)=>O.position-D.position),[u,l]=T.useState(null),[f,h]=T.useState(!1),[m,g]=T.useState(""),[b,C]=T.useState("text"),[E,k]=T.useState(!1);async function _(){const O=m.trim();if(!O||E)return;k(!0),(await km({name:O,type:b})).success?(i("success",n("channelCreated")),g(""),h(!1)):i("error",n("channelCreateError")),k(!1)}async function w(O,D){if(!await r({message:n("deleteConfirm",{name:D}),confirmLabel:n("deleteChannel"),danger:!0}))return;(await cC(O)).success?(i("success",n("channelDeleted")),u?.id===O&&l(null)):i("error",n("channelDeleteError"))}return y.jsxs("div",{className:"channel-settings-wrapper",children:[y.jsxs("div",{className:"role-list",children:[y.jsxs("div",{className:"channel-settings-header",children:[y.jsx("span",{className:"channel-settings-header-label",children:e("channels")}),y.jsx("button",{onClick:()=>h(!f),className:"settings-btn channel-settings-header-btn",children:"+"})]}),f&&y.jsxs("div",{className:"channel-settings-create-inline",children:[y.jsx("input",{className:"settings-input",placeholder:n("channelName"),value:m,onChange:O=>g(O.target.value),onKeyDown:O=>{O.key==="Enter"&&_(),O.key==="Escape"&&h(!1)},autoFocus:!0}),y.jsxs("select",{className:"settings-input",value:b,onChange:O=>C(O.target.value),children:[y.jsx("option",{value:"text",children:n("text")}),y.jsx("option",{value:"voice",children:n("voice")})]}),y.jsx("button",{className:"settings-btn",onClick:_,disabled:!m.trim()||E,children:E?"...":n("createChannel")})]}),y.jsx("div",{className:"channel-settings-ch-list",children:o.map(O=>y.jsxs("div",{className:`role-list-item channel-settings-ch-row${O.id===u?.id?" active":""}`,onClick:()=>l(O),children:[y.jsx("span",{className:"channel-settings-ch-icon",children:O.type==="voice"?"":"#"}),y.jsx("span",{className:"role-list-name",children:O.name}),y.jsx("button",{className:"channel-settings-delete",onClick:D=>{D.stopPropagation(),w(O.id,O.name)},title:n("deleteChannel"),children:""})]},O.id))})]}),y.jsx("div",{className:"settings-content channel-settings-right",children:u?y.jsxs("div",{className:"channel-perm-section",children:[y.jsxs("h2",{className:"settings-section-title channel-settings-right-title",children:[u.type==="voice"?"":"#"," ",u.name]}),y.jsx(QV,{channel:u})]}):y.jsx("div",{className:"no-channel",children:e("selectChannelToEdit")})})]})}function WV(){const{t:n}=Te("settings"),e=ar(r=>r.isOpen),t=ar(r=>r.activeTab),i=ar(r=>r.closeSettings);return T.useEffect(()=>{if(!e)return;function r(o){o.key==="Escape"&&i()}return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[e,i]),T.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[e]),e?y.jsxs("div",{className:"settings-overlay",children:[y.jsx(bV,{}),y.jsx("div",{className:"settings-content",children:y.jsx(ZV,{activeTab:t})}),y.jsx("button",{onClick:i,className:"settings-close",title:n("title")+"  ESC",children:""})]}):null}function ZV({activeTab:n}){const{t:e}=Te("settings");switch(n){case"profile":return y.jsx(LV,{});case"roles":return y.jsx(wV,{});case"server-general":return y.jsx(jV,{});case"invites":return y.jsx(qV,{});case"voice":return y.jsx(KV,{});case"channels":return y.jsx(XV,{});case"appearance":case"members":return y.jsxs("div",{className:"no-channel settings-placeholder",children:[y.jsx("span",{className:"settings-section-title",children:e(n)}),y.jsx("span",{className:"settings-placeholder-text",children:e("comingSoon")})]});default:return null}}let _h=null;function e9(){return _h||(_h=new AudioContext),_h}function FT(n,e,t,i){try{const r=e9();r.state==="suspended"&&r.resume().catch(()=>{});const o=r.currentTime,u=r.createOscillator();u.type="sine",u.frequency.setValueAtTime(n,o),u.frequency.linearRampToValueAtTime(e,o+t);const l=r.createGain();l.gain.setValueAtTime(i*.3,o),l.gain.linearRampToValueAtTime(0,o+t),u.connect(l),l.connect(r.destination),u.start(o),u.stop(o+t)}catch{}}function t9(){const{soundsEnabled:n,masterVolume:e}=be.getState();if(!n)return;const t=e/100;FT(350,600,.15,t)}function n9(){const{soundsEnabled:n,masterVolume:e}=be.getState();if(!n)return;const t=e/100;FT(400,200,.12,t)}const i9=3e3,s9=3e3;function a9(){const n=T.useRef(null),e=T.useRef(0),t=T.useRef(0),i=T.useRef(null),r=T.useRef(null),o=T.useRef(0),u=T.useRef(new Map),l=T.useRef(()=>{});function f(k){switch(k.op){case"heartbeat_ack":t.current=0;break;case"channel_create":xt.getState().handleChannelCreate(k.d);break;case"channel_update":xt.getState().handleChannelUpdate(k.d);break;case"channel_delete":xt.getState().handleChannelDelete(k.d.id);break;case"channel_reorder":xt.getState().handleChannelReorder(k.d);break;case"category_create":xt.getState().handleCategoryCreate(k.d);break;case"category_update":xt.getState().handleCategoryUpdate(k.d);break;case"category_delete":xt.getState().handleCategoryDelete(k.d.id);break;case"message_create":{const _=k.d;ht.getState().handleMessageCreate(_);const w=at.getState().user?.id;if(_.author?.id===w||_.user_id===w)break;const O=Xe.getState(),D=O.panels[O.activePanelId],x=D?.tabs.find(M=>M.id===D.activeTabId);x?.type==="text"&&x?.channelId===_.channel_id?rr.getState().markAsRead(_.channel_id,_.id):rr.getState().incrementUnread(_.channel_id);break}case"message_update":ht.getState().handleMessageUpdate(k.d);break;case"message_delete":ht.getState().handleMessageDelete(k.d);break;case"typing_start":{const _=k.d;ht.getState().handleTypingStart(_.channel_id,_.username);break}case"ready":{const _=k.d;Et.getState().handleReady(_.online_user_ids),rr.getState().fetchUnreadCounts(),lt.getState().fetchChannels();break}case"presence_update":{const _=k.d;Et.getState().handlePresenceUpdate(_.user_id,_.status);break}case"member_join":Et.getState().handleMemberJoin(k.d);break;case"member_leave":Et.getState().handleMemberLeave(k.d.user_id);break;case"member_update":Et.getState().handleMemberUpdate(k.d);break;case"role_create":{const _=k.d;Et.getState().handleRoleCreate(_),Lo.getState().handleRoleCreate(_);break}case"role_update":{const _=k.d;Et.getState().handleRoleUpdate(_),Lo.getState().handleRoleUpdate(_);break}case"role_delete":{const _=k.d.id;Et.getState().handleRoleDelete(_),Lo.getState().handleRoleDelete(_);break}case"voice_state_update":{const _=k.d;be.getState().handleVoiceStateUpdate(_);const w=at.getState().user?.id;_.user_id!==w&&(_.action==="join"?t9():_.action==="leave"&&n9());break}case"voice_states_sync":{const _=k.d;be.getState().handleVoiceStatesSync(_.states);break}case"message_pin":Xn.getState().handleMessagePin(k.d);break;case"message_unpin":Xn.getState().handleMessageUnpin(k.d);break;case"reaction_update":{const _=k.d;ht.getState().handleReactionUpdate(_);break}case"dm_channel_create":lt.getState().handleDMChannelCreate(k.d);break;case"dm_message_create":{const _=k.d;lt.getState().handleDMMessageCreate(_);const w=at.getState().user?.id;if(_.user_id===w)break;const O=lt.getState(),D=O.selectedDMId;_.dm_channel_id!==D&&O.incrementDMUnread(_.dm_channel_id);break}case"dm_message_update":lt.getState().handleDMMessageUpdate(k.d);break;case"dm_message_delete":lt.getState().handleDMMessageDelete(k.d);break;case"channel_permission_update":Uo.getState().handleOverrideUpdate(k.d);break;case"channel_permission_delete":{const _=k.d;Uo.getState().handleOverrideDelete(_.channel_id,_.role_id);break}case"server_update":Cm.getState().handleServerUpdate(k.d);break}}l.current=f;function h(){i.current&&(clearInterval(i.current),i.current=null),r.current&&(clearTimeout(r.current),r.current=null)}const m=T.useCallback(k=>{const _=Date.now(),w=u.current.get(k)??0;_-w<s9||n.current?.readyState===WebSocket.OPEN&&(n.current.send(JSON.stringify({op:"typing",d:{channel_id:k}})),u.current.set(k,_))},[]),g=T.useCallback(k=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({op:"voice_join",d:{channel_id:k}}))},[]),b=T.useCallback(()=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({op:"voice_leave"}))},[]),C=T.useCallback(k=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({op:"presence_update",d:{status:k}}))},[]),E=T.useCallback(k=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({op:"voice_state_update_request",d:k}))},[]);return T.useEffect(()=>{const k=++o.current;function _(){const w=Lh();if(!w||o.current!==k)return;h(),n.current&&(n.current.close(),n.current=null);const O=new WebSocket(`${fU}?token=${w}`);n.current=O,O.onopen=()=>{o.current===k&&(t.current=0,i.current=setInterval(()=>{if(o.current!==k){clearInterval(i.current);return}O.readyState===WebSocket.OPEN&&(O.send(JSON.stringify({op:"heartbeat"})),t.current++,t.current>=mU&&O.close())},hU))},O.onmessage=D=>{if(o.current!==k)return;let x;try{x=JSON.parse(D.data)}catch{return}x.seq&&(e.current=x.seq),l.current(x)},O.onclose=()=>{o.current===k&&(h(),r.current=setTimeout(()=>{o.current===k&&_()},i9))},O.onerror=()=>{}}return _(),()=>{o.current++,h(),n.current&&(n.current.close(),n.current=null)}},[]),{sendTyping:m,sendPresenceUpdate:C,sendVoiceJoin:g,sendVoiceLeave:b,sendVoiceStateUpdate:E}}function r9({sendVoiceJoin:n,sendVoiceLeave:e,sendVoiceStateUpdate:t}){const i=be(C=>C.joinVoiceChannel),r=be(C=>C.leaveVoiceChannel),o=be(C=>C.toggleMute),u=be(C=>C.toggleDeafen),l=be(C=>C.setStreaming),f=T.useCallback(async C=>{await i(C)&&n(C)},[i,n]),h=T.useCallback(()=>{e(),r()},[r,e]),m=T.useCallback(()=>{o();const{isMuted:C,isDeafened:E}=be.getState();t({is_muted:C,is_deafened:E})},[o,t]),g=T.useCallback(()=>{u();const{isMuted:C,isDeafened:E}=be.getState();t({is_muted:C,is_deafened:E})},[u,t]),b=T.useCallback(()=>{const{isStreaming:C}=be.getState(),E=!C;l(E),t({is_streaming:E})},[l,t]);return{joinVoice:f,leaveVoice:h,toggleMute:m,toggleDeafen:g,toggleScreenShare:b}}function o9({sendPresenceUpdate:n}){const e=T.useRef(!1),t=T.useRef(null);T.useEffect(()=>{function i(){t.current&&clearTimeout(t.current),e.current&&(e.current=!1,n("online")),t.current=setTimeout(()=>{e.current=!0,n("idle")},vU)}for(const r of qb)window.addEventListener(r,i,{passive:!0});return i(),()=>{for(const r of qb)window.removeEventListener(r,i);t.current&&clearTimeout(t.current)}},[n])}function c9({toggleMute:n,toggleDeafen:e}){T.useEffect(()=>{function t(i){const r=i.target,o=r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable;if(i.ctrlKey&&!i.shiftKey&&i.key==="k"){i.preventDefault(),Xe.getState().toggleQuickSwitcher();return}if(!o){if(i.ctrlKey&&i.shiftKey&&i.key==="M"){i.preventDefault(),n();return}if(i.ctrlKey&&i.shiftKey&&i.key==="D"){i.preventDefault(),e();return}}}return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[n,e])}function l9(){const{t:n}=Te("common"),e=Xe(w=>w.quickSwitcherOpen),t=Xe(w=>w.closeQuickSwitcher),i=Xe(w=>w.openTab),r=xt(w=>w.categories),o=xt(w=>w.selectChannel),u=lt(w=>w.channels),l=lt(w=>w.selectDM),[f,h]=T.useState(""),[m,g]=T.useState(0),b=T.useRef(null);T.useEffect(()=>{e&&(h(""),g(0),requestAnimationFrame(()=>b.current?.focus()))},[e]);const C=T.useMemo(()=>{const w=r.flatMap(D=>D.channels.map(x=>({id:x.id,label:x.name,type:"channel",channelType:x.type,category:D.category.name}))),O=u.map(D=>({id:D.id,label:D.other_user?.display_name??D.other_user?.username??"DM",type:"dm"}));return[...w,...O]},[r,u]),E=T.useMemo(()=>{if(!f.trim())return C;const w=f.toLowerCase();return C.filter(O=>O.label.toLowerCase().includes(w))},[C,f]);T.useEffect(()=>{m>=E.length&&g(Math.max(0,E.length-1))},[E.length,m]);function k(w){if(w.type==="channel"){o(w.id);const O=w.channelType==="voice"?"voice":"text";i(w.id,O,w.label)}else l(w.id),i(w.id,"dm",w.label);t()}function _(w){switch(w.key){case"ArrowDown":w.preventDefault(),g(O=>Math.min(O+1,E.length-1));break;case"ArrowUp":w.preventDefault(),g(O=>Math.max(O-1,0));break;case"Enter":w.preventDefault(),E[m]&&k(E[m]);break;case"Escape":w.preventDefault(),t();break}}return e?y.jsx("div",{className:"quick-switcher-overlay",onClick:t,children:y.jsxs("div",{className:"quick-switcher",onClick:w=>w.stopPropagation(),children:[y.jsx("input",{ref:b,className:"qs-input",type:"text",value:f,onChange:w=>{h(w.target.value),g(0)},onKeyDown:_,placeholder:n("quickSwitcherPlaceholder")}),y.jsx("div",{className:"qs-results",children:E.length===0?y.jsx("div",{className:"qs-empty",children:n("noResults")}):E.map((w,O)=>y.jsxs("button",{className:`qs-item${O===m?" qs-selected":""}`,onClick:()=>k(w),onMouseEnter:()=>g(O),children:[y.jsx("span",{className:"qs-icon",children:w.type==="channel"?w.channelType==="voice"?"":"#":"@"}),y.jsx("span",{className:"qs-label",children:w.label}),w.category&&y.jsx("span",{className:"qs-category",children:w.category})]},w.id))}),y.jsxs("div",{className:"qs-footer",children:[y.jsxs("span",{children:[" ",n("search")]}),y.jsxs("span",{children:[" ",n("confirm")]}),y.jsxs("span",{children:["esc ",n("close")]})]})]})}):null}function u9(){const{sendTyping:n,sendPresenceUpdate:e,sendVoiceJoin:t,sendVoiceLeave:i,sendVoiceStateUpdate:r}=a9();o9({sendPresenceUpdate:e});const o=Cm(x=>x.fetchServer),u=xt(x=>x.fetchChannels),l=Et(x=>x.fetchMembers),f=xt(x=>x.selectedChannelId),h=xt(x=>x.categories),m=Xe(x=>x.layout),g=Xe(x=>x.openTab),b=T.useRef(!1);T.useEffect(()=>{o(),u(),l()},[o,u,l]),T.useEffect(()=>{if(!f||b.current||h.length===0)return;const x=h.flatMap(R=>R.channels).find(R=>R.id===f);x&&(g(x.id,x.type==="text"?"text":"voice",x.name),b.current=!0)},[f,h,g]),T.useEffect(()=>{if(!f)return;const x=ht.getState().messagesByChannel[f];if(x&&x.length>0){const R=x[x.length-1];rr.getState().markAsRead(f,R.id)}else rr.getState().clearUnread(f)},[f]);const{joinVoice:C,leaveVoice:E,toggleMute:k,toggleDeafen:_,toggleScreenShare:w}=r9({sendVoiceJoin:t,sendVoiceLeave:i,sendVoiceStateUpdate:r});c9({toggleMute:k,toggleDeafen:_}),T.useEffect(()=>(be.getState().registerOnLeave(E),()=>{be.getState().registerOnLeave(null)}),[E]);const O=be(x=>x.currentVoiceChannelId),D=T.useRef(null);return T.useEffect(()=>{const x=D.current;D.current=O,x&&!O&&Xe.getState().closeVoiceTabs(x)},[O]),y.jsxs("div",{className:"mqvi-app",children:[y.jsx(AU,{}),y.jsxs("div",{className:"main-area",children:[y.jsx(hm,{node:m,sendTyping:n}),y.jsx(eV,{})]}),y.jsx(uV,{onJoinVoice:C}),y.jsx(fV,{onToggleMute:k,onToggleDeafen:_,onToggleScreenShare:w,onDisconnect:E}),y.jsx(WV,{}),y.jsx(gV,{}),y.jsx(pV,{}),y.jsx(l9,{})]})}function d9(){const{t:n}=Te("common"),e=at(r=>r.initialize),t=at(r=>r.isInitialized),i=at(r=>r.user);return T.useEffect(()=>{e()},[e]),t?y.jsxs(mR,{children:[y.jsx(xo,{path:"/login",element:i?y.jsx(yl,{to:"/channels",replace:!0}):y.jsx(TU,{})}),y.jsx(xo,{path:"/register",element:i?y.jsx(yl,{to:"/channels",replace:!0}):y.jsx(EU,{})}),y.jsx(xo,{path:"/channels/*",element:i?y.jsx(u9,{}):y.jsx(yl,{to:"/login",replace:!0})}),y.jsx(xo,{path:"*",element:y.jsx(yl,{to:i?"/channels":"/login",replace:!0})})]}):y.jsx("div",{className:"flex h-full items-center justify-center bg-background",children:y.jsxs("div",{className:"text-center",children:[y.jsx("div",{className:"mx-auto mb-6 h-14 w-14 animate-spin rounded-full border-4 border-surface border-t-brand"}),y.jsx("p",{className:"text-base text-text-muted",children:n("loading")})]})})}vx.createRoot(document.getElementById("root")).render(y.jsx(T.StrictMode,{children:y.jsx(UR,{children:y.jsx(d9,{})})}));
