(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();function hx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Lh={exports:{}},io={};var tb;function fx(){if(tb)return io;tb=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,a,o){var l=null;if(o!==void 0&&(l=""+o),a.key!==void 0&&(l=""+a.key),"key"in a){o={};for(var u in a)u!=="key"&&(o[u]=a[u])}else o=a;return a=o.ref,{$$typeof:n,type:i,key:l,ref:a!==void 0?a:null,props:o}}return io.Fragment=e,io.jsx=t,io.jsxs=t,io}var nb;function mx(){return nb||(nb=1,Lh.exports=fx()),Lh.exports}var g=mx(),Ih={exports:{}},Re={};var ib;function px(){if(ib)return Re;ib=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),b=Symbol.iterator;function C(B){return B===null||typeof B!="object"?null:(B=b&&B[b]||B["@@iterator"],typeof B=="function"?B:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,R={};function _(B,W,oe){this.props=B,this.context=W,this.refs=R,this.updater=oe||T}_.prototype.isReactComponent={},_.prototype.setState=function(B,W){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,W,"setState")},_.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function D(){}D.prototype=_.prototype;function j(B,W,oe){this.props=B,this.context=W,this.refs=R,this.updater=oe||T}var x=j.prototype=new D;x.constructor=j,S(x,_.prototype),x.isPureReactComponent=!0;var w=Array.isArray;function M(){}var I={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function L(B,W,oe){var he=oe.ref;return{$$typeof:n,type:B,key:W,ref:he!==void 0?he:null,props:oe}}function A(B,W){return L(B.type,W,B.props)}function O(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function Y(B){var W={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(oe){return W[oe]})}var J=/\/+/g;function le(B,W){return typeof B=="object"&&B!==null&&B.key!=null?Y(""+B.key):W.toString(36)}function Te(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(M,M):(B.status="pending",B.then(function(W){B.status==="pending"&&(B.status="fulfilled",B.value=W)},function(W){B.status==="pending"&&(B.status="rejected",B.reason=W)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function H(B,W,oe,he,Ce){var re=typeof B;(re==="undefined"||re==="boolean")&&(B=null);var fe=!1;if(B===null)fe=!0;else switch(re){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(B.$$typeof){case n:case e:fe=!0;break;case m:return fe=B._init,H(fe(B._payload),W,oe,he,Ce)}}if(fe)return Ce=Ce(B),fe=he===""?"."+le(B,0):he,w(Ce)?(oe="",fe!=null&&(oe=fe.replace(J,"$&/")+"/"),H(Ce,W,oe,"",function(Li){return Li})):Ce!=null&&(O(Ce)&&(Ce=A(Ce,oe+(Ce.key==null||B&&B.key===Ce.key?"":(""+Ce.key).replace(J,"$&/")+"/")+fe)),W.push(Ce)),1;fe=0;var Je=he===""?".":he+":";if(w(B))for(var $e=0;$e<B.length;$e++)he=B[$e],re=Je+le(he,$e),fe+=H(he,W,oe,re,Ce);else if($e=C(B),typeof $e=="function")for(B=$e.call(B),$e=0;!(he=B.next()).done;)he=he.value,re=Je+le(he,$e++),fe+=H(he,W,oe,re,Ce);else if(re==="object"){if(typeof B.then=="function")return H(Te(B),W,oe,he,Ce);throw W=String(B),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return fe}function ae(B,W,oe){if(B==null)return B;var he=[],Ce=0;return H(B,he,"","",function(re){return W.call(oe,re,Ce++)}),he}function de(B){if(B._status===-1){var W=B._result;W=W(),W.then(function(oe){(B._status===0||B._status===-1)&&(B._status=1,B._result=oe)},function(oe){(B._status===0||B._status===-1)&&(B._status=2,B._result=oe)}),B._status===-1&&(B._status=0,B._result=W)}if(B._status===1)return B._result.default;throw B._result}var Ee=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},De={map:ae,forEach:function(B,W,oe){ae(B,function(){W.apply(this,arguments)},oe)},count:function(B){var W=0;return ae(B,function(){W++}),W},toArray:function(B){return ae(B,function(W){return W})||[]},only:function(B){if(!O(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return Re.Activity=v,Re.Children=De,Re.Component=_,Re.Fragment=t,Re.Profiler=a,Re.PureComponent=j,Re.StrictMode=i,Re.Suspense=h,Re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,Re.__COMPILER_RUNTIME={__proto__:null,c:function(B){return I.H.useMemoCache(B)}},Re.cache=function(B){return function(){return B.apply(null,arguments)}},Re.cacheSignal=function(){return null},Re.cloneElement=function(B,W,oe){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var he=S({},B.props),Ce=B.key;if(W!=null)for(re in W.key!==void 0&&(Ce=""+W.key),W)!F.call(W,re)||re==="key"||re==="__self"||re==="__source"||re==="ref"&&W.ref===void 0||(he[re]=W[re]);var re=arguments.length-2;if(re===1)he.children=oe;else if(1<re){for(var fe=Array(re),Je=0;Je<re;Je++)fe[Je]=arguments[Je+2];he.children=fe}return L(B.type,Ce,he)},Re.createContext=function(B){return B={$$typeof:l,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:o,_context:B},B},Re.createElement=function(B,W,oe){var he,Ce={},re=null;if(W!=null)for(he in W.key!==void 0&&(re=""+W.key),W)F.call(W,he)&&he!=="key"&&he!=="__self"&&he!=="__source"&&(Ce[he]=W[he]);var fe=arguments.length-2;if(fe===1)Ce.children=oe;else if(1<fe){for(var Je=Array(fe),$e=0;$e<fe;$e++)Je[$e]=arguments[$e+2];Ce.children=Je}if(B&&B.defaultProps)for(he in fe=B.defaultProps,fe)Ce[he]===void 0&&(Ce[he]=fe[he]);return L(B,re,Ce)},Re.createRef=function(){return{current:null}},Re.forwardRef=function(B){return{$$typeof:u,render:B}},Re.isValidElement=O,Re.lazy=function(B){return{$$typeof:m,_payload:{_status:-1,_result:B},_init:de}},Re.memo=function(B,W){return{$$typeof:f,type:B,compare:W===void 0?null:W}},Re.startTransition=function(B){var W=I.T,oe={};I.T=oe;try{var he=B(),Ce=I.S;Ce!==null&&Ce(oe,he),typeof he=="object"&&he!==null&&typeof he.then=="function"&&he.then(M,Ee)}catch(re){Ee(re)}finally{W!==null&&oe.types!==null&&(W.types=oe.types),I.T=W}},Re.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},Re.use=function(B){return I.H.use(B)},Re.useActionState=function(B,W,oe){return I.H.useActionState(B,W,oe)},Re.useCallback=function(B,W){return I.H.useCallback(B,W)},Re.useContext=function(B){return I.H.useContext(B)},Re.useDebugValue=function(){},Re.useDeferredValue=function(B,W){return I.H.useDeferredValue(B,W)},Re.useEffect=function(B,W){return I.H.useEffect(B,W)},Re.useEffectEvent=function(B){return I.H.useEffectEvent(B)},Re.useId=function(){return I.H.useId()},Re.useImperativeHandle=function(B,W,oe){return I.H.useImperativeHandle(B,W,oe)},Re.useInsertionEffect=function(B,W){return I.H.useInsertionEffect(B,W)},Re.useLayoutEffect=function(B,W){return I.H.useLayoutEffect(B,W)},Re.useMemo=function(B,W){return I.H.useMemo(B,W)},Re.useOptimistic=function(B,W){return I.H.useOptimistic(B,W)},Re.useReducer=function(B,W,oe){return I.H.useReducer(B,W,oe)},Re.useRef=function(B){return I.H.useRef(B)},Re.useState=function(B){return I.H.useState(B)},Re.useSyncExternalStore=function(B,W,oe){return I.H.useSyncExternalStore(B,W,oe)},Re.useTransition=function(){return I.H.useTransition()},Re.version="19.2.4",Re}var sb;function tu(){return sb||(sb=1,Ih.exports=px()),Ih.exports}var E=tu();const ol=hx(E);var Uh={exports:{}},so={},Bh={exports:{}},zh={};var ab;function gx(){return ab||(ab=1,(function(n){function e(H,ae){var de=H.length;H.push(ae);e:for(;0<de;){var Ee=de-1>>>1,De=H[Ee];if(0<a(De,ae))H[Ee]=ae,H[de]=De,de=Ee;else break e}}function t(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var ae=H[0],de=H.pop();if(de!==ae){H[0]=de;e:for(var Ee=0,De=H.length,B=De>>>1;Ee<B;){var W=2*(Ee+1)-1,oe=H[W],he=W+1,Ce=H[he];if(0>a(oe,de))he<De&&0>a(Ce,oe)?(H[Ee]=Ce,H[he]=de,Ee=he):(H[Ee]=oe,H[W]=de,Ee=W);else if(he<De&&0>a(Ce,de))H[Ee]=Ce,H[he]=de,Ee=he;else break e}}return ae}function a(H,ae){var de=H.sortIndex-ae.sortIndex;return de!==0?de:H.id-ae.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();n.unstable_now=function(){return l.now()-u}}var h=[],f=[],m=1,v=null,b=3,C=!1,T=!1,S=!1,R=!1,_=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function x(H){for(var ae=t(f);ae!==null;){if(ae.callback===null)i(f);else if(ae.startTime<=H)i(f),ae.sortIndex=ae.expirationTime,e(h,ae);else break;ae=t(f)}}function w(H){if(S=!1,x(H),!T)if(t(h)!==null)T=!0,M||(M=!0,Y());else{var ae=t(f);ae!==null&&Te(w,ae.startTime-H)}}var M=!1,I=-1,F=5,L=-1;function A(){return R?!0:!(n.unstable_now()-L<F)}function O(){if(R=!1,M){var H=n.unstable_now();L=H;var ae=!0;try{e:{T=!1,S&&(S=!1,D(I),I=-1),C=!0;var de=b;try{t:{for(x(H),v=t(h);v!==null&&!(v.expirationTime>H&&A());){var Ee=v.callback;if(typeof Ee=="function"){v.callback=null,b=v.priorityLevel;var De=Ee(v.expirationTime<=H);if(H=n.unstable_now(),typeof De=="function"){v.callback=De,x(H),ae=!0;break t}v===t(h)&&i(h),x(H)}else i(h);v=t(h)}if(v!==null)ae=!0;else{var B=t(f);B!==null&&Te(w,B.startTime-H),ae=!1}}break e}finally{v=null,b=de,C=!1}ae=void 0}}finally{ae?Y():M=!1}}}var Y;if(typeof j=="function")Y=function(){j(O)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,le=J.port2;J.port1.onmessage=O,Y=function(){le.postMessage(null)}}else Y=function(){_(O,0)};function Te(H,ae){I=_(function(){H(n.unstable_now())},ae)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return b},n.unstable_next=function(H){switch(b){case 1:case 2:case 3:var ae=3;break;default:ae=b}var de=b;b=ae;try{return H()}finally{b=de}},n.unstable_requestPaint=function(){R=!0},n.unstable_runWithPriority=function(H,ae){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var de=b;b=H;try{return ae()}finally{b=de}},n.unstable_scheduleCallback=function(H,ae,de){var Ee=n.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?Ee+de:Ee):de=Ee,H){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=de+De,H={id:m++,callback:ae,priorityLevel:H,startTime:de,expirationTime:De,sortIndex:-1},de>Ee?(H.sortIndex=de,e(f,H),t(h)===null&&H===t(f)&&(S?(D(I),I=-1):S=!0,Te(w,de-Ee))):(H.sortIndex=De,e(h,H),T||C||(T=!0,M||(M=!0,Y()))),H},n.unstable_shouldYield=A,n.unstable_wrapCallback=function(H){var ae=b;return function(){var de=b;b=ae;try{return H.apply(this,arguments)}finally{b=de}}}})(zh)),zh}var rb;function vx(){return rb||(rb=1,Bh.exports=gx()),Bh.exports}var Fh={exports:{}},qt={};var ob;function yx(){if(ob)return qt;ob=1;var n=tu();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(h,f,m){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:v==null?null:""+v,children:h,containerInfo:f,implementation:m}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return qt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,qt.createPortal=function(h,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,m)},qt.flushSync=function(h){var f=l.T,m=i.p;try{if(l.T=null,i.p=2,h)return h()}finally{l.T=f,i.p=m,i.d.f()}},qt.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,i.d.C(h,f))},qt.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},qt.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var m=f.as,v=u(m,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,C=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?i.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:v,integrity:b,fetchPriority:C}):m==="script"&&i.d.X(h,{crossOrigin:v,integrity:b,fetchPriority:C,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},qt.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=u(f.as,f.crossOrigin);i.d.M(h,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&i.d.M(h)},qt.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,v=u(m,f.crossOrigin);i.d.L(h,m,{crossOrigin:v,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},qt.preloadModule=function(h,f){if(typeof h=="string")if(f){var m=u(f.as,f.crossOrigin);i.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else i.d.m(h)},qt.requestFormReset=function(h){i.d.r(h)},qt.unstable_batchedUpdates=function(h,f){return h(f)},qt.useFormState=function(h,f,m){return l.H.useFormState(h,f,m)},qt.useFormStatus=function(){return l.H.useHostTransitionStatus()},qt.version="19.2.4",qt}var cb;function xS(){if(cb)return Fh.exports;cb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Fh.exports=yx(),Fh.exports}var lb;function bx(){if(lb)return so;lb=1;var n=vx(),e=tu(),t=xS();function i(s){var r="https://react.dev/errors/"+s;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var r=s,c=s;if(s.alternate)for(;r.return;)r=r.return;else{s=r;do r=s,(r.flags&4098)!==0&&(c=r.return),s=r.return;while(s)}return r.tag===3?c:null}function l(s){if(s.tag===13){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function u(s){if(s.tag===31){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(i(188))}function f(s){var r=s.alternate;if(!r){if(r=o(s),r===null)throw Error(i(188));return r!==s?null:s}for(var c=s,d=r;;){var p=c.return;if(p===null)break;var y=p.alternate;if(y===null){if(d=p.return,d!==null){c=d;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===c)return h(p),s;if(y===d)return h(p),r;y=y.sibling}throw Error(i(188))}if(c.return!==d.return)c=p,d=y;else{for(var k=!1,N=p.child;N;){if(N===c){k=!0,c=p,d=y;break}if(N===d){k=!0,d=p,c=y;break}N=N.sibling}if(!k){for(N=y.child;N;){if(N===c){k=!0,c=y,d=p;break}if(N===d){k=!0,d=y,c=p;break}N=N.sibling}if(!k)throw Error(i(189))}}if(c.alternate!==d)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?s:r}function m(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s;for(s=s.child;s!==null;){if(r=m(s),r!==null)return r;s=s.sibling}return null}var v=Object.assign,b=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),j=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),A=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function Y(s){return s===null||typeof s!="object"?null:(s=O&&s[O]||s["@@iterator"],typeof s=="function"?s:null)}var J=Symbol.for("react.client.reference");function le(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===J?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case S:return"Fragment";case _:return"Profiler";case R:return"StrictMode";case w:return"Suspense";case M:return"SuspenseList";case L:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case T:return"Portal";case j:return s.displayName||"Context";case D:return(s._context.displayName||"Context")+".Consumer";case x:var r=s.render;return s=s.displayName,s||(s=r.displayName||r.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case I:return r=s.displayName||null,r!==null?r:le(s.type)||"Memo";case F:r=s._payload,s=s._init;try{return le(s(r))}catch{}}return null}var Te=Array.isArray,H=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},Ee=[],De=-1;function B(s){return{current:s}}function W(s){0>De||(s.current=Ee[De],Ee[De]=null,De--)}function oe(s,r){De++,Ee[De]=s.current,s.current=r}var he=B(null),Ce=B(null),re=B(null),fe=B(null);function Je(s,r){switch(oe(re,r),oe(Ce,s),oe(he,null),r.nodeType){case 9:case 11:s=(s=r.documentElement)&&(s=s.namespaceURI)?Ey(s):0;break;default:if(s=r.tagName,r=r.namespaceURI)r=Ey(r),s=xy(r,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}W(he),oe(he,s)}function $e(){W(he),W(Ce),W(re)}function Li(s){s.memoizedState!==null&&oe(fe,s);var r=he.current,c=xy(r,s.type);r!==c&&(oe(Ce,s),oe(he,c))}function qo(s){Ce.current===s&&(W(he),W(Ce)),fe.current===s&&(W(fe),Zr._currentValue=de)}var yu,ep;function xs(s){if(yu===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);yu=r&&r[1]||"",ep=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+yu+s+ep}var bu=!1;function Su(s,r){if(!s||bu)return"";bu=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(r){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch(Q){var G=Q}Reflect.construct(s,[],ne)}else{try{ne.call()}catch(Q){G=Q}s.call(ne.prototype)}}else{try{throw Error()}catch(Q){G=Q}(ne=s())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch(Q){if(Q&&G&&typeof Q.stack=="string")return[Q.stack,G.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=d.DetermineComponentFrameRoot(),k=y[0],N=y[1];if(k&&N){var U=k.split(`
`),K=N.split(`
`);for(p=d=0;d<U.length&&!U[d].includes("DetermineComponentFrameRoot");)d++;for(;p<K.length&&!K[p].includes("DetermineComponentFrameRoot");)p++;if(d===U.length||p===K.length)for(d=U.length-1,p=K.length-1;1<=d&&0<=p&&U[d]!==K[p];)p--;for(;1<=d&&0<=p;d--,p--)if(U[d]!==K[p]){if(d!==1||p!==1)do if(d--,p--,0>p||U[d]!==K[p]){var Z=`
`+U[d].replace(" at new "," at ");return s.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",s.displayName)),Z}while(1<=d&&0<=p);break}}}finally{bu=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?xs(c):""}function qT(s,r){switch(s.tag){case 26:case 27:case 5:return xs(s.type);case 16:return xs("Lazy");case 13:return s.child!==r&&r!==null?xs("Suspense Fallback"):xs("Suspense");case 19:return xs("SuspenseList");case 0:case 15:return Su(s.type,!1);case 11:return Su(s.type.render,!1);case 1:return Su(s.type,!0);case 31:return xs("Activity");default:return""}}function tp(s){try{var r="",c=null;do r+=qT(s,c),c=s,s=s.return;while(s);return r}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var ku=Object.prototype.hasOwnProperty,Cu=n.unstable_scheduleCallback,Tu=n.unstable_cancelCallback,HT=n.unstable_shouldYield,$T=n.unstable_requestPaint,dn=n.unstable_now,KT=n.unstable_getCurrentPriorityLevel,np=n.unstable_ImmediatePriority,ip=n.unstable_UserBlockingPriority,Ho=n.unstable_NormalPriority,GT=n.unstable_LowPriority,sp=n.unstable_IdlePriority,YT=n.log,JT=n.unstable_setDisableYieldValue,dr=null,hn=null;function Ii(s){if(typeof YT=="function"&&JT(s),hn&&typeof hn.setStrictMode=="function")try{hn.setStrictMode(dr,s)}catch{}}var fn=Math.clz32?Math.clz32:WT,QT=Math.log,XT=Math.LN2;function WT(s){return s>>>=0,s===0?32:31-(QT(s)/XT|0)|0}var $o=256,Ko=262144,Go=4194304;function Rs(s){var r=s&42;if(r!==0)return r;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Yo(s,r,c){var d=s.pendingLanes;if(d===0)return 0;var p=0,y=s.suspendedLanes,k=s.pingedLanes;s=s.warmLanes;var N=d&134217727;return N!==0?(d=N&~y,d!==0?p=Rs(d):(k&=N,k!==0?p=Rs(k):c||(c=N&~s,c!==0&&(p=Rs(c))))):(N=d&~y,N!==0?p=Rs(N):k!==0?p=Rs(k):c||(c=d&~s,c!==0&&(p=Rs(c)))),p===0?0:r!==0&&r!==p&&(r&y)===0&&(y=p&-p,c=r&-r,y>=c||y===32&&(c&4194048)!==0)?r:p}function hr(s,r){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&r)===0}function ZT(s,r){switch(s){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ap(){var s=Go;return Go<<=1,(Go&62914560)===0&&(Go=4194304),s}function Eu(s){for(var r=[],c=0;31>c;c++)r.push(s);return r}function fr(s,r){s.pendingLanes|=r,r!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function e1(s,r,c,d,p,y){var k=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var N=s.entanglements,U=s.expirationTimes,K=s.hiddenUpdates;for(c=k&~c;0<c;){var Z=31-fn(c),ne=1<<Z;N[Z]=0,U[Z]=-1;var G=K[Z];if(G!==null)for(K[Z]=null,Z=0;Z<G.length;Z++){var Q=G[Z];Q!==null&&(Q.lane&=-536870913)}c&=~ne}d!==0&&rp(s,d,0),y!==0&&p===0&&s.tag!==0&&(s.suspendedLanes|=y&~(k&~r))}function rp(s,r,c){s.pendingLanes|=r,s.suspendedLanes&=~r;var d=31-fn(r);s.entangledLanes|=r,s.entanglements[d]=s.entanglements[d]|1073741824|c&261930}function op(s,r){var c=s.entangledLanes|=r;for(s=s.entanglements;c;){var d=31-fn(c),p=1<<d;p&r|s[d]&r&&(s[d]|=r),c&=~p}}function cp(s,r){var c=r&-r;return c=(c&42)!==0?1:xu(c),(c&(s.suspendedLanes|r))!==0?0:c}function xu(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Ru(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function lp(){var s=ae.p;return s!==0?s:(s=window.event,s===void 0?32:Yy(s.type))}function up(s,r){var c=ae.p;try{return ae.p=s,r()}finally{ae.p=c}}var Ui=Math.random().toString(36).slice(2),Lt="__reactFiber$"+Ui,Zt="__reactProps$"+Ui,ea="__reactContainer$"+Ui,_u="__reactEvents$"+Ui,t1="__reactListeners$"+Ui,n1="__reactHandles$"+Ui,dp="__reactResources$"+Ui,mr="__reactMarker$"+Ui;function wu(s){delete s[Lt],delete s[Zt],delete s[_u],delete s[t1],delete s[n1]}function ta(s){var r=s[Lt];if(r)return r;for(var c=s.parentNode;c;){if(r=c[ea]||c[Lt]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(s=Oy(s);s!==null;){if(c=s[Lt])return c;s=Oy(s)}return r}s=c,c=s.parentNode}return null}function na(s){if(s=s[Lt]||s[ea]){var r=s.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return s}return null}function pr(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s.stateNode;throw Error(i(33))}function ia(s){var r=s[dp];return r||(r=s[dp]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Mt(s){s[mr]=!0}var hp=new Set,fp={};function _s(s,r){sa(s,r),sa(s+"Capture",r)}function sa(s,r){for(fp[s]=r,s=0;s<r.length;s++)hp.add(r[s])}var i1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),mp={},pp={};function s1(s){return ku.call(pp,s)?!0:ku.call(mp,s)?!1:i1.test(s)?pp[s]=!0:(mp[s]=!0,!1)}function Jo(s,r,c){if(s1(r))if(c===null)s.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(r);return;case"boolean":var d=r.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){s.removeAttribute(r);return}}s.setAttribute(r,""+c)}}function Qo(s,r,c){if(c===null)s.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(r);return}s.setAttribute(r,""+c)}}function ci(s,r,c,d){if(d===null)s.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(r,c,""+d)}}function En(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function gp(s){var r=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function a1(s,r,c){var d=Object.getOwnPropertyDescriptor(s.constructor.prototype,r);if(!s.hasOwnProperty(r)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var p=d.get,y=d.set;return Object.defineProperty(s,r,{configurable:!0,get:function(){return p.call(this)},set:function(k){c=""+k,y.call(this,k)}}),Object.defineProperty(s,r,{enumerable:d.enumerable}),{getValue:function(){return c},setValue:function(k){c=""+k},stopTracking:function(){s._valueTracker=null,delete s[r]}}}}function Mu(s){if(!s._valueTracker){var r=gp(s)?"checked":"value";s._valueTracker=a1(s,r,""+s[r])}}function vp(s){if(!s)return!1;var r=s._valueTracker;if(!r)return!0;var c=r.getValue(),d="";return s&&(d=gp(s)?s.checked?"true":"false":s.value),s=d,s!==c?(r.setValue(s),!0):!1}function Xo(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var r1=/[\n"\\]/g;function xn(s){return s.replace(r1,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Nu(s,r,c,d,p,y,k,N){s.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?s.type=k:s.removeAttribute("type"),r!=null?k==="number"?(r===0&&s.value===""||s.value!=r)&&(s.value=""+En(r)):s.value!==""+En(r)&&(s.value=""+En(r)):k!=="submit"&&k!=="reset"||s.removeAttribute("value"),r!=null?Du(s,k,En(r)):c!=null?Du(s,k,En(c)):d!=null&&s.removeAttribute("value"),p==null&&y!=null&&(s.defaultChecked=!!y),p!=null&&(s.checked=p&&typeof p!="function"&&typeof p!="symbol"),N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?s.name=""+En(N):s.removeAttribute("name")}function yp(s,r,c,d,p,y,k,N){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(s.type=y),r!=null||c!=null){if(!(y!=="submit"&&y!=="reset"||r!=null)){Mu(s);return}c=c!=null?""+En(c):"",r=r!=null?""+En(r):c,N||r===s.value||(s.value=r),s.defaultValue=r}d=d??p,d=typeof d!="function"&&typeof d!="symbol"&&!!d,s.checked=N?s.checked:!!d,s.defaultChecked=!!d,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(s.name=k),Mu(s)}function Du(s,r,c){r==="number"&&Xo(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function aa(s,r,c,d){if(s=s.options,r){r={};for(var p=0;p<c.length;p++)r["$"+c[p]]=!0;for(c=0;c<s.length;c++)p=r.hasOwnProperty("$"+s[c].value),s[c].selected!==p&&(s[c].selected=p),p&&d&&(s[c].defaultSelected=!0)}else{for(c=""+En(c),r=null,p=0;p<s.length;p++){if(s[p].value===c){s[p].selected=!0,d&&(s[p].defaultSelected=!0);return}r!==null||s[p].disabled||(r=s[p])}r!==null&&(r.selected=!0)}}function bp(s,r,c){if(r!=null&&(r=""+En(r),r!==s.value&&(s.value=r),c==null)){s.defaultValue!==r&&(s.defaultValue=r);return}s.defaultValue=c!=null?""+En(c):""}function Sp(s,r,c,d){if(r==null){if(d!=null){if(c!=null)throw Error(i(92));if(Te(d)){if(1<d.length)throw Error(i(93));d=d[0]}c=d}c==null&&(c=""),r=c}c=En(r),s.defaultValue=c,d=s.textContent,d===c&&d!==""&&d!==null&&(s.value=d),Mu(s)}function ra(s,r){if(r){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=r;return}}s.textContent=r}var o1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kp(s,r,c){var d=r.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?s.setProperty(r,""):r==="float"?s.cssFloat="":s[r]="":d?s.setProperty(r,c):typeof c!="number"||c===0||o1.has(r)?r==="float"?s.cssFloat=c:s[r]=(""+c).trim():s[r]=c+"px"}function Cp(s,r,c){if(r!=null&&typeof r!="object")throw Error(i(62));if(s=s.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||r!=null&&r.hasOwnProperty(d)||(d.indexOf("--")===0?s.setProperty(d,""):d==="float"?s.cssFloat="":s[d]="");for(var p in r)d=r[p],r.hasOwnProperty(p)&&c[p]!==d&&kp(s,p,d)}else for(var y in r)r.hasOwnProperty(y)&&kp(s,y,r[y])}function Ou(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var c1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),l1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wo(s){return l1.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function li(){}var Au=null;function ju(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var oa=null,ca=null;function Tp(s){var r=na(s);if(r&&(s=r.stateNode)){var c=s[Zt]||null;e:switch(s=r.stateNode,r.type){case"input":if(Nu(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),r=c.name,c.type==="radio"&&r!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+xn(""+r)+'"][type="radio"]'),r=0;r<c.length;r++){var d=c[r];if(d!==s&&d.form===s.form){var p=d[Zt]||null;if(!p)throw Error(i(90));Nu(d,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(r=0;r<c.length;r++)d=c[r],d.form===s.form&&vp(d)}break e;case"textarea":bp(s,c.value,c.defaultValue);break e;case"select":r=c.value,r!=null&&aa(s,!!c.multiple,r,!1)}}}var Pu=!1;function Ep(s,r,c){if(Pu)return s(r,c);Pu=!0;try{var d=s(r);return d}finally{if(Pu=!1,(oa!==null||ca!==null)&&(Bc(),oa&&(r=oa,s=ca,ca=oa=null,Tp(r),s)))for(r=0;r<s.length;r++)Tp(s[r])}}function gr(s,r){var c=s.stateNode;if(c===null)return null;var d=c[Zt]||null;if(d===null)return null;c=d[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(s=s.type,d=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!d;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(i(231,r,typeof c));return c}var ui=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lu=!1;if(ui)try{var vr={};Object.defineProperty(vr,"passive",{get:function(){Lu=!0}}),window.addEventListener("test",vr,vr),window.removeEventListener("test",vr,vr)}catch{Lu=!1}var Bi=null,Iu=null,Zo=null;function xp(){if(Zo)return Zo;var s,r=Iu,c=r.length,d,p="value"in Bi?Bi.value:Bi.textContent,y=p.length;for(s=0;s<c&&r[s]===p[s];s++);var k=c-s;for(d=1;d<=k&&r[c-d]===p[y-d];d++);return Zo=p.slice(s,1<d?1-d:void 0)}function ec(s){var r=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&r===13&&(s=13)):s=r,s===10&&(s=13),32<=s||s===13?s:0}function tc(){return!0}function Rp(){return!1}function en(s){function r(c,d,p,y,k){this._reactName=c,this._targetInst=p,this.type=d,this.nativeEvent=y,this.target=k,this.currentTarget=null;for(var N in s)s.hasOwnProperty(N)&&(c=s[N],this[N]=c?c(y):y[N]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?tc:Rp,this.isPropagationStopped=Rp,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=tc)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=tc)},persist:function(){},isPersistent:tc}),r}var ws={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nc=en(ws),yr=v({},ws,{view:0,detail:0}),u1=en(yr),Uu,Bu,br,ic=v({},yr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==br&&(br&&s.type==="mousemove"?(Uu=s.screenX-br.screenX,Bu=s.screenY-br.screenY):Bu=Uu=0,br=s),Uu)},movementY:function(s){return"movementY"in s?s.movementY:Bu}}),_p=en(ic),d1=v({},ic,{dataTransfer:0}),h1=en(d1),f1=v({},yr,{relatedTarget:0}),zu=en(f1),m1=v({},ws,{animationName:0,elapsedTime:0,pseudoElement:0}),p1=en(m1),g1=v({},ws,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),v1=en(g1),y1=v({},ws,{data:0}),wp=en(y1),b1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},S1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},k1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function C1(s){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(s):(s=k1[s])?!!r[s]:!1}function Fu(){return C1}var T1=v({},yr,{key:function(s){if(s.key){var r=b1[s.key]||s.key;if(r!=="Unidentified")return r}return s.type==="keypress"?(s=ec(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?S1[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fu,charCode:function(s){return s.type==="keypress"?ec(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?ec(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),E1=en(T1),x1=v({},ic,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mp=en(x1),R1=v({},yr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fu}),_1=en(R1),w1=v({},ws,{propertyName:0,elapsedTime:0,pseudoElement:0}),M1=en(w1),N1=v({},ic,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),D1=en(N1),O1=v({},ws,{newState:0,oldState:0}),A1=en(O1),j1=[9,13,27,32],Vu=ui&&"CompositionEvent"in window,Sr=null;ui&&"documentMode"in document&&(Sr=document.documentMode);var P1=ui&&"TextEvent"in window&&!Sr,Np=ui&&(!Vu||Sr&&8<Sr&&11>=Sr),Dp=" ",Op=!1;function Ap(s,r){switch(s){case"keyup":return j1.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jp(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var la=!1;function L1(s,r){switch(s){case"compositionend":return jp(r);case"keypress":return r.which!==32?null:(Op=!0,Dp);case"textInput":return s=r.data,s===Dp&&Op?null:s;default:return null}}function I1(s,r){if(la)return s==="compositionend"||!Vu&&Ap(s,r)?(s=xp(),Zo=Iu=Bi=null,la=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Np&&r.locale!=="ko"?null:r.data;default:return null}}var U1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pp(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r==="input"?!!U1[s.type]:r==="textarea"}function Lp(s,r,c,d){oa?ca?ca.push(d):ca=[d]:oa=d,r=Kc(r,"onChange"),0<r.length&&(c=new nc("onChange","change",null,c,d),s.push({event:c,listeners:r}))}var kr=null,Cr=null;function B1(s){yy(s,0)}function sc(s){var r=pr(s);if(vp(r))return s}function Ip(s,r){if(s==="change")return r}var Up=!1;if(ui){var qu;if(ui){var Hu="oninput"in document;if(!Hu){var Bp=document.createElement("div");Bp.setAttribute("oninput","return;"),Hu=typeof Bp.oninput=="function"}qu=Hu}else qu=!1;Up=qu&&(!document.documentMode||9<document.documentMode)}function zp(){kr&&(kr.detachEvent("onpropertychange",Fp),Cr=kr=null)}function Fp(s){if(s.propertyName==="value"&&sc(Cr)){var r=[];Lp(r,Cr,s,ju(s)),Ep(B1,r)}}function z1(s,r,c){s==="focusin"?(zp(),kr=r,Cr=c,kr.attachEvent("onpropertychange",Fp)):s==="focusout"&&zp()}function F1(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return sc(Cr)}function V1(s,r){if(s==="click")return sc(r)}function q1(s,r){if(s==="input"||s==="change")return sc(r)}function H1(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var mn=typeof Object.is=="function"?Object.is:H1;function Tr(s,r){if(mn(s,r))return!0;if(typeof s!="object"||s===null||typeof r!="object"||r===null)return!1;var c=Object.keys(s),d=Object.keys(r);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var p=c[d];if(!ku.call(r,p)||!mn(s[p],r[p]))return!1}return!0}function Vp(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function qp(s,r){var c=Vp(s);s=0;for(var d;c;){if(c.nodeType===3){if(d=s+c.textContent.length,s<=r&&d>=r)return{node:c,offset:r-s};s=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Vp(c)}}function Hp(s,r){return s&&r?s===r?!0:s&&s.nodeType===3?!1:r&&r.nodeType===3?Hp(s,r.parentNode):"contains"in s?s.contains(r):s.compareDocumentPosition?!!(s.compareDocumentPosition(r)&16):!1:!1}function $p(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var r=Xo(s.document);r instanceof s.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)s=r.contentWindow;else break;r=Xo(s.document)}return r}function $u(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r&&(r==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||r==="textarea"||s.contentEditable==="true")}var $1=ui&&"documentMode"in document&&11>=document.documentMode,ua=null,Ku=null,Er=null,Gu=!1;function Kp(s,r,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Gu||ua==null||ua!==Xo(d)||(d=ua,"selectionStart"in d&&$u(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Er&&Tr(Er,d)||(Er=d,d=Kc(Ku,"onSelect"),0<d.length&&(r=new nc("onSelect","select",null,r,c),s.push({event:r,listeners:d}),r.target=ua)))}function Ms(s,r){var c={};return c[s.toLowerCase()]=r.toLowerCase(),c["Webkit"+s]="webkit"+r,c["Moz"+s]="moz"+r,c}var da={animationend:Ms("Animation","AnimationEnd"),animationiteration:Ms("Animation","AnimationIteration"),animationstart:Ms("Animation","AnimationStart"),transitionrun:Ms("Transition","TransitionRun"),transitionstart:Ms("Transition","TransitionStart"),transitioncancel:Ms("Transition","TransitionCancel"),transitionend:Ms("Transition","TransitionEnd")},Yu={},Gp={};ui&&(Gp=document.createElement("div").style,"AnimationEvent"in window||(delete da.animationend.animation,delete da.animationiteration.animation,delete da.animationstart.animation),"TransitionEvent"in window||delete da.transitionend.transition);function Ns(s){if(Yu[s])return Yu[s];if(!da[s])return s;var r=da[s],c;for(c in r)if(r.hasOwnProperty(c)&&c in Gp)return Yu[s]=r[c];return s}var Yp=Ns("animationend"),Jp=Ns("animationiteration"),Qp=Ns("animationstart"),K1=Ns("transitionrun"),G1=Ns("transitionstart"),Y1=Ns("transitioncancel"),Xp=Ns("transitionend"),Wp=new Map,Ju="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ju.push("scrollEnd");function Un(s,r){Wp.set(s,r),_s(r,[s])}var ac=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Rn=[],ha=0,Qu=0;function rc(){for(var s=ha,r=Qu=ha=0;r<s;){var c=Rn[r];Rn[r++]=null;var d=Rn[r];Rn[r++]=null;var p=Rn[r];Rn[r++]=null;var y=Rn[r];if(Rn[r++]=null,d!==null&&p!==null){var k=d.pending;k===null?p.next=p:(p.next=k.next,k.next=p),d.pending=p}y!==0&&Zp(c,p,y)}}function oc(s,r,c,d){Rn[ha++]=s,Rn[ha++]=r,Rn[ha++]=c,Rn[ha++]=d,Qu|=d,s.lanes|=d,s=s.alternate,s!==null&&(s.lanes|=d)}function Xu(s,r,c,d){return oc(s,r,c,d),cc(s)}function Ds(s,r){return oc(s,null,null,r),cc(s)}function Zp(s,r,c){s.lanes|=c;var d=s.alternate;d!==null&&(d.lanes|=c);for(var p=!1,y=s.return;y!==null;)y.childLanes|=c,d=y.alternate,d!==null&&(d.childLanes|=c),y.tag===22&&(s=y.stateNode,s===null||s._visibility&1||(p=!0)),s=y,y=y.return;return s.tag===3?(y=s.stateNode,p&&r!==null&&(p=31-fn(c),s=y.hiddenUpdates,d=s[p],d===null?s[p]=[r]:d.push(r),r.lane=c|536870912),y):null}function cc(s){if(50<Kr)throw Kr=0,rh=null,Error(i(185));for(var r=s.return;r!==null;)s=r,r=s.return;return s.tag===3?s.stateNode:null}var fa={};function J1(s,r,c,d){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pn(s,r,c,d){return new J1(s,r,c,d)}function Wu(s){return s=s.prototype,!(!s||!s.isReactComponent)}function di(s,r){var c=s.alternate;return c===null?(c=pn(s.tag,r,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=r,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,r=s.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function eg(s,r){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,r=c.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),s}function lc(s,r,c,d,p,y){var k=0;if(d=s,typeof s=="function")Wu(s)&&(k=1);else if(typeof s=="string")k=ex(s,c,he.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case L:return s=pn(31,c,r,p),s.elementType=L,s.lanes=y,s;case S:return Os(c.children,p,y,r);case R:k=8,p|=24;break;case _:return s=pn(12,c,r,p|2),s.elementType=_,s.lanes=y,s;case w:return s=pn(13,c,r,p),s.elementType=w,s.lanes=y,s;case M:return s=pn(19,c,r,p),s.elementType=M,s.lanes=y,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case j:k=10;break e;case D:k=9;break e;case x:k=11;break e;case I:k=14;break e;case F:k=16,d=null;break e}k=29,c=Error(i(130,s===null?"null":typeof s,"")),d=null}return r=pn(k,c,r,p),r.elementType=s,r.type=d,r.lanes=y,r}function Os(s,r,c,d){return s=pn(7,s,d,r),s.lanes=c,s}function Zu(s,r,c){return s=pn(6,s,null,r),s.lanes=c,s}function tg(s){var r=pn(18,null,null,0);return r.stateNode=s,r}function ed(s,r,c){return r=pn(4,s.children!==null?s.children:[],s.key,r),r.lanes=c,r.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},r}var ng=new WeakMap;function _n(s,r){if(typeof s=="object"&&s!==null){var c=ng.get(s);return c!==void 0?c:(r={value:s,source:r,stack:tp(r)},ng.set(s,r),r)}return{value:s,source:r,stack:tp(r)}}var ma=[],pa=0,uc=null,xr=0,wn=[],Mn=0,zi=null,Jn=1,Qn="";function hi(s,r){ma[pa++]=xr,ma[pa++]=uc,uc=s,xr=r}function ig(s,r,c){wn[Mn++]=Jn,wn[Mn++]=Qn,wn[Mn++]=zi,zi=s;var d=Jn;s=Qn;var p=32-fn(d)-1;d&=~(1<<p),c+=1;var y=32-fn(r)+p;if(30<y){var k=p-p%5;y=(d&(1<<k)-1).toString(32),d>>=k,p-=k,Jn=1<<32-fn(r)+p|c<<p|d,Qn=y+s}else Jn=1<<y|c<<p|d,Qn=s}function td(s){s.return!==null&&(hi(s,1),ig(s,1,0))}function nd(s){for(;s===uc;)uc=ma[--pa],ma[pa]=null,xr=ma[--pa],ma[pa]=null;for(;s===zi;)zi=wn[--Mn],wn[Mn]=null,Qn=wn[--Mn],wn[Mn]=null,Jn=wn[--Mn],wn[Mn]=null}function sg(s,r){wn[Mn++]=Jn,wn[Mn++]=Qn,wn[Mn++]=zi,Jn=r.id,Qn=r.overflow,zi=s}var It=null,at=null,ze=!1,Fi=null,Nn=!1,id=Error(i(519));function Vi(s){var r=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Rr(_n(r,s)),id}function ag(s){var r=s.stateNode,c=s.type,d=s.memoizedProps;switch(r[Lt]=s,r[Zt]=d,c){case"dialog":je("cancel",r),je("close",r);break;case"iframe":case"object":case"embed":je("load",r);break;case"video":case"audio":for(c=0;c<Yr.length;c++)je(Yr[c],r);break;case"source":je("error",r);break;case"img":case"image":case"link":je("error",r),je("load",r);break;case"details":je("toggle",r);break;case"input":je("invalid",r),yp(r,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":je("invalid",r);break;case"textarea":je("invalid",r),Sp(r,d.value,d.defaultValue,d.children)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||r.textContent===""+c||d.suppressHydrationWarning===!0||Cy(r.textContent,c)?(d.popover!=null&&(je("beforetoggle",r),je("toggle",r)),d.onScroll!=null&&je("scroll",r),d.onScrollEnd!=null&&je("scrollend",r),d.onClick!=null&&(r.onclick=li),r=!0):r=!1,r||Vi(s,!0)}function rg(s){for(It=s.return;It;)switch(It.tag){case 5:case 31:case 13:Nn=!1;return;case 27:case 3:Nn=!0;return;default:It=It.return}}function ga(s){if(s!==It)return!1;if(!ze)return rg(s),ze=!0,!1;var r=s.tag,c;if((c=r!==3&&r!==27)&&((c=r===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||kh(s.type,s.memoizedProps)),c=!c),c&&at&&Vi(s),rg(s),r===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));at=Dy(s)}else if(r===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));at=Dy(s)}else r===27?(r=at,ns(s.type)?(s=Rh,Rh=null,at=s):at=r):at=It?On(s.stateNode.nextSibling):null;return!0}function As(){at=It=null,ze=!1}function sd(){var s=Fi;return s!==null&&(an===null?an=s:an.push.apply(an,s),Fi=null),s}function Rr(s){Fi===null?Fi=[s]:Fi.push(s)}var ad=B(null),js=null,fi=null;function qi(s,r,c){oe(ad,r._currentValue),r._currentValue=c}function mi(s){s._currentValue=ad.current,W(ad)}function rd(s,r,c){for(;s!==null;){var d=s.alternate;if((s.childLanes&r)!==r?(s.childLanes|=r,d!==null&&(d.childLanes|=r)):d!==null&&(d.childLanes&r)!==r&&(d.childLanes|=r),s===c)break;s=s.return}}function od(s,r,c,d){var p=s.child;for(p!==null&&(p.return=s);p!==null;){var y=p.dependencies;if(y!==null){var k=p.child;y=y.firstContext;e:for(;y!==null;){var N=y;y=p;for(var U=0;U<r.length;U++)if(N.context===r[U]){y.lanes|=c,N=y.alternate,N!==null&&(N.lanes|=c),rd(y.return,c,s),d||(k=null);break e}y=N.next}}else if(p.tag===18){if(k=p.return,k===null)throw Error(i(341));k.lanes|=c,y=k.alternate,y!==null&&(y.lanes|=c),rd(k,c,s),k=null}else k=p.child;if(k!==null)k.return=p;else for(k=p;k!==null;){if(k===s){k=null;break}if(p=k.sibling,p!==null){p.return=k.return,k=p;break}k=k.return}p=k}}function va(s,r,c,d){s=null;for(var p=r,y=!1;p!==null;){if(!y){if((p.flags&524288)!==0)y=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var k=p.alternate;if(k===null)throw Error(i(387));if(k=k.memoizedProps,k!==null){var N=p.type;mn(p.pendingProps.value,k.value)||(s!==null?s.push(N):s=[N])}}else if(p===fe.current){if(k=p.alternate,k===null)throw Error(i(387));k.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(s!==null?s.push(Zr):s=[Zr])}p=p.return}s!==null&&od(r,s,c,d),r.flags|=262144}function dc(s){for(s=s.firstContext;s!==null;){if(!mn(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Ps(s){js=s,fi=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Ut(s){return og(js,s)}function hc(s,r){return js===null&&Ps(s),og(s,r)}function og(s,r){var c=r._currentValue;if(r={context:r,memoizedValue:c,next:null},fi===null){if(s===null)throw Error(i(308));fi=r,s.dependencies={lanes:0,firstContext:r},s.flags|=524288}else fi=fi.next=r;return c}var Q1=typeof AbortController<"u"?AbortController:function(){var s=[],r=this.signal={aborted:!1,addEventListener:function(c,d){s.push(d)}};this.abort=function(){r.aborted=!0,s.forEach(function(c){return c()})}},X1=n.unstable_scheduleCallback,W1=n.unstable_NormalPriority,Ct={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function cd(){return{controller:new Q1,data:new Map,refCount:0}}function _r(s){s.refCount--,s.refCount===0&&X1(W1,function(){s.controller.abort()})}var wr=null,ld=0,ya=0,ba=null;function Z1(s,r){if(wr===null){var c=wr=[];ld=0,ya=hh(),ba={status:"pending",value:void 0,then:function(d){c.push(d)}}}return ld++,r.then(cg,cg),r}function cg(){if(--ld===0&&wr!==null){ba!==null&&(ba.status="fulfilled");var s=wr;wr=null,ya=0,ba=null;for(var r=0;r<s.length;r++)(0,s[r])()}}function eE(s,r){var c=[],d={status:"pending",value:null,reason:null,then:function(p){c.push(p)}};return s.then(function(){d.status="fulfilled",d.value=r;for(var p=0;p<c.length;p++)(0,c[p])(r)},function(p){for(d.status="rejected",d.reason=p,p=0;p<c.length;p++)(0,c[p])(void 0)}),d}var lg=H.S;H.S=function(s,r){Kv=dn(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&Z1(s,r),lg!==null&&lg(s,r)};var Ls=B(null);function ud(){var s=Ls.current;return s!==null?s:tt.pooledCache}function fc(s,r){r===null?oe(Ls,Ls.current):oe(Ls,r.pool)}function ug(){var s=ud();return s===null?null:{parent:Ct._currentValue,pool:s}}var Sa=Error(i(460)),dd=Error(i(474)),mc=Error(i(542)),pc={then:function(){}};function dg(s){return s=s.status,s==="fulfilled"||s==="rejected"}function hg(s,r,c){switch(c=s[c],c===void 0?s.push(r):c!==r&&(r.then(li,li),r=c),r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,mg(s),s;default:if(typeof r.status=="string")r.then(li,li);else{if(s=tt,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=r,s.status="pending",s.then(function(d){if(r.status==="pending"){var p=r;p.status="fulfilled",p.value=d}},function(d){if(r.status==="pending"){var p=r;p.status="rejected",p.reason=d}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,mg(s),s}throw Us=r,Sa}}function Is(s){try{var r=s._init;return r(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Us=c,Sa):c}}var Us=null;function fg(){if(Us===null)throw Error(i(459));var s=Us;return Us=null,s}function mg(s){if(s===Sa||s===mc)throw Error(i(483))}var ka=null,Mr=0;function gc(s){var r=Mr;return Mr+=1,ka===null&&(ka=[]),hg(ka,s,r)}function Nr(s,r){r=r.props.ref,s.ref=r!==void 0?r:null}function vc(s,r){throw r.$$typeof===b?Error(i(525)):(s=Object.prototype.toString.call(r),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)))}function pg(s){function r(V,z){if(s){var $=V.deletions;$===null?(V.deletions=[z],V.flags|=16):$.push(z)}}function c(V,z){if(!s)return null;for(;z!==null;)r(V,z),z=z.sibling;return null}function d(V){for(var z=new Map;V!==null;)V.key!==null?z.set(V.key,V):z.set(V.index,V),V=V.sibling;return z}function p(V,z){return V=di(V,z),V.index=0,V.sibling=null,V}function y(V,z,$){return V.index=$,s?($=V.alternate,$!==null?($=$.index,$<z?(V.flags|=67108866,z):$):(V.flags|=67108866,z)):(V.flags|=1048576,z)}function k(V){return s&&V.alternate===null&&(V.flags|=67108866),V}function N(V,z,$,te){return z===null||z.tag!==6?(z=Zu($,V.mode,te),z.return=V,z):(z=p(z,$),z.return=V,z)}function U(V,z,$,te){var ve=$.type;return ve===S?Z(V,z,$.props.children,te,$.key):z!==null&&(z.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===F&&Is(ve)===z.type)?(z=p(z,$.props),Nr(z,$),z.return=V,z):(z=lc($.type,$.key,$.props,null,V.mode,te),Nr(z,$),z.return=V,z)}function K(V,z,$,te){return z===null||z.tag!==4||z.stateNode.containerInfo!==$.containerInfo||z.stateNode.implementation!==$.implementation?(z=ed($,V.mode,te),z.return=V,z):(z=p(z,$.children||[]),z.return=V,z)}function Z(V,z,$,te,ve){return z===null||z.tag!==7?(z=Os($,V.mode,te,ve),z.return=V,z):(z=p(z,$),z.return=V,z)}function ne(V,z,$){if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return z=Zu(""+z,V.mode,$),z.return=V,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case C:return $=lc(z.type,z.key,z.props,null,V.mode,$),Nr($,z),$.return=V,$;case T:return z=ed(z,V.mode,$),z.return=V,z;case F:return z=Is(z),ne(V,z,$)}if(Te(z)||Y(z))return z=Os(z,V.mode,$,null),z.return=V,z;if(typeof z.then=="function")return ne(V,gc(z),$);if(z.$$typeof===j)return ne(V,hc(V,z),$);vc(V,z)}return null}function G(V,z,$,te){var ve=z!==null?z.key:null;if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return ve!==null?null:N(V,z,""+$,te);if(typeof $=="object"&&$!==null){switch($.$$typeof){case C:return $.key===ve?U(V,z,$,te):null;case T:return $.key===ve?K(V,z,$,te):null;case F:return $=Is($),G(V,z,$,te)}if(Te($)||Y($))return ve!==null?null:Z(V,z,$,te,null);if(typeof $.then=="function")return G(V,z,gc($),te);if($.$$typeof===j)return G(V,z,hc(V,$),te);vc(V,$)}return null}function Q(V,z,$,te,ve){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return V=V.get($)||null,N(z,V,""+te,ve);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case C:return V=V.get(te.key===null?$:te.key)||null,U(z,V,te,ve);case T:return V=V.get(te.key===null?$:te.key)||null,K(z,V,te,ve);case F:return te=Is(te),Q(V,z,$,te,ve)}if(Te(te)||Y(te))return V=V.get($)||null,Z(z,V,te,ve,null);if(typeof te.then=="function")return Q(V,z,$,gc(te),ve);if(te.$$typeof===j)return Q(V,z,$,hc(z,te),ve);vc(z,te)}return null}function me(V,z,$,te){for(var ve=null,Ve=null,pe=z,we=z=0,Ue=null;pe!==null&&we<$.length;we++){pe.index>we?(Ue=pe,pe=null):Ue=pe.sibling;var qe=G(V,pe,$[we],te);if(qe===null){pe===null&&(pe=Ue);break}s&&pe&&qe.alternate===null&&r(V,pe),z=y(qe,z,we),Ve===null?ve=qe:Ve.sibling=qe,Ve=qe,pe=Ue}if(we===$.length)return c(V,pe),ze&&hi(V,we),ve;if(pe===null){for(;we<$.length;we++)pe=ne(V,$[we],te),pe!==null&&(z=y(pe,z,we),Ve===null?ve=pe:Ve.sibling=pe,Ve=pe);return ze&&hi(V,we),ve}for(pe=d(pe);we<$.length;we++)Ue=Q(pe,V,we,$[we],te),Ue!==null&&(s&&Ue.alternate!==null&&pe.delete(Ue.key===null?we:Ue.key),z=y(Ue,z,we),Ve===null?ve=Ue:Ve.sibling=Ue,Ve=Ue);return s&&pe.forEach(function(os){return r(V,os)}),ze&&hi(V,we),ve}function Se(V,z,$,te){if($==null)throw Error(i(151));for(var ve=null,Ve=null,pe=z,we=z=0,Ue=null,qe=$.next();pe!==null&&!qe.done;we++,qe=$.next()){pe.index>we?(Ue=pe,pe=null):Ue=pe.sibling;var os=G(V,pe,qe.value,te);if(os===null){pe===null&&(pe=Ue);break}s&&pe&&os.alternate===null&&r(V,pe),z=y(os,z,we),Ve===null?ve=os:Ve.sibling=os,Ve=os,pe=Ue}if(qe.done)return c(V,pe),ze&&hi(V,we),ve;if(pe===null){for(;!qe.done;we++,qe=$.next())qe=ne(V,qe.value,te),qe!==null&&(z=y(qe,z,we),Ve===null?ve=qe:Ve.sibling=qe,Ve=qe);return ze&&hi(V,we),ve}for(pe=d(pe);!qe.done;we++,qe=$.next())qe=Q(pe,V,we,qe.value,te),qe!==null&&(s&&qe.alternate!==null&&pe.delete(qe.key===null?we:qe.key),z=y(qe,z,we),Ve===null?ve=qe:Ve.sibling=qe,Ve=qe);return s&&pe.forEach(function(dx){return r(V,dx)}),ze&&hi(V,we),ve}function We(V,z,$,te){if(typeof $=="object"&&$!==null&&$.type===S&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case C:e:{for(var ve=$.key;z!==null;){if(z.key===ve){if(ve=$.type,ve===S){if(z.tag===7){c(V,z.sibling),te=p(z,$.props.children),te.return=V,V=te;break e}}else if(z.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===F&&Is(ve)===z.type){c(V,z.sibling),te=p(z,$.props),Nr(te,$),te.return=V,V=te;break e}c(V,z);break}else r(V,z);z=z.sibling}$.type===S?(te=Os($.props.children,V.mode,te,$.key),te.return=V,V=te):(te=lc($.type,$.key,$.props,null,V.mode,te),Nr(te,$),te.return=V,V=te)}return k(V);case T:e:{for(ve=$.key;z!==null;){if(z.key===ve)if(z.tag===4&&z.stateNode.containerInfo===$.containerInfo&&z.stateNode.implementation===$.implementation){c(V,z.sibling),te=p(z,$.children||[]),te.return=V,V=te;break e}else{c(V,z);break}else r(V,z);z=z.sibling}te=ed($,V.mode,te),te.return=V,V=te}return k(V);case F:return $=Is($),We(V,z,$,te)}if(Te($))return me(V,z,$,te);if(Y($)){if(ve=Y($),typeof ve!="function")throw Error(i(150));return $=ve.call($),Se(V,z,$,te)}if(typeof $.then=="function")return We(V,z,gc($),te);if($.$$typeof===j)return We(V,z,hc(V,$),te);vc(V,$)}return typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint"?($=""+$,z!==null&&z.tag===6?(c(V,z.sibling),te=p(z,$),te.return=V,V=te):(c(V,z),te=Zu($,V.mode,te),te.return=V,V=te),k(V)):c(V,z)}return function(V,z,$,te){try{Mr=0;var ve=We(V,z,$,te);return ka=null,ve}catch(pe){if(pe===Sa||pe===mc)throw pe;var Ve=pn(29,pe,null,V.mode);return Ve.lanes=te,Ve.return=V,Ve}}}var Bs=pg(!0),gg=pg(!1),Hi=!1;function hd(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fd(s,r){s=s.updateQueue,r.updateQueue===s&&(r.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function $i(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ki(s,r,c){var d=s.updateQueue;if(d===null)return null;if(d=d.shared,(He&2)!==0){var p=d.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),d.pending=r,r=cc(s),Zp(s,null,c),r}return oc(s,d,r,c),cc(s)}function Dr(s,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194048)!==0)){var d=r.lanes;d&=s.pendingLanes,c|=d,r.lanes=c,op(s,c)}}function md(s,r){var c=s.updateQueue,d=s.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var p=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var k={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};y===null?p=y=k:y=y.next=k,c=c.next}while(c!==null);y===null?p=y=r:y=y.next=r}else p=y=r;c={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:d.shared,callbacks:d.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=r:s.next=r,c.lastBaseUpdate=r}var pd=!1;function Or(){if(pd){var s=ba;if(s!==null)throw s}}function Ar(s,r,c,d){pd=!1;var p=s.updateQueue;Hi=!1;var y=p.firstBaseUpdate,k=p.lastBaseUpdate,N=p.shared.pending;if(N!==null){p.shared.pending=null;var U=N,K=U.next;U.next=null,k===null?y=K:k.next=K,k=U;var Z=s.alternate;Z!==null&&(Z=Z.updateQueue,N=Z.lastBaseUpdate,N!==k&&(N===null?Z.firstBaseUpdate=K:N.next=K,Z.lastBaseUpdate=U))}if(y!==null){var ne=p.baseState;k=0,Z=K=U=null,N=y;do{var G=N.lane&-536870913,Q=G!==N.lane;if(Q?(Ie&G)===G:(d&G)===G){G!==0&&G===ya&&(pd=!0),Z!==null&&(Z=Z.next={lane:0,tag:N.tag,payload:N.payload,callback:null,next:null});e:{var me=s,Se=N;G=r;var We=c;switch(Se.tag){case 1:if(me=Se.payload,typeof me=="function"){ne=me.call(We,ne,G);break e}ne=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=Se.payload,G=typeof me=="function"?me.call(We,ne,G):me,G==null)break e;ne=v({},ne,G);break e;case 2:Hi=!0}}G=N.callback,G!==null&&(s.flags|=64,Q&&(s.flags|=8192),Q=p.callbacks,Q===null?p.callbacks=[G]:Q.push(G))}else Q={lane:G,tag:N.tag,payload:N.payload,callback:N.callback,next:null},Z===null?(K=Z=Q,U=ne):Z=Z.next=Q,k|=G;if(N=N.next,N===null){if(N=p.shared.pending,N===null)break;Q=N,N=Q.next,Q.next=null,p.lastBaseUpdate=Q,p.shared.pending=null}}while(!0);Z===null&&(U=ne),p.baseState=U,p.firstBaseUpdate=K,p.lastBaseUpdate=Z,y===null&&(p.shared.lanes=0),Xi|=k,s.lanes=k,s.memoizedState=ne}}function vg(s,r){if(typeof s!="function")throw Error(i(191,s));s.call(r)}function yg(s,r){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)vg(c[s],r)}var Ca=B(null),yc=B(0);function bg(s,r){s=Ti,oe(yc,s),oe(Ca,r),Ti=s|r.baseLanes}function gd(){oe(yc,Ti),oe(Ca,Ca.current)}function vd(){Ti=yc.current,W(Ca),W(yc)}var gn=B(null),Dn=null;function Gi(s){var r=s.alternate;oe(vt,vt.current&1),oe(gn,s),Dn===null&&(r===null||Ca.current!==null||r.memoizedState!==null)&&(Dn=s)}function yd(s){oe(vt,vt.current),oe(gn,s),Dn===null&&(Dn=s)}function Sg(s){s.tag===22?(oe(vt,vt.current),oe(gn,s),Dn===null&&(Dn=s)):Yi()}function Yi(){oe(vt,vt.current),oe(gn,gn.current)}function vn(s){W(gn),Dn===s&&(Dn=null),W(vt)}var vt=B(0);function bc(s){for(var r=s;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Eh(c)||xh(c)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var pi=0,_e=null,Qe=null,Tt=null,Sc=!1,Ta=!1,zs=!1,kc=0,jr=0,Ea=null,tE=0;function dt(){throw Error(i(321))}function bd(s,r){if(r===null)return!1;for(var c=0;c<r.length&&c<s.length;c++)if(!mn(s[c],r[c]))return!1;return!0}function Sd(s,r,c,d,p,y){return pi=y,_e=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,H.H=s===null||s.memoizedState===null?iv:Pd,zs=!1,y=c(d,p),zs=!1,Ta&&(y=Cg(r,c,d,p)),kg(s),y}function kg(s){H.H=Ir;var r=Qe!==null&&Qe.next!==null;if(pi=0,Tt=Qe=_e=null,Sc=!1,jr=0,Ea=null,r)throw Error(i(300));s===null||Et||(s=s.dependencies,s!==null&&dc(s)&&(Et=!0))}function Cg(s,r,c,d){_e=s;var p=0;do{if(Ta&&(Ea=null),jr=0,Ta=!1,25<=p)throw Error(i(301));if(p+=1,Tt=Qe=null,s.updateQueue!=null){var y=s.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}H.H=sv,y=r(c,d)}while(Ta);return y}function nE(){var s=H.H,r=s.useState()[0];return r=typeof r.then=="function"?Pr(r):r,s=s.useState()[0],(Qe!==null?Qe.memoizedState:null)!==s&&(_e.flags|=1024),r}function kd(){var s=kc!==0;return kc=0,s}function Cd(s,r,c){r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~c}function Td(s){if(Sc){for(s=s.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Sc=!1}pi=0,Tt=Qe=_e=null,Ta=!1,jr=kc=0,Ea=null}function Gt(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?_e.memoizedState=Tt=s:Tt=Tt.next=s,Tt}function yt(){if(Qe===null){var s=_e.alternate;s=s!==null?s.memoizedState:null}else s=Qe.next;var r=Tt===null?_e.memoizedState:Tt.next;if(r!==null)Tt=r,Qe=s;else{if(s===null)throw _e.alternate===null?Error(i(467)):Error(i(310));Qe=s,s={memoizedState:Qe.memoizedState,baseState:Qe.baseState,baseQueue:Qe.baseQueue,queue:Qe.queue,next:null},Tt===null?_e.memoizedState=Tt=s:Tt=Tt.next=s}return Tt}function Cc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Pr(s){var r=jr;return jr+=1,Ea===null&&(Ea=[]),s=hg(Ea,s,r),r=_e,(Tt===null?r.memoizedState:Tt.next)===null&&(r=r.alternate,H.H=r===null||r.memoizedState===null?iv:Pd),s}function Tc(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Pr(s);if(s.$$typeof===j)return Ut(s)}throw Error(i(438,String(s)))}function Ed(s){var r=null,c=_e.updateQueue;if(c!==null&&(r=c.memoCache),r==null){var d=_e.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(r={data:d.data.map(function(p){return p.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),c===null&&(c=Cc(),_e.updateQueue=c),c.memoCache=r,c=r.data[r.index],c===void 0)for(c=r.data[r.index]=Array(s),d=0;d<s;d++)c[d]=A;return r.index++,c}function gi(s,r){return typeof r=="function"?r(s):r}function Ec(s){var r=yt();return xd(r,Qe,s)}function xd(s,r,c){var d=s.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=c;var p=s.baseQueue,y=d.pending;if(y!==null){if(p!==null){var k=p.next;p.next=y.next,y.next=k}r.baseQueue=p=y,d.pending=null}if(y=s.baseState,p===null)s.memoizedState=y;else{r=p.next;var N=k=null,U=null,K=r,Z=!1;do{var ne=K.lane&-536870913;if(ne!==K.lane?(Ie&ne)===ne:(pi&ne)===ne){var G=K.revertLane;if(G===0)U!==null&&(U=U.next={lane:0,revertLane:0,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),ne===ya&&(Z=!0);else if((pi&G)===G){K=K.next,G===ya&&(Z=!0);continue}else ne={lane:0,revertLane:K.revertLane,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},U===null?(N=U=ne,k=y):U=U.next=ne,_e.lanes|=G,Xi|=G;ne=K.action,zs&&c(y,ne),y=K.hasEagerState?K.eagerState:c(y,ne)}else G={lane:ne,revertLane:K.revertLane,gesture:K.gesture,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},U===null?(N=U=G,k=y):U=U.next=G,_e.lanes|=ne,Xi|=ne;K=K.next}while(K!==null&&K!==r);if(U===null?k=y:U.next=N,!mn(y,s.memoizedState)&&(Et=!0,Z&&(c=ba,c!==null)))throw c;s.memoizedState=y,s.baseState=k,s.baseQueue=U,d.lastRenderedState=y}return p===null&&(d.lanes=0),[s.memoizedState,d.dispatch]}function Rd(s){var r=yt(),c=r.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=s;var d=c.dispatch,p=c.pending,y=r.memoizedState;if(p!==null){c.pending=null;var k=p=p.next;do y=s(y,k.action),k=k.next;while(k!==p);mn(y,r.memoizedState)||(Et=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),c.lastRenderedState=y}return[y,d]}function Tg(s,r,c){var d=_e,p=yt(),y=ze;if(y){if(c===void 0)throw Error(i(407));c=c()}else c=r();var k=!mn((Qe||p).memoizedState,c);if(k&&(p.memoizedState=c,Et=!0),p=p.queue,Md(Rg.bind(null,d,p,s),[s]),p.getSnapshot!==r||k||Tt!==null&&Tt.memoizedState.tag&1){if(d.flags|=2048,xa(9,{destroy:void 0},xg.bind(null,d,p,c,r),null),tt===null)throw Error(i(349));y||(pi&127)!==0||Eg(d,r,c)}return c}function Eg(s,r,c){s.flags|=16384,s={getSnapshot:r,value:c},r=_e.updateQueue,r===null?(r=Cc(),_e.updateQueue=r,r.stores=[s]):(c=r.stores,c===null?r.stores=[s]:c.push(s))}function xg(s,r,c,d){r.value=c,r.getSnapshot=d,_g(r)&&wg(s)}function Rg(s,r,c){return c(function(){_g(r)&&wg(s)})}function _g(s){var r=s.getSnapshot;s=s.value;try{var c=r();return!mn(s,c)}catch{return!0}}function wg(s){var r=Ds(s,2);r!==null&&rn(r,s,2)}function _d(s){var r=Gt();if(typeof s=="function"){var c=s;if(s=c(),zs){Ii(!0);try{c()}finally{Ii(!1)}}}return r.memoizedState=r.baseState=s,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:s},r}function Mg(s,r,c,d){return s.baseState=c,xd(s,Qe,typeof d=="function"?d:gi)}function iE(s,r,c,d,p){if(_c(s))throw Error(i(485));if(s=r.action,s!==null){var y={payload:p,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){y.listeners.push(k)}};H.T!==null?c(!0):y.isTransition=!1,d(y),c=r.pending,c===null?(y.next=r.pending=y,Ng(r,y)):(y.next=c.next,r.pending=c.next=y)}}function Ng(s,r){var c=r.action,d=r.payload,p=s.state;if(r.isTransition){var y=H.T,k={};H.T=k;try{var N=c(p,d),U=H.S;U!==null&&U(k,N),Dg(s,r,N)}catch(K){wd(s,r,K)}finally{y!==null&&k.types!==null&&(y.types=k.types),H.T=y}}else try{y=c(p,d),Dg(s,r,y)}catch(K){wd(s,r,K)}}function Dg(s,r,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){Og(s,r,d)},function(d){return wd(s,r,d)}):Og(s,r,c)}function Og(s,r,c){r.status="fulfilled",r.value=c,Ag(r),s.state=c,r=s.pending,r!==null&&(c=r.next,c===r?s.pending=null:(c=c.next,r.next=c,Ng(s,c)))}function wd(s,r,c){var d=s.pending;if(s.pending=null,d!==null){d=d.next;do r.status="rejected",r.reason=c,Ag(r),r=r.next;while(r!==d)}s.action=null}function Ag(s){s=s.listeners;for(var r=0;r<s.length;r++)(0,s[r])()}function jg(s,r){return r}function Pg(s,r){if(ze){var c=tt.formState;if(c!==null){e:{var d=_e;if(ze){if(at){t:{for(var p=at,y=Nn;p.nodeType!==8;){if(!y){p=null;break t}if(p=On(p.nextSibling),p===null){p=null;break t}}y=p.data,p=y==="F!"||y==="F"?p:null}if(p){at=On(p.nextSibling),d=p.data==="F!";break e}}Vi(d)}d=!1}d&&(r=c[0])}}return c=Gt(),c.memoizedState=c.baseState=r,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:jg,lastRenderedState:r},c.queue=d,c=ev.bind(null,_e,d),d.dispatch=c,d=_d(!1),y=jd.bind(null,_e,!1,d.queue),d=Gt(),p={state:r,dispatch:null,action:s,pending:null},d.queue=p,c=iE.bind(null,_e,p,y,c),p.dispatch=c,d.memoizedState=s,[r,c,!1]}function Lg(s){var r=yt();return Ig(r,Qe,s)}function Ig(s,r,c){if(r=xd(s,r,jg)[0],s=Ec(gi)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var d=Pr(r)}catch(k){throw k===Sa?mc:k}else d=r;r=yt();var p=r.queue,y=p.dispatch;return c!==r.memoizedState&&(_e.flags|=2048,xa(9,{destroy:void 0},sE.bind(null,p,c),null)),[d,y,s]}function sE(s,r){s.action=r}function Ug(s){var r=yt(),c=Qe;if(c!==null)return Ig(r,c,s);yt(),r=r.memoizedState,c=yt();var d=c.queue.dispatch;return c.memoizedState=s,[r,d,!1]}function xa(s,r,c,d){return s={tag:s,create:c,deps:d,inst:r,next:null},r=_e.updateQueue,r===null&&(r=Cc(),_e.updateQueue=r),c=r.lastEffect,c===null?r.lastEffect=s.next=s:(d=c.next,c.next=s,s.next=d,r.lastEffect=s),s}function Bg(){return yt().memoizedState}function xc(s,r,c,d){var p=Gt();_e.flags|=s,p.memoizedState=xa(1|r,{destroy:void 0},c,d===void 0?null:d)}function Rc(s,r,c,d){var p=yt();d=d===void 0?null:d;var y=p.memoizedState.inst;Qe!==null&&d!==null&&bd(d,Qe.memoizedState.deps)?p.memoizedState=xa(r,y,c,d):(_e.flags|=s,p.memoizedState=xa(1|r,y,c,d))}function zg(s,r){xc(8390656,8,s,r)}function Md(s,r){Rc(2048,8,s,r)}function aE(s){_e.flags|=4;var r=_e.updateQueue;if(r===null)r=Cc(),_e.updateQueue=r,r.events=[s];else{var c=r.events;c===null?r.events=[s]:c.push(s)}}function Fg(s){var r=yt().memoizedState;return aE({ref:r,nextImpl:s}),function(){if((He&2)!==0)throw Error(i(440));return r.impl.apply(void 0,arguments)}}function Vg(s,r){return Rc(4,2,s,r)}function qg(s,r){return Rc(4,4,s,r)}function Hg(s,r){if(typeof r=="function"){s=s();var c=r(s);return function(){typeof c=="function"?c():r(null)}}if(r!=null)return s=s(),r.current=s,function(){r.current=null}}function $g(s,r,c){c=c!=null?c.concat([s]):null,Rc(4,4,Hg.bind(null,r,s),c)}function Nd(){}function Kg(s,r){var c=yt();r=r===void 0?null:r;var d=c.memoizedState;return r!==null&&bd(r,d[1])?d[0]:(c.memoizedState=[s,r],s)}function Gg(s,r){var c=yt();r=r===void 0?null:r;var d=c.memoizedState;if(r!==null&&bd(r,d[1]))return d[0];if(d=s(),zs){Ii(!0);try{s()}finally{Ii(!1)}}return c.memoizedState=[d,r],d}function Dd(s,r,c){return c===void 0||(pi&1073741824)!==0&&(Ie&261930)===0?s.memoizedState=r:(s.memoizedState=c,s=Yv(),_e.lanes|=s,Xi|=s,c)}function Yg(s,r,c,d){return mn(c,r)?c:Ca.current!==null?(s=Dd(s,c,d),mn(s,r)||(Et=!0),s):(pi&42)===0||(pi&1073741824)!==0&&(Ie&261930)===0?(Et=!0,s.memoizedState=c):(s=Yv(),_e.lanes|=s,Xi|=s,r)}function Jg(s,r,c,d,p){var y=ae.p;ae.p=y!==0&&8>y?y:8;var k=H.T,N={};H.T=N,jd(s,!1,r,c);try{var U=p(),K=H.S;if(K!==null&&K(N,U),U!==null&&typeof U=="object"&&typeof U.then=="function"){var Z=eE(U,d);Lr(s,r,Z,Sn(s))}else Lr(s,r,d,Sn(s))}catch(ne){Lr(s,r,{then:function(){},status:"rejected",reason:ne},Sn())}finally{ae.p=y,k!==null&&N.types!==null&&(k.types=N.types),H.T=k}}function rE(){}function Od(s,r,c,d){if(s.tag!==5)throw Error(i(476));var p=Qg(s).queue;Jg(s,p,r,de,c===null?rE:function(){return Xg(s),c(d)})}function Qg(s){var r=s.memoizedState;if(r!==null)return r;r={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:de},next:null};var c={};return r.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:c},next:null},s.memoizedState=r,s=s.alternate,s!==null&&(s.memoizedState=r),r}function Xg(s){var r=Qg(s);r.next===null&&(r=s.alternate.memoizedState),Lr(s,r.next.queue,{},Sn())}function Ad(){return Ut(Zr)}function Wg(){return yt().memoizedState}function Zg(){return yt().memoizedState}function oE(s){for(var r=s.return;r!==null;){switch(r.tag){case 24:case 3:var c=Sn();s=$i(c);var d=Ki(r,s,c);d!==null&&(rn(d,r,c),Dr(d,r,c)),r={cache:cd()},s.payload=r;return}r=r.return}}function cE(s,r,c){var d=Sn();c={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},_c(s)?tv(r,c):(c=Xu(s,r,c,d),c!==null&&(rn(c,s,d),nv(c,r,d)))}function ev(s,r,c){var d=Sn();Lr(s,r,c,d)}function Lr(s,r,c,d){var p={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(_c(s))tv(r,p);else{var y=s.alternate;if(s.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var k=r.lastRenderedState,N=y(k,c);if(p.hasEagerState=!0,p.eagerState=N,mn(N,k))return oc(s,r,p,0),tt===null&&rc(),!1}catch{}if(c=Xu(s,r,p,d),c!==null)return rn(c,s,d),nv(c,r,d),!0}return!1}function jd(s,r,c,d){if(d={lane:2,revertLane:hh(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},_c(s)){if(r)throw Error(i(479))}else r=Xu(s,c,d,2),r!==null&&rn(r,s,2)}function _c(s){var r=s.alternate;return s===_e||r!==null&&r===_e}function tv(s,r){Ta=Sc=!0;var c=s.pending;c===null?r.next=r:(r.next=c.next,c.next=r),s.pending=r}function nv(s,r,c){if((c&4194048)!==0){var d=r.lanes;d&=s.pendingLanes,c|=d,r.lanes=c,op(s,c)}}var Ir={readContext:Ut,use:Tc,useCallback:dt,useContext:dt,useEffect:dt,useImperativeHandle:dt,useLayoutEffect:dt,useInsertionEffect:dt,useMemo:dt,useReducer:dt,useRef:dt,useState:dt,useDebugValue:dt,useDeferredValue:dt,useTransition:dt,useSyncExternalStore:dt,useId:dt,useHostTransitionStatus:dt,useFormState:dt,useActionState:dt,useOptimistic:dt,useMemoCache:dt,useCacheRefresh:dt};Ir.useEffectEvent=dt;var iv={readContext:Ut,use:Tc,useCallback:function(s,r){return Gt().memoizedState=[s,r===void 0?null:r],s},useContext:Ut,useEffect:zg,useImperativeHandle:function(s,r,c){c=c!=null?c.concat([s]):null,xc(4194308,4,Hg.bind(null,r,s),c)},useLayoutEffect:function(s,r){return xc(4194308,4,s,r)},useInsertionEffect:function(s,r){xc(4,2,s,r)},useMemo:function(s,r){var c=Gt();r=r===void 0?null:r;var d=s();if(zs){Ii(!0);try{s()}finally{Ii(!1)}}return c.memoizedState=[d,r],d},useReducer:function(s,r,c){var d=Gt();if(c!==void 0){var p=c(r);if(zs){Ii(!0);try{c(r)}finally{Ii(!1)}}}else p=r;return d.memoizedState=d.baseState=p,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:p},d.queue=s,s=s.dispatch=cE.bind(null,_e,s),[d.memoizedState,s]},useRef:function(s){var r=Gt();return s={current:s},r.memoizedState=s},useState:function(s){s=_d(s);var r=s.queue,c=ev.bind(null,_e,r);return r.dispatch=c,[s.memoizedState,c]},useDebugValue:Nd,useDeferredValue:function(s,r){var c=Gt();return Dd(c,s,r)},useTransition:function(){var s=_d(!1);return s=Jg.bind(null,_e,s.queue,!0,!1),Gt().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,r,c){var d=_e,p=Gt();if(ze){if(c===void 0)throw Error(i(407));c=c()}else{if(c=r(),tt===null)throw Error(i(349));(Ie&127)!==0||Eg(d,r,c)}p.memoizedState=c;var y={value:c,getSnapshot:r};return p.queue=y,zg(Rg.bind(null,d,y,s),[s]),d.flags|=2048,xa(9,{destroy:void 0},xg.bind(null,d,y,c,r),null),c},useId:function(){var s=Gt(),r=tt.identifierPrefix;if(ze){var c=Qn,d=Jn;c=(d&~(1<<32-fn(d)-1)).toString(32)+c,r="_"+r+"R_"+c,c=kc++,0<c&&(r+="H"+c.toString(32)),r+="_"}else c=tE++,r="_"+r+"r_"+c.toString(32)+"_";return s.memoizedState=r},useHostTransitionStatus:Ad,useFormState:Pg,useActionState:Pg,useOptimistic:function(s){var r=Gt();r.memoizedState=r.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=c,r=jd.bind(null,_e,!0,c),c.dispatch=r,[s,r]},useMemoCache:Ed,useCacheRefresh:function(){return Gt().memoizedState=oE.bind(null,_e)},useEffectEvent:function(s){var r=Gt(),c={impl:s};return r.memoizedState=c,function(){if((He&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},Pd={readContext:Ut,use:Tc,useCallback:Kg,useContext:Ut,useEffect:Md,useImperativeHandle:$g,useInsertionEffect:Vg,useLayoutEffect:qg,useMemo:Gg,useReducer:Ec,useRef:Bg,useState:function(){return Ec(gi)},useDebugValue:Nd,useDeferredValue:function(s,r){var c=yt();return Yg(c,Qe.memoizedState,s,r)},useTransition:function(){var s=Ec(gi)[0],r=yt().memoizedState;return[typeof s=="boolean"?s:Pr(s),r]},useSyncExternalStore:Tg,useId:Wg,useHostTransitionStatus:Ad,useFormState:Lg,useActionState:Lg,useOptimistic:function(s,r){var c=yt();return Mg(c,Qe,s,r)},useMemoCache:Ed,useCacheRefresh:Zg};Pd.useEffectEvent=Fg;var sv={readContext:Ut,use:Tc,useCallback:Kg,useContext:Ut,useEffect:Md,useImperativeHandle:$g,useInsertionEffect:Vg,useLayoutEffect:qg,useMemo:Gg,useReducer:Rd,useRef:Bg,useState:function(){return Rd(gi)},useDebugValue:Nd,useDeferredValue:function(s,r){var c=yt();return Qe===null?Dd(c,s,r):Yg(c,Qe.memoizedState,s,r)},useTransition:function(){var s=Rd(gi)[0],r=yt().memoizedState;return[typeof s=="boolean"?s:Pr(s),r]},useSyncExternalStore:Tg,useId:Wg,useHostTransitionStatus:Ad,useFormState:Ug,useActionState:Ug,useOptimistic:function(s,r){var c=yt();return Qe!==null?Mg(c,Qe,s,r):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:Ed,useCacheRefresh:Zg};sv.useEffectEvent=Fg;function Ld(s,r,c,d){r=s.memoizedState,c=c(d,r),c=c==null?r:v({},r,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Id={enqueueSetState:function(s,r,c){s=s._reactInternals;var d=Sn(),p=$i(d);p.payload=r,c!=null&&(p.callback=c),r=Ki(s,p,d),r!==null&&(rn(r,s,d),Dr(r,s,d))},enqueueReplaceState:function(s,r,c){s=s._reactInternals;var d=Sn(),p=$i(d);p.tag=1,p.payload=r,c!=null&&(p.callback=c),r=Ki(s,p,d),r!==null&&(rn(r,s,d),Dr(r,s,d))},enqueueForceUpdate:function(s,r){s=s._reactInternals;var c=Sn(),d=$i(c);d.tag=2,r!=null&&(d.callback=r),r=Ki(s,d,c),r!==null&&(rn(r,s,c),Dr(r,s,c))}};function av(s,r,c,d,p,y,k){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(d,y,k):r.prototype&&r.prototype.isPureReactComponent?!Tr(c,d)||!Tr(p,y):!0}function rv(s,r,c,d){s=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,d),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,d),r.state!==s&&Id.enqueueReplaceState(r,r.state,null)}function Fs(s,r){var c=r;if("ref"in r){c={};for(var d in r)d!=="ref"&&(c[d]=r[d])}if(s=s.defaultProps){c===r&&(c=v({},c));for(var p in s)c[p]===void 0&&(c[p]=s[p])}return c}function ov(s){ac(s)}function cv(s){console.error(s)}function lv(s){ac(s)}function wc(s,r){try{var c=s.onUncaughtError;c(r.value,{componentStack:r.stack})}catch(d){setTimeout(function(){throw d})}}function uv(s,r,c){try{var d=s.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Ud(s,r,c){return c=$i(c),c.tag=3,c.payload={element:null},c.callback=function(){wc(s,r)},c}function dv(s){return s=$i(s),s.tag=3,s}function hv(s,r,c,d){var p=c.type.getDerivedStateFromError;if(typeof p=="function"){var y=d.value;s.payload=function(){return p(y)},s.callback=function(){uv(r,c,d)}}var k=c.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(s.callback=function(){uv(r,c,d),typeof p!="function"&&(Wi===null?Wi=new Set([this]):Wi.add(this));var N=d.stack;this.componentDidCatch(d.value,{componentStack:N!==null?N:""})})}function lE(s,r,c,d,p){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(r=c.alternate,r!==null&&va(r,c,p,!0),c=gn.current,c!==null){switch(c.tag){case 31:case 13:return Dn===null?zc():c.alternate===null&&ht===0&&(ht=3),c.flags&=-257,c.flags|=65536,c.lanes=p,d===pc?c.flags|=16384:(r=c.updateQueue,r===null?c.updateQueue=new Set([d]):r.add(d),lh(s,d,p)),!1;case 22:return c.flags|=65536,d===pc?c.flags|=16384:(r=c.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=r):(c=r.retryQueue,c===null?r.retryQueue=new Set([d]):c.add(d)),lh(s,d,p)),!1}throw Error(i(435,c.tag))}return lh(s,d,p),zc(),!1}if(ze)return r=gn.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=p,d!==id&&(s=Error(i(422),{cause:d}),Rr(_n(s,c)))):(d!==id&&(r=Error(i(423),{cause:d}),Rr(_n(r,c))),s=s.current.alternate,s.flags|=65536,p&=-p,s.lanes|=p,d=_n(d,c),p=Ud(s.stateNode,d,p),md(s,p),ht!==4&&(ht=2)),!1;var y=Error(i(520),{cause:d});if(y=_n(y,c),$r===null?$r=[y]:$r.push(y),ht!==4&&(ht=2),r===null)return!0;d=_n(d,c),c=r;do{switch(c.tag){case 3:return c.flags|=65536,s=p&-p,c.lanes|=s,s=Ud(c.stateNode,d,s),md(c,s),!1;case 1:if(r=c.type,y=c.stateNode,(c.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Wi===null||!Wi.has(y))))return c.flags|=65536,p&=-p,c.lanes|=p,p=dv(p),hv(p,s,c,d),md(c,p),!1}c=c.return}while(c!==null);return!1}var Bd=Error(i(461)),Et=!1;function Bt(s,r,c,d){r.child=s===null?gg(r,null,c,d):Bs(r,s.child,c,d)}function fv(s,r,c,d,p){c=c.render;var y=r.ref;if("ref"in d){var k={};for(var N in d)N!=="ref"&&(k[N]=d[N])}else k=d;return Ps(r),d=Sd(s,r,c,k,y,p),N=kd(),s!==null&&!Et?(Cd(s,r,p),vi(s,r,p)):(ze&&N&&td(r),r.flags|=1,Bt(s,r,d,p),r.child)}function mv(s,r,c,d,p){if(s===null){var y=c.type;return typeof y=="function"&&!Wu(y)&&y.defaultProps===void 0&&c.compare===null?(r.tag=15,r.type=y,pv(s,r,y,d,p)):(s=lc(c.type,null,d,r,r.mode,p),s.ref=r.ref,s.return=r,r.child=s)}if(y=s.child,!Gd(s,p)){var k=y.memoizedProps;if(c=c.compare,c=c!==null?c:Tr,c(k,d)&&s.ref===r.ref)return vi(s,r,p)}return r.flags|=1,s=di(y,d),s.ref=r.ref,s.return=r,r.child=s}function pv(s,r,c,d,p){if(s!==null){var y=s.memoizedProps;if(Tr(y,d)&&s.ref===r.ref)if(Et=!1,r.pendingProps=d=y,Gd(s,p))(s.flags&131072)!==0&&(Et=!0);else return r.lanes=s.lanes,vi(s,r,p)}return zd(s,r,c,d,p)}function gv(s,r,c,d){var p=d.children,y=s!==null?s.memoizedState:null;if(s===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((r.flags&128)!==0){if(y=y!==null?y.baseLanes|c:c,s!==null){for(d=r.child=s.child,p=0;d!==null;)p=p|d.lanes|d.childLanes,d=d.sibling;d=p&~y}else d=0,r.child=null;return vv(s,r,y,c,d)}if((c&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},s!==null&&fc(r,y!==null?y.cachePool:null),y!==null?bg(r,y):gd(),Sg(r);else return d=r.lanes=536870912,vv(s,r,y!==null?y.baseLanes|c:c,c,d)}else y!==null?(fc(r,y.cachePool),bg(r,y),Yi(),r.memoizedState=null):(s!==null&&fc(r,null),gd(),Yi());return Bt(s,r,p,c),r.child}function Ur(s,r){return s!==null&&s.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function vv(s,r,c,d,p){var y=ud();return y=y===null?null:{parent:Ct._currentValue,pool:y},r.memoizedState={baseLanes:c,cachePool:y},s!==null&&fc(r,null),gd(),Sg(r),s!==null&&va(s,r,d,!0),r.childLanes=p,null}function Mc(s,r){return r=Dc({mode:r.mode,children:r.children},s.mode),r.ref=s.ref,s.child=r,r.return=s,r}function yv(s,r,c){return Bs(r,s.child,null,c),s=Mc(r,r.pendingProps),s.flags|=2,vn(r),r.memoizedState=null,s}function uE(s,r,c){var d=r.pendingProps,p=(r.flags&128)!==0;if(r.flags&=-129,s===null){if(ze){if(d.mode==="hidden")return s=Mc(r,d),r.lanes=536870912,Ur(null,s);if(yd(r),(s=at)?(s=Ny(s,Nn),s=s!==null&&s.data==="&"?s:null,s!==null&&(r.memoizedState={dehydrated:s,treeContext:zi!==null?{id:Jn,overflow:Qn}:null,retryLane:536870912,hydrationErrors:null},c=tg(s),c.return=r,r.child=c,It=r,at=null)):s=null,s===null)throw Vi(r);return r.lanes=536870912,null}return Mc(r,d)}var y=s.memoizedState;if(y!==null){var k=y.dehydrated;if(yd(r),p)if(r.flags&256)r.flags&=-257,r=yv(s,r,c);else if(r.memoizedState!==null)r.child=s.child,r.flags|=128,r=null;else throw Error(i(558));else if(Et||va(s,r,c,!1),p=(c&s.childLanes)!==0,Et||p){if(d=tt,d!==null&&(k=cp(d,c),k!==0&&k!==y.retryLane))throw y.retryLane=k,Ds(s,k),rn(d,s,k),Bd;zc(),r=yv(s,r,c)}else s=y.treeContext,at=On(k.nextSibling),It=r,ze=!0,Fi=null,Nn=!1,s!==null&&sg(r,s),r=Mc(r,d),r.flags|=4096;return r}return s=di(s.child,{mode:d.mode,children:d.children}),s.ref=r.ref,r.child=s,s.return=r,s}function Nc(s,r){var c=r.ref;if(c===null)s!==null&&s.ref!==null&&(r.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(s===null||s.ref!==c)&&(r.flags|=4194816)}}function zd(s,r,c,d,p){return Ps(r),c=Sd(s,r,c,d,void 0,p),d=kd(),s!==null&&!Et?(Cd(s,r,p),vi(s,r,p)):(ze&&d&&td(r),r.flags|=1,Bt(s,r,c,p),r.child)}function bv(s,r,c,d,p,y){return Ps(r),r.updateQueue=null,c=Cg(r,d,c,p),kg(s),d=kd(),s!==null&&!Et?(Cd(s,r,y),vi(s,r,y)):(ze&&d&&td(r),r.flags|=1,Bt(s,r,c,y),r.child)}function Sv(s,r,c,d,p){if(Ps(r),r.stateNode===null){var y=fa,k=c.contextType;typeof k=="object"&&k!==null&&(y=Ut(k)),y=new c(d,y),r.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Id,r.stateNode=y,y._reactInternals=r,y=r.stateNode,y.props=d,y.state=r.memoizedState,y.refs={},hd(r),k=c.contextType,y.context=typeof k=="object"&&k!==null?Ut(k):fa,y.state=r.memoizedState,k=c.getDerivedStateFromProps,typeof k=="function"&&(Ld(r,c,k,d),y.state=r.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(k=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),k!==y.state&&Id.enqueueReplaceState(y,y.state,null),Ar(r,d,y,p),Or(),y.state=r.memoizedState),typeof y.componentDidMount=="function"&&(r.flags|=4194308),d=!0}else if(s===null){y=r.stateNode;var N=r.memoizedProps,U=Fs(c,N);y.props=U;var K=y.context,Z=c.contextType;k=fa,typeof Z=="object"&&Z!==null&&(k=Ut(Z));var ne=c.getDerivedStateFromProps;Z=typeof ne=="function"||typeof y.getSnapshotBeforeUpdate=="function",N=r.pendingProps!==N,Z||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(N||K!==k)&&rv(r,y,d,k),Hi=!1;var G=r.memoizedState;y.state=G,Ar(r,d,y,p),Or(),K=r.memoizedState,N||G!==K||Hi?(typeof ne=="function"&&(Ld(r,c,ne,d),K=r.memoizedState),(U=Hi||av(r,c,U,d,G,K,k))?(Z||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(r.flags|=4194308)):(typeof y.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=d,r.memoizedState=K),y.props=d,y.state=K,y.context=k,d=U):(typeof y.componentDidMount=="function"&&(r.flags|=4194308),d=!1)}else{y=r.stateNode,fd(s,r),k=r.memoizedProps,Z=Fs(c,k),y.props=Z,ne=r.pendingProps,G=y.context,K=c.contextType,U=fa,typeof K=="object"&&K!==null&&(U=Ut(K)),N=c.getDerivedStateFromProps,(K=typeof N=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(k!==ne||G!==U)&&rv(r,y,d,U),Hi=!1,G=r.memoizedState,y.state=G,Ar(r,d,y,p),Or();var Q=r.memoizedState;k!==ne||G!==Q||Hi||s!==null&&s.dependencies!==null&&dc(s.dependencies)?(typeof N=="function"&&(Ld(r,c,N,d),Q=r.memoizedState),(Z=Hi||av(r,c,Z,d,G,Q,U)||s!==null&&s.dependencies!==null&&dc(s.dependencies))?(K||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,Q,U),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,Q,U)),typeof y.componentDidUpdate=="function"&&(r.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof y.componentDidUpdate!="function"||k===s.memoizedProps&&G===s.memoizedState||(r.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&G===s.memoizedState||(r.flags|=1024),r.memoizedProps=d,r.memoizedState=Q),y.props=d,y.state=Q,y.context=U,d=Z):(typeof y.componentDidUpdate!="function"||k===s.memoizedProps&&G===s.memoizedState||(r.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&G===s.memoizedState||(r.flags|=1024),d=!1)}return y=d,Nc(s,r),d=(r.flags&128)!==0,y||d?(y=r.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:y.render(),r.flags|=1,s!==null&&d?(r.child=Bs(r,s.child,null,p),r.child=Bs(r,null,c,p)):Bt(s,r,c,p),r.memoizedState=y.state,s=r.child):s=vi(s,r,p),s}function kv(s,r,c,d){return As(),r.flags|=256,Bt(s,r,c,d),r.child}var Fd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Vd(s){return{baseLanes:s,cachePool:ug()}}function qd(s,r,c){return s=s!==null?s.childLanes&~c:0,r&&(s|=bn),s}function Cv(s,r,c){var d=r.pendingProps,p=!1,y=(r.flags&128)!==0,k;if((k=y)||(k=s!==null&&s.memoizedState===null?!1:(vt.current&2)!==0),k&&(p=!0,r.flags&=-129),k=(r.flags&32)!==0,r.flags&=-33,s===null){if(ze){if(p?Gi(r):Yi(),(s=at)?(s=Ny(s,Nn),s=s!==null&&s.data!=="&"?s:null,s!==null&&(r.memoizedState={dehydrated:s,treeContext:zi!==null?{id:Jn,overflow:Qn}:null,retryLane:536870912,hydrationErrors:null},c=tg(s),c.return=r,r.child=c,It=r,at=null)):s=null,s===null)throw Vi(r);return xh(s)?r.lanes=32:r.lanes=536870912,null}var N=d.children;return d=d.fallback,p?(Yi(),p=r.mode,N=Dc({mode:"hidden",children:N},p),d=Os(d,p,c,null),N.return=r,d.return=r,N.sibling=d,r.child=N,d=r.child,d.memoizedState=Vd(c),d.childLanes=qd(s,k,c),r.memoizedState=Fd,Ur(null,d)):(Gi(r),Hd(r,N))}var U=s.memoizedState;if(U!==null&&(N=U.dehydrated,N!==null)){if(y)r.flags&256?(Gi(r),r.flags&=-257,r=$d(s,r,c)):r.memoizedState!==null?(Yi(),r.child=s.child,r.flags|=128,r=null):(Yi(),N=d.fallback,p=r.mode,d=Dc({mode:"visible",children:d.children},p),N=Os(N,p,c,null),N.flags|=2,d.return=r,N.return=r,d.sibling=N,r.child=d,Bs(r,s.child,null,c),d=r.child,d.memoizedState=Vd(c),d.childLanes=qd(s,k,c),r.memoizedState=Fd,r=Ur(null,d));else if(Gi(r),xh(N)){if(k=N.nextSibling&&N.nextSibling.dataset,k)var K=k.dgst;k=K,d=Error(i(419)),d.stack="",d.digest=k,Rr({value:d,source:null,stack:null}),r=$d(s,r,c)}else if(Et||va(s,r,c,!1),k=(c&s.childLanes)!==0,Et||k){if(k=tt,k!==null&&(d=cp(k,c),d!==0&&d!==U.retryLane))throw U.retryLane=d,Ds(s,d),rn(k,s,d),Bd;Eh(N)||zc(),r=$d(s,r,c)}else Eh(N)?(r.flags|=192,r.child=s.child,r=null):(s=U.treeContext,at=On(N.nextSibling),It=r,ze=!0,Fi=null,Nn=!1,s!==null&&sg(r,s),r=Hd(r,d.children),r.flags|=4096);return r}return p?(Yi(),N=d.fallback,p=r.mode,U=s.child,K=U.sibling,d=di(U,{mode:"hidden",children:d.children}),d.subtreeFlags=U.subtreeFlags&65011712,K!==null?N=di(K,N):(N=Os(N,p,c,null),N.flags|=2),N.return=r,d.return=r,d.sibling=N,r.child=d,Ur(null,d),d=r.child,N=s.child.memoizedState,N===null?N=Vd(c):(p=N.cachePool,p!==null?(U=Ct._currentValue,p=p.parent!==U?{parent:U,pool:U}:p):p=ug(),N={baseLanes:N.baseLanes|c,cachePool:p}),d.memoizedState=N,d.childLanes=qd(s,k,c),r.memoizedState=Fd,Ur(s.child,d)):(Gi(r),c=s.child,s=c.sibling,c=di(c,{mode:"visible",children:d.children}),c.return=r,c.sibling=null,s!==null&&(k=r.deletions,k===null?(r.deletions=[s],r.flags|=16):k.push(s)),r.child=c,r.memoizedState=null,c)}function Hd(s,r){return r=Dc({mode:"visible",children:r},s.mode),r.return=s,s.child=r}function Dc(s,r){return s=pn(22,s,null,r),s.lanes=0,s}function $d(s,r,c){return Bs(r,s.child,null,c),s=Hd(r,r.pendingProps.children),s.flags|=2,r.memoizedState=null,s}function Tv(s,r,c){s.lanes|=r;var d=s.alternate;d!==null&&(d.lanes|=r),rd(s.return,r,c)}function Kd(s,r,c,d,p,y){var k=s.memoizedState;k===null?s.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:p,treeForkCount:y}:(k.isBackwards=r,k.rendering=null,k.renderingStartTime=0,k.last=d,k.tail=c,k.tailMode=p,k.treeForkCount=y)}function Ev(s,r,c){var d=r.pendingProps,p=d.revealOrder,y=d.tail;d=d.children;var k=vt.current,N=(k&2)!==0;if(N?(k=k&1|2,r.flags|=128):k&=1,oe(vt,k),Bt(s,r,d,c),d=ze?xr:0,!N&&s!==null&&(s.flags&128)!==0)e:for(s=r.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Tv(s,c,r);else if(s.tag===19)Tv(s,c,r);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(p){case"forwards":for(c=r.child,p=null;c!==null;)s=c.alternate,s!==null&&bc(s)===null&&(p=c),c=c.sibling;c=p,c===null?(p=r.child,r.child=null):(p=c.sibling,c.sibling=null),Kd(r,!1,p,c,y,d);break;case"backwards":case"unstable_legacy-backwards":for(c=null,p=r.child,r.child=null;p!==null;){if(s=p.alternate,s!==null&&bc(s)===null){r.child=p;break}s=p.sibling,p.sibling=c,c=p,p=s}Kd(r,!0,c,null,y,d);break;case"together":Kd(r,!1,null,null,void 0,d);break;default:r.memoizedState=null}return r.child}function vi(s,r,c){if(s!==null&&(r.dependencies=s.dependencies),Xi|=r.lanes,(c&r.childLanes)===0)if(s!==null){if(va(s,r,c,!1),(c&r.childLanes)===0)return null}else return null;if(s!==null&&r.child!==s.child)throw Error(i(153));if(r.child!==null){for(s=r.child,c=di(s,s.pendingProps),r.child=c,c.return=r;s.sibling!==null;)s=s.sibling,c=c.sibling=di(s,s.pendingProps),c.return=r;c.sibling=null}return r.child}function Gd(s,r){return(s.lanes&r)!==0?!0:(s=s.dependencies,!!(s!==null&&dc(s)))}function dE(s,r,c){switch(r.tag){case 3:Je(r,r.stateNode.containerInfo),qi(r,Ct,s.memoizedState.cache),As();break;case 27:case 5:Li(r);break;case 4:Je(r,r.stateNode.containerInfo);break;case 10:qi(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,yd(r),null;break;case 13:var d=r.memoizedState;if(d!==null)return d.dehydrated!==null?(Gi(r),r.flags|=128,null):(c&r.child.childLanes)!==0?Cv(s,r,c):(Gi(r),s=vi(s,r,c),s!==null?s.sibling:null);Gi(r);break;case 19:var p=(s.flags&128)!==0;if(d=(c&r.childLanes)!==0,d||(va(s,r,c,!1),d=(c&r.childLanes)!==0),p){if(d)return Ev(s,r,c);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),oe(vt,vt.current),d)break;return null;case 22:return r.lanes=0,gv(s,r,c,r.pendingProps);case 24:qi(r,Ct,s.memoizedState.cache)}return vi(s,r,c)}function xv(s,r,c){if(s!==null)if(s.memoizedProps!==r.pendingProps)Et=!0;else{if(!Gd(s,c)&&(r.flags&128)===0)return Et=!1,dE(s,r,c);Et=(s.flags&131072)!==0}else Et=!1,ze&&(r.flags&1048576)!==0&&ig(r,xr,r.index);switch(r.lanes=0,r.tag){case 16:e:{var d=r.pendingProps;if(s=Is(r.elementType),r.type=s,typeof s=="function")Wu(s)?(d=Fs(s,d),r.tag=1,r=Sv(null,r,s,d,c)):(r.tag=0,r=zd(null,r,s,d,c));else{if(s!=null){var p=s.$$typeof;if(p===x){r.tag=11,r=fv(null,r,s,d,c);break e}else if(p===I){r.tag=14,r=mv(null,r,s,d,c);break e}}throw r=le(s)||s,Error(i(306,r,""))}}return r;case 0:return zd(s,r,r.type,r.pendingProps,c);case 1:return d=r.type,p=Fs(d,r.pendingProps),Sv(s,r,d,p,c);case 3:e:{if(Je(r,r.stateNode.containerInfo),s===null)throw Error(i(387));d=r.pendingProps;var y=r.memoizedState;p=y.element,fd(s,r),Ar(r,d,null,c);var k=r.memoizedState;if(d=k.cache,qi(r,Ct,d),d!==y.cache&&od(r,[Ct],c,!0),Or(),d=k.element,y.isDehydrated)if(y={element:d,isDehydrated:!1,cache:k.cache},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){r=kv(s,r,d,c);break e}else if(d!==p){p=_n(Error(i(424)),r),Rr(p),r=kv(s,r,d,c);break e}else for(s=r.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,at=On(s.firstChild),It=r,ze=!0,Fi=null,Nn=!0,c=gg(r,null,d,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(As(),d===p){r=vi(s,r,c);break e}Bt(s,r,d,c)}r=r.child}return r;case 26:return Nc(s,r),s===null?(c=Ly(r.type,null,r.pendingProps,null))?r.memoizedState=c:ze||(c=r.type,s=r.pendingProps,d=Gc(re.current).createElement(c),d[Lt]=r,d[Zt]=s,zt(d,c,s),Mt(d),r.stateNode=d):r.memoizedState=Ly(r.type,s.memoizedProps,r.pendingProps,s.memoizedState),null;case 27:return Li(r),s===null&&ze&&(d=r.stateNode=Ay(r.type,r.pendingProps,re.current),It=r,Nn=!0,p=at,ns(r.type)?(Rh=p,at=On(d.firstChild)):at=p),Bt(s,r,r.pendingProps.children,c),Nc(s,r),s===null&&(r.flags|=4194304),r.child;case 5:return s===null&&ze&&((p=d=at)&&(d=FE(d,r.type,r.pendingProps,Nn),d!==null?(r.stateNode=d,It=r,at=On(d.firstChild),Nn=!1,p=!0):p=!1),p||Vi(r)),Li(r),p=r.type,y=r.pendingProps,k=s!==null?s.memoizedProps:null,d=y.children,kh(p,y)?d=null:k!==null&&kh(p,k)&&(r.flags|=32),r.memoizedState!==null&&(p=Sd(s,r,nE,null,null,c),Zr._currentValue=p),Nc(s,r),Bt(s,r,d,c),r.child;case 6:return s===null&&ze&&((s=c=at)&&(c=VE(c,r.pendingProps,Nn),c!==null?(r.stateNode=c,It=r,at=null,s=!0):s=!1),s||Vi(r)),null;case 13:return Cv(s,r,c);case 4:return Je(r,r.stateNode.containerInfo),d=r.pendingProps,s===null?r.child=Bs(r,null,d,c):Bt(s,r,d,c),r.child;case 11:return fv(s,r,r.type,r.pendingProps,c);case 7:return Bt(s,r,r.pendingProps,c),r.child;case 8:return Bt(s,r,r.pendingProps.children,c),r.child;case 12:return Bt(s,r,r.pendingProps.children,c),r.child;case 10:return d=r.pendingProps,qi(r,r.type,d.value),Bt(s,r,d.children,c),r.child;case 9:return p=r.type._context,d=r.pendingProps.children,Ps(r),p=Ut(p),d=d(p),r.flags|=1,Bt(s,r,d,c),r.child;case 14:return mv(s,r,r.type,r.pendingProps,c);case 15:return pv(s,r,r.type,r.pendingProps,c);case 19:return Ev(s,r,c);case 31:return uE(s,r,c);case 22:return gv(s,r,c,r.pendingProps);case 24:return Ps(r),d=Ut(Ct),s===null?(p=ud(),p===null&&(p=tt,y=cd(),p.pooledCache=y,y.refCount++,y!==null&&(p.pooledCacheLanes|=c),p=y),r.memoizedState={parent:d,cache:p},hd(r),qi(r,Ct,p)):((s.lanes&c)!==0&&(fd(s,r),Ar(r,null,null,c),Or()),p=s.memoizedState,y=r.memoizedState,p.parent!==d?(p={parent:d,cache:d},r.memoizedState=p,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=p),qi(r,Ct,d)):(d=y.cache,qi(r,Ct,d),d!==p.cache&&od(r,[Ct],c,!0))),Bt(s,r,r.pendingProps.children,c),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function yi(s){s.flags|=4}function Yd(s,r,c,d,p){if((r=(s.mode&32)!==0)&&(r=!1),r){if(s.flags|=16777216,(p&335544128)===p)if(s.stateNode.complete)s.flags|=8192;else if(Wv())s.flags|=8192;else throw Us=pc,dd}else s.flags&=-16777217}function Rv(s,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Fy(r))if(Wv())s.flags|=8192;else throw Us=pc,dd}function Oc(s,r){r!==null&&(s.flags|=4),s.flags&16384&&(r=s.tag!==22?ap():536870912,s.lanes|=r,Ma|=r)}function Br(s,r){if(!ze)switch(s.tailMode){case"hidden":r=s.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?r||s.tail===null?s.tail=null:s.tail.sibling=null:d.sibling=null}}function rt(s){var r=s.alternate!==null&&s.alternate.child===s.child,c=0,d=0;if(r)for(var p=s.child;p!==null;)c|=p.lanes|p.childLanes,d|=p.subtreeFlags&65011712,d|=p.flags&65011712,p.return=s,p=p.sibling;else for(p=s.child;p!==null;)c|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=s,p=p.sibling;return s.subtreeFlags|=d,s.childLanes=c,r}function hE(s,r,c){var d=r.pendingProps;switch(nd(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rt(r),null;case 1:return rt(r),null;case 3:return c=r.stateNode,d=null,s!==null&&(d=s.memoizedState.cache),r.memoizedState.cache!==d&&(r.flags|=2048),mi(Ct),$e(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(ga(r)?yi(r):s===null||s.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,sd())),rt(r),null;case 26:var p=r.type,y=r.memoizedState;return s===null?(yi(r),y!==null?(rt(r),Rv(r,y)):(rt(r),Yd(r,p,null,d,c))):y?y!==s.memoizedState?(yi(r),rt(r),Rv(r,y)):(rt(r),r.flags&=-16777217):(s=s.memoizedProps,s!==d&&yi(r),rt(r),Yd(r,p,s,d,c)),null;case 27:if(qo(r),c=re.current,p=r.type,s!==null&&r.stateNode!=null)s.memoizedProps!==d&&yi(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return rt(r),null}s=he.current,ga(r)?ag(r):(s=Ay(p,d,c),r.stateNode=s,yi(r))}return rt(r),null;case 5:if(qo(r),p=r.type,s!==null&&r.stateNode!=null)s.memoizedProps!==d&&yi(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return rt(r),null}if(y=he.current,ga(r))ag(r);else{var k=Gc(re.current);switch(y){case 1:y=k.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:y=k.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":y=k.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":y=k.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":y=k.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof d.is=="string"?k.createElement("select",{is:d.is}):k.createElement("select"),d.multiple?y.multiple=!0:d.size&&(y.size=d.size);break;default:y=typeof d.is=="string"?k.createElement(p,{is:d.is}):k.createElement(p)}}y[Lt]=r,y[Zt]=d;e:for(k=r.child;k!==null;){if(k.tag===5||k.tag===6)y.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===r)break e;for(;k.sibling===null;){if(k.return===null||k.return===r)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}r.stateNode=y;e:switch(zt(y,p,d),p){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&yi(r)}}return rt(r),Yd(r,r.type,s===null?null:s.memoizedProps,r.pendingProps,c),null;case 6:if(s&&r.stateNode!=null)s.memoizedProps!==d&&yi(r);else{if(typeof d!="string"&&r.stateNode===null)throw Error(i(166));if(s=re.current,ga(r)){if(s=r.stateNode,c=r.memoizedProps,d=null,p=It,p!==null)switch(p.tag){case 27:case 5:d=p.memoizedProps}s[Lt]=r,s=!!(s.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||Cy(s.nodeValue,c)),s||Vi(r,!0)}else s=Gc(s).createTextNode(d),s[Lt]=r,r.stateNode=s}return rt(r),null;case 31:if(c=r.memoizedState,s===null||s.memoizedState!==null){if(d=ga(r),c!==null){if(s===null){if(!d)throw Error(i(318));if(s=r.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(557));s[Lt]=r}else As(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;rt(r),s=!1}else c=sd(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return r.flags&256?(vn(r),r):(vn(r),null);if((r.flags&128)!==0)throw Error(i(558))}return rt(r),null;case 13:if(d=r.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(p=ga(r),d!==null&&d.dehydrated!==null){if(s===null){if(!p)throw Error(i(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[Lt]=r}else As(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;rt(r),p=!1}else p=sd(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=p),p=!0;if(!p)return r.flags&256?(vn(r),r):(vn(r),null)}return vn(r),(r.flags&128)!==0?(r.lanes=c,r):(c=d!==null,s=s!==null&&s.memoizedState!==null,c&&(d=r.child,p=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(p=d.alternate.memoizedState.cachePool.pool),y=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==p&&(d.flags|=2048)),c!==s&&c&&(r.child.flags|=8192),Oc(r,r.updateQueue),rt(r),null);case 4:return $e(),s===null&&gh(r.stateNode.containerInfo),rt(r),null;case 10:return mi(r.type),rt(r),null;case 19:if(W(vt),d=r.memoizedState,d===null)return rt(r),null;if(p=(r.flags&128)!==0,y=d.rendering,y===null)if(p)Br(d,!1);else{if(ht!==0||s!==null&&(s.flags&128)!==0)for(s=r.child;s!==null;){if(y=bc(s),y!==null){for(r.flags|=128,Br(d,!1),s=y.updateQueue,r.updateQueue=s,Oc(r,s),r.subtreeFlags=0,s=c,c=r.child;c!==null;)eg(c,s),c=c.sibling;return oe(vt,vt.current&1|2),ze&&hi(r,d.treeForkCount),r.child}s=s.sibling}d.tail!==null&&dn()>Ic&&(r.flags|=128,p=!0,Br(d,!1),r.lanes=4194304)}else{if(!p)if(s=bc(y),s!==null){if(r.flags|=128,p=!0,s=s.updateQueue,r.updateQueue=s,Oc(r,s),Br(d,!0),d.tail===null&&d.tailMode==="hidden"&&!y.alternate&&!ze)return rt(r),null}else 2*dn()-d.renderingStartTime>Ic&&c!==536870912&&(r.flags|=128,p=!0,Br(d,!1),r.lanes=4194304);d.isBackwards?(y.sibling=r.child,r.child=y):(s=d.last,s!==null?s.sibling=y:r.child=y,d.last=y)}return d.tail!==null?(s=d.tail,d.rendering=s,d.tail=s.sibling,d.renderingStartTime=dn(),s.sibling=null,c=vt.current,oe(vt,p?c&1|2:c&1),ze&&hi(r,d.treeForkCount),s):(rt(r),null);case 22:case 23:return vn(r),vd(),d=r.memoizedState!==null,s!==null?s.memoizedState!==null!==d&&(r.flags|=8192):d&&(r.flags|=8192),d?(c&536870912)!==0&&(r.flags&128)===0&&(rt(r),r.subtreeFlags&6&&(r.flags|=8192)):rt(r),c=r.updateQueue,c!==null&&Oc(r,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),d=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),d!==c&&(r.flags|=2048),s!==null&&W(Ls),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),mi(Ct),rt(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function fE(s,r){switch(nd(r),r.tag){case 1:return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 3:return mi(Ct),$e(),s=r.flags,(s&65536)!==0&&(s&128)===0?(r.flags=s&-65537|128,r):null;case 26:case 27:case 5:return qo(r),null;case 31:if(r.memoizedState!==null){if(vn(r),r.alternate===null)throw Error(i(340));As()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 13:if(vn(r),s=r.memoizedState,s!==null&&s.dehydrated!==null){if(r.alternate===null)throw Error(i(340));As()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 19:return W(vt),null;case 4:return $e(),null;case 10:return mi(r.type),null;case 22:case 23:return vn(r),vd(),s!==null&&W(Ls),s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 24:return mi(Ct),null;case 25:return null;default:return null}}function _v(s,r){switch(nd(r),r.tag){case 3:mi(Ct),$e();break;case 26:case 27:case 5:qo(r);break;case 4:$e();break;case 31:r.memoizedState!==null&&vn(r);break;case 13:vn(r);break;case 19:W(vt);break;case 10:mi(r.type);break;case 22:case 23:vn(r),vd(),s!==null&&W(Ls);break;case 24:mi(Ct)}}function zr(s,r){try{var c=r.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var p=d.next;c=p;do{if((c.tag&s)===s){d=void 0;var y=c.create,k=c.inst;d=y(),k.destroy=d}c=c.next}while(c!==p)}}catch(N){Ge(r,r.return,N)}}function Ji(s,r,c){try{var d=r.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var y=p.next;d=y;do{if((d.tag&s)===s){var k=d.inst,N=k.destroy;if(N!==void 0){k.destroy=void 0,p=r;var U=c,K=N;try{K()}catch(Z){Ge(p,U,Z)}}}d=d.next}while(d!==y)}}catch(Z){Ge(r,r.return,Z)}}function wv(s){var r=s.updateQueue;if(r!==null){var c=s.stateNode;try{yg(r,c)}catch(d){Ge(s,s.return,d)}}}function Mv(s,r,c){c.props=Fs(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(d){Ge(s,r,d)}}function Fr(s,r){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var d=s.stateNode;break;case 30:d=s.stateNode;break;default:d=s.stateNode}typeof c=="function"?s.refCleanup=c(d):c.current=d}}catch(p){Ge(s,r,p)}}function Xn(s,r){var c=s.ref,d=s.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(p){Ge(s,r,p)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(p){Ge(s,r,p)}else c.current=null}function Nv(s){var r=s.type,c=s.memoizedProps,d=s.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break e;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(p){Ge(s,s.return,p)}}function Jd(s,r,c){try{var d=s.stateNode;PE(d,s.type,c,r),d[Zt]=r}catch(p){Ge(s,s.return,p)}}function Dv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ns(s.type)||s.tag===4}function Qd(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Dv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ns(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Xd(s,r,c){var d=s.tag;if(d===5||d===6)s=s.stateNode,r?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,r):(r=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,r.appendChild(s),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=li));else if(d!==4&&(d===27&&ns(s.type)&&(c=s.stateNode,r=null),s=s.child,s!==null))for(Xd(s,r,c),s=s.sibling;s!==null;)Xd(s,r,c),s=s.sibling}function Ac(s,r,c){var d=s.tag;if(d===5||d===6)s=s.stateNode,r?c.insertBefore(s,r):c.appendChild(s);else if(d!==4&&(d===27&&ns(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(Ac(s,r,c),s=s.sibling;s!==null;)Ac(s,r,c),s=s.sibling}function Ov(s){var r=s.stateNode,c=s.memoizedProps;try{for(var d=s.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);zt(r,d,c),r[Lt]=s,r[Zt]=c}catch(y){Ge(s,s.return,y)}}var bi=!1,xt=!1,Wd=!1,Av=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function mE(s,r){if(s=s.containerInfo,bh=el,s=$p(s),$u(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var p=d.anchorOffset,y=d.focusNode;d=d.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var k=0,N=-1,U=-1,K=0,Z=0,ne=s,G=null;t:for(;;){for(var Q;ne!==c||p!==0&&ne.nodeType!==3||(N=k+p),ne!==y||d!==0&&ne.nodeType!==3||(U=k+d),ne.nodeType===3&&(k+=ne.nodeValue.length),(Q=ne.firstChild)!==null;)G=ne,ne=Q;for(;;){if(ne===s)break t;if(G===c&&++K===p&&(N=k),G===y&&++Z===d&&(U=k),(Q=ne.nextSibling)!==null)break;ne=G,G=ne.parentNode}ne=Q}c=N===-1||U===-1?null:{start:N,end:U}}else c=null}c=c||{start:0,end:0}}else c=null;for(Sh={focusedElem:s,selectionRange:c},el=!1,Nt=r;Nt!==null;)if(r=Nt,s=r.child,(r.subtreeFlags&1028)!==0&&s!==null)s.return=r,Nt=s;else for(;Nt!==null;){switch(r=Nt,y=r.alternate,s=r.flags,r.tag){case 0:if((s&4)!==0&&(s=r.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)p=s[c],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&y!==null){s=void 0,c=r,p=y.memoizedProps,y=y.memoizedState,d=c.stateNode;try{var me=Fs(c.type,p);s=d.getSnapshotBeforeUpdate(me,y),d.__reactInternalSnapshotBeforeUpdate=s}catch(Se){Ge(c,c.return,Se)}}break;case 3:if((s&1024)!==0){if(s=r.stateNode.containerInfo,c=s.nodeType,c===9)Th(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Th(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=r.sibling,s!==null){s.return=r.return,Nt=s;break}Nt=r.return}}function jv(s,r,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:ki(s,c),d&4&&zr(5,c);break;case 1:if(ki(s,c),d&4)if(s=c.stateNode,r===null)try{s.componentDidMount()}catch(k){Ge(c,c.return,k)}else{var p=Fs(c.type,r.memoizedProps);r=r.memoizedState;try{s.componentDidUpdate(p,r,s.__reactInternalSnapshotBeforeUpdate)}catch(k){Ge(c,c.return,k)}}d&64&&wv(c),d&512&&Fr(c,c.return);break;case 3:if(ki(s,c),d&64&&(s=c.updateQueue,s!==null)){if(r=null,c.child!==null)switch(c.child.tag){case 27:case 5:r=c.child.stateNode;break;case 1:r=c.child.stateNode}try{yg(s,r)}catch(k){Ge(c,c.return,k)}}break;case 27:r===null&&d&4&&Ov(c);case 26:case 5:ki(s,c),r===null&&d&4&&Nv(c),d&512&&Fr(c,c.return);break;case 12:ki(s,c);break;case 31:ki(s,c),d&4&&Iv(s,c);break;case 13:ki(s,c),d&4&&Uv(s,c),d&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=TE.bind(null,c),qE(s,c))));break;case 22:if(d=c.memoizedState!==null||bi,!d){r=r!==null&&r.memoizedState!==null||xt,p=bi;var y=xt;bi=d,(xt=r)&&!y?Ci(s,c,(c.subtreeFlags&8772)!==0):ki(s,c),bi=p,xt=y}break;case 30:break;default:ki(s,c)}}function Pv(s){var r=s.alternate;r!==null&&(s.alternate=null,Pv(r)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(r=s.stateNode,r!==null&&wu(r)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var ot=null,tn=!1;function Si(s,r,c){for(c=c.child;c!==null;)Lv(s,r,c),c=c.sibling}function Lv(s,r,c){if(hn&&typeof hn.onCommitFiberUnmount=="function")try{hn.onCommitFiberUnmount(dr,c)}catch{}switch(c.tag){case 26:xt||Xn(c,r),Si(s,r,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:xt||Xn(c,r);var d=ot,p=tn;ns(c.type)&&(ot=c.stateNode,tn=!1),Si(s,r,c),Qr(c.stateNode),ot=d,tn=p;break;case 5:xt||Xn(c,r);case 6:if(d=ot,p=tn,ot=null,Si(s,r,c),ot=d,tn=p,ot!==null)if(tn)try{(ot.nodeType===9?ot.body:ot.nodeName==="HTML"?ot.ownerDocument.body:ot).removeChild(c.stateNode)}catch(y){Ge(c,r,y)}else try{ot.removeChild(c.stateNode)}catch(y){Ge(c,r,y)}break;case 18:ot!==null&&(tn?(s=ot,wy(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Ia(s)):wy(ot,c.stateNode));break;case 4:d=ot,p=tn,ot=c.stateNode.containerInfo,tn=!0,Si(s,r,c),ot=d,tn=p;break;case 0:case 11:case 14:case 15:Ji(2,c,r),xt||Ji(4,c,r),Si(s,r,c);break;case 1:xt||(Xn(c,r),d=c.stateNode,typeof d.componentWillUnmount=="function"&&Mv(c,r,d)),Si(s,r,c);break;case 21:Si(s,r,c);break;case 22:xt=(d=xt)||c.memoizedState!==null,Si(s,r,c),xt=d;break;default:Si(s,r,c)}}function Iv(s,r){if(r.memoizedState===null&&(s=r.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Ia(s)}catch(c){Ge(r,r.return,c)}}}function Uv(s,r){if(r.memoizedState===null&&(s=r.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Ia(s)}catch(c){Ge(r,r.return,c)}}function pE(s){switch(s.tag){case 31:case 13:case 19:var r=s.stateNode;return r===null&&(r=s.stateNode=new Av),r;case 22:return s=s.stateNode,r=s._retryCache,r===null&&(r=s._retryCache=new Av),r;default:throw Error(i(435,s.tag))}}function jc(s,r){var c=pE(s);r.forEach(function(d){if(!c.has(d)){c.add(d);var p=EE.bind(null,s,d);d.then(p,p)}})}function nn(s,r){var c=r.deletions;if(c!==null)for(var d=0;d<c.length;d++){var p=c[d],y=s,k=r,N=k;e:for(;N!==null;){switch(N.tag){case 27:if(ns(N.type)){ot=N.stateNode,tn=!1;break e}break;case 5:ot=N.stateNode,tn=!1;break e;case 3:case 4:ot=N.stateNode.containerInfo,tn=!0;break e}N=N.return}if(ot===null)throw Error(i(160));Lv(y,k,p),ot=null,tn=!1,y=p.alternate,y!==null&&(y.return=null),p.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Bv(r,s),r=r.sibling}var Bn=null;function Bv(s,r){var c=s.alternate,d=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:nn(r,s),sn(s),d&4&&(Ji(3,s,s.return),zr(3,s),Ji(5,s,s.return));break;case 1:nn(r,s),sn(s),d&512&&(xt||c===null||Xn(c,c.return)),d&64&&bi&&(s=s.updateQueue,s!==null&&(d=s.callbacks,d!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var p=Bn;if(nn(r,s),sn(s),d&512&&(xt||c===null||Xn(c,c.return)),d&4){var y=c!==null?c.memoizedState:null;if(d=s.memoizedState,c===null)if(d===null)if(s.stateNode===null){e:{d=s.type,c=s.memoizedProps,p=p.ownerDocument||p;t:switch(d){case"title":y=p.getElementsByTagName("title")[0],(!y||y[mr]||y[Lt]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=p.createElement(d),p.head.insertBefore(y,p.querySelector("head > title"))),zt(y,d,c),y[Lt]=s,Mt(y),d=y;break e;case"link":var k=By("link","href",p).get(d+(c.href||""));if(k){for(var N=0;N<k.length;N++)if(y=k[N],y.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&y.getAttribute("rel")===(c.rel==null?null:c.rel)&&y.getAttribute("title")===(c.title==null?null:c.title)&&y.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){k.splice(N,1);break t}}y=p.createElement(d),zt(y,d,c),p.head.appendChild(y);break;case"meta":if(k=By("meta","content",p).get(d+(c.content||""))){for(N=0;N<k.length;N++)if(y=k[N],y.getAttribute("content")===(c.content==null?null:""+c.content)&&y.getAttribute("name")===(c.name==null?null:c.name)&&y.getAttribute("property")===(c.property==null?null:c.property)&&y.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&y.getAttribute("charset")===(c.charSet==null?null:c.charSet)){k.splice(N,1);break t}}y=p.createElement(d),zt(y,d,c),p.head.appendChild(y);break;default:throw Error(i(468,d))}y[Lt]=s,Mt(y),d=y}s.stateNode=d}else zy(p,s.type,s.stateNode);else s.stateNode=Uy(p,d,s.memoizedProps);else y!==d?(y===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):y.count--,d===null?zy(p,s.type,s.stateNode):Uy(p,d,s.memoizedProps)):d===null&&s.stateNode!==null&&Jd(s,s.memoizedProps,c.memoizedProps)}break;case 27:nn(r,s),sn(s),d&512&&(xt||c===null||Xn(c,c.return)),c!==null&&d&4&&Jd(s,s.memoizedProps,c.memoizedProps);break;case 5:if(nn(r,s),sn(s),d&512&&(xt||c===null||Xn(c,c.return)),s.flags&32){p=s.stateNode;try{ra(p,"")}catch(me){Ge(s,s.return,me)}}d&4&&s.stateNode!=null&&(p=s.memoizedProps,Jd(s,p,c!==null?c.memoizedProps:p)),d&1024&&(Wd=!0);break;case 6:if(nn(r,s),sn(s),d&4){if(s.stateNode===null)throw Error(i(162));d=s.memoizedProps,c=s.stateNode;try{c.nodeValue=d}catch(me){Ge(s,s.return,me)}}break;case 3:if(Qc=null,p=Bn,Bn=Yc(r.containerInfo),nn(r,s),Bn=p,sn(s),d&4&&c!==null&&c.memoizedState.isDehydrated)try{Ia(r.containerInfo)}catch(me){Ge(s,s.return,me)}Wd&&(Wd=!1,zv(s));break;case 4:d=Bn,Bn=Yc(s.stateNode.containerInfo),nn(r,s),sn(s),Bn=d;break;case 12:nn(r,s),sn(s);break;case 31:nn(r,s),sn(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,jc(s,d)));break;case 13:nn(r,s),sn(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Lc=dn()),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,jc(s,d)));break;case 22:p=s.memoizedState!==null;var U=c!==null&&c.memoizedState!==null,K=bi,Z=xt;if(bi=K||p,xt=Z||U,nn(r,s),xt=Z,bi=K,sn(s),d&8192)e:for(r=s.stateNode,r._visibility=p?r._visibility&-2:r._visibility|1,p&&(c===null||U||bi||xt||Vs(s)),c=null,r=s;;){if(r.tag===5||r.tag===26){if(c===null){U=c=r;try{if(y=U.stateNode,p)k=y.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{N=U.stateNode;var ne=U.memoizedProps.style,G=ne!=null&&ne.hasOwnProperty("display")?ne.display:null;N.style.display=G==null||typeof G=="boolean"?"":(""+G).trim()}}catch(me){Ge(U,U.return,me)}}}else if(r.tag===6){if(c===null){U=r;try{U.stateNode.nodeValue=p?"":U.memoizedProps}catch(me){Ge(U,U.return,me)}}}else if(r.tag===18){if(c===null){U=r;try{var Q=U.stateNode;p?My(Q,!0):My(U.stateNode,!1)}catch(me){Ge(U,U.return,me)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===s)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;c===r&&(c=null),r=r.return}c===r&&(c=null),r.sibling.return=r.return,r=r.sibling}d&4&&(d=s.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,jc(s,c))));break;case 19:nn(r,s),sn(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,jc(s,d)));break;case 30:break;case 21:break;default:nn(r,s),sn(s)}}function sn(s){var r=s.flags;if(r&2){try{for(var c,d=s.return;d!==null;){if(Dv(d)){c=d;break}d=d.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var p=c.stateNode,y=Qd(s);Ac(s,y,p);break;case 5:var k=c.stateNode;c.flags&32&&(ra(k,""),c.flags&=-33);var N=Qd(s);Ac(s,N,k);break;case 3:case 4:var U=c.stateNode.containerInfo,K=Qd(s);Xd(s,K,U);break;default:throw Error(i(161))}}catch(Z){Ge(s,s.return,Z)}s.flags&=-3}r&4096&&(s.flags&=-4097)}function zv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var r=s;zv(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),s=s.sibling}}function ki(s,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)jv(s,r.alternate,r),r=r.sibling}function Vs(s){for(s=s.child;s!==null;){var r=s;switch(r.tag){case 0:case 11:case 14:case 15:Ji(4,r,r.return),Vs(r);break;case 1:Xn(r,r.return);var c=r.stateNode;typeof c.componentWillUnmount=="function"&&Mv(r,r.return,c),Vs(r);break;case 27:Qr(r.stateNode);case 26:case 5:Xn(r,r.return),Vs(r);break;case 22:r.memoizedState===null&&Vs(r);break;case 30:Vs(r);break;default:Vs(r)}s=s.sibling}}function Ci(s,r,c){for(c=c&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var d=r.alternate,p=s,y=r,k=y.flags;switch(y.tag){case 0:case 11:case 15:Ci(p,y,c),zr(4,y);break;case 1:if(Ci(p,y,c),d=y,p=d.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(K){Ge(d,d.return,K)}if(d=y,p=d.updateQueue,p!==null){var N=d.stateNode;try{var U=p.shared.hiddenCallbacks;if(U!==null)for(p.shared.hiddenCallbacks=null,p=0;p<U.length;p++)vg(U[p],N)}catch(K){Ge(d,d.return,K)}}c&&k&64&&wv(y),Fr(y,y.return);break;case 27:Ov(y);case 26:case 5:Ci(p,y,c),c&&d===null&&k&4&&Nv(y),Fr(y,y.return);break;case 12:Ci(p,y,c);break;case 31:Ci(p,y,c),c&&k&4&&Iv(p,y);break;case 13:Ci(p,y,c),c&&k&4&&Uv(p,y);break;case 22:y.memoizedState===null&&Ci(p,y,c),Fr(y,y.return);break;case 30:break;default:Ci(p,y,c)}r=r.sibling}}function Zd(s,r){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(s=r.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&_r(c))}function eh(s,r){s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&_r(s))}function zn(s,r,c,d){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Fv(s,r,c,d),r=r.sibling}function Fv(s,r,c,d){var p=r.flags;switch(r.tag){case 0:case 11:case 15:zn(s,r,c,d),p&2048&&zr(9,r);break;case 1:zn(s,r,c,d);break;case 3:zn(s,r,c,d),p&2048&&(s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&_r(s)));break;case 12:if(p&2048){zn(s,r,c,d),s=r.stateNode;try{var y=r.memoizedProps,k=y.id,N=y.onPostCommit;typeof N=="function"&&N(k,r.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(U){Ge(r,r.return,U)}}else zn(s,r,c,d);break;case 31:zn(s,r,c,d);break;case 13:zn(s,r,c,d);break;case 23:break;case 22:y=r.stateNode,k=r.alternate,r.memoizedState!==null?y._visibility&2?zn(s,r,c,d):Vr(s,r):y._visibility&2?zn(s,r,c,d):(y._visibility|=2,Ra(s,r,c,d,(r.subtreeFlags&10256)!==0||!1)),p&2048&&Zd(k,r);break;case 24:zn(s,r,c,d),p&2048&&eh(r.alternate,r);break;default:zn(s,r,c,d)}}function Ra(s,r,c,d,p){for(p=p&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var y=s,k=r,N=c,U=d,K=k.flags;switch(k.tag){case 0:case 11:case 15:Ra(y,k,N,U,p),zr(8,k);break;case 23:break;case 22:var Z=k.stateNode;k.memoizedState!==null?Z._visibility&2?Ra(y,k,N,U,p):Vr(y,k):(Z._visibility|=2,Ra(y,k,N,U,p)),p&&K&2048&&Zd(k.alternate,k);break;case 24:Ra(y,k,N,U,p),p&&K&2048&&eh(k.alternate,k);break;default:Ra(y,k,N,U,p)}r=r.sibling}}function Vr(s,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var c=s,d=r,p=d.flags;switch(d.tag){case 22:Vr(c,d),p&2048&&Zd(d.alternate,d);break;case 24:Vr(c,d),p&2048&&eh(d.alternate,d);break;default:Vr(c,d)}r=r.sibling}}var qr=8192;function _a(s,r,c){if(s.subtreeFlags&qr)for(s=s.child;s!==null;)Vv(s,r,c),s=s.sibling}function Vv(s,r,c){switch(s.tag){case 26:_a(s,r,c),s.flags&qr&&s.memoizedState!==null&&tx(c,Bn,s.memoizedState,s.memoizedProps);break;case 5:_a(s,r,c);break;case 3:case 4:var d=Bn;Bn=Yc(s.stateNode.containerInfo),_a(s,r,c),Bn=d;break;case 22:s.memoizedState===null&&(d=s.alternate,d!==null&&d.memoizedState!==null?(d=qr,qr=16777216,_a(s,r,c),qr=d):_a(s,r,c));break;default:_a(s,r,c)}}function qv(s){var r=s.alternate;if(r!==null&&(s=r.child,s!==null)){r.child=null;do r=s.sibling,s.sibling=null,s=r;while(s!==null)}}function Hr(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var d=r[c];Nt=d,$v(d,s)}qv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Hv(s),s=s.sibling}function Hv(s){switch(s.tag){case 0:case 11:case 15:Hr(s),s.flags&2048&&Ji(9,s,s.return);break;case 3:Hr(s);break;case 12:Hr(s);break;case 22:var r=s.stateNode;s.memoizedState!==null&&r._visibility&2&&(s.return===null||s.return.tag!==13)?(r._visibility&=-3,Pc(s)):Hr(s);break;default:Hr(s)}}function Pc(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var d=r[c];Nt=d,$v(d,s)}qv(s)}for(s=s.child;s!==null;){switch(r=s,r.tag){case 0:case 11:case 15:Ji(8,r,r.return),Pc(r);break;case 22:c=r.stateNode,c._visibility&2&&(c._visibility&=-3,Pc(r));break;default:Pc(r)}s=s.sibling}}function $v(s,r){for(;Nt!==null;){var c=Nt;switch(c.tag){case 0:case 11:case 15:Ji(8,c,r);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:_r(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,Nt=d;else e:for(c=s;Nt!==null;){d=Nt;var p=d.sibling,y=d.return;if(Pv(d),d===c){Nt=null;break e}if(p!==null){p.return=y,Nt=p;break e}Nt=y}}}var gE={getCacheForType:function(s){var r=Ut(Ct),c=r.data.get(s);return c===void 0&&(c=s(),r.data.set(s,c)),c},cacheSignal:function(){return Ut(Ct).controller.signal}},vE=typeof WeakMap=="function"?WeakMap:Map,He=0,tt=null,Ae=null,Ie=0,Ke=0,yn=null,Qi=!1,wa=!1,th=!1,Ti=0,ht=0,Xi=0,qs=0,nh=0,bn=0,Ma=0,$r=null,an=null,ih=!1,Lc=0,Kv=0,Ic=1/0,Uc=null,Wi=null,_t=0,Zi=null,Na=null,Ei=0,sh=0,ah=null,Gv=null,Kr=0,rh=null;function Sn(){return(He&2)!==0&&Ie!==0?Ie&-Ie:H.T!==null?hh():lp()}function Yv(){if(bn===0)if((Ie&536870912)===0||ze){var s=Ko;Ko<<=1,(Ko&3932160)===0&&(Ko=262144),bn=s}else bn=536870912;return s=gn.current,s!==null&&(s.flags|=32),bn}function rn(s,r,c){(s===tt&&(Ke===2||Ke===9)||s.cancelPendingCommit!==null)&&(Da(s,0),es(s,Ie,bn,!1)),fr(s,c),((He&2)===0||s!==tt)&&(s===tt&&((He&2)===0&&(qs|=c),ht===4&&es(s,Ie,bn,!1)),Wn(s))}function Jv(s,r,c){if((He&6)!==0)throw Error(i(327));var d=!c&&(r&127)===0&&(r&s.expiredLanes)===0||hr(s,r),p=d?SE(s,r):ch(s,r,!0),y=d;do{if(p===0){wa&&!d&&es(s,r,0,!1);break}else{if(c=s.current.alternate,y&&!yE(c)){p=ch(s,r,!1),y=!1;continue}if(p===2){if(y=r,s.errorRecoveryDisabledLanes&y)var k=0;else k=s.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){r=k;e:{var N=s;p=$r;var U=N.current.memoizedState.isDehydrated;if(U&&(Da(N,k).flags|=256),k=ch(N,k,!1),k!==2){if(th&&!U){N.errorRecoveryDisabledLanes|=y,qs|=y,p=4;break e}y=an,an=p,y!==null&&(an===null?an=y:an.push.apply(an,y))}p=k}if(y=!1,p!==2)continue}}if(p===1){Da(s,0),es(s,r,0,!0);break}e:{switch(d=s,y=p,y){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:es(d,r,bn,!Qi);break e;case 2:an=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(p=Lc+300-dn(),10<p)){if(es(d,r,bn,!Qi),Yo(d,0,!0)!==0)break e;Ei=r,d.timeoutHandle=Ry(Qv.bind(null,d,c,an,Uc,ih,r,bn,qs,Ma,Qi,y,"Throttled",-0,0),p);break e}Qv(d,c,an,Uc,ih,r,bn,qs,Ma,Qi,y,null,-0,0)}}break}while(!0);Wn(s)}function Qv(s,r,c,d,p,y,k,N,U,K,Z,ne,G,Q){if(s.timeoutHandle=-1,ne=r.subtreeFlags,ne&8192||(ne&16785408)===16785408){ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:li},Vv(r,y,ne);var me=(y&62914560)===y?Lc-dn():(y&4194048)===y?Kv-dn():0;if(me=nx(ne,me),me!==null){Ei=y,s.cancelPendingCommit=me(sy.bind(null,s,r,y,c,d,p,k,N,U,Z,ne,null,G,Q)),es(s,y,k,!K);return}}sy(s,r,y,c,d,p,k,N,U)}function yE(s){for(var r=s;;){var c=r.tag;if((c===0||c===11||c===15)&&r.flags&16384&&(c=r.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var p=c[d],y=p.getSnapshot;p=p.value;try{if(!mn(y(),p))return!1}catch{return!1}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function es(s,r,c,d){r&=~nh,r&=~qs,s.suspendedLanes|=r,s.pingedLanes&=~r,d&&(s.warmLanes|=r),d=s.expirationTimes;for(var p=r;0<p;){var y=31-fn(p),k=1<<y;d[y]=-1,p&=~k}c!==0&&rp(s,c,r)}function Bc(){return(He&6)===0?(Gr(0),!1):!0}function oh(){if(Ae!==null){if(Ke===0)var s=Ae.return;else s=Ae,fi=js=null,Td(s),ka=null,Mr=0,s=Ae;for(;s!==null;)_v(s.alternate,s),s=s.return;Ae=null}}function Da(s,r){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,UE(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),Ei=0,oh(),tt=s,Ae=c=di(s.current,null),Ie=r,Ke=0,yn=null,Qi=!1,wa=hr(s,r),th=!1,Ma=bn=nh=qs=Xi=ht=0,an=$r=null,ih=!1,(r&8)!==0&&(r|=r&32);var d=s.entangledLanes;if(d!==0)for(s=s.entanglements,d&=r;0<d;){var p=31-fn(d),y=1<<p;r|=s[p],d&=~y}return Ti=r,rc(),c}function Xv(s,r){_e=null,H.H=Ir,r===Sa||r===mc?(r=fg(),Ke=3):r===dd?(r=fg(),Ke=4):Ke=r===Bd?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,yn=r,Ae===null&&(ht=1,wc(s,_n(r,s.current)))}function Wv(){var s=gn.current;return s===null?!0:(Ie&4194048)===Ie?Dn===null:(Ie&62914560)===Ie||(Ie&536870912)!==0?s===Dn:!1}function Zv(){var s=H.H;return H.H=Ir,s===null?Ir:s}function ey(){var s=H.A;return H.A=gE,s}function zc(){ht=4,Qi||(Ie&4194048)!==Ie&&gn.current!==null||(wa=!0),(Xi&134217727)===0&&(qs&134217727)===0||tt===null||es(tt,Ie,bn,!1)}function ch(s,r,c){var d=He;He|=2;var p=Zv(),y=ey();(tt!==s||Ie!==r)&&(Uc=null,Da(s,r)),r=!1;var k=ht;e:do try{if(Ke!==0&&Ae!==null){var N=Ae,U=yn;switch(Ke){case 8:oh(),k=6;break e;case 3:case 2:case 9:case 6:gn.current===null&&(r=!0);var K=Ke;if(Ke=0,yn=null,Oa(s,N,U,K),c&&wa){k=0;break e}break;default:K=Ke,Ke=0,yn=null,Oa(s,N,U,K)}}bE(),k=ht;break}catch(Z){Xv(s,Z)}while(!0);return r&&s.shellSuspendCounter++,fi=js=null,He=d,H.H=p,H.A=y,Ae===null&&(tt=null,Ie=0,rc()),k}function bE(){for(;Ae!==null;)ty(Ae)}function SE(s,r){var c=He;He|=2;var d=Zv(),p=ey();tt!==s||Ie!==r?(Uc=null,Ic=dn()+500,Da(s,r)):wa=hr(s,r);e:do try{if(Ke!==0&&Ae!==null){r=Ae;var y=yn;t:switch(Ke){case 1:Ke=0,yn=null,Oa(s,r,y,1);break;case 2:case 9:if(dg(y)){Ke=0,yn=null,ny(r);break}r=function(){Ke!==2&&Ke!==9||tt!==s||(Ke=7),Wn(s)},y.then(r,r);break e;case 3:Ke=7;break e;case 4:Ke=5;break e;case 7:dg(y)?(Ke=0,yn=null,ny(r)):(Ke=0,yn=null,Oa(s,r,y,7));break;case 5:var k=null;switch(Ae.tag){case 26:k=Ae.memoizedState;case 5:case 27:var N=Ae;if(k?Fy(k):N.stateNode.complete){Ke=0,yn=null;var U=N.sibling;if(U!==null)Ae=U;else{var K=N.return;K!==null?(Ae=K,Fc(K)):Ae=null}break t}}Ke=0,yn=null,Oa(s,r,y,5);break;case 6:Ke=0,yn=null,Oa(s,r,y,6);break;case 8:oh(),ht=6;break e;default:throw Error(i(462))}}kE();break}catch(Z){Xv(s,Z)}while(!0);return fi=js=null,H.H=d,H.A=p,He=c,Ae!==null?0:(tt=null,Ie=0,rc(),ht)}function kE(){for(;Ae!==null&&!HT();)ty(Ae)}function ty(s){var r=xv(s.alternate,s,Ti);s.memoizedProps=s.pendingProps,r===null?Fc(s):Ae=r}function ny(s){var r=s,c=r.alternate;switch(r.tag){case 15:case 0:r=bv(c,r,r.pendingProps,r.type,void 0,Ie);break;case 11:r=bv(c,r,r.pendingProps,r.type.render,r.ref,Ie);break;case 5:Td(r);default:_v(c,r),r=Ae=eg(r,Ti),r=xv(c,r,Ti)}s.memoizedProps=s.pendingProps,r===null?Fc(s):Ae=r}function Oa(s,r,c,d){fi=js=null,Td(r),ka=null,Mr=0;var p=r.return;try{if(lE(s,p,r,c,Ie)){ht=1,wc(s,_n(c,s.current)),Ae=null;return}}catch(y){if(p!==null)throw Ae=p,y;ht=1,wc(s,_n(c,s.current)),Ae=null;return}r.flags&32768?(ze||d===1?s=!0:wa||(Ie&536870912)!==0?s=!1:(Qi=s=!0,(d===2||d===9||d===3||d===6)&&(d=gn.current,d!==null&&d.tag===13&&(d.flags|=16384))),iy(r,s)):Fc(r)}function Fc(s){var r=s;do{if((r.flags&32768)!==0){iy(r,Qi);return}s=r.return;var c=hE(r.alternate,r,Ti);if(c!==null){Ae=c;return}if(r=r.sibling,r!==null){Ae=r;return}Ae=r=s}while(r!==null);ht===0&&(ht=5)}function iy(s,r){do{var c=fE(s.alternate,s);if(c!==null){c.flags&=32767,Ae=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!r&&(s=s.sibling,s!==null)){Ae=s;return}Ae=s=c}while(s!==null);ht=6,Ae=null}function sy(s,r,c,d,p,y,k,N,U){s.cancelPendingCommit=null;do Vc();while(_t!==0);if((He&6)!==0)throw Error(i(327));if(r!==null){if(r===s.current)throw Error(i(177));if(y=r.lanes|r.childLanes,y|=Qu,e1(s,c,y,k,N,U),s===tt&&(Ae=tt=null,Ie=0),Na=r,Zi=s,Ei=c,sh=y,ah=p,Gv=d,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,xE(Ho,function(){return ly(),null})):(s.callbackNode=null,s.callbackPriority=0),d=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||d){d=H.T,H.T=null,p=ae.p,ae.p=2,k=He,He|=4;try{mE(s,r,c)}finally{He=k,ae.p=p,H.T=d}}_t=1,ay(),ry(),oy()}}function ay(){if(_t===1){_t=0;var s=Zi,r=Na,c=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||c){c=H.T,H.T=null;var d=ae.p;ae.p=2;var p=He;He|=4;try{Bv(r,s);var y=Sh,k=$p(s.containerInfo),N=y.focusedElem,U=y.selectionRange;if(k!==N&&N&&N.ownerDocument&&Hp(N.ownerDocument.documentElement,N)){if(U!==null&&$u(N)){var K=U.start,Z=U.end;if(Z===void 0&&(Z=K),"selectionStart"in N)N.selectionStart=K,N.selectionEnd=Math.min(Z,N.value.length);else{var ne=N.ownerDocument||document,G=ne&&ne.defaultView||window;if(G.getSelection){var Q=G.getSelection(),me=N.textContent.length,Se=Math.min(U.start,me),We=U.end===void 0?Se:Math.min(U.end,me);!Q.extend&&Se>We&&(k=We,We=Se,Se=k);var V=qp(N,Se),z=qp(N,We);if(V&&z&&(Q.rangeCount!==1||Q.anchorNode!==V.node||Q.anchorOffset!==V.offset||Q.focusNode!==z.node||Q.focusOffset!==z.offset)){var $=ne.createRange();$.setStart(V.node,V.offset),Q.removeAllRanges(),Se>We?(Q.addRange($),Q.extend(z.node,z.offset)):($.setEnd(z.node,z.offset),Q.addRange($))}}}}for(ne=[],Q=N;Q=Q.parentNode;)Q.nodeType===1&&ne.push({element:Q,left:Q.scrollLeft,top:Q.scrollTop});for(typeof N.focus=="function"&&N.focus(),N=0;N<ne.length;N++){var te=ne[N];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}el=!!bh,Sh=bh=null}finally{He=p,ae.p=d,H.T=c}}s.current=r,_t=2}}function ry(){if(_t===2){_t=0;var s=Zi,r=Na,c=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||c){c=H.T,H.T=null;var d=ae.p;ae.p=2;var p=He;He|=4;try{jv(s,r.alternate,r)}finally{He=p,ae.p=d,H.T=c}}_t=3}}function oy(){if(_t===4||_t===3){_t=0,$T();var s=Zi,r=Na,c=Ei,d=Gv;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?_t=5:(_t=0,Na=Zi=null,cy(s,s.pendingLanes));var p=s.pendingLanes;if(p===0&&(Wi=null),Ru(c),r=r.stateNode,hn&&typeof hn.onCommitFiberRoot=="function")try{hn.onCommitFiberRoot(dr,r,void 0,(r.current.flags&128)===128)}catch{}if(d!==null){r=H.T,p=ae.p,ae.p=2,H.T=null;try{for(var y=s.onRecoverableError,k=0;k<d.length;k++){var N=d[k];y(N.value,{componentStack:N.stack})}}finally{H.T=r,ae.p=p}}(Ei&3)!==0&&Vc(),Wn(s),p=s.pendingLanes,(c&261930)!==0&&(p&42)!==0?s===rh?Kr++:(Kr=0,rh=s):Kr=0,Gr(0)}}function cy(s,r){(s.pooledCacheLanes&=r)===0&&(r=s.pooledCache,r!=null&&(s.pooledCache=null,_r(r)))}function Vc(){return ay(),ry(),oy(),ly()}function ly(){if(_t!==5)return!1;var s=Zi,r=sh;sh=0;var c=Ru(Ei),d=H.T,p=ae.p;try{ae.p=32>c?32:c,H.T=null,c=ah,ah=null;var y=Zi,k=Ei;if(_t=0,Na=Zi=null,Ei=0,(He&6)!==0)throw Error(i(331));var N=He;if(He|=4,Hv(y.current),Fv(y,y.current,k,c),He=N,Gr(0,!1),hn&&typeof hn.onPostCommitFiberRoot=="function")try{hn.onPostCommitFiberRoot(dr,y)}catch{}return!0}finally{ae.p=p,H.T=d,cy(s,r)}}function uy(s,r,c){r=_n(c,r),r=Ud(s.stateNode,r,2),s=Ki(s,r,2),s!==null&&(fr(s,2),Wn(s))}function Ge(s,r,c){if(s.tag===3)uy(s,s,c);else for(;r!==null;){if(r.tag===3){uy(r,s,c);break}else if(r.tag===1){var d=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Wi===null||!Wi.has(d))){s=_n(c,s),c=dv(2),d=Ki(r,c,2),d!==null&&(hv(c,d,r,s),fr(d,2),Wn(d));break}}r=r.return}}function lh(s,r,c){var d=s.pingCache;if(d===null){d=s.pingCache=new vE;var p=new Set;d.set(r,p)}else p=d.get(r),p===void 0&&(p=new Set,d.set(r,p));p.has(c)||(th=!0,p.add(c),s=CE.bind(null,s,r,c),r.then(s,s))}function CE(s,r,c){var d=s.pingCache;d!==null&&d.delete(r),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,tt===s&&(Ie&c)===c&&(ht===4||ht===3&&(Ie&62914560)===Ie&&300>dn()-Lc?(He&2)===0&&Da(s,0):nh|=c,Ma===Ie&&(Ma=0)),Wn(s)}function dy(s,r){r===0&&(r=ap()),s=Ds(s,r),s!==null&&(fr(s,r),Wn(s))}function TE(s){var r=s.memoizedState,c=0;r!==null&&(c=r.retryLane),dy(s,c)}function EE(s,r){var c=0;switch(s.tag){case 31:case 13:var d=s.stateNode,p=s.memoizedState;p!==null&&(c=p.retryLane);break;case 19:d=s.stateNode;break;case 22:d=s.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(r),dy(s,c)}function xE(s,r){return Cu(s,r)}var qc=null,Aa=null,uh=!1,Hc=!1,dh=!1,ts=0;function Wn(s){s!==Aa&&s.next===null&&(Aa===null?qc=Aa=s:Aa=Aa.next=s),Hc=!0,uh||(uh=!0,_E())}function Gr(s,r){if(!dh&&Hc){dh=!0;do for(var c=!1,d=qc;d!==null;){if(s!==0){var p=d.pendingLanes;if(p===0)var y=0;else{var k=d.suspendedLanes,N=d.pingedLanes;y=(1<<31-fn(42|s)+1)-1,y&=p&~(k&~N),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(c=!0,py(d,y))}else y=Ie,y=Yo(d,d===tt?y:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(y&3)===0||hr(d,y)||(c=!0,py(d,y));d=d.next}while(c);dh=!1}}function RE(){hy()}function hy(){Hc=uh=!1;var s=0;ts!==0&&IE()&&(s=ts);for(var r=dn(),c=null,d=qc;d!==null;){var p=d.next,y=fy(d,r);y===0?(d.next=null,c===null?qc=p:c.next=p,p===null&&(Aa=c)):(c=d,(s!==0||(y&3)!==0)&&(Hc=!0)),d=p}_t!==0&&_t!==5||Gr(s),ts!==0&&(ts=0)}function fy(s,r){for(var c=s.suspendedLanes,d=s.pingedLanes,p=s.expirationTimes,y=s.pendingLanes&-62914561;0<y;){var k=31-fn(y),N=1<<k,U=p[k];U===-1?((N&c)===0||(N&d)!==0)&&(p[k]=ZT(N,r)):U<=r&&(s.expiredLanes|=N),y&=~N}if(r=tt,c=Ie,c=Yo(s,s===r?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d=s.callbackNode,c===0||s===r&&(Ke===2||Ke===9)||s.cancelPendingCommit!==null)return d!==null&&d!==null&&Tu(d),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||hr(s,c)){if(r=c&-c,r===s.callbackPriority)return r;switch(d!==null&&Tu(d),Ru(c)){case 2:case 8:c=ip;break;case 32:c=Ho;break;case 268435456:c=sp;break;default:c=Ho}return d=my.bind(null,s),c=Cu(c,d),s.callbackPriority=r,s.callbackNode=c,r}return d!==null&&d!==null&&Tu(d),s.callbackPriority=2,s.callbackNode=null,2}function my(s,r){if(_t!==0&&_t!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Vc()&&s.callbackNode!==c)return null;var d=Ie;return d=Yo(s,s===tt?d:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d===0?null:(Jv(s,d,r),fy(s,dn()),s.callbackNode!=null&&s.callbackNode===c?my.bind(null,s):null)}function py(s,r){if(Vc())return null;Jv(s,r,!0)}function _E(){BE(function(){(He&6)!==0?Cu(np,RE):hy()})}function hh(){if(ts===0){var s=ya;s===0&&(s=$o,$o<<=1,($o&261888)===0&&($o=256)),ts=s}return ts}function gy(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Wo(""+s)}function vy(s,r){var c=r.ownerDocument.createElement("input");return c.name=r.name,c.value=r.value,s.id&&c.setAttribute("form",s.id),r.parentNode.insertBefore(c,r),s=new FormData(s),c.parentNode.removeChild(c),s}function wE(s,r,c,d,p){if(r==="submit"&&c&&c.stateNode===p){var y=gy((p[Zt]||null).action),k=d.submitter;k&&(r=(r=k[Zt]||null)?gy(r.formAction):k.getAttribute("formAction"),r!==null&&(y=r,k=null));var N=new nc("action","action",null,d,p);s.push({event:N,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(ts!==0){var U=k?vy(p,k):new FormData(p);Od(c,{pending:!0,data:U,method:p.method,action:y},null,U)}}else typeof y=="function"&&(N.preventDefault(),U=k?vy(p,k):new FormData(p),Od(c,{pending:!0,data:U,method:p.method,action:y},y,U))},currentTarget:p}]})}}for(var fh=0;fh<Ju.length;fh++){var mh=Ju[fh],ME=mh.toLowerCase(),NE=mh[0].toUpperCase()+mh.slice(1);Un(ME,"on"+NE)}Un(Yp,"onAnimationEnd"),Un(Jp,"onAnimationIteration"),Un(Qp,"onAnimationStart"),Un("dblclick","onDoubleClick"),Un("focusin","onFocus"),Un("focusout","onBlur"),Un(K1,"onTransitionRun"),Un(G1,"onTransitionStart"),Un(Y1,"onTransitionCancel"),Un(Xp,"onTransitionEnd"),sa("onMouseEnter",["mouseout","mouseover"]),sa("onMouseLeave",["mouseout","mouseover"]),sa("onPointerEnter",["pointerout","pointerover"]),sa("onPointerLeave",["pointerout","pointerover"]),_s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),_s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),_s("onBeforeInput",["compositionend","keypress","textInput","paste"]),_s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),_s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),_s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),DE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yr));function yy(s,r){r=(r&4)!==0;for(var c=0;c<s.length;c++){var d=s[c],p=d.event;d=d.listeners;e:{var y=void 0;if(r)for(var k=d.length-1;0<=k;k--){var N=d[k],U=N.instance,K=N.currentTarget;if(N=N.listener,U!==y&&p.isPropagationStopped())break e;y=N,p.currentTarget=K;try{y(p)}catch(Z){ac(Z)}p.currentTarget=null,y=U}else for(k=0;k<d.length;k++){if(N=d[k],U=N.instance,K=N.currentTarget,N=N.listener,U!==y&&p.isPropagationStopped())break e;y=N,p.currentTarget=K;try{y(p)}catch(Z){ac(Z)}p.currentTarget=null,y=U}}}}function je(s,r){var c=r[_u];c===void 0&&(c=r[_u]=new Set);var d=s+"__bubble";c.has(d)||(by(r,s,2,!1),c.add(d))}function ph(s,r,c){var d=0;r&&(d|=4),by(c,s,d,r)}var $c="_reactListening"+Math.random().toString(36).slice(2);function gh(s){if(!s[$c]){s[$c]=!0,hp.forEach(function(c){c!=="selectionchange"&&(DE.has(c)||ph(c,!1,s),ph(c,!0,s))});var r=s.nodeType===9?s:s.ownerDocument;r===null||r[$c]||(r[$c]=!0,ph("selectionchange",!1,r))}}function by(s,r,c,d){switch(Yy(r)){case 2:var p=ax;break;case 8:p=rx;break;default:p=Dh}c=p.bind(null,r,c,s),p=void 0,!Lu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),d?p!==void 0?s.addEventListener(r,c,{capture:!0,passive:p}):s.addEventListener(r,c,!0):p!==void 0?s.addEventListener(r,c,{passive:p}):s.addEventListener(r,c,!1)}function vh(s,r,c,d,p){var y=d;if((r&1)===0&&(r&2)===0&&d!==null)e:for(;;){if(d===null)return;var k=d.tag;if(k===3||k===4){var N=d.stateNode.containerInfo;if(N===p)break;if(k===4)for(k=d.return;k!==null;){var U=k.tag;if((U===3||U===4)&&k.stateNode.containerInfo===p)return;k=k.return}for(;N!==null;){if(k=ta(N),k===null)return;if(U=k.tag,U===5||U===6||U===26||U===27){d=y=k;continue e}N=N.parentNode}}d=d.return}Ep(function(){var K=y,Z=ju(c),ne=[];e:{var G=Wp.get(s);if(G!==void 0){var Q=nc,me=s;switch(s){case"keypress":if(ec(c)===0)break e;case"keydown":case"keyup":Q=E1;break;case"focusin":me="focus",Q=zu;break;case"focusout":me="blur",Q=zu;break;case"beforeblur":case"afterblur":Q=zu;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Q=_p;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Q=h1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Q=_1;break;case Yp:case Jp:case Qp:Q=p1;break;case Xp:Q=M1;break;case"scroll":case"scrollend":Q=u1;break;case"wheel":Q=D1;break;case"copy":case"cut":case"paste":Q=v1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Q=Mp;break;case"toggle":case"beforetoggle":Q=A1}var Se=(r&4)!==0,We=!Se&&(s==="scroll"||s==="scrollend"),V=Se?G!==null?G+"Capture":null:G;Se=[];for(var z=K,$;z!==null;){var te=z;if($=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||$===null||V===null||(te=gr(z,V),te!=null&&Se.push(Jr(z,te,$))),We)break;z=z.return}0<Se.length&&(G=new Q(G,me,null,c,Z),ne.push({event:G,listeners:Se}))}}if((r&7)===0){e:{if(G=s==="mouseover"||s==="pointerover",Q=s==="mouseout"||s==="pointerout",G&&c!==Au&&(me=c.relatedTarget||c.fromElement)&&(ta(me)||me[ea]))break e;if((Q||G)&&(G=Z.window===Z?Z:(G=Z.ownerDocument)?G.defaultView||G.parentWindow:window,Q?(me=c.relatedTarget||c.toElement,Q=K,me=me?ta(me):null,me!==null&&(We=o(me),Se=me.tag,me!==We||Se!==5&&Se!==27&&Se!==6)&&(me=null)):(Q=null,me=K),Q!==me)){if(Se=_p,te="onMouseLeave",V="onMouseEnter",z="mouse",(s==="pointerout"||s==="pointerover")&&(Se=Mp,te="onPointerLeave",V="onPointerEnter",z="pointer"),We=Q==null?G:pr(Q),$=me==null?G:pr(me),G=new Se(te,z+"leave",Q,c,Z),G.target=We,G.relatedTarget=$,te=null,ta(Z)===K&&(Se=new Se(V,z+"enter",me,c,Z),Se.target=$,Se.relatedTarget=We,te=Se),We=te,Q&&me)t:{for(Se=OE,V=Q,z=me,$=0,te=V;te;te=Se(te))$++;te=0;for(var ve=z;ve;ve=Se(ve))te++;for(;0<$-te;)V=Se(V),$--;for(;0<te-$;)z=Se(z),te--;for(;$--;){if(V===z||z!==null&&V===z.alternate){Se=V;break t}V=Se(V),z=Se(z)}Se=null}else Se=null;Q!==null&&Sy(ne,G,Q,Se,!1),me!==null&&We!==null&&Sy(ne,We,me,Se,!0)}}e:{if(G=K?pr(K):window,Q=G.nodeName&&G.nodeName.toLowerCase(),Q==="select"||Q==="input"&&G.type==="file")var Ve=Ip;else if(Pp(G))if(Up)Ve=q1;else{Ve=F1;var pe=z1}else Q=G.nodeName,!Q||Q.toLowerCase()!=="input"||G.type!=="checkbox"&&G.type!=="radio"?K&&Ou(K.elementType)&&(Ve=Ip):Ve=V1;if(Ve&&(Ve=Ve(s,K))){Lp(ne,Ve,c,Z);break e}pe&&pe(s,G,K),s==="focusout"&&K&&G.type==="number"&&K.memoizedProps.value!=null&&Du(G,"number",G.value)}switch(pe=K?pr(K):window,s){case"focusin":(Pp(pe)||pe.contentEditable==="true")&&(ua=pe,Ku=K,Er=null);break;case"focusout":Er=Ku=ua=null;break;case"mousedown":Gu=!0;break;case"contextmenu":case"mouseup":case"dragend":Gu=!1,Kp(ne,c,Z);break;case"selectionchange":if($1)break;case"keydown":case"keyup":Kp(ne,c,Z)}var we;if(Vu)e:{switch(s){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else la?Ap(s,c)&&(Ue="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(Ue="onCompositionStart");Ue&&(Np&&c.locale!=="ko"&&(la||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&la&&(we=xp()):(Bi=Z,Iu="value"in Bi?Bi.value:Bi.textContent,la=!0)),pe=Kc(K,Ue),0<pe.length&&(Ue=new wp(Ue,s,null,c,Z),ne.push({event:Ue,listeners:pe}),we?Ue.data=we:(we=jp(c),we!==null&&(Ue.data=we)))),(we=P1?L1(s,c):I1(s,c))&&(Ue=Kc(K,"onBeforeInput"),0<Ue.length&&(pe=new wp("onBeforeInput","beforeinput",null,c,Z),ne.push({event:pe,listeners:Ue}),pe.data=we)),wE(ne,s,K,c,Z)}yy(ne,r)})}function Jr(s,r,c){return{instance:s,listener:r,currentTarget:c}}function Kc(s,r){for(var c=r+"Capture",d=[];s!==null;){var p=s,y=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||y===null||(p=gr(s,c),p!=null&&d.unshift(Jr(s,p,y)),p=gr(s,r),p!=null&&d.push(Jr(s,p,y))),s.tag===3)return d;s=s.return}return[]}function OE(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Sy(s,r,c,d,p){for(var y=r._reactName,k=[];c!==null&&c!==d;){var N=c,U=N.alternate,K=N.stateNode;if(N=N.tag,U!==null&&U===d)break;N!==5&&N!==26&&N!==27||K===null||(U=K,p?(K=gr(c,y),K!=null&&k.unshift(Jr(c,K,U))):p||(K=gr(c,y),K!=null&&k.push(Jr(c,K,U)))),c=c.return}k.length!==0&&s.push({event:r,listeners:k})}var AE=/\r\n?/g,jE=/\u0000|\uFFFD/g;function ky(s){return(typeof s=="string"?s:""+s).replace(AE,`
`).replace(jE,"")}function Cy(s,r){return r=ky(r),ky(s)===r}function Xe(s,r,c,d,p,y){switch(c){case"children":typeof d=="string"?r==="body"||r==="textarea"&&d===""||ra(s,d):(typeof d=="number"||typeof d=="bigint")&&r!=="body"&&ra(s,""+d);break;case"className":Qo(s,"class",d);break;case"tabIndex":Qo(s,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Qo(s,c,d);break;case"style":Cp(s,d,y);break;case"data":if(r!=="object"){Qo(s,"data",d);break}case"src":case"href":if(d===""&&(r!=="a"||c!=="href")){s.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(c);break}d=Wo(""+d),s.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(c==="formAction"?(r!=="input"&&Xe(s,r,"name",p.name,p,null),Xe(s,r,"formEncType",p.formEncType,p,null),Xe(s,r,"formMethod",p.formMethod,p,null),Xe(s,r,"formTarget",p.formTarget,p,null)):(Xe(s,r,"encType",p.encType,p,null),Xe(s,r,"method",p.method,p,null),Xe(s,r,"target",p.target,p,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(c);break}d=Wo(""+d),s.setAttribute(c,d);break;case"onClick":d!=null&&(s.onclick=li);break;case"onScroll":d!=null&&je("scroll",s);break;case"onScrollEnd":d!=null&&je("scrollend",s);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(c=d.__html,c!=null){if(p.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"multiple":s.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":s.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){s.removeAttribute("xlink:href");break}c=Wo(""+d),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(c,""+d):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":d===!0?s.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(c,d):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?s.setAttribute(c,d):s.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?s.removeAttribute(c):s.setAttribute(c,d);break;case"popover":je("beforetoggle",s),je("toggle",s),Jo(s,"popover",d);break;case"xlinkActuate":ci(s,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":ci(s,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":ci(s,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":ci(s,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":ci(s,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":ci(s,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":ci(s,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":ci(s,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":ci(s,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Jo(s,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=c1.get(c)||c,Jo(s,c,d))}}function yh(s,r,c,d,p,y){switch(c){case"style":Cp(s,d,y);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(c=d.__html,c!=null){if(p.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"children":typeof d=="string"?ra(s,d):(typeof d=="number"||typeof d=="bigint")&&ra(s,""+d);break;case"onScroll":d!=null&&je("scroll",s);break;case"onScrollEnd":d!=null&&je("scrollend",s);break;case"onClick":d!=null&&(s.onclick=li);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fp.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(p=c.endsWith("Capture"),r=c.slice(2,p?c.length-7:void 0),y=s[Zt]||null,y=y!=null?y[c]:null,typeof y=="function"&&s.removeEventListener(r,y,p),typeof d=="function")){typeof y!="function"&&y!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(r,d,p);break e}c in s?s[c]=d:d===!0?s.setAttribute(c,""):Jo(s,c,d)}}}function zt(s,r,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":je("error",s),je("load",s);var d=!1,p=!1,y;for(y in c)if(c.hasOwnProperty(y)){var k=c[y];if(k!=null)switch(y){case"src":d=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:Xe(s,r,y,k,c,null)}}p&&Xe(s,r,"srcSet",c.srcSet,c,null),d&&Xe(s,r,"src",c.src,c,null);return;case"input":je("invalid",s);var N=y=k=p=null,U=null,K=null;for(d in c)if(c.hasOwnProperty(d)){var Z=c[d];if(Z!=null)switch(d){case"name":p=Z;break;case"type":k=Z;break;case"checked":U=Z;break;case"defaultChecked":K=Z;break;case"value":y=Z;break;case"defaultValue":N=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,r));break;default:Xe(s,r,d,Z,c,null)}}yp(s,y,N,U,K,k,p,!1);return;case"select":je("invalid",s),d=k=y=null;for(p in c)if(c.hasOwnProperty(p)&&(N=c[p],N!=null))switch(p){case"value":y=N;break;case"defaultValue":k=N;break;case"multiple":d=N;default:Xe(s,r,p,N,c,null)}r=y,c=k,s.multiple=!!d,r!=null?aa(s,!!d,r,!1):c!=null&&aa(s,!!d,c,!0);return;case"textarea":je("invalid",s),y=p=d=null;for(k in c)if(c.hasOwnProperty(k)&&(N=c[k],N!=null))switch(k){case"value":d=N;break;case"defaultValue":p=N;break;case"children":y=N;break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(i(91));break;default:Xe(s,r,k,N,c,null)}Sp(s,d,p,y);return;case"option":for(U in c)c.hasOwnProperty(U)&&(d=c[U],d!=null)&&(U==="selected"?s.selected=d&&typeof d!="function"&&typeof d!="symbol":Xe(s,r,U,d,c,null));return;case"dialog":je("beforetoggle",s),je("toggle",s),je("cancel",s),je("close",s);break;case"iframe":case"object":je("load",s);break;case"video":case"audio":for(d=0;d<Yr.length;d++)je(Yr[d],s);break;case"image":je("error",s),je("load",s);break;case"details":je("toggle",s);break;case"embed":case"source":case"link":je("error",s),je("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(K in c)if(c.hasOwnProperty(K)&&(d=c[K],d!=null))switch(K){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:Xe(s,r,K,d,c,null)}return;default:if(Ou(r)){for(Z in c)c.hasOwnProperty(Z)&&(d=c[Z],d!==void 0&&yh(s,r,Z,d,c,void 0));return}}for(N in c)c.hasOwnProperty(N)&&(d=c[N],d!=null&&Xe(s,r,N,d,c,null))}function PE(s,r,c,d){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,y=null,k=null,N=null,U=null,K=null,Z=null;for(Q in c){var ne=c[Q];if(c.hasOwnProperty(Q)&&ne!=null)switch(Q){case"checked":break;case"value":break;case"defaultValue":U=ne;default:d.hasOwnProperty(Q)||Xe(s,r,Q,null,d,ne)}}for(var G in d){var Q=d[G];if(ne=c[G],d.hasOwnProperty(G)&&(Q!=null||ne!=null))switch(G){case"type":y=Q;break;case"name":p=Q;break;case"checked":K=Q;break;case"defaultChecked":Z=Q;break;case"value":k=Q;break;case"defaultValue":N=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(i(137,r));break;default:Q!==ne&&Xe(s,r,G,Q,d,ne)}}Nu(s,k,N,U,K,Z,y,p);return;case"select":Q=k=N=G=null;for(y in c)if(U=c[y],c.hasOwnProperty(y)&&U!=null)switch(y){case"value":break;case"multiple":Q=U;default:d.hasOwnProperty(y)||Xe(s,r,y,null,d,U)}for(p in d)if(y=d[p],U=c[p],d.hasOwnProperty(p)&&(y!=null||U!=null))switch(p){case"value":G=y;break;case"defaultValue":N=y;break;case"multiple":k=y;default:y!==U&&Xe(s,r,p,y,d,U)}r=N,c=k,d=Q,G!=null?aa(s,!!c,G,!1):!!d!=!!c&&(r!=null?aa(s,!!c,r,!0):aa(s,!!c,c?[]:"",!1));return;case"textarea":Q=G=null;for(N in c)if(p=c[N],c.hasOwnProperty(N)&&p!=null&&!d.hasOwnProperty(N))switch(N){case"value":break;case"children":break;default:Xe(s,r,N,null,d,p)}for(k in d)if(p=d[k],y=c[k],d.hasOwnProperty(k)&&(p!=null||y!=null))switch(k){case"value":G=p;break;case"defaultValue":Q=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==y&&Xe(s,r,k,p,d,y)}bp(s,G,Q);return;case"option":for(var me in c)G=c[me],c.hasOwnProperty(me)&&G!=null&&!d.hasOwnProperty(me)&&(me==="selected"?s.selected=!1:Xe(s,r,me,null,d,G));for(U in d)G=d[U],Q=c[U],d.hasOwnProperty(U)&&G!==Q&&(G!=null||Q!=null)&&(U==="selected"?s.selected=G&&typeof G!="function"&&typeof G!="symbol":Xe(s,r,U,G,d,Q));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Se in c)G=c[Se],c.hasOwnProperty(Se)&&G!=null&&!d.hasOwnProperty(Se)&&Xe(s,r,Se,null,d,G);for(K in d)if(G=d[K],Q=c[K],d.hasOwnProperty(K)&&G!==Q&&(G!=null||Q!=null))switch(K){case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(i(137,r));break;default:Xe(s,r,K,G,d,Q)}return;default:if(Ou(r)){for(var We in c)G=c[We],c.hasOwnProperty(We)&&G!==void 0&&!d.hasOwnProperty(We)&&yh(s,r,We,void 0,d,G);for(Z in d)G=d[Z],Q=c[Z],!d.hasOwnProperty(Z)||G===Q||G===void 0&&Q===void 0||yh(s,r,Z,G,d,Q);return}}for(var V in c)G=c[V],c.hasOwnProperty(V)&&G!=null&&!d.hasOwnProperty(V)&&Xe(s,r,V,null,d,G);for(ne in d)G=d[ne],Q=c[ne],!d.hasOwnProperty(ne)||G===Q||G==null&&Q==null||Xe(s,r,ne,G,d,Q)}function Ty(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function LE(){if(typeof performance.getEntriesByType=="function"){for(var s=0,r=0,c=performance.getEntriesByType("resource"),d=0;d<c.length;d++){var p=c[d],y=p.transferSize,k=p.initiatorType,N=p.duration;if(y&&N&&Ty(k)){for(k=0,N=p.responseEnd,d+=1;d<c.length;d++){var U=c[d],K=U.startTime;if(K>N)break;var Z=U.transferSize,ne=U.initiatorType;Z&&Ty(ne)&&(U=U.responseEnd,k+=Z*(U<N?1:(N-K)/(U-K)))}if(--d,r+=8*(y+k)/(p.duration/1e3),s++,10<s)break}}if(0<s)return r/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var bh=null,Sh=null;function Gc(s){return s.nodeType===9?s:s.ownerDocument}function Ey(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xy(s,r){if(s===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&r==="foreignObject"?0:s}function kh(s,r){return s==="textarea"||s==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Ch=null;function IE(){var s=window.event;return s&&s.type==="popstate"?s===Ch?!1:(Ch=s,!0):(Ch=null,!1)}var Ry=typeof setTimeout=="function"?setTimeout:void 0,UE=typeof clearTimeout=="function"?clearTimeout:void 0,_y=typeof Promise=="function"?Promise:void 0,BE=typeof queueMicrotask=="function"?queueMicrotask:typeof _y<"u"?function(s){return _y.resolve(null).then(s).catch(zE)}:Ry;function zE(s){setTimeout(function(){throw s})}function ns(s){return s==="head"}function wy(s,r){var c=r,d=0;do{var p=c.nextSibling;if(s.removeChild(c),p&&p.nodeType===8)if(c=p.data,c==="/$"||c==="/&"){if(d===0){s.removeChild(p),Ia(r);return}d--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")d++;else if(c==="html")Qr(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,Qr(c);for(var y=c.firstChild;y;){var k=y.nextSibling,N=y.nodeName;y[mr]||N==="SCRIPT"||N==="STYLE"||N==="LINK"&&y.rel.toLowerCase()==="stylesheet"||c.removeChild(y),y=k}}else c==="body"&&Qr(s.ownerDocument.body);c=p}while(c);Ia(r)}function My(s,r){var c=s;s=0;do{var d=c.nextSibling;if(c.nodeType===1?r?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(r?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),d&&d.nodeType===8)if(c=d.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=d}while(c)}function Th(s){var r=s.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var c=r;switch(r=r.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Th(c),wu(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function FE(s,r,c,d){for(;s.nodeType===1;){var p=c;if(s.nodeName.toLowerCase()!==r.toLowerCase()){if(!d&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(d){if(!s[mr])switch(r){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(y=s.getAttribute("rel"),y==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(y!==p.rel||s.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||s.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||s.getAttribute("title")!==(p.title==null?null:p.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(y=s.getAttribute("src"),(y!==(p.src==null?null:p.src)||s.getAttribute("type")!==(p.type==null?null:p.type)||s.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&y&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(r==="input"&&s.type==="hidden"){var y=p.name==null?null:""+p.name;if(p.type==="hidden"&&s.getAttribute("name")===y)return s}else return s;if(s=On(s.nextSibling),s===null)break}return null}function VE(s,r,c){if(r==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=On(s.nextSibling),s===null))return null;return s}function Ny(s,r){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!r||(s=On(s.nextSibling),s===null))return null;return s}function Eh(s){return s.data==="$?"||s.data==="$~"}function xh(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function qE(s,r){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=r;else if(s.data!=="$?"||c.readyState!=="loading")r();else{var d=function(){r(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),s._reactRetry=d}}function On(s){for(;s!=null;s=s.nextSibling){var r=s.nodeType;if(r===1||r===3)break;if(r===8){if(r=s.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return s}var Rh=null;function Dy(s){s=s.nextSibling;for(var r=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(r===0)return On(s.nextSibling);r--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||r++}s=s.nextSibling}return null}function Oy(s){s=s.previousSibling;for(var r=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(r===0)return s;r--}else c!=="/$"&&c!=="/&"||r++}s=s.previousSibling}return null}function Ay(s,r,c){switch(r=Gc(c),s){case"html":if(s=r.documentElement,!s)throw Error(i(452));return s;case"head":if(s=r.head,!s)throw Error(i(453));return s;case"body":if(s=r.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function Qr(s){for(var r=s.attributes;r.length;)s.removeAttributeNode(r[0]);wu(s)}var An=new Map,jy=new Set;function Yc(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var xi=ae.d;ae.d={f:HE,r:$E,D:KE,C:GE,L:YE,m:JE,X:XE,S:QE,M:WE};function HE(){var s=xi.f(),r=Bc();return s||r}function $E(s){var r=na(s);r!==null&&r.tag===5&&r.type==="form"?Xg(r):xi.r(s)}var ja=typeof document>"u"?null:document;function Py(s,r,c){var d=ja;if(d&&typeof r=="string"&&r){var p=xn(r);p='link[rel="'+s+'"][href="'+p+'"]',typeof c=="string"&&(p+='[crossorigin="'+c+'"]'),jy.has(p)||(jy.add(p),s={rel:s,crossOrigin:c,href:r},d.querySelector(p)===null&&(r=d.createElement("link"),zt(r,"link",s),Mt(r),d.head.appendChild(r)))}}function KE(s){xi.D(s),Py("dns-prefetch",s,null)}function GE(s,r){xi.C(s,r),Py("preconnect",s,r)}function YE(s,r,c){xi.L(s,r,c);var d=ja;if(d&&s&&r){var p='link[rel="preload"][as="'+xn(r)+'"]';r==="image"&&c&&c.imageSrcSet?(p+='[imagesrcset="'+xn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(p+='[imagesizes="'+xn(c.imageSizes)+'"]')):p+='[href="'+xn(s)+'"]';var y=p;switch(r){case"style":y=Pa(s);break;case"script":y=La(s)}An.has(y)||(s=v({rel:"preload",href:r==="image"&&c&&c.imageSrcSet?void 0:s,as:r},c),An.set(y,s),d.querySelector(p)!==null||r==="style"&&d.querySelector(Xr(y))||r==="script"&&d.querySelector(Wr(y))||(r=d.createElement("link"),zt(r,"link",s),Mt(r),d.head.appendChild(r)))}}function JE(s,r){xi.m(s,r);var c=ja;if(c&&s){var d=r&&typeof r.as=="string"?r.as:"script",p='link[rel="modulepreload"][as="'+xn(d)+'"][href="'+xn(s)+'"]',y=p;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=La(s)}if(!An.has(y)&&(s=v({rel:"modulepreload",href:s},r),An.set(y,s),c.querySelector(p)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(Wr(y)))return}d=c.createElement("link"),zt(d,"link",s),Mt(d),c.head.appendChild(d)}}}function QE(s,r,c){xi.S(s,r,c);var d=ja;if(d&&s){var p=ia(d).hoistableStyles,y=Pa(s);r=r||"default";var k=p.get(y);if(!k){var N={loading:0,preload:null};if(k=d.querySelector(Xr(y)))N.loading=5;else{s=v({rel:"stylesheet",href:s,"data-precedence":r},c),(c=An.get(y))&&_h(s,c);var U=k=d.createElement("link");Mt(U),zt(U,"link",s),U._p=new Promise(function(K,Z){U.onload=K,U.onerror=Z}),U.addEventListener("load",function(){N.loading|=1}),U.addEventListener("error",function(){N.loading|=2}),N.loading|=4,Jc(k,r,d)}k={type:"stylesheet",instance:k,count:1,state:N},p.set(y,k)}}}function XE(s,r){xi.X(s,r);var c=ja;if(c&&s){var d=ia(c).hoistableScripts,p=La(s),y=d.get(p);y||(y=c.querySelector(Wr(p)),y||(s=v({src:s,async:!0},r),(r=An.get(p))&&wh(s,r),y=c.createElement("script"),Mt(y),zt(y,"link",s),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(p,y))}}function WE(s,r){xi.M(s,r);var c=ja;if(c&&s){var d=ia(c).hoistableScripts,p=La(s),y=d.get(p);y||(y=c.querySelector(Wr(p)),y||(s=v({src:s,async:!0,type:"module"},r),(r=An.get(p))&&wh(s,r),y=c.createElement("script"),Mt(y),zt(y,"link",s),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(p,y))}}function Ly(s,r,c,d){var p=(p=re.current)?Yc(p):null;if(!p)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(r=Pa(c.href),c=ia(p).hoistableStyles,d=c.get(r),d||(d={type:"style",instance:null,count:0,state:null},c.set(r,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Pa(c.href);var y=ia(p).hoistableStyles,k=y.get(s);if(k||(p=p.ownerDocument||p,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(s,k),(y=p.querySelector(Xr(s)))&&!y._p&&(k.instance=y,k.state.loading=5),An.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},An.set(s,c),y||ZE(p,s,c,k.state))),r&&d===null)throw Error(i(528,""));return k}if(r&&d!==null)throw Error(i(529,""));return null;case"script":return r=c.async,c=c.src,typeof c=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=La(c),c=ia(p).hoistableScripts,d=c.get(r),d||(d={type:"script",instance:null,count:0,state:null},c.set(r,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function Pa(s){return'href="'+xn(s)+'"'}function Xr(s){return'link[rel="stylesheet"]['+s+"]"}function Iy(s){return v({},s,{"data-precedence":s.precedence,precedence:null})}function ZE(s,r,c,d){s.querySelector('link[rel="preload"][as="style"]['+r+"]")?d.loading=1:(r=s.createElement("link"),d.preload=r,r.addEventListener("load",function(){return d.loading|=1}),r.addEventListener("error",function(){return d.loading|=2}),zt(r,"link",c),Mt(r),s.head.appendChild(r))}function La(s){return'[src="'+xn(s)+'"]'}function Wr(s){return"script[async]"+s}function Uy(s,r,c){if(r.count++,r.instance===null)switch(r.type){case"style":var d=s.querySelector('style[data-href~="'+xn(c.href)+'"]');if(d)return r.instance=d,Mt(d),d;var p=v({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(s.ownerDocument||s).createElement("style"),Mt(d),zt(d,"style",p),Jc(d,c.precedence,s),r.instance=d;case"stylesheet":p=Pa(c.href);var y=s.querySelector(Xr(p));if(y)return r.state.loading|=4,r.instance=y,Mt(y),y;d=Iy(c),(p=An.get(p))&&_h(d,p),y=(s.ownerDocument||s).createElement("link"),Mt(y);var k=y;return k._p=new Promise(function(N,U){k.onload=N,k.onerror=U}),zt(y,"link",d),r.state.loading|=4,Jc(y,c.precedence,s),r.instance=y;case"script":return y=La(c.src),(p=s.querySelector(Wr(y)))?(r.instance=p,Mt(p),p):(d=c,(p=An.get(y))&&(d=v({},c),wh(d,p)),s=s.ownerDocument||s,p=s.createElement("script"),Mt(p),zt(p,"link",d),s.head.appendChild(p),r.instance=p);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(d=r.instance,r.state.loading|=4,Jc(d,c.precedence,s));return r.instance}function Jc(s,r,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=d.length?d[d.length-1]:null,y=p,k=0;k<d.length;k++){var N=d[k];if(N.dataset.precedence===r)y=N;else if(y!==p)break}y?y.parentNode.insertBefore(s,y.nextSibling):(r=c.nodeType===9?c.head:c,r.insertBefore(s,r.firstChild))}function _h(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.title==null&&(s.title=r.title)}function wh(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.integrity==null&&(s.integrity=r.integrity)}var Qc=null;function By(s,r,c){if(Qc===null){var d=new Map,p=Qc=new Map;p.set(c,d)}else p=Qc,d=p.get(c),d||(d=new Map,p.set(c,d));if(d.has(s))return d;for(d.set(s,null),c=c.getElementsByTagName(s),p=0;p<c.length;p++){var y=c[p];if(!(y[mr]||y[Lt]||s==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var k=y.getAttribute(r)||"";k=s+k;var N=d.get(k);N?N.push(y):d.set(k,[y])}}return d}function zy(s,r,c){s=s.ownerDocument||s,s.head.insertBefore(c,r==="title"?s.querySelector("head > title"):null)}function ex(s,r,c){if(c===1||r.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(s=r.disabled,typeof r.precedence=="string"&&s==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Fy(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function tx(s,r,c,d){if(c.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var p=Pa(d.href),y=r.querySelector(Xr(p));if(y){r=y._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(s.count++,s=Xc.bind(s),r.then(s,s)),c.state.loading|=4,c.instance=y,Mt(y);return}y=r.ownerDocument||r,d=Iy(d),(p=An.get(p))&&_h(d,p),y=y.createElement("link"),Mt(y);var k=y;k._p=new Promise(function(N,U){k.onload=N,k.onerror=U}),zt(y,"link",d),c.instance=y}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,r),(r=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Xc.bind(s),r.addEventListener("load",c),r.addEventListener("error",c))}}var Mh=0;function nx(s,r){return s.stylesheets&&s.count===0&&Zc(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var d=setTimeout(function(){if(s.stylesheets&&Zc(s,s.stylesheets),s.unsuspend){var y=s.unsuspend;s.unsuspend=null,y()}},6e4+r);0<s.imgBytes&&Mh===0&&(Mh=62500*LE());var p=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Zc(s,s.stylesheets),s.unsuspend)){var y=s.unsuspend;s.unsuspend=null,y()}},(s.imgBytes>Mh?50:800)+r);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(d),clearTimeout(p)}}:null}function Xc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Zc(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Wc=null;function Zc(s,r){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Wc=new Map,r.forEach(ix,s),Wc=null,Xc.call(s))}function ix(s,r){if(!(r.state.loading&4)){var c=Wc.get(s);if(c)var d=c.get(null);else{c=new Map,Wc.set(s,c);for(var p=s.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<p.length;y++){var k=p[y];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(c.set(k.dataset.precedence,k),d=k)}d&&c.set(null,d)}p=r.instance,k=p.getAttribute("data-precedence"),y=c.get(k)||d,y===d&&c.set(null,p),c.set(k,p),this.count++,d=Xc.bind(this),p.addEventListener("load",d),p.addEventListener("error",d),y?y.parentNode.insertBefore(p,y.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(p,s.firstChild)),r.state.loading|=4}}var Zr={$$typeof:j,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function sx(s,r,c,d,p,y,k,N,U){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Eu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Eu(0),this.hiddenUpdates=Eu(null),this.identifierPrefix=d,this.onUncaughtError=p,this.onCaughtError=y,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function Vy(s,r,c,d,p,y,k,N,U,K,Z,ne){return s=new sx(s,r,c,k,U,K,Z,ne,N),r=1,y===!0&&(r|=24),y=pn(3,null,null,r),s.current=y,y.stateNode=s,r=cd(),r.refCount++,s.pooledCache=r,r.refCount++,y.memoizedState={element:d,isDehydrated:c,cache:r},hd(y),s}function qy(s){return s?(s=fa,s):fa}function Hy(s,r,c,d,p,y){p=qy(p),d.context===null?d.context=p:d.pendingContext=p,d=$i(r),d.payload={element:c},y=y===void 0?null:y,y!==null&&(d.callback=y),c=Ki(s,d,r),c!==null&&(rn(c,s,r),Dr(c,s,r))}function $y(s,r){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<r?c:r}}function Nh(s,r){$y(s,r),(s=s.alternate)&&$y(s,r)}function Ky(s){if(s.tag===13||s.tag===31){var r=Ds(s,67108864);r!==null&&rn(r,s,67108864),Nh(s,67108864)}}function Gy(s){if(s.tag===13||s.tag===31){var r=Sn();r=xu(r);var c=Ds(s,r);c!==null&&rn(c,s,r),Nh(s,r)}}var el=!0;function ax(s,r,c,d){var p=H.T;H.T=null;var y=ae.p;try{ae.p=2,Dh(s,r,c,d)}finally{ae.p=y,H.T=p}}function rx(s,r,c,d){var p=H.T;H.T=null;var y=ae.p;try{ae.p=8,Dh(s,r,c,d)}finally{ae.p=y,H.T=p}}function Dh(s,r,c,d){if(el){var p=Oh(d);if(p===null)vh(s,r,d,tl,c),Jy(s,d);else if(cx(p,s,r,c,d))d.stopPropagation();else if(Jy(s,d),r&4&&-1<ox.indexOf(s)){for(;p!==null;){var y=na(p);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var k=Rs(y.pendingLanes);if(k!==0){var N=y;for(N.pendingLanes|=2,N.entangledLanes|=2;k;){var U=1<<31-fn(k);N.entanglements[1]|=U,k&=~U}Wn(y),(He&6)===0&&(Ic=dn()+500,Gr(0))}}break;case 31:case 13:N=Ds(y,2),N!==null&&rn(N,y,2),Bc(),Nh(y,2)}if(y=Oh(d),y===null&&vh(s,r,d,tl,c),y===p)break;p=y}p!==null&&d.stopPropagation()}else vh(s,r,d,null,c)}}function Oh(s){return s=ju(s),Ah(s)}var tl=null;function Ah(s){if(tl=null,s=ta(s),s!==null){var r=o(s);if(r===null)s=null;else{var c=r.tag;if(c===13){if(s=l(r),s!==null)return s;s=null}else if(c===31){if(s=u(r),s!==null)return s;s=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;s=null}else r!==s&&(s=null)}}return tl=s,null}function Yy(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(KT()){case np:return 2;case ip:return 8;case Ho:case GT:return 32;case sp:return 268435456;default:return 32}default:return 32}}var jh=!1,is=null,ss=null,as=null,eo=new Map,to=new Map,rs=[],ox="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Jy(s,r){switch(s){case"focusin":case"focusout":is=null;break;case"dragenter":case"dragleave":ss=null;break;case"mouseover":case"mouseout":as=null;break;case"pointerover":case"pointerout":eo.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":to.delete(r.pointerId)}}function no(s,r,c,d,p,y){return s===null||s.nativeEvent!==y?(s={blockedOn:r,domEventName:c,eventSystemFlags:d,nativeEvent:y,targetContainers:[p]},r!==null&&(r=na(r),r!==null&&Ky(r)),s):(s.eventSystemFlags|=d,r=s.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),s)}function cx(s,r,c,d,p){switch(r){case"focusin":return is=no(is,s,r,c,d,p),!0;case"dragenter":return ss=no(ss,s,r,c,d,p),!0;case"mouseover":return as=no(as,s,r,c,d,p),!0;case"pointerover":var y=p.pointerId;return eo.set(y,no(eo.get(y)||null,s,r,c,d,p)),!0;case"gotpointercapture":return y=p.pointerId,to.set(y,no(to.get(y)||null,s,r,c,d,p)),!0}return!1}function Qy(s){var r=ta(s.target);if(r!==null){var c=o(r);if(c!==null){if(r=c.tag,r===13){if(r=l(c),r!==null){s.blockedOn=r,up(s.priority,function(){Gy(c)});return}}else if(r===31){if(r=u(c),r!==null){s.blockedOn=r,up(s.priority,function(){Gy(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function nl(s){if(s.blockedOn!==null)return!1;for(var r=s.targetContainers;0<r.length;){var c=Oh(s.nativeEvent);if(c===null){c=s.nativeEvent;var d=new c.constructor(c.type,c);Au=d,c.target.dispatchEvent(d),Au=null}else return r=na(c),r!==null&&Ky(r),s.blockedOn=c,!1;r.shift()}return!0}function Xy(s,r,c){nl(s)&&c.delete(r)}function lx(){jh=!1,is!==null&&nl(is)&&(is=null),ss!==null&&nl(ss)&&(ss=null),as!==null&&nl(as)&&(as=null),eo.forEach(Xy),to.forEach(Xy)}function il(s,r){s.blockedOn===r&&(s.blockedOn=null,jh||(jh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,lx)))}var sl=null;function Wy(s){sl!==s&&(sl=s,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){sl===s&&(sl=null);for(var r=0;r<s.length;r+=3){var c=s[r],d=s[r+1],p=s[r+2];if(typeof d!="function"){if(Ah(d||c)===null)continue;break}var y=na(c);y!==null&&(s.splice(r,3),r-=3,Od(y,{pending:!0,data:p,method:c.method,action:d},d,p))}}))}function Ia(s){function r(U){return il(U,s)}is!==null&&il(is,s),ss!==null&&il(ss,s),as!==null&&il(as,s),eo.forEach(r),to.forEach(r);for(var c=0;c<rs.length;c++){var d=rs[c];d.blockedOn===s&&(d.blockedOn=null)}for(;0<rs.length&&(c=rs[0],c.blockedOn===null);)Qy(c),c.blockedOn===null&&rs.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var p=c[d],y=c[d+1],k=p[Zt]||null;if(typeof y=="function")k||Wy(c);else if(k){var N=null;if(y&&y.hasAttribute("formAction")){if(p=y,k=y[Zt]||null)N=k.formAction;else if(Ah(p)!==null)continue}else N=k.action;typeof N=="function"?c[d+1]=N:(c.splice(d,3),d-=3),Wy(c)}}}function Zy(){function s(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(k){return p=k})},focusReset:"manual",scroll:"manual"})}function r(){p!==null&&(p(),p=null),d||setTimeout(c,20)}function c(){if(!d&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,p=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(c,100),function(){d=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),p!==null&&(p(),p=null)}}}function Ph(s){this._internalRoot=s}al.prototype.render=Ph.prototype.render=function(s){var r=this._internalRoot;if(r===null)throw Error(i(409));var c=r.current,d=Sn();Hy(c,d,s,r,null,null)},al.prototype.unmount=Ph.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var r=s.containerInfo;Hy(s.current,2,null,s,null,null),Bc(),r[ea]=null}};function al(s){this._internalRoot=s}al.prototype.unstable_scheduleHydration=function(s){if(s){var r=lp();s={blockedOn:null,target:s,priority:r};for(var c=0;c<rs.length&&r!==0&&r<rs[c].priority;c++);rs.splice(c,0,s),c===0&&Qy(s)}};var eb=e.version;if(eb!=="19.2.4")throw Error(i(527,eb,"19.2.4"));ae.findDOMNode=function(s){var r=s._reactInternals;if(r===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=f(r),s=s!==null?m(s):null,s=s===null?null:s.stateNode,s};var ux={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:H,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rl.isDisabled&&rl.supportsFiber)try{dr=rl.inject(ux),hn=rl}catch{}}return so.createRoot=function(s,r){if(!a(s))throw Error(i(299));var c=!1,d="",p=ov,y=cv,k=lv;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(y=r.onCaughtError),r.onRecoverableError!==void 0&&(k=r.onRecoverableError)),r=Vy(s,1,!1,null,null,c,d,null,p,y,k,Zy),s[ea]=r.current,gh(s),new Ph(r)},so.hydrateRoot=function(s,r,c){if(!a(s))throw Error(i(299));var d=!1,p="",y=ov,k=cv,N=lv,U=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(y=c.onUncaughtError),c.onCaughtError!==void 0&&(k=c.onCaughtError),c.onRecoverableError!==void 0&&(N=c.onRecoverableError),c.formState!==void 0&&(U=c.formState)),r=Vy(s,1,!0,r,c??null,d,p,U,y,k,N,Zy),r.context=qy(null),c=r.current,d=Sn(),d=xu(d),p=$i(d),p.callback=null,Ki(c,p,d),c=d,r.current.lanes=c,fr(r,c),Wn(r),s[ea]=r.current,gh(s),new al(r)},so.version="19.2.4",so}var ub;function Sx(){if(ub)return Uh.exports;ub=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Uh.exports=bx(),Uh.exports}var kx=Sx();var db="popstate";function Cx(n={}){function e(i,a){let{pathname:o,search:l,hash:u}=i.location;return xf("",{pathname:o,search:l,hash:u},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(i,a){return typeof a=="string"?a:_o(a)}return Ex(e,t,null,n)}function lt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Gn(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Tx(){return Math.random().toString(36).substring(2,10)}function hb(n,e){return{usr:n.state,key:n.key,idx:e}}function xf(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?ar(e):e,state:t,key:e&&e.key||i||Tx()}}function _o({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function ar(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function Ex(n,e,t,i={}){let{window:a=document.defaultView,v5Compat:o=!1}=i,l=a.history,u="POP",h=null,f=m();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function m(){return(l.state||{idx:null}).idx}function v(){u="POP";let R=m(),_=R==null?null:R-f;f=R,h&&h({action:u,location:S.location,delta:_})}function b(R,_){u="PUSH";let D=xf(S.location,R,_);f=m()+1;let j=hb(D,f),x=S.createHref(D);try{l.pushState(j,"",x)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;a.location.assign(x)}o&&h&&h({action:u,location:S.location,delta:1})}function C(R,_){u="REPLACE";let D=xf(S.location,R,_);f=m();let j=hb(D,f),x=S.createHref(D);l.replaceState(j,"",x),o&&h&&h({action:u,location:S.location,delta:0})}function T(R){return xx(R)}let S={get action(){return u},get location(){return n(a,l)},listen(R){if(h)throw new Error("A history only accepts one active listener");return a.addEventListener(db,v),h=R,()=>{a.removeEventListener(db,v),h=null}},createHref(R){return e(a,R)},createURL:T,encodeLocation(R){let _=T(R);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:b,replace:C,go(R){return l.go(R)}};return S}function xx(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),lt(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:_o(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function RS(n,e,t="/"){return Rx(n,e,t,!1)}function Rx(n,e,t,i){let a=typeof e=="string"?ar(e):e,o=Ai(a.pathname||"/",t);if(o==null)return null;let l=_S(n);_x(l);let u=null;for(let h=0;u==null&&h<l.length;++h){let f=Ux(o);u=Lx(l[h],f,i)}return u}function _S(n,e=[],t=[],i="",a=!1){let o=(l,u,h=a,f)=>{let m={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(i)&&h)return;lt(m.relativePath.startsWith(i),`Absolute route path "${m.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(i.length)}let v=Oi([i,m.relativePath]),b=t.concat(m);l.children&&l.children.length>0&&(lt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),_S(l.children,e,b,v,h)),!(l.path==null&&!l.index)&&e.push({path:v,score:jx(v,l.index),routesMeta:b})};return n.forEach((l,u)=>{if(l.path===""||!l.path?.includes("?"))o(l,u);else for(let h of wS(l.path))o(l,u,!0,h)}),e}function wS(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,a=t.endsWith("?"),o=t.replace(/\?$/,"");if(i.length===0)return a?[o,""]:[o];let l=wS(i.join("/")),u=[];return u.push(...l.map(h=>h===""?o:[o,h].join("/"))),a&&u.push(...l),u.map(h=>n.startsWith("/")&&h===""?"/":h)}function _x(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:Px(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var wx=/^:[\w-]+$/,Mx=3,Nx=2,Dx=1,Ox=10,Ax=-2,fb=n=>n==="*";function jx(n,e){let t=n.split("/"),i=t.length;return t.some(fb)&&(i+=Ax),e&&(i+=Nx),t.filter(a=>!fb(a)).reduce((a,o)=>a+(wx.test(o)?Mx:o===""?Dx:Ox),i)}function Px(n,e){return n.length===e.length&&n.slice(0,-1).every((i,a)=>i===e[a])?n[n.length-1]-e[e.length-1]:0}function Lx(n,e,t=!1){let{routesMeta:i}=n,a={},o="/",l=[];for(let u=0;u<i.length;++u){let h=i[u],f=u===i.length-1,m=o==="/"?e:e.slice(o.length)||"/",v=jl({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},m),b=h.route;if(!v&&f&&t&&!i[i.length-1].route.index&&(v=jl({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},m)),!v)return null;Object.assign(a,v.params),l.push({params:a,pathname:Oi([o,v.pathname]),pathnameBase:Vx(Oi([o,v.pathnameBase])),route:b}),v.pathnameBase!=="/"&&(o=Oi([o,v.pathnameBase]))}return l}function jl(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=Ix(n.path,n.caseSensitive,n.end),a=e.match(t);if(!a)return null;let o=a[0],l=o.replace(/(.)\/+$/,"$1"),u=a.slice(1);return{params:i.reduce((f,{paramName:m,isOptional:v},b)=>{if(m==="*"){let T=u[b]||"";l=o.slice(0,o.length-T.length).replace(/(.)\/+$/,"$1")}const C=u[b];return v&&!C?f[m]=void 0:f[m]=(C||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:n}}function Ix(n,e=!1,t=!0){Gn(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],a="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,h)=>(i.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),a+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?a+="\\/*$":n!==""&&n!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),i]}function Ux(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Gn(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ai(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}var Bx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function zx(n,e="/"){let{pathname:t,search:i="",hash:a=""}=typeof n=="string"?ar(n):n,o;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?o=mb(t.substring(1),"/"):o=mb(t,e)):o=e,{pathname:o,search:qx(i),hash:Hx(a)}}function mb(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(a=>{a===".."?t.length>1&&t.pop():a!=="."&&t.push(a)}),t.length>1?t.join("/"):"/"}function Vh(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Fx(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function dm(n){let e=Fx(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function hm(n,e,t,i=!1){let a;typeof n=="string"?a=ar(n):(a={...n},lt(!a.pathname||!a.pathname.includes("?"),Vh("?","pathname","search",a)),lt(!a.pathname||!a.pathname.includes("#"),Vh("#","pathname","hash",a)),lt(!a.search||!a.search.includes("#"),Vh("#","search","hash",a)));let o=n===""||a.pathname==="",l=o?"/":a.pathname,u;if(l==null)u=t;else{let v=e.length-1;if(!i&&l.startsWith("..")){let b=l.split("/");for(;b[0]==="..";)b.shift(),v-=1;a.pathname=b.join("/")}u=v>=0?e[v]:"/"}let h=zx(a,u),f=l&&l!=="/"&&l.endsWith("/"),m=(o||l===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(f||m)&&(h.pathname+="/"),h}var Oi=n=>n.join("/").replace(/\/\/+/g,"/"),Vx=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),qx=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Hx=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,$x=class{constructor(n,e,t,i=!1){this.status=n,this.statusText=e||"",this.internal=i,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function Kx(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function Gx(n){return n.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var MS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function NS(n,e){let t=n;if(typeof t!="string"||!Bx.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let i=t,a=!1;if(MS)try{let o=new URL(window.location.href),l=t.startsWith("//")?new URL(o.protocol+t):new URL(t),u=Ai(l.pathname,e);l.origin===o.origin&&u!=null?t=u+l.search+l.hash:a=!0}catch{Gn(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:i,isExternal:a,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var DS=["POST","PUT","PATCH","DELETE"];new Set(DS);var Yx=["GET",...DS];new Set(Yx);var rr=E.createContext(null);rr.displayName="DataRouter";var nu=E.createContext(null);nu.displayName="DataRouterState";var Jx=E.createContext(!1),OS=E.createContext({isTransitioning:!1});OS.displayName="ViewTransition";var Qx=E.createContext(new Map);Qx.displayName="Fetchers";var Xx=E.createContext(null);Xx.displayName="Await";var Tn=E.createContext(null);Tn.displayName="Navigation";var Uo=E.createContext(null);Uo.displayName="Location";var ri=E.createContext({outlet:null,matches:[],isDataRoute:!1});ri.displayName="Route";var fm=E.createContext(null);fm.displayName="RouteError";var AS="REACT_ROUTER_ERROR",Wx="REDIRECT",Zx="ROUTE_ERROR_RESPONSE";function eR(n){if(n.startsWith(`${AS}:${Wx}:{`))try{let e=JSON.parse(n.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function tR(n){if(n.startsWith(`${AS}:${Zx}:{`))try{let e=JSON.parse(n.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new $x(e.status,e.statusText,e.data)}catch{}}function nR(n,{relative:e}={}){lt(or(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=E.useContext(Tn),{hash:a,pathname:o,search:l}=Bo(n,{relative:e}),u=o;return t!=="/"&&(u=o==="/"?t:Oi([t,o])),i.createHref({pathname:u,search:l,hash:a})}function or(){return E.useContext(Uo)!=null}function ks(){return lt(or(),"useLocation() may be used only in the context of a <Router> component."),E.useContext(Uo).location}var jS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function PS(n){E.useContext(Tn).static||E.useLayoutEffect(n)}function iu(){let{isDataRoute:n}=E.useContext(ri);return n?pR():iR()}function iR(){lt(or(),"useNavigate() may be used only in the context of a <Router> component.");let n=E.useContext(rr),{basename:e,navigator:t}=E.useContext(Tn),{matches:i}=E.useContext(ri),{pathname:a}=ks(),o=JSON.stringify(dm(i)),l=E.useRef(!1);return PS(()=>{l.current=!0}),E.useCallback((h,f={})=>{if(Gn(l.current,jS),!l.current)return;if(typeof h=="number"){t.go(h);return}let m=hm(h,JSON.parse(o),a,f.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Oi([e,m.pathname])),(f.replace?t.replace:t.push)(m,f.state,f)},[e,t,o,a,n])}E.createContext(null);function Bo(n,{relative:e}={}){let{matches:t}=E.useContext(ri),{pathname:i}=ks(),a=JSON.stringify(dm(t));return E.useMemo(()=>hm(n,JSON.parse(a),i,e==="path"),[n,a,i,e])}function sR(n,e){return LS(n,e)}function LS(n,e,t,i,a){lt(or(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=E.useContext(Tn),{matches:l}=E.useContext(ri),u=l[l.length-1],h=u?u.params:{},f=u?u.pathname:"/",m=u?u.pathnameBase:"/",v=u&&u.route;{let D=v&&v.path||"";US(f,!v||D.endsWith("*")||D.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${D}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${D}"> to <Route path="${D==="/"?"*":`${D}/*`}">.`)}let b=ks(),C;if(e){let D=typeof e=="string"?ar(e):e;lt(m==="/"||D.pathname?.startsWith(m),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${D.pathname}" was given in the \`location\` prop.`),C=D}else C=b;let T=C.pathname||"/",S=T;if(m!=="/"){let D=m.replace(/^\//,"").split("/");S="/"+T.replace(/^\//,"").split("/").slice(D.length).join("/")}let R=RS(n,{pathname:S});Gn(v||R!=null,`No routes matched location "${C.pathname}${C.search}${C.hash}" `),Gn(R==null||R[R.length-1].route.element!==void 0||R[R.length-1].route.Component!==void 0||R[R.length-1].route.lazy!==void 0,`Matched leaf route at location "${C.pathname}${C.search}${C.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _=lR(R&&R.map(D=>Object.assign({},D,{params:Object.assign({},h,D.params),pathname:Oi([m,o.encodeLocation?o.encodeLocation(D.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?m:Oi([m,o.encodeLocation?o.encodeLocation(D.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathnameBase])})),l,t,i,a);return e&&_?E.createElement(Uo.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...C},navigationType:"POP"}},_):_}function aR(){let n=mR(),e=Kx(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},o={padding:"2px 4px",backgroundColor:i},l=null;return console.error("Error handled by React Router default ErrorBoundary:",n),l=E.createElement(E.Fragment,null,E.createElement("p",null," Hey developer "),E.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",E.createElement("code",{style:o},"ErrorBoundary")," or"," ",E.createElement("code",{style:o},"errorElement")," prop on your route.")),E.createElement(E.Fragment,null,E.createElement("h2",null,"Unexpected Application Error!"),E.createElement("h3",{style:{fontStyle:"italic"}},e),t?E.createElement("pre",{style:a},t):null,l)}var rR=E.createElement(aR,null),IS=class extends E.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.onError?this.props.onError(n,e):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const t=tR(n.digest);t&&(n=t)}let e=n!==void 0?E.createElement(ri.Provider,{value:this.props.routeContext},E.createElement(fm.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?E.createElement(oR,{error:n},e):e}};IS.contextType=Jx;var qh=new WeakMap;function oR({children:n,error:e}){let{basename:t}=E.useContext(Tn);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let i=eR(e.digest);if(i){let a=qh.get(e);if(a)throw a;let o=NS(i.location,t);if(MS&&!qh.get(e))if(o.isExternal||i.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:i.replace}));throw qh.set(e,l),l}return E.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return n}function cR({routeContext:n,match:e,children:t}){let i=E.useContext(rr);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),E.createElement(ri.Provider,{value:n},t)}function lR(n,e=[],t=null,i=null,a=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,l=t?.errors;if(l!=null){let m=o.findIndex(v=>v.route.id&&l?.[v.route.id]!==void 0);lt(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,m+1))}let u=!1,h=-1;if(t)for(let m=0;m<o.length;m++){let v=o[m];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(h=m),v.route.id){let{loaderData:b,errors:C}=t,T=v.route.loader&&!b.hasOwnProperty(v.route.id)&&(!C||C[v.route.id]===void 0);if(v.route.lazy||T){u=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=t&&i?(m,v)=>{i(m,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:Gx(t.matches),errorInfo:v})}:void 0;return o.reduceRight((m,v,b)=>{let C,T=!1,S=null,R=null;t&&(C=l&&v.route.id?l[v.route.id]:void 0,S=v.route.errorElement||rR,u&&(h<0&&b===0?(US("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),T=!0,R=null):h===b&&(T=!0,R=v.route.hydrateFallbackElement||null)));let _=e.concat(o.slice(0,b+1)),D=()=>{let j;return C?j=S:T?j=R:v.route.Component?j=E.createElement(v.route.Component,null):v.route.element?j=v.route.element:j=m,E.createElement(cR,{match:v,routeContext:{outlet:m,matches:_,isDataRoute:t!=null},children:j})};return t&&(v.route.ErrorBoundary||v.route.errorElement||b===0)?E.createElement(IS,{location:t.location,revalidation:t.revalidation,component:S,error:C,children:D(),routeContext:{outlet:null,matches:_,isDataRoute:!0},onError:f}):D()},null)}function mm(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function uR(n){let e=E.useContext(rr);return lt(e,mm(n)),e}function dR(n){let e=E.useContext(nu);return lt(e,mm(n)),e}function hR(n){let e=E.useContext(ri);return lt(e,mm(n)),e}function pm(n){let e=hR(n),t=e.matches[e.matches.length-1];return lt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function fR(){return pm("useRouteId")}function mR(){let n=E.useContext(fm),e=dR("useRouteError"),t=pm("useRouteError");return n!==void 0?n:e.errors?.[t]}function pR(){let{router:n}=uR("useNavigate"),e=pm("useNavigate"),t=E.useRef(!1);return PS(()=>{t.current=!0}),E.useCallback(async(a,o={})=>{Gn(t.current,jS),t.current&&(typeof a=="number"?await n.navigate(a):await n.navigate(a,{fromRouteId:e,...o}))},[n,e])}var pb={};function US(n,e,t){!e&&!pb[n]&&(pb[n]=!0,Gn(!1,t))}E.memo(gR);function gR({routes:n,future:e,state:t,onError:i}){return LS(n,void 0,t,i,e)}function cl({to:n,replace:e,state:t,relative:i}){lt(or(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=E.useContext(Tn);Gn(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=E.useContext(ri),{pathname:l}=ks(),u=iu(),h=hm(n,dm(o),l,i==="path"),f=JSON.stringify(h);return E.useEffect(()=>{u(JSON.parse(f),{replace:e,state:t,relative:i})},[u,f,i,e,t]),null}function vo(n){lt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function vR({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:a,static:o=!1,unstable_useTransitions:l}){lt(!or(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=n.replace(/^\/*/,"/"),h=E.useMemo(()=>({basename:u,navigator:a,static:o,unstable_useTransitions:l,future:{}}),[u,a,o,l]);typeof t=="string"&&(t=ar(t));let{pathname:f="/",search:m="",hash:v="",state:b=null,key:C="default"}=t,T=E.useMemo(()=>{let S=Ai(f,u);return S==null?null:{location:{pathname:S,search:m,hash:v,state:b,key:C},navigationType:i}},[u,f,m,v,b,C,i]);return Gn(T!=null,`<Router basename="${u}"> is not able to match the URL "${f}${m}${v}" because it does not start with the basename, so the <Router> won't render anything.`),T==null?null:E.createElement(Tn.Provider,{value:h},E.createElement(Uo.Provider,{children:e,value:T}))}function yR({children:n,location:e}){return sR(Rf(n),e)}function Rf(n,e=[]){let t=[];return E.Children.forEach(n,(i,a)=>{if(!E.isValidElement(i))return;let o=[...e,a];if(i.type===E.Fragment){t.push.apply(t,Rf(i.props.children,o));return}lt(i.type===vo,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),lt(!i.props.index||!i.props.children,"An index route cannot have child routes.");let l={id:i.props.id||o.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(l.children=Rf(i.props.children,o)),t.push(l)}),t}var gl="get",vl="application/x-www-form-urlencoded";function su(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function bR(n){return su(n)&&n.tagName.toLowerCase()==="button"}function SR(n){return su(n)&&n.tagName.toLowerCase()==="form"}function kR(n){return su(n)&&n.tagName.toLowerCase()==="input"}function CR(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function TR(n,e){return n.button===0&&(!e||e==="_self")&&!CR(n)}var ll=null;function ER(){if(ll===null)try{new FormData(document.createElement("form"),0),ll=!1}catch{ll=!0}return ll}var xR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Hh(n){return n!=null&&!xR.has(n)?(Gn(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${vl}"`),null):n}function RR(n,e){let t,i,a,o,l;if(SR(n)){let u=n.getAttribute("action");i=u?Ai(u,e):null,t=n.getAttribute("method")||gl,a=Hh(n.getAttribute("enctype"))||vl,o=new FormData(n)}else if(bR(n)||kR(n)&&(n.type==="submit"||n.type==="image")){let u=n.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=n.getAttribute("formaction")||u.getAttribute("action");if(i=h?Ai(h,e):null,t=n.getAttribute("formmethod")||u.getAttribute("method")||gl,a=Hh(n.getAttribute("formenctype"))||Hh(u.getAttribute("enctype"))||vl,o=new FormData(u,n),!ER()){let{name:f,type:m,value:v}=n;if(m==="image"){let b=f?`${f}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else f&&o.append(f,v)}}else{if(su(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=gl,i=null,a=vl,l=n}return o&&a==="text/plain"&&(l=o,o=void 0),{action:i,method:t.toLowerCase(),encType:a,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function gm(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function _R(n,e,t,i){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return t?a.pathname.endsWith("/")?a.pathname=`${a.pathname}_.${i}`:a.pathname=`${a.pathname}.${i}`:a.pathname==="/"?a.pathname=`_root.${i}`:e&&Ai(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function wR(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function MR(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function NR(n,e,t){let i=await Promise.all(n.map(async a=>{let o=e.routes[a.route.id];if(o){let l=await wR(o,t);return l.links?l.links():[]}return[]}));return jR(i.flat(1).filter(MR).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function gb(n,e,t,i,a,o){let l=(h,f)=>t[f]?h.route.id!==t[f].route.id:!0,u=(h,f)=>t[f].pathname!==h.pathname||t[f].route.path?.endsWith("*")&&t[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>l(h,f)||u(h,f)):o==="data"?e.filter((h,f)=>{let m=i.routes[h.route.id];if(!m||!m.hasLoader)return!1;if(l(h,f)||u(h,f))return!0;if(h.route.shouldRevalidate){let v=h.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function DR(n,e,{includeHydrateFallback:t}={}){return OR(n.map(i=>{let a=e.routes[i.route.id];if(!a)return[];let o=[a.module];return a.clientActionModule&&(o=o.concat(a.clientActionModule)),a.clientLoaderModule&&(o=o.concat(a.clientLoaderModule)),t&&a.hydrateFallbackModule&&(o=o.concat(a.hydrateFallbackModule)),a.imports&&(o=o.concat(a.imports)),o}).flat(1))}function OR(n){return[...new Set(n)]}function AR(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function jR(n,e){let t=new Set;return new Set(e),n.reduce((i,a)=>{let o=JSON.stringify(AR(a));return t.has(o)||(t.add(o),i.push({key:o,link:a})),i},[])}function BS(){let n=E.useContext(rr);return gm(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function PR(){let n=E.useContext(nu);return gm(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var vm=E.createContext(void 0);vm.displayName="FrameworkContext";function zS(){let n=E.useContext(vm);return gm(n,"You must render this element inside a <HydratedRouter> element"),n}function LR(n,e){let t=E.useContext(vm),[i,a]=E.useState(!1),[o,l]=E.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:f,onMouseLeave:m,onTouchStart:v}=e,b=E.useRef(null);E.useEffect(()=>{if(n==="render"&&l(!0),n==="viewport"){let S=_=>{_.forEach(D=>{l(D.isIntersecting)})},R=new IntersectionObserver(S,{threshold:.5});return b.current&&R.observe(b.current),()=>{R.disconnect()}}},[n]),E.useEffect(()=>{if(i){let S=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(S)}}},[i]);let C=()=>{a(!0)},T=()=>{a(!1),l(!1)};return t?n!=="intent"?[o,b,{}]:[o,b,{onFocus:ao(u,C),onBlur:ao(h,T),onMouseEnter:ao(f,C),onMouseLeave:ao(m,T),onTouchStart:ao(v,C)}]:[!1,b,{}]}function ao(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function IR({page:n,...e}){let{router:t}=BS(),i=E.useMemo(()=>RS(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?E.createElement(BR,{page:n,matches:i,...e}):null}function UR(n){let{manifest:e,routeModules:t}=zS(),[i,a]=E.useState([]);return E.useEffect(()=>{let o=!1;return NR(n,e,t).then(l=>{o||a(l)}),()=>{o=!0}},[n,e,t]),i}function BR({page:n,matches:e,...t}){let i=ks(),{future:a,manifest:o,routeModules:l}=zS(),{basename:u}=BS(),{loaderData:h,matches:f}=PR(),m=E.useMemo(()=>gb(n,e,f,o,i,"data"),[n,e,f,o,i]),v=E.useMemo(()=>gb(n,e,f,o,i,"assets"),[n,e,f,o,i]),b=E.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let S=new Set,R=!1;if(e.forEach(D=>{let j=o.routes[D.route.id];!j||!j.hasLoader||(!m.some(x=>x.route.id===D.route.id)&&D.route.id in h&&l[D.route.id]?.shouldRevalidate||j.hasClientLoader?R=!0:S.add(D.route.id))}),S.size===0)return[];let _=_R(n,u,a.unstable_trailingSlashAwareDataRequests,"data");return R&&S.size>0&&_.searchParams.set("_routes",e.filter(D=>S.has(D.route.id)).map(D=>D.route.id).join(",")),[_.pathname+_.search]},[u,a.unstable_trailingSlashAwareDataRequests,h,i,o,m,e,n,l]),C=E.useMemo(()=>DR(v,o),[v,o]),T=UR(v);return E.createElement(E.Fragment,null,b.map(S=>E.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...t})),C.map(S=>E.createElement("link",{key:S,rel:"modulepreload",href:S,...t})),T.map(({key:S,link:R})=>E.createElement("link",{key:S,nonce:t.nonce,...R,crossOrigin:R.crossOrigin??t.crossOrigin})))}function zR(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var FR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{FR&&(window.__reactRouterVersion="7.13.0")}catch{}function VR({basename:n,children:e,unstable_useTransitions:t,window:i}){let a=E.useRef();a.current==null&&(a.current=Cx({window:i,v5Compat:!0}));let o=a.current,[l,u]=E.useState({action:o.action,location:o.location}),h=E.useCallback(f=>{t===!1?u(f):E.startTransition(()=>u(f))},[t]);return E.useLayoutEffect(()=>o.listen(h),[o,h]),E.createElement(vR,{basename:n,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:t})}var FS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,au=E.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:a,reloadDocument:o,replace:l,state:u,target:h,to:f,preventScrollReset:m,viewTransition:v,unstable_defaultShouldRevalidate:b,...C},T){let{basename:S,unstable_useTransitions:R}=E.useContext(Tn),_=typeof f=="string"&&FS.test(f),D=NS(f,S);f=D.to;let j=nR(f,{relative:a}),[x,w,M]=LR(i,C),I=KR(f,{replace:l,state:u,target:h,preventScrollReset:m,relative:a,viewTransition:v,unstable_defaultShouldRevalidate:b,unstable_useTransitions:R});function F(A){e&&e(A),A.defaultPrevented||I(A)}let L=E.createElement("a",{...C,...M,href:D.absoluteURL||j,onClick:D.isExternal||o?e:F,ref:zR(T,w),target:h,"data-discover":!_&&t==="render"?"true":void 0});return x&&!_?E.createElement(E.Fragment,null,L,E.createElement(IR,{page:j})):L});au.displayName="Link";var qR=E.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:a=!1,style:o,to:l,viewTransition:u,children:h,...f},m){let v=Bo(l,{relative:f.relative}),b=ks(),C=E.useContext(nu),{navigator:T,basename:S}=E.useContext(Tn),R=C!=null&&XR(v)&&u===!0,_=T.encodeLocation?T.encodeLocation(v).pathname:v.pathname,D=b.pathname,j=C&&C.navigation&&C.navigation.location?C.navigation.location.pathname:null;t||(D=D.toLowerCase(),j=j?j.toLowerCase():null,_=_.toLowerCase()),j&&S&&(j=Ai(j,S)||j);const x=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let w=D===_||!a&&D.startsWith(_)&&D.charAt(x)==="/",M=j!=null&&(j===_||!a&&j.startsWith(_)&&j.charAt(_.length)==="/"),I={isActive:w,isPending:M,isTransitioning:R},F=w?e:void 0,L;typeof i=="function"?L=i(I):L=[i,w?"active":null,M?"pending":null,R?"transitioning":null].filter(Boolean).join(" ");let A=typeof o=="function"?o(I):o;return E.createElement(au,{...f,"aria-current":F,className:L,ref:m,style:A,to:l,viewTransition:u},typeof h=="function"?h(I):h)});qR.displayName="NavLink";var HR=E.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:a,state:o,method:l=gl,action:u,onSubmit:h,relative:f,preventScrollReset:m,viewTransition:v,unstable_defaultShouldRevalidate:b,...C},T)=>{let{unstable_useTransitions:S}=E.useContext(Tn),R=JR(),_=QR(u,{relative:f}),D=l.toLowerCase()==="get"?"get":"post",j=typeof u=="string"&&FS.test(u),x=w=>{if(h&&h(w),w.defaultPrevented)return;w.preventDefault();let M=w.nativeEvent.submitter,I=M?.getAttribute("formmethod")||l,F=()=>R(M||w.currentTarget,{fetcherKey:e,method:I,navigate:t,replace:a,state:o,relative:f,preventScrollReset:m,viewTransition:v,unstable_defaultShouldRevalidate:b});S&&t!==!1?E.startTransition(()=>F()):F()};return E.createElement("form",{ref:T,method:D,action:_,onSubmit:i?h:x,...C,"data-discover":!j&&n==="render"?"true":void 0})});HR.displayName="Form";function $R(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function VS(n){let e=E.useContext(rr);return lt(e,$R(n)),e}function KR(n,{target:e,replace:t,state:i,preventScrollReset:a,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:u,unstable_useTransitions:h}={}){let f=iu(),m=ks(),v=Bo(n,{relative:o});return E.useCallback(b=>{if(TR(b,e)){b.preventDefault();let C=t!==void 0?t:_o(m)===_o(v),T=()=>f(n,{replace:C,state:i,preventScrollReset:a,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:u});h?E.startTransition(()=>T()):T()}},[m,f,v,t,i,e,n,a,o,l,u,h])}var GR=0,YR=()=>`__${String(++GR)}__`;function JR(){let{router:n}=VS("useSubmit"),{basename:e}=E.useContext(Tn),t=fR(),i=n.fetch,a=n.navigate;return E.useCallback(async(o,l={})=>{let{action:u,method:h,encType:f,formData:m,body:v}=RR(o,e);if(l.navigate===!1){let b=l.fetcherKey||YR();await i(b,t,l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:m,body:v,formMethod:l.method||h,formEncType:l.encType||f,flushSync:l.flushSync})}else await a(l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:m,body:v,formMethod:l.method||h,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:t,flushSync:l.flushSync,viewTransition:l.viewTransition})},[i,a,e,t])}function QR(n,{relative:e}={}){let{basename:t}=E.useContext(Tn),i=E.useContext(ri);lt(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),o={...Bo(n||".",{relative:e})},l=ks();if(n==null){o.search=l.search;let u=new URLSearchParams(o.search),h=u.getAll("index");if(h.some(m=>m==="")){u.delete("index"),h.filter(v=>v).forEach(v=>u.append("index",v));let m=u.toString();o.search=m?`?${m}`:""}}return(!n||n===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(o.pathname=o.pathname==="/"?t:Oi([t,o.pathname])),_o(o)}function XR(n,{relative:e}={}){let t=E.useContext(OS);lt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=VS("useViewTransitionState"),a=Bo(n,{relative:e});if(!t.isTransitioning)return!1;let o=Ai(t.currentLocation.pathname,i)||t.currentLocation.pathname,l=Ai(t.nextLocation.pathname,i)||t.nextLocation.pathname;return jl(a.pathname,l)!=null||jl(a.pathname,o)!=null}var qS=xS();const xe=n=>typeof n=="string",ro=()=>{let n,e;const t=new Promise((i,a)=>{n=i,e=a});return t.resolve=n,t.reject=e,t},vb=n=>n==null?"":""+n,WR=(n,e,t)=>{n.forEach(i=>{e[i]&&(t[i]=e[i])})},ZR=/###/g,yb=n=>n&&n.indexOf("###")>-1?n.replace(ZR,"."):n,bb=n=>!n||xe(n),So=(n,e,t)=>{const i=xe(e)?e.split("."):e;let a=0;for(;a<i.length-1;){if(bb(n))return{};const o=yb(i[a]);!n[o]&&t&&(n[o]=new t),Object.prototype.hasOwnProperty.call(n,o)?n=n[o]:n={},++a}return bb(n)?{}:{obj:n,k:yb(i[a])}},Sb=(n,e,t)=>{const{obj:i,k:a}=So(n,e,Object);if(i!==void 0||e.length===1){i[a]=t;return}let o=e[e.length-1],l=e.slice(0,e.length-1),u=So(n,l,Object);for(;u.obj===void 0&&l.length;)o=`${l[l.length-1]}.${o}`,l=l.slice(0,l.length-1),u=So(n,l,Object),u?.obj&&typeof u.obj[`${u.k}.${o}`]<"u"&&(u.obj=void 0);u.obj[`${u.k}.${o}`]=t},e_=(n,e,t,i)=>{const{obj:a,k:o}=So(n,e,Object);a[o]=a[o]||[],a[o].push(t)},Pl=(n,e)=>{const{obj:t,k:i}=So(n,e);if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i]},t_=(n,e,t)=>{const i=Pl(n,t);return i!==void 0?i:Pl(e,t)},HS=(n,e,t)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in n?xe(n[i])||n[i]instanceof String||xe(e[i])||e[i]instanceof String?t&&(n[i]=e[i]):HS(n[i],e[i],t):n[i]=e[i]);return n},Ua=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var n_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const i_=n=>xe(n)?n.replace(/[&<>"'\/]/g,e=>n_[e]):n;class s_{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const a_=[" ",",","?","!",";"],r_=new s_(20),o_=(n,e,t)=>{e=e||"",t=t||"";const i=a_.filter(l=>e.indexOf(l)<0&&t.indexOf(l)<0);if(i.length===0)return!0;const a=r_.getRegExp(`(${i.map(l=>l==="?"?"\\?":l).join("|")})`);let o=!a.test(n);if(!o){const l=n.indexOf(t);l>0&&!a.test(n.substring(0,l))&&(o=!0)}return o},_f=(n,e,t=".")=>{if(!n)return;if(n[e])return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0;const i=e.split(t);let a=n;for(let o=0;o<i.length;){if(!a||typeof a!="object")return;let l,u="";for(let h=o;h<i.length;++h)if(h!==o&&(u+=t),u+=i[h],l=a[u],l!==void 0){if(["string","number","boolean"].indexOf(typeof l)>-1&&h<i.length-1)continue;o+=h-o+1;break}a=l}return a},wo=n=>n?.replace("_","-"),c_={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console?.[n]?.apply?.(console,e)}};class Ll{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||c_,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,a){return a&&!this.debug?null:(xe(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Ll(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Ll(this.logger,e)}}var ti=new Ll;class ru{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const a=this.observers[i].get(t)||0;this.observers[i].set(t,a+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([a,o])=>{for(let l=0;l<o;l++)a(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([a,o])=>{for(let l=0;l<o;l++)a.apply(a,[e,...t])})}}class kb extends ru{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i,a={}){const o=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,l=a.ignoreJSONStructure!==void 0?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let u;e.indexOf(".")>-1?u=e.split("."):(u=[e,t],i&&(Array.isArray(i)?u.push(...i):xe(i)&&o?u.push(...i.split(o)):u.push(i)));const h=Pl(this.data,u);return!h&&!t&&!i&&e.indexOf(".")>-1&&(e=u[0],t=u[1],i=u.slice(2).join(".")),h||!l||!xe(i)?h:_f(this.data?.[e]?.[t],i,o)}addResource(e,t,i,a,o={silent:!1}){const l=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let u=[e,t];i&&(u=u.concat(l?i.split(l):i)),e.indexOf(".")>-1&&(u=e.split("."),a=t,t=u[1]),this.addNamespaces(t),Sb(this.data,u,a),o.silent||this.emit("added",e,t,i,a)}addResources(e,t,i,a={silent:!1}){for(const o in i)(xe(i[o])||Array.isArray(i[o]))&&this.addResource(e,t,o,i[o],{silent:!0});a.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,a,o,l={silent:!1,skipCopy:!1}){let u=[e,t];e.indexOf(".")>-1&&(u=e.split("."),a=i,i=t,t=u[1]),this.addNamespaces(t);let h=Pl(this.data,u)||{};l.skipCopy||(i=JSON.parse(JSON.stringify(i))),a?HS(h,i,o):h={...h,...i},Sb(this.data,u,h),l.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(a=>t[a]&&Object.keys(t[a]).length>0)}toJSON(){return this.data}}var $S={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,i,a){return n.forEach(o=>{e=this.processors[o]?.process(e,t,i,a)??e}),e}};const KS=Symbol("i18next/PATH_KEY");function l_(){const n=[],e=Object.create(null);let t;return e.get=(i,a)=>(t?.revoke?.(),a===KS?n:(n.push(a),t=Proxy.revocable(i,e),t.proxy)),Proxy.revocable(Object.create(null),e).proxy}function wf(n,e){const{[KS]:t}=n(l_());return t.join(e?.keySeparator??".")}const Cb={},$h=n=>!xe(n)&&typeof n!="boolean"&&typeof n!="number";class Il extends ru{constructor(e,t={}){super(),WR(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=ti.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const i={...t};if(e==null)return!1;const a=this.resolve(e,i);if(a?.res===void 0)return!1;const o=$h(a.res);return!(i.returnObjects===!1&&o)}extractFromKey(e,t){let i=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const a=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let o=t.ns||this.options.defaultNS||[];const l=i&&e.indexOf(i)>-1,u=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!o_(e,i,a);if(l&&!u){const h=e.match(this.interpolator.nestingRegexp);if(h&&h.length>0)return{key:e,namespaces:xe(o)?[o]:o};const f=e.split(i);(i!==a||i===a&&this.options.ns.indexOf(f[0])>-1)&&(o=f.shift()),e=f.join(a)}return{key:e,namespaces:xe(o)?[o]:o}}translate(e,t,i){let a=typeof t=="object"?{...t}:t;if(typeof a!="object"&&this.options.overloadTranslationOptionHandler&&(a=this.options.overloadTranslationOptionHandler(arguments)),typeof a=="object"&&(a={...a}),a||(a={}),e==null)return"";typeof e=="function"&&(e=wf(e,{...this.options,...a})),Array.isArray(e)||(e=[String(e)]);const o=a.returnDetails!==void 0?a.returnDetails:this.options.returnDetails,l=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,{key:u,namespaces:h}=this.extractFromKey(e[e.length-1],a),f=h[h.length-1];let m=a.nsSeparator!==void 0?a.nsSeparator:this.options.nsSeparator;m===void 0&&(m=":");const v=a.lng||this.language,b=a.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(v?.toLowerCase()==="cimode")return b?o?{res:`${f}${m}${u}`,usedKey:u,exactUsedKey:u,usedLng:v,usedNS:f,usedParams:this.getUsedParamsDetails(a)}:`${f}${m}${u}`:o?{res:u,usedKey:u,exactUsedKey:u,usedLng:v,usedNS:f,usedParams:this.getUsedParamsDetails(a)}:u;const C=this.resolve(e,a);let T=C?.res;const S=C?.usedKey||u,R=C?.exactUsedKey||u,_=["[object Number]","[object Function]","[object RegExp]"],D=a.joinArrays!==void 0?a.joinArrays:this.options.joinArrays,j=!this.i18nFormat||this.i18nFormat.handleAsObject,x=a.count!==void 0&&!xe(a.count),w=Il.hasDefaultValue(a),M=x?this.pluralResolver.getSuffix(v,a.count,a):"",I=a.ordinal&&x?this.pluralResolver.getSuffix(v,a.count,{ordinal:!1}):"",F=x&&!a.ordinal&&a.count===0,L=F&&a[`defaultValue${this.options.pluralSeparator}zero`]||a[`defaultValue${M}`]||a[`defaultValue${I}`]||a.defaultValue;let A=T;j&&!T&&w&&(A=L);const O=$h(A),Y=Object.prototype.toString.apply(A);if(j&&A&&O&&_.indexOf(Y)<0&&!(xe(D)&&Array.isArray(A))){if(!a.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const J=this.options.returnedObjectHandler?this.options.returnedObjectHandler(S,A,{...a,ns:h}):`key '${u} (${this.language})' returned an object instead of string.`;return o?(C.res=J,C.usedParams=this.getUsedParamsDetails(a),C):J}if(l){const J=Array.isArray(A),le=J?[]:{},Te=J?R:S;for(const H in A)if(Object.prototype.hasOwnProperty.call(A,H)){const ae=`${Te}${l}${H}`;w&&!T?le[H]=this.translate(ae,{...a,defaultValue:$h(L)?L[H]:void 0,joinArrays:!1,ns:h}):le[H]=this.translate(ae,{...a,joinArrays:!1,ns:h}),le[H]===ae&&(le[H]=A[H])}T=le}}else if(j&&xe(D)&&Array.isArray(T))T=T.join(D),T&&(T=this.extendTranslation(T,e,a,i));else{let J=!1,le=!1;!this.isValidLookup(T)&&w&&(J=!0,T=L),this.isValidLookup(T)||(le=!0,T=u);const H=(a.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&le?void 0:T,ae=w&&L!==T&&this.options.updateMissing;if(le||J||ae){if(this.logger.log(ae?"updateKey":"missingKey",v,f,u,ae?L:T),l){const B=this.resolve(u,{...a,keySeparator:!1});B&&B.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let de=[];const Ee=this.languageUtils.getFallbackCodes(this.options.fallbackLng,a.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Ee&&Ee[0])for(let B=0;B<Ee.length;B++)de.push(Ee[B]);else this.options.saveMissingTo==="all"?de=this.languageUtils.toResolveHierarchy(a.lng||this.language):de.push(a.lng||this.language);const De=(B,W,oe)=>{const he=w&&oe!==T?oe:H;this.options.missingKeyHandler?this.options.missingKeyHandler(B,f,W,he,ae,a):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(B,f,W,he,ae,a),this.emit("missingKey",B,f,W,T)};this.options.saveMissing&&(this.options.saveMissingPlurals&&x?de.forEach(B=>{const W=this.pluralResolver.getSuffixes(B,a);F&&a[`defaultValue${this.options.pluralSeparator}zero`]&&W.indexOf(`${this.options.pluralSeparator}zero`)<0&&W.push(`${this.options.pluralSeparator}zero`),W.forEach(oe=>{De([B],u+oe,a[`defaultValue${oe}`]||L)})}):De(de,u,L))}T=this.extendTranslation(T,e,a,C,i),le&&T===u&&this.options.appendNamespaceToMissingKey&&(T=`${f}${m}${u}`),(le||J)&&this.options.parseMissingKeyHandler&&(T=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${f}${m}${u}`:u,J?T:void 0,a))}return o?(C.res=T,C.usedParams=this.getUsedParamsDetails(a),C):T}extendTranslation(e,t,i,a,o){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const h=xe(e)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let f;if(h){const v=e.match(this.interpolator.nestingRegexp);f=v&&v.length}let m=i.replace&&!xe(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(m={...this.options.interpolation.defaultVariables,...m}),e=this.interpolator.interpolate(e,m,i.lng||this.language||a.usedLng,i),h){const v=e.match(this.interpolator.nestingRegexp),b=v&&v.length;f<b&&(i.nest=!1)}!i.lng&&a&&a.res&&(i.lng=this.language||a.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,(...v)=>o?.[0]===v[0]&&!i.context?(this.logger.warn(`It seems you are nesting recursively key: ${v[0]} in key: ${t[0]}`),null):this.translate(...v,t),i)),i.interpolation&&this.interpolator.reset()}const l=i.postProcess||this.options.postProcess,u=xe(l)?[l]:l;return e!=null&&u?.length&&i.applyPostProcessor!==!1&&(e=$S.handle(u,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e,t={}){let i,a,o,l,u;return xe(e)&&(e=[e]),e.forEach(h=>{if(this.isValidLookup(i))return;const f=this.extractFromKey(h,t),m=f.key;a=m;let v=f.namespaces;this.options.fallbackNS&&(v=v.concat(this.options.fallbackNS));const b=t.count!==void 0&&!xe(t.count),C=b&&!t.ordinal&&t.count===0,T=t.context!==void 0&&(xe(t.context)||typeof t.context=="number")&&t.context!=="",S=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);v.forEach(R=>{this.isValidLookup(i)||(u=R,!Cb[`${S[0]}-${R}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(u)&&(Cb[`${S[0]}-${R}`]=!0,this.logger.warn(`key "${a}" for languages "${S.join(", ")}" won't get resolved as namespace "${u}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),S.forEach(_=>{if(this.isValidLookup(i))return;l=_;const D=[m];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(D,m,_,R,t);else{let x;b&&(x=this.pluralResolver.getSuffix(_,t.count,t));const w=`${this.options.pluralSeparator}zero`,M=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(b&&(t.ordinal&&x.indexOf(M)===0&&D.push(m+x.replace(M,this.options.pluralSeparator)),D.push(m+x),C&&D.push(m+w)),T){const I=`${m}${this.options.contextSeparator||"_"}${t.context}`;D.push(I),b&&(t.ordinal&&x.indexOf(M)===0&&D.push(I+x.replace(M,this.options.pluralSeparator)),D.push(I+x),C&&D.push(I+w))}}let j;for(;j=D.pop();)this.isValidLookup(i)||(o=j,i=this.getResource(_,R,j,t))}))})}),{res:i,usedKey:a,exactUsedKey:o,usedLng:l,usedNS:u}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,i,a={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,i,a):this.resourceStore.getResource(e,t,i,a)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!xe(e.replace);let a=i?e.replace:e;if(i&&typeof e.count<"u"&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!i){a={...a};for(const o of t)delete a[o]}return a}static hasDefaultValue(e){const t="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&e[i]!==void 0)return!0;return!1}}class Tb{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=ti.create("languageUtils")}getScriptPartFromCode(e){if(e=wo(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=wo(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(xe(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(i=>{if(t)return;const a=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(a))&&(t=a)}),!t&&this.options.supportedLngs&&e.forEach(i=>{if(t)return;const a=this.getScriptPartFromCode(i);if(this.isSupportedCode(a))return t=a;const o=this.getLanguagePartFromCode(i);if(this.isSupportedCode(o))return t=o;t=this.options.supportedLngs.find(l=>{if(l===o)return l;if(!(l.indexOf("-")<0&&o.indexOf("-")<0)&&(l.indexOf("-")>0&&o.indexOf("-")<0&&l.substring(0,l.indexOf("-"))===o||l.indexOf(o)===0&&o.length>1))return l})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),xe(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes((t===!1?[]:t)||this.options.fallbackLng||[],e),a=[],o=l=>{l&&(this.isSupportedCode(l)?a.push(l):this.logger.warn(`rejecting language code not found in supportedLngs: ${l}`))};return xe(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(e))):xe(e)&&o(this.formatLanguageCode(e)),i.forEach(l=>{a.indexOf(l)<0&&o(this.formatLanguageCode(l))}),a}}const Eb={zero:0,one:1,two:2,few:3,many:4,other:5},xb={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class u_{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=ti.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const i=wo(e==="dev"?"en":e),a=t.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:i,type:a});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let l;try{l=new Intl.PluralRules(i,{type:a})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),xb;if(!e.match(/-|_/))return xb;const h=this.languageUtils.getLanguagePartFromCode(e);l=this.getRule(h,t)}return this.pluralRulesCache[o]=l,l}needsPlural(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,i={}){return this.getSuffixes(e,i).map(a=>`${t}${a}`)}getSuffixes(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?i.resolvedOptions().pluralCategories.sort((a,o)=>Eb[a]-Eb[o]).map(a=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${a}`):[]}getSuffix(e,t,i={}){const a=this.getRule(e,i);return a?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,i))}}const Rb=(n,e,t,i=".",a=!0)=>{let o=t_(n,e,t);return!o&&a&&xe(t)&&(o=_f(n,t,i),o===void 0&&(o=_f(e,t,i))),o},Kh=n=>n.replace(/\$/g,"$$$$");class _b{constructor(e={}){this.logger=ti.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(t=>t),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:a,prefix:o,prefixEscaped:l,suffix:u,suffixEscaped:h,formatSeparator:f,unescapeSuffix:m,unescapePrefix:v,nestingPrefix:b,nestingPrefixEscaped:C,nestingSuffix:T,nestingSuffixEscaped:S,nestingOptionsSeparator:R,maxReplaces:_,alwaysFormat:D}=e.interpolation;this.escape=t!==void 0?t:i_,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=a!==void 0?a:!1,this.prefix=o?Ua(o):l||"{{",this.suffix=u?Ua(u):h||"}}",this.formatSeparator=f||",",this.unescapePrefix=m?"":v||"-",this.unescapeSuffix=this.unescapePrefix?"":m||"",this.nestingPrefix=b?Ua(b):C||Ua("$t("),this.nestingSuffix=T?Ua(T):S||Ua(")"),this.nestingOptionsSeparator=R||",",this.maxReplaces=_||1e3,this.alwaysFormat=D!==void 0?D:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,i)=>t?.source===i?(t.lastIndex=0,t):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,i,a){let o,l,u;const h=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},f=C=>{if(C.indexOf(this.formatSeparator)<0){const _=Rb(t,h,C,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(_,void 0,i,{...a,...t,interpolationkey:C}):_}const T=C.split(this.formatSeparator),S=T.shift().trim(),R=T.join(this.formatSeparator).trim();return this.format(Rb(t,h,S,this.options.keySeparator,this.options.ignoreJSONStructure),R,i,{...a,...t,interpolationkey:S})};this.resetRegExp();const m=a?.missingInterpolationHandler||this.options.missingInterpolationHandler,v=a?.interpolation?.skipOnVariables!==void 0?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:C=>Kh(C)},{regex:this.regexp,safeValue:C=>this.escapeValue?Kh(this.escape(C)):Kh(C)}].forEach(C=>{for(u=0;o=C.regex.exec(e);){const T=o[1].trim();if(l=f(T),l===void 0)if(typeof m=="function"){const R=m(e,o,a);l=xe(R)?R:""}else if(a&&Object.prototype.hasOwnProperty.call(a,T))l="";else if(v){l=o[0];continue}else this.logger.warn(`missed to pass in variable ${T} for interpolating ${e}`),l="";else!xe(l)&&!this.useRawValueToEscape&&(l=vb(l));const S=C.safeValue(l);if(e=e.replace(o[0],S),v?(C.regex.lastIndex+=l.length,C.regex.lastIndex-=o[0].length):C.regex.lastIndex=0,u++,u>=this.maxReplaces)break}}),e}nest(e,t,i={}){let a,o,l;const u=(h,f)=>{const m=this.nestingOptionsSeparator;if(h.indexOf(m)<0)return h;const v=h.split(new RegExp(`${m}[ ]*{`));let b=`{${v[1]}`;h=v[0],b=this.interpolate(b,l);const C=b.match(/'/g),T=b.match(/"/g);((C?.length??0)%2===0&&!T||T.length%2!==0)&&(b=b.replace(/'/g,'"'));try{l=JSON.parse(b),f&&(l={...f,...l})}catch(S){return this.logger.warn(`failed parsing options string in nesting for key ${h}`,S),`${h}${m}${b}`}return l.defaultValue&&l.defaultValue.indexOf(this.prefix)>-1&&delete l.defaultValue,h};for(;a=this.nestingRegexp.exec(e);){let h=[];l={...i},l=l.replace&&!xe(l.replace)?l.replace:l,l.applyPostProcessor=!1,delete l.defaultValue;const f=/{.*}/.test(a[1])?a[1].lastIndexOf("}")+1:a[1].indexOf(this.formatSeparator);if(f!==-1&&(h=a[1].slice(f).split(this.formatSeparator).map(m=>m.trim()).filter(Boolean),a[1]=a[1].slice(0,f)),o=t(u.call(this,a[1].trim(),l),l),o&&a[0]===e&&!xe(o))return o;xe(o)||(o=vb(o)),o||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${e}`),o=""),h.length&&(o=h.reduce((m,v)=>this.format(m,v,i.lng,{...i,interpolationkey:a[1].trim()}),o.trim())),e=e.replace(a[0],o),this.regexp.lastIndex=0}return e}}const d_=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const i=n.split("(");e=i[0].toLowerCase().trim();const a=i[1].substring(0,i[1].length-1);e==="currency"&&a.indexOf(":")<0?t.currency||(t.currency=a.trim()):e==="relativetime"&&a.indexOf(":")<0?t.range||(t.range=a.trim()):a.split(";").forEach(l=>{if(l){const[u,...h]=l.split(":"),f=h.join(":").trim().replace(/^'+|'+$/g,""),m=u.trim();t[m]||(t[m]=f),f==="false"&&(t[m]=!1),f==="true"&&(t[m]=!0),isNaN(f)||(t[m]=parseInt(f,10))}})}return{formatName:e,formatOptions:t}},wb=n=>{const e={};return(t,i,a)=>{let o=a;a&&a.interpolationkey&&a.formatParams&&a.formatParams[a.interpolationkey]&&a[a.interpolationkey]&&(o={...o,[a.interpolationkey]:void 0});const l=i+JSON.stringify(o);let u=e[l];return u||(u=n(wo(i),a),e[l]=u),u(t)}},h_=n=>(e,t,i)=>n(wo(t),i)(e);class f_{constructor(e={}){this.logger=ti.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const i=t.cacheInBuiltFormats?wb:h_;this.formats={number:i((a,o)=>{const l=new Intl.NumberFormat(a,{...o});return u=>l.format(u)}),currency:i((a,o)=>{const l=new Intl.NumberFormat(a,{...o,style:"currency"});return u=>l.format(u)}),datetime:i((a,o)=>{const l=new Intl.DateTimeFormat(a,{...o});return u=>l.format(u)}),relativetime:i((a,o)=>{const l=new Intl.RelativeTimeFormat(a,{...o});return u=>l.format(u,o.range||"day")}),list:i((a,o)=>{const l=new Intl.ListFormat(a,{...o});return u=>l.format(u)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=wb(t)}format(e,t,i,a={}){const o=t.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(u=>u.indexOf(")")>-1)){const u=o.findIndex(h=>h.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,u)].join(this.formatSeparator)}return o.reduce((u,h)=>{const{formatName:f,formatOptions:m}=d_(h);if(this.formats[f]){let v=u;try{const b=a?.formatParams?.[a.interpolationkey]||{},C=b.locale||b.lng||a.locale||a.lng||i;v=this.formats[f](u,C,{...m,...a,...b})}catch(b){this.logger.warn(b)}return v}else this.logger.warn(`there was no format function for ${f}`);return u},e)}}const m_=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class p_ extends ru{constructor(e,t,i,a={}){super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=a,this.logger=ti.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,a.backend,a)}queueLoad(e,t,i,a){const o={},l={},u={},h={};return e.forEach(f=>{let m=!0;t.forEach(v=>{const b=`${f}|${v}`;!i.reload&&this.store.hasResourceBundle(f,v)?this.state[b]=2:this.state[b]<0||(this.state[b]===1?l[b]===void 0&&(l[b]=!0):(this.state[b]=1,m=!1,l[b]===void 0&&(l[b]=!0),o[b]===void 0&&(o[b]=!0),h[v]===void 0&&(h[v]=!0)))}),m||(u[f]=!0)}),(Object.keys(o).length||Object.keys(l).length)&&this.queue.push({pending:l,pendingCount:Object.keys(l).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(o),pending:Object.keys(l),toLoadLanguages:Object.keys(u),toLoadNamespaces:Object.keys(h)}}loaded(e,t,i){const a=e.split("|"),o=a[0],l=a[1];t&&this.emit("failedLoading",o,l,t),!t&&i&&this.store.addResourceBundle(o,l,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const u={};this.queue.forEach(h=>{e_(h.loaded,[o],l),m_(h,e),t&&h.errors.push(t),h.pendingCount===0&&!h.done&&(Object.keys(h.loaded).forEach(f=>{u[f]||(u[f]={});const m=h.loaded[f];m.length&&m.forEach(v=>{u[f][v]===void 0&&(u[f][v]=!0)})}),h.done=!0,h.errors.length?h.callback(h.errors):h.callback())}),this.emit("loaded",u),this.queue=this.queue.filter(h=>!h.done)}read(e,t,i,a=0,o=this.retryTimeout,l){if(!e.length)return l(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:i,tried:a,wait:o,callback:l});return}this.readingCalls++;const u=(f,m)=>{if(this.readingCalls--,this.waitingReads.length>0){const v=this.waitingReads.shift();this.read(v.lng,v.ns,v.fcName,v.tried,v.wait,v.callback)}if(f&&m&&a<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,i,a+1,o*2,l)},o);return}l(f,m)},h=this.backend[i].bind(this.backend);if(h.length===2){try{const f=h(e,t);f&&typeof f.then=="function"?f.then(m=>u(null,m)).catch(u):u(null,f)}catch(f){u(f)}return}return h(e,t,u)}prepareLoading(e,t,i={},a){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();xe(e)&&(e=this.languageUtils.toResolveHierarchy(e)),xe(t)&&(t=[t]);const o=this.queueLoad(e,t,i,a);if(!o.toLoad.length)return o.pending.length||a(),null;o.toLoad.forEach(l=>{this.loadOne(l)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e,t=""){const i=e.split("|"),a=i[0],o=i[1];this.read(a,o,"read",void 0,void 0,(l,u)=>{l&&this.logger.warn(`${t}loading namespace ${o} for language ${a} failed`,l),!l&&u&&this.logger.log(`${t}loaded namespace ${o} for language ${a}`,u),this.loaded(e,l,u)})}saveMissing(e,t,i,a,o,l={},u=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend?.create){const h={...l,isUpdate:o},f=this.backend.create.bind(this.backend);if(f.length<6)try{let m;f.length===5?m=f(e,t,i,a,h):m=f(e,t,i,a),m&&typeof m.then=="function"?m.then(v=>u(null,v)).catch(u):u(null,m)}catch(m){u(m)}else f(e,t,i,a,u,h)}!e||!e[0]||this.store.addResource(e[0],t,i,a)}}}const Gh=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),xe(n[1])&&(e.defaultValue=n[1]),xe(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(i=>{e[i]=t[i]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Mb=n=>(xe(n.ns)&&(n.ns=[n.ns]),xe(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),xe(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs?.indexOf?.("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n),ul=()=>{},g_=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})},v_=n=>!!(n?.modules?.backend?.name?.indexOf("Locize")>0||n?.modules?.backend?.constructor?.name?.indexOf("Locize")>0||n?.options?.backend?.backends&&n.options.backend.backends.some(e=>e?.name?.indexOf("Locize")>0||e?.constructor?.name?.indexOf("Locize")>0));class ko extends ru{constructor(e={},t){if(super(),this.options=Mb(e),this.services={},this.logger=ti,this.modules={external:[]},g_(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,typeof e=="function"&&(t=e,e={}),e.defaultNS==null&&e.ns&&(xe(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const i=Gh();this.options={...i,...this.options,...Mb(e)},this.options.interpolation={...i.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=i.overloadTranslationOptionHandler),this.options.showSupportNotice!==!1&&!v_(this)&&typeof console<"u"&&typeof console.info<"u"&&console.info(" i18next is maintained with support from locize.com  consider powering your project with managed localization (AI, CDN, integrations): https://locize.com ");const a=f=>f?typeof f=="function"?new f:f:null;if(!this.options.isClone){this.modules.logger?ti.init(a(this.modules.logger),this.options):ti.init(null,this.options);let f;this.modules.formatter?f=this.modules.formatter:f=f_;const m=new Tb(this.options);this.store=new kb(this.options.resources,this.options);const v=this.services;v.logger=ti,v.resourceStore=this.store,v.languageUtils=m,v.pluralResolver=new u_(m,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),f&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(v.formatter=a(f),v.formatter.init&&v.formatter.init(v,this.options),this.options.interpolation.format=v.formatter.format.bind(v.formatter)),v.interpolator=new _b(this.options),v.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},v.backendConnector=new p_(a(this.modules.backend),v.resourceStore,v,this.options),v.backendConnector.on("*",(C,...T)=>{this.emit(C,...T)}),this.modules.languageDetector&&(v.languageDetector=a(this.modules.languageDetector),v.languageDetector.init&&v.languageDetector.init(v,this.options.detection,this.options)),this.modules.i18nFormat&&(v.i18nFormat=a(this.modules.i18nFormat),v.i18nFormat.init&&v.i18nFormat.init(this)),this.translator=new Il(this.services,this.options),this.translator.on("*",(C,...T)=>{this.emit(C,...T)}),this.modules.external.forEach(C=>{C.init&&C.init(this)})}if(this.format=this.options.interpolation.format,t||(t=ul),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const f=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);f.length>0&&f[0]!=="dev"&&(this.options.lng=f[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(f=>{this[f]=(...m)=>this.store[f](...m)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(f=>{this[f]=(...m)=>(this.store[f](...m),this)});const u=ro(),h=()=>{const f=(m,v)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),u.resolve(v),t(m,v)};if(this.languages&&!this.isInitialized)return f(null,this.t.bind(this));this.changeLanguage(this.options.lng,f)};return this.options.resources||!this.options.initAsync?h():setTimeout(h,0),u}loadResources(e,t=ul){let i=t;const a=xe(e)?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(a?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const o=[],l=u=>{if(!u||u==="cimode")return;this.services.languageUtils.toResolveHierarchy(u).forEach(f=>{f!=="cimode"&&o.indexOf(f)<0&&o.push(f)})};a?l(a):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(h=>l(h)),this.options.preload?.forEach?.(u=>l(u)),this.services.backendConnector.load(o,this.options.ns,u=>{!u&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(u)})}else i(null)}reloadResources(e,t,i){const a=ro();return typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=ul),this.services.backendConnector.reload(e,t,o=>{a.resolve(),i(o)}),a}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&$S.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let t=0;t<this.languages.length;t++){const i=this.languages[t];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const i=ro();this.emit("languageChanging",e);const a=u=>{this.language=u,this.languages=this.services.languageUtils.toResolveHierarchy(u),this.resolvedLanguage=void 0,this.setResolvedLanguage(u)},o=(u,h)=>{h?this.isLanguageChangingTo===e&&(a(h),this.translator.changeLanguage(h),this.isLanguageChangingTo=void 0,this.emit("languageChanged",h),this.logger.log("languageChanged",h)):this.isLanguageChangingTo=void 0,i.resolve((...f)=>this.t(...f)),t&&t(u,(...f)=>this.t(...f))},l=u=>{!e&&!u&&this.services.languageDetector&&(u=[]);const h=xe(u)?u:u&&u[0],f=this.store.hasLanguageSomeTranslations(h)?h:this.services.languageUtils.getBestMatchFromCodes(xe(u)?[u]:u);f&&(this.language||a(f),this.translator.language||this.translator.changeLanguage(f),this.services.languageDetector?.cacheUserLanguage?.(f)),this.loadResources(f,m=>{o(m,f)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?l(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(l):this.services.languageDetector.detect(l):l(e),i}getFixedT(e,t,i){const a=(o,l,...u)=>{let h;typeof l!="object"?h=this.options.overloadTranslationOptionHandler([o,l].concat(u)):h={...l},h.lng=h.lng||a.lng,h.lngs=h.lngs||a.lngs,h.ns=h.ns||a.ns,h.keyPrefix!==""&&(h.keyPrefix=h.keyPrefix||i||a.keyPrefix);const f=this.options.keySeparator||".";let m;return h.keyPrefix&&Array.isArray(o)?m=o.map(v=>(typeof v=="function"&&(v=wf(v,{...this.options,...l})),`${h.keyPrefix}${f}${v}`)):(typeof o=="function"&&(o=wf(o,{...this.options,...l})),m=h.keyPrefix?`${h.keyPrefix}${f}${o}`:o),this.t(m,h)};return xe(e)?a.lng=e:a.lngs=e,a.ns=t,a.keyPrefix=i,a}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],a=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const l=(u,h)=>{const f=this.services.backendConnector.state[`${u}|${h}`];return f===-1||f===0||f===2};if(t.precheck){const u=t.precheck(this,l);if(u!==void 0)return u}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||l(i,e)&&(!a||l(o,e)))}loadNamespaces(e,t){const i=ro();return this.options.ns?(xe(e)&&(e=[e]),e.forEach(a=>{this.options.ns.indexOf(a)<0&&this.options.ns.push(a)}),this.loadResources(a=>{i.resolve(),t&&t(a)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=ro();xe(e)&&(e=[e]);const a=this.options.preload||[],o=e.filter(l=>a.indexOf(l)<0&&this.services.languageUtils.isSupportedCode(l));return o.length?(this.options.preload=a.concat(o),this.loadResources(l=>{i.resolve(),t&&t(l)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const a=new Intl.Locale(e);if(a&&a.getTextInfo){const o=a.getTextInfo();if(o&&o.direction)return o.direction}}catch{}const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services?.languageUtils||new Tb(Gh());return e.toLowerCase().indexOf("-latn")>1?"ltr":t.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){const i=new ko(e,t);return i.createInstance=ko.createInstance,i}cloneInstance(e={},t=ul){const i=e.forkResourceStore;i&&delete e.forkResourceStore;const a={...this.options,...e,isClone:!0},o=new ko(a);if((e.debug!==void 0||e.prefix!==void 0)&&(o.logger=o.logger.clone(e)),["store","services","language"].forEach(u=>{o[u]=this[u]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},i){const u=Object.keys(this.store.data).reduce((h,f)=>(h[f]={...this.store.data[f]},h[f]=Object.keys(h[f]).reduce((m,v)=>(m[v]={...h[f][v]},m),h[f]),h),{});o.store=new kb(u,a),o.services.resourceStore=o.store}if(e.interpolation){const h={...Gh().interpolation,...this.options.interpolation,...e.interpolation},f={...a,interpolation:h};o.services.interpolator=new _b(f)}return o.translator=new Il(o.services,a),o.translator.on("*",(u,...h)=>{o.emit(u,...h)}),o.init(a,t),o.translator.options=a,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Xt=ko.createInstance();Xt.createInstance;Xt.dir;Xt.init;Xt.loadResources;Xt.reloadResources;Xt.use;Xt.changeLanguage;Xt.getFixedT;Xt.t;Xt.exists;Xt.setDefaultNamespace;Xt.hasLoadedNamespace;Xt.loadNamespaces;Xt.loadLanguages;const y_=(n,e,t,i)=>{const a=[t,{code:e,...i||{}}];if(n?.services?.logger?.forward)return n.services.logger.forward(a,"warn","react-i18next::",!0);Js(a[0])&&(a[0]=`react-i18next:: ${a[0]}`),n?.services?.logger?.warn?n.services.logger.warn(...a):console?.warn&&console.warn(...a)},Nb={},GS=(n,e,t,i)=>{Js(t)&&Nb[t]||(Js(t)&&(Nb[t]=new Date),y_(n,e,t,i))},YS=(n,e)=>()=>{if(n.isInitialized)e();else{const t=()=>{setTimeout(()=>{n.off("initialized",t)},0),e()};n.on("initialized",t)}},Mf=(n,e,t)=>{n.loadNamespaces(e,YS(n,t))},Db=(n,e,t,i)=>{if(Js(t)&&(t=[t]),n.options.preload&&n.options.preload.indexOf(e)>-1)return Mf(n,t,i);t.forEach(a=>{n.options.ns.indexOf(a)<0&&n.options.ns.push(a)}),n.loadLanguages(e,YS(n,i))},b_=(n,e,t={})=>!e.languages||!e.languages.length?(GS(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(n,{lng:t.lng,precheck:(i,a)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!a(i.isLanguageChangingTo,n))return!1}}),Js=n=>typeof n=="string",S_=n=>typeof n=="object"&&n!==null,k_=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,C_={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},T_=n=>C_[n],E_=n=>n.replace(k_,T_);let Nf={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:E_,transDefaultProps:void 0};const x_=(n={})=>{Nf={...Nf,...n}},R_=()=>Nf;let JS;const __=n=>{JS=n},w_=()=>JS,M_={type:"3rdParty",init(n){x_(n.options.react),__(n)}},N_=E.createContext();class D_{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var Yh={exports:{}},Jh={};var Ob;function O_(){if(Ob)return Jh;Ob=1;var n=tu();function e(v,b){return v===b&&(v!==0||1/v===1/b)||v!==v&&b!==b}var t=typeof Object.is=="function"?Object.is:e,i=n.useState,a=n.useEffect,o=n.useLayoutEffect,l=n.useDebugValue;function u(v,b){var C=b(),T=i({inst:{value:C,getSnapshot:b}}),S=T[0].inst,R=T[1];return o(function(){S.value=C,S.getSnapshot=b,h(S)&&R({inst:S})},[v,C,b]),a(function(){return h(S)&&R({inst:S}),v(function(){h(S)&&R({inst:S})})},[v]),l(C),C}function h(v){var b=v.getSnapshot;v=v.value;try{var C=b();return!t(v,C)}catch{return!0}}function f(v,b){return b()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:u;return Jh.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:m,Jh}var Ab;function A_(){return Ab||(Ab=1,Yh.exports=O_()),Yh.exports}var j_=A_();const P_=(n,e)=>Js(e)?e:S_(e)&&Js(e.defaultValue)?e.defaultValue:Array.isArray(n)?n[n.length-1]:n,L_={t:P_,ready:!1},I_=()=>()=>{},ye=(n,e={})=>{const{i18n:t}=e,{i18n:i,defaultNS:a}=E.useContext(N_)||{},o=t||i||w_();o&&!o.reportNamespaces&&(o.reportNamespaces=new D_),o||GS(o,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const l=E.useMemo(()=>({...R_(),...o?.options?.react,...e}),[o,e]),{useSuspense:u,keyPrefix:h}=l,f=n||a||o?.options?.defaultNS,m=Js(f)?[f]:f||["translation"],v=E.useMemo(()=>m,m);o?.reportNamespaces?.addUsedNamespaces?.(v);const b=E.useRef(0),C=E.useCallback(L=>{if(!o)return I_;const{bindI18n:A,bindI18nStore:O}=l,Y=()=>{b.current+=1,L()};return A&&o.on(A,Y),O&&o.store.on(O,Y),()=>{A&&A.split(" ").forEach(J=>o.off(J,Y)),O&&O.split(" ").forEach(J=>o.store.off(J,Y))}},[o,l]),T=E.useRef(),S=E.useCallback(()=>{if(!o)return L_;const L=!!(o.isInitialized||o.initializedStoreOnce)&&v.every(Te=>b_(Te,o,l)),A=e.lng||o.language,O=b.current,Y=T.current;if(Y&&Y.ready===L&&Y.lng===A&&Y.keyPrefix===h&&Y.revision===O)return Y;const le={t:o.getFixedT(A,l.nsMode==="fallback"?v:v[0],h),ready:L,lng:A,keyPrefix:h,revision:O};return T.current=le,le},[o,v,h,l,e.lng]),[R,_]=E.useState(0),{t:D,ready:j}=j_.useSyncExternalStore(C,S,S);E.useEffect(()=>{if(o&&!j&&!u){const L=()=>_(A=>A+1);e.lng?Db(o,e.lng,v,L):Mf(o,v,L)}},[o,e.lng,v,j,u,R]);const x=o||{},w=E.useRef(null),M=E.useRef(),I=L=>{const A=Object.getOwnPropertyDescriptors(L);A.__original&&delete A.__original;const O=Object.create(Object.getPrototypeOf(L),A);if(!Object.prototype.hasOwnProperty.call(O,"__original"))try{Object.defineProperty(O,"__original",{value:L,writable:!1,enumerable:!1,configurable:!1})}catch{}return O},F=E.useMemo(()=>{const L=x,A=L?.language;let O=L;L&&(w.current&&w.current.__original===L?M.current!==A?(O=I(L),w.current=O,M.current=A):O=w.current:(O=I(L),w.current=O,M.current=A));const Y=[D,O,j];return Y.t=D,Y.i18n=O,Y.ready=j,Y},[D,x,j,x.resolvedLanguage,x.language,x.languages]);if(o&&u&&!j)throw new Promise(L=>{const A=()=>L();e.lng?Db(o,e.lng,v,A):Mf(o,v,A)});return F},{slice:U_,forEach:B_}=[];function z_(n){return B_.call(U_.call(arguments,1),e=>{if(e)for(const t in e)n[t]===void 0&&(n[t]=e[t])}),n}function F_(n){return typeof n!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(t=>t.test(n))}const jb=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,V_=function(n,e){const i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},a=encodeURIComponent(e);let o=`${n}=${a}`;if(i.maxAge>0){const l=i.maxAge-0;if(Number.isNaN(l))throw new Error("maxAge should be a Number");o+=`; Max-Age=${Math.floor(l)}`}if(i.domain){if(!jb.test(i.domain))throw new TypeError("option domain is invalid");o+=`; Domain=${i.domain}`}if(i.path){if(!jb.test(i.path))throw new TypeError("option path is invalid");o+=`; Path=${i.path}`}if(i.expires){if(typeof i.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+=`; Expires=${i.expires.toUTCString()}`}if(i.httpOnly&&(o+="; HttpOnly"),i.secure&&(o+="; Secure"),i.sameSite)switch(typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i.partitioned&&(o+="; Partitioned"),o},Pb={create(n,e,t,i){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(a.expires=new Date,a.expires.setTime(a.expires.getTime()+t*60*1e3)),i&&(a.domain=i),document.cookie=V_(n,e,a)},read(n){const e=`${n}=`,t=document.cookie.split(";");for(let i=0;i<t.length;i++){let a=t[i];for(;a.charAt(0)===" ";)a=a.substring(1,a.length);if(a.indexOf(e)===0)return a.substring(e.length,a.length)}return null},remove(n,e){this.create(n,"",-1,e)}};var q_={name:"cookie",lookup(n){let{lookupCookie:e}=n;if(e&&typeof document<"u")return Pb.read(e)||void 0},cacheUserLanguage(n,e){let{lookupCookie:t,cookieMinutes:i,cookieDomain:a,cookieOptions:o}=e;t&&typeof document<"u"&&Pb.create(t,n,i,a,o)}},H_={name:"querystring",lookup(n){let{lookupQuerystring:e}=n,t;if(typeof window<"u"){let{search:i}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(i=window.location.hash.substring(window.location.hash.indexOf("?")));const o=i.substring(1).split("&");for(let l=0;l<o.length;l++){const u=o[l].indexOf("=");u>0&&o[l].substring(0,u)===e&&(t=o[l].substring(u+1))}}return t}},$_={name:"hash",lookup(n){let{lookupHash:e,lookupFromHashIndex:t}=n,i;if(typeof window<"u"){const{hash:a}=window.location;if(a&&a.length>2){const o=a.substring(1);if(e){const l=o.split("&");for(let u=0;u<l.length;u++){const h=l[u].indexOf("=");h>0&&l[u].substring(0,h)===e&&(i=l[u].substring(h+1))}}if(i)return i;if(!i&&t>-1){const l=a.match(/\/([a-zA-Z-]*)/g);return Array.isArray(l)?l[typeof t=="number"?t:0]?.replace("/",""):void 0}}}return i}};let Ba=null;const Lb=()=>{if(Ba!==null)return Ba;try{if(Ba=typeof window<"u"&&window.localStorage!==null,!Ba)return!1;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{Ba=!1}return Ba};var K_={name:"localStorage",lookup(n){let{lookupLocalStorage:e}=n;if(e&&Lb())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupLocalStorage:t}=e;t&&Lb()&&window.localStorage.setItem(t,n)}};let za=null;const Ib=()=>{if(za!==null)return za;try{if(za=typeof window<"u"&&window.sessionStorage!==null,!za)return!1;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{za=!1}return za};var G_={name:"sessionStorage",lookup(n){let{lookupSessionStorage:e}=n;if(e&&Ib())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupSessionStorage:t}=e;t&&Ib()&&window.sessionStorage.setItem(t,n)}},Y_={name:"navigator",lookup(n){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:i,language:a}=navigator;if(t)for(let o=0;o<t.length;o++)e.push(t[o]);i&&e.push(i),a&&e.push(a)}return e.length>0?e:void 0}},J_={name:"htmlTag",lookup(n){let{htmlTag:e}=n,t;const i=e||(typeof document<"u"?document.documentElement:null);return i&&typeof i.getAttribute=="function"&&(t=i.getAttribute("lang")),t}},Q_={name:"path",lookup(n){let{lookupFromPathIndex:e}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?t[typeof e=="number"?e:0]?.replace("/",""):void 0}},X_={name:"subdomain",lookup(n){let{lookupFromSubdomainIndex:e}=n;const t=typeof e=="number"?e+1:1,i=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(i)return i[t]}};let QS=!1;try{document.cookie,QS=!0}catch{}const XS=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];QS||XS.splice(1,1);const W_=()=>({order:XS,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n});class WS{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=z_(t,this.options||{},W_()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=a=>a.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=i,this.addDetector(q_),this.addDetector(H_),this.addDetector(K_),this.addDetector(G_),this.addDetector(Y_),this.addDetector(J_),this.addDetector(Q_),this.addDetector(X_),this.addDetector($_)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,t=[];return e.forEach(i=>{if(this.detectors[i]){let a=this.detectors[i].lookup(this.options);a&&typeof a=="string"&&(a=[a]),a&&(t=t.concat(a))}}),t=t.filter(i=>i!=null&&!F_(i)).map(i=>this.options.convertDetectedLanguage(i)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(i=>{this.detectors[i]&&this.detectors[i].cacheUserLanguage(e,this.options)}))}}WS.type="languageDetector";const Z_="mqvi",ew="Loading...",tw="Save",nw="Cancel",iw="Edit",sw="Create",aw="Close",rw="Confirm",ow="Back",cw="Next",lw="Submit",uw="Search",dw="Online",hw="Offline",fw="Idle",mw="Do Not Disturb",pw="Error",gw="Success",vw="Something went wrong",yw="No results found",bw="Copied to clipboard",Sw="Language",kw="Members",Cw="Kick",Tw="Ban",Ew="Unban",xw="Manage Roles",Rw="Joined {{date}}",_w="Roles",ww="Are you sure you want to kick {{username}}?",Mw="Are you sure you want to ban {{username}}?",Nw="Reason for ban",Dw="No roles",Ow="Warning",Aw="Info",jw="Settings",Pw="Upload",Lw="Uploading...",Iw="Close Tab",Uw="Server",Bw="Add Server",zw="Messages",Fw="Files",Vw="Send Message",qw="Quick Switcher",Hw="Search channels and DMs...",$w="Channels",Kw="Direct Messages",Gw="Friends",Yw="Online",Jw="All",Qw="Pending",Xw="Incoming",Ww="Outgoing",Zw="Add Friend",eM="You can add a friend with their username.",tM="Enter a username",nM="Send Request",iM="Friend request sent to {{username}}",sM="Accept",aM="Decline",rM="Remove",oM="No friends yet",cM="No incoming requests",lM="No outgoing requests",uM="No pending requests",dM={appName:Z_,loading:ew,save:tw,cancel:nw,delete:"Delete",edit:iw,create:sw,close:aw,confirm:rw,back:ow,next:cw,submit:lw,search:uw,online:dw,offline:hw,idle:fw,dnd:mw,error:pw,success:gw,somethingWentWrong:vw,noResults:yw,copySuccess:bw,language:Sw,members:kw,kick:Cw,ban:Tw,unban:Ew,manageRoles:xw,joinedAt:Rw,roles:_w,confirmKick:ww,confirmBan:Mw,banReason:Nw,noRoles:Dw,warning:Ow,info:Aw,settings:jw,upload:Pw,uploading:Lw,closeTab:Iw,server:Uw,addServer:Bw,messages:zw,files:Fw,sendMessage:Vw,quickSwitcher:qw,quickSwitcherPlaceholder:Hw,channels:$w,directMessages:Kw,friends:Gw,friendsOnline:Yw,friendsAll:Jw,friendsPending:Qw,friendsIncoming:Xw,friendsOutgoing:Ww,addFriend:Zw,addFriendDesc:eM,addFriendPlaceholder:tM,friendSendRequest:nM,friendRequestSent:iM,friendAccept:sM,friendDecline:aM,friendRemove:rM,noFriendsYet:oM,noIncomingRequests:cM,noOutgoingRequests:lM,noPendingRequests:uM},hM="Welcome back!",fM="We're so excited to see you again!",mM="Create an account",pM="Username",gM="Display Name",vM="Password",yM="Confirm Password",bM="Log In",SM="Logging in...",kM="Continue",CM="Creating account...",TM="Need an account?",EM="Already have an account?",xM="Register",RM="Log In",_M="Logout",wM="Login failed",MM="Registration failed",NM="Passwords do not match",DM="Password must be at least 8 characters",OM="Invalid username or password",AM="Invite Code",jM="Enter invite code (optional)",PM={welcomeBack:hM,excitedToSeeYou:fM,createAccount:mM,username:pM,displayName:gM,password:vM,confirmPassword:yM,login:bM,loggingIn:SM,register:kM,registering:CM,needAccount:TM,alreadyHaveAccount:EM,registerLink:xM,loginLink:RM,logout:_M,loginFailed:wM,registrationFailed:MM,passwordsDoNotMatch:NM,passwordTooShort:DM,invalidCredentials:OM,inviteCode:AM,inviteCodePlaceholder:jM},LM="Text Channels",IM="Voice Channels",UM="Create Channel",BM="Edit Channel",zM="Delete Channel",FM="Channel Name",VM="Channel Topic",qM="Channel Type",HM="Text",$M="Voice",KM="Are you sure you want to delete #{{name}}?",GM="No channels yet",YM="Channel order updated",JM="Failed to update channel order",QM="Channels",XM="Channel created",WM="Failed to create channel",ZM="Channel deleted",eN="Failed to delete channel",tN="Cancel",nN={textChannels:LM,voiceChannels:IM,createChannel:UM,editChannel:BM,deleteChannel:zM,channelName:FM,channelTopic:VM,channelType:qM,text:HM,voice:$M,deleteConfirm:KM,noChannels:GM,reorderSuccess:YM,reorderError:JM,channelsTitle:QM,channelCreated:XM,channelCreateError:WM,channelDeleted:ZM,channelDeleteError:eN,cancel:tN},iN="Message #{{channel}}",sN="Edit Message",aN="Delete Message",rN="Are you sure you want to delete this message?",oN="{{user}} is typing...",cN="{{count}} people are typing...",lN="Welcome to #{{channel}}!",uN="This is the start of the #{{channel}} channel.",dN="Today",hN="Yesterday",fN="(edited)",mN="Upload File",pN="File is too large (max {{max}}MB)",gN="Select a channel",vN="cancel",yN="save",bN="Pin Message",SN="Unpin Message",kN="Pinned Messages",CN="No pinned messages in this channel",TN="Pinned by {{user}}",EN="{{count}} pinned",xN="Search Messages",RN="Search messages...",_N="Searching...",wN="Start typing to search",MN="No results found",NN="{{count}} results",DN="Previous",ON="Next",AN="Direct Messages",jN="No conversations yet",PN="Message @{{user}}",LN="This is the beginning of your conversation with {{user}}.",IN="Copy Message",UN="Copy ID",BN="Add Reaction",zN="Frequently Used",FN="Smileys & People",VN="Gestures",qN="Animals & Nature",HN="Food & Drink",$N="Objects & Symbols",KN="Reply",GN="Replying to {{user}}",YN="Original message was deleted",JN="Unknown User",QN="Click to see attachment",XN="You do not have permission to send messages in this channel",WN="Attach file",ZN="Emoji",eD={messagePlaceholder:iN,editMessage:sN,deleteMessage:aN,deleteMessageConfirm:rN,typing:oN,typingMultiple:cN,welcomeChannel:lN,channelStart:uN,today:dN,yesterday:hN,edited:fN,uploadFile:mN,fileTooLarge:pN,noChannel:gN,editCancel:vN,editSave:yN,pinMessage:bN,unpinMessage:SN,pinnedMessages:kN,noPinnedMessages:CN,pinnedBy:TN,pinCount:EN,searchMessages:xN,searchPlaceholder:RN,searching:_N,searchHint:wN,noSearchResults:MN,searchResultCount:NN,searchPrev:DN,searchNext:ON,directMessages:AN,noDMs:jN,dmPlaceholder:PN,dmWelcome:LN,copyMessage:IN,copyId:UN,addReaction:BN,emojiFrequent:zN,emojiPeople:FN,emojiGestures:VN,emojiNature:qN,emojiFood:HN,emojiObjects:$N,replyMessage:KN,replyingTo:GN,replyDeleted:YN,unknownUser:JN,noContent:QN,noSendPermission:XN,attachFile:WN,emoji:ZN},tD="Settings",nD="User Settings",iD="Server Settings",sD="Voice & Video",aD="Appearance",rD="Language",oD="Select Language",cD="Profile",lD="Change Avatar",uD="Roles",dD="Members",hD="Channels",fD="Invites",mD="Danger Zone",pD="Create Role",gD="Edit Role",vD="Role Name",yD="Role Color",bD="Permissions",SD="Delete Role",kD='Are you sure you want to delete the role "{{name}}"? This action cannot be undone.',CD="Manage Channels",TD="Create, edit, and delete channels",ED="Manage Roles",xD="Create, edit, and delete roles below their highest role",RD="Kick Members",_D="Remove members from the server",wD="Ban Members",MD="Permanently ban members from the server",ND="Manage Messages",DD="Delete and edit other members' messages",OD="Send Messages",AD="Send messages in text channels",jD="Read Messages",PD="View messages in text channels",LD="Connect",ID="Join voice channels",UD="Speak",BD="Speak in voice channels",zD="Screen Share",FD="Share screen in voice channels",VD="Administrator",qD="Members with this permission have every permission and can bypass channel-specific overrides",HD="This is a dangerous permission to grant!",$D="Save Changes",KD="You have unsaved changes",GD="This is the default role assigned to all members. It cannot be deleted.",YD="Select a role to edit its settings",JD="General",QD="Display Name",XD="How others see you",WD="Custom Status",ZD="Set a custom status",eO="Click to upload avatar",tO="Max 8MB. JPG, PNG, GIF, or WebP.",nO="Select your preferred language",iO="English",sO="Trke",aO="Profile updated successfully",rO="Failed to update profile",oO="Avatar updated",cO="Failed to upload avatar",lO="Server Name",uO="Server Icon",dO="Server settings updated",hO="Failed to update server settings",fO="Coming soon",mO="You don't have permission to access this section",pO="Log Out",gO="Are you sure you want to log out?",vO="Role updated successfully",yO="Role created successfully",bO="Role deleted successfully",SO="Failed to update role",kO="Manage Invites",CO="Create, view, and delete invite links",TO="Expire After",EO="Max Uses",xO="Create Invite",RO="Creating...",_O="Invite created",wO="Failed to create invite",MO="Invite code copied to clipboard",NO="Failed to copy invite code",DO="Invite deleted",OO="Failed to delete invite",AO="Copy",jO="Delete",PO="Expired",LO="{{count}}d left",IO="{{count}}h left",UO="{{count}}m left",BO="uses",zO="No invite links yet",FO="Loading...",VO="30 minutes",qO="1 hour",HO="6 hours",$O="12 hours",KO="1 day",GO="7 days",YO="Never",JO="No limit",QO="1 use",XO="5 uses",WO="10 uses",ZO="25 uses",e2="50 uses",t2="100 uses",n2="Require Invite",i2="When enabled, new members must provide an invite code to register",s2="Input Mode",a2="Voice Activity",r2="Automatically transmit when you speak",o2="Push to Talk",c2="Hold a key to transmit",l2="PTT Key",u2="Click and press a key to bind",d2="Press a key...",h2="Mic Sensitivity",f2="Input Device",m2="Output Device",p2="Default",g2="Output Volume",v2="Join/Leave Sounds",y2="Play a sound when someone joins or leaves voice",b2="Select a channel to edit its permissions",S2="Select a role to edit overrides",k2="Text Permissions",C2="Voice Permissions",T2="Override role permissions for this channel. Inherit uses the role's default setting.",E2="Channel permission saved",x2="Failed to save channel permission",R2="Inherit",_2="Allow",w2="Deny",M2="Theme",N2="Choose a color palette for the interface",D2="Ocean",O2="Cyan-teal palette with cool tones",A2="Aurora Borealis",j2="Deep space blue with northern lights green",P2="Midnight Ink",L2="Neutral dark gray with blue accent",I2="Warm Ember",U2="Warm brown-black with orange accent",B2="Deep Teal",z2="Rich teal with high contrast",F2="Select a member to manage their roles",V2="Current Roles",q2="No roles assigned",H2="Assign Roles",$2="Member roles updated",K2="Failed to update member roles",G2="Kick",Y2="Ban",J2='Are you sure you want to kick "{{name}}"? They can rejoin with an invite link.',Q2='Are you sure you want to ban "{{name}}"? They will not be able to rejoin.',X2="Member has been kicked",W2="Failed to kick member",Z2="Member has been banned",eA="Failed to ban member",tA={title:tD,userSettings:nD,serverSettings:iD,voiceSettings:sD,appearance:aD,language:rD,selectLanguage:oD,profile:cD,changeAvatar:lD,roles:uD,members:dD,channels:hD,invites:fD,dangerZone:mD,createRole:pD,editRole:gD,roleName:vD,roleColor:yD,permissions:bD,deleteRole:SD,confirmDeleteRole:kD,permManageChannels:CD,permManageChannelsDesc:TD,permManageRoles:ED,permManageRolesDesc:xD,permKickMembers:RD,permKickMembersDesc:_D,permBanMembers:wD,permBanMembersDesc:MD,permManageMessages:ND,permManageMessagesDesc:DD,permSendMessages:OD,permSendMessagesDesc:AD,permReadMessages:jD,permReadMessagesDesc:PD,permConnect:LD,permConnectDesc:ID,permSpeak:UD,permSpeakDesc:BD,permStream:zD,permStreamDesc:FD,permAdmin:VD,permAdminDesc:qD,permAdminWarning:HD,saveChanges:$D,unsavedChanges:KD,defaultRoleWarning:GD,noRoleSelected:YD,general:JD,displayName:QD,displayNamePlaceholder:XD,customStatus:WD,customStatusPlaceholder:ZD,avatarUpload:eO,avatarMaxSize:tO,languageDescription:nO,english:iO,turkish:sO,profileSaved:aO,profileSaveError:rO,avatarUploaded:oO,avatarUploadError:cO,serverName:lO,serverIcon:uO,serverSaved:dO,serverSaveError:hO,comingSoon:fO,noPermission:mO,logOut:pO,logOutConfirm:gO,roleSaved:vO,roleCreated:yO,roleDeleted:bO,roleSaveError:SO,permManageInvites:kO,permManageInvitesDesc:CO,inviteExpiry:TO,inviteMaxUses:EO,inviteCreate:xO,inviteCreating:RO,inviteCreated:_O,inviteCreateError:wO,inviteCopied:MO,inviteCopyError:NO,inviteDeleted:DO,inviteDeleteError:OO,inviteCopy:AO,inviteDelete:jO,inviteExpired:PO,inviteExpiresInDays:LO,inviteExpiresInHours:IO,inviteExpiresInMinutes:UO,inviteUsesLabel:BO,noInvites:zO,loading:FO,expiry30min:VO,expiry1h:qO,expiry6h:HO,expiry12h:$O,expiry1d:KO,expiry7d:GO,expiryNever:YO,usesNoLimit:JO,uses1:QO,uses5:XO,uses10:WO,uses25:ZO,uses50:e2,uses100:t2,inviteRequired:n2,inviteRequiredDesc:i2,voiceInputMode:s2,voiceActivity:a2,voiceActivityDesc:r2,pushToTalk:o2,pushToTalkDesc:c2,pttKey:l2,pttKeyHint:u2,pttListening:d2,micSensitivity:h2,inputDevice:f2,outputDevice:m2,defaultDevice:p2,masterVolume:g2,joinLeaveSounds:v2,joinLeaveSoundsDesc:y2,selectChannelToEdit:b2,selectRoleToEdit:S2,textPermissions:k2,voicePermissions:C2,channelPermDesc:T2,channelPermSaved:E2,channelPermSaveError:x2,permOverrideInherit:R2,permOverrideAllow:_2,permOverrideDeny:w2,themeTitle:M2,themeDescription:N2,themeOcean:D2,themeOceanDesc:O2,themeAurora:A2,themeAuroraDesc:j2,themeMidnight:P2,themeMidnightDesc:L2,themeEmber:I2,themeEmberDesc:U2,themeDeepTeal:B2,themeDeepTealDesc:z2,noMemberSelected:F2,memberCurrentRoles:V2,memberNoRoles:q2,memberAssignRoles:H2,memberRolesSaved:$2,memberRolesSaveError:K2,kickMember:G2,banMember:Y2,confirmKick:J2,confirmBan:Q2,memberKicked:X2,memberKickError:W2,memberBanned:Z2,memberBanError:eA},nA="Join Voice",iA="Disconnect",sA="Mute",aA="Unmute",rA="Deafen",oA="Undeafen",cA="Share Screen",lA="Stop Sharing",uA="Voice Connected",dA="No one is in this voice channel",hA="Maximum of 2 screen shares reached",fA="This voice channel is full",mA="Connecting...",pA="Reconnecting...",gA="Voice disconnected",vA="Click to join this voice channel",yA="Fullscreen",bA="Exit Fullscreen",SA="Toggle Layout",kA="End Call",CA="Minimize",TA="Could not connect to the voice server. Please check that the server is running and try again.",EA="Voice disconnected  the voice server may be unavailable",xA={joinVoice:nA,leaveVoice:iA,mute:sA,unmute:aA,deafen:rA,undeafen:oA,screenShare:cA,stopScreenShare:lA,voiceConnected:uA,noOneInVoice:dA,screenShareLimit:hA,voiceChannelFull:fA,connectingToVoice:mA,reconnectingToVoice:pA,voiceDisconnected:gA,joinVoicePrompt:vA,fullscreen:yA,exitFullscreen:bA,toggleLayout:SA,endCall:kA,minimize:CA,livekitConnectionError:TA,voiceDisconnectedHint:EA},RA="mqvi",_A="Ykleniyor...",wA="Kaydet",MA="ptal",NA="Dzenle",DA="Olutur",OA="Kapat",AA="Onayla",jA="Geri",PA="leri",LA="Gnder",IA="Ara",UA="evrimii",BA="evrimd",zA="Bota",FA="Rahatsz Etmeyin",VA="Hata",qA="Baarl",HA="Bir eyler ters gitti",$A="Sonu bulunamad",KA="Panoya kopyaland",GA="Dil",YA="yeler",JA="At",QA="Yasakla",XA="Yasa Kaldr",WA="Rolleri Ynet",ZA="Katld: {{date}}",ej="Roller",tj="{{username}} adl kullancy atmak istediinizden emin misiniz?",nj="{{username}} adl kullancy yasaklamak istediinizden emin misiniz?",ij="Yasaklama sebebi",sj="Rol yok",aj="Uyar",rj="Bilgi",oj="Ayarlar",cj="Ykle",lj="Ykleniyor...",uj="Sekmeyi Kapat",dj="Sunucu",hj="Sunucu Ekle",fj="Mesajlar",mj="Dosyalar",pj="Mesaj Gnder",gj="Hzl Gei",vj="Kanal ve DM ara...",yj="Kanallar",bj="Direkt Mesajlar",Sj="Arkadalar",kj="evrimii",Cj="Tm",Tj="Bekleyen",Ej="Gelen",xj="Gnderilen",Rj="Arkada Ekle",_j="Kullanc adyla arkada ekleyebilirsiniz.",wj="Kullanc ad girin",Mj="stek Gnder",Nj="{{username}} kullancsna arkadalk istei gnderildi",Dj="Kabul Et",Oj="Reddet",Aj="Kaldr",jj="Henz arkada yok",Pj="Gelen istek yok",Lj="Gnderilen istek yok",Ij="Bekleyen istek yok",Uj={appName:RA,loading:_A,save:wA,cancel:MA,delete:"Sil",edit:NA,create:DA,close:OA,confirm:AA,back:jA,next:PA,submit:LA,search:IA,online:UA,offline:BA,idle:zA,dnd:FA,error:VA,success:qA,somethingWentWrong:HA,noResults:$A,copySuccess:KA,language:GA,members:YA,kick:JA,ban:QA,unban:XA,manageRoles:WA,joinedAt:ZA,roles:ej,confirmKick:tj,confirmBan:nj,banReason:ij,noRoles:sj,warning:aj,info:rj,settings:oj,upload:cj,uploading:lj,closeTab:uj,server:dj,addServer:hj,messages:fj,files:mj,sendMessage:pj,quickSwitcher:gj,quickSwitcherPlaceholder:vj,channels:yj,directMessages:bj,friends:Sj,friendsOnline:kj,friendsAll:Cj,friendsPending:Tj,friendsIncoming:Ej,friendsOutgoing:xj,addFriend:Rj,addFriendDesc:_j,addFriendPlaceholder:wj,friendSendRequest:Mj,friendRequestSent:Nj,friendAccept:Dj,friendDecline:Oj,friendRemove:Aj,noFriendsYet:jj,noIncomingRequests:Pj,noOutgoingRequests:Lj,noPendingRequests:Ij},Bj="Tekrar ho geldin!",zj="Seni tekrar grdmze ok sevindik!",Fj="Hesap olutur",Vj="Kullanc Ad",qj="Grnen Ad",Hj="ifre",$j="ifre Tekrar",Kj="Giri Yap",Gj="Giri yaplyor...",Yj="Devam Et",Jj="Hesap oluturuluyor...",Qj="Hesabn yok mu?",Xj="Zaten hesabn var m?",Wj="Kayt Ol",Zj="Giri Yap",eP="k Yap",tP="Giri baarsz",nP="Kayt baarsz",iP="ifreler elemiyor",sP="ifre en az 8 karakter olmal",aP="Geersiz kullanc ad veya ifre",rP="Davet Kodu",oP="Davet kodunu girin (opsiyonel)",cP={welcomeBack:Bj,excitedToSeeYou:zj,createAccount:Fj,username:Vj,displayName:qj,password:Hj,confirmPassword:$j,login:Kj,loggingIn:Gj,register:Yj,registering:Jj,needAccount:Qj,alreadyHaveAccount:Xj,registerLink:Wj,loginLink:Zj,logout:eP,loginFailed:tP,registrationFailed:nP,passwordsDoNotMatch:iP,passwordTooShort:sP,invalidCredentials:aP,inviteCode:rP,inviteCodePlaceholder:oP},lP="Metin Kanallar",uP="Sesli Kanallar",dP="Kanal Olutur",hP="Kanal Dzenle",fP="Kanal Sil",mP="Kanal Ad",pP="Kanal Konusu",gP="Kanal Tr",vP="Metin",yP="Sesli",bP="#{{name}} kanaln silmek istediinize emin misiniz?",SP="Henz kanal yok",kP="Kanal sras gncellendi",CP="Kanal sras gncellenemedi",TP="Kanallar",EP="Kanal oluturuldu",xP="Kanal oluturulamad",RP="Kanal silindi",_P="Kanal silinemedi",wP="ptal",MP={textChannels:lP,voiceChannels:uP,createChannel:dP,editChannel:hP,deleteChannel:fP,channelName:mP,channelTopic:pP,channelType:gP,text:vP,voice:yP,deleteConfirm:bP,noChannels:SP,reorderSuccess:kP,reorderError:CP,channelsTitle:TP,channelCreated:EP,channelCreateError:xP,channelDeleted:RP,channelDeleteError:_P,cancel:wP},NP="#{{channel}} kanalna mesaj yaz",DP="Mesaj Dzenle",OP="Mesaj Sil",AP="Bu mesaj silmek istediinize emin misiniz?",jP="{{user}} yazyor...",PP="{{count}} kii yazyor...",LP="#{{channel}} kanalna ho geldiniz!",IP="Bu, #{{channel}} kanalnn balangcdr.",UP="Bugn",BP="Dn",zP="(dzenlendi)",FP="Dosya Ykle",VP="Dosya ok byk (maks. {{max}}MB)",qP="Bir kanal sein",HP="iptal",$P="kaydet",KP="Mesaj Sabitle",GP="Sabitlemeyi Kaldr",YP="Sabitlenmi Mesajlar",JP="Bu kanalda sabitlenmi mesaj yok",QP="{{user}} tarafndan sabitlendi",XP="{{count}} sabitlenmi",WP="Mesaj Ara",ZP="Mesajlarda ara...",eL="Aranyor...",tL="Aramaya balamak iin yazn",nL="Sonu bulunamad",iL="{{count}} sonu",sL="nceki",aL="Sonraki",rL="Direkt Mesajlar",oL="Henz konuma yok",cL="@{{user}} kullancsna mesaj yaz",lL="{{user}} ile konumanzn balangc.",uL="Mesaj Kopyala",dL="ID Kopyala",hL="Tepki Ekle",fL="Sk Kullanlanlar",mL="Yzler ve nsanlar",pL="El aretleri",gL="Hayvanlar ve Doa",vL="Yiyecek ve ecek",yL="Nesneler ve Semboller",bL="Yantla",SL="{{user}} kullancsna yant",kL="Orijinal mesaj silindi",CL="Bilinmeyen Kullanc",TL="Eki grmek iin tklayn",EL="Bu kanalda mesaj gnderme yetkiniz yok",xL="Dosya ekle",RL="Emoji",_L={messagePlaceholder:NP,editMessage:DP,deleteMessage:OP,deleteMessageConfirm:AP,typing:jP,typingMultiple:PP,welcomeChannel:LP,channelStart:IP,today:UP,yesterday:BP,edited:zP,uploadFile:FP,fileTooLarge:VP,noChannel:qP,editCancel:HP,editSave:$P,pinMessage:KP,unpinMessage:GP,pinnedMessages:YP,noPinnedMessages:JP,pinnedBy:QP,pinCount:XP,searchMessages:WP,searchPlaceholder:ZP,searching:eL,searchHint:tL,noSearchResults:nL,searchResultCount:iL,searchPrev:sL,searchNext:aL,directMessages:rL,noDMs:oL,dmPlaceholder:cL,dmWelcome:lL,copyMessage:uL,copyId:dL,addReaction:hL,emojiFrequent:fL,emojiPeople:mL,emojiGestures:pL,emojiNature:gL,emojiFood:vL,emojiObjects:yL,replyMessage:bL,replyingTo:SL,replyDeleted:kL,unknownUser:CL,noContent:TL,noSendPermission:EL,attachFile:xL,emoji:RL},wL="Ayarlar",ML="Kullanc Ayarlar",NL="Sunucu Ayarlar",DL="Ses ve Grnt",OL="Grnm",AL="Dil",jL="Dil Sein",PL="Profil",LL="Avatar Deitir",IL="Roller",UL="yeler",BL="Kanallar",zL="Davetler",FL="Tehlikeli Blge",VL="Rol Olutur",qL="Rol Dzenle",HL="Rol Ad",$L="Rol Rengi",KL="Yetkiler",GL="Rol Sil",YL='"{{name}}" roln silmek istediinizden emin misiniz? Bu ilem geri alnamaz.',JL="Kanallar Ynet",QL="Kanal oluturma, dzenleme ve silme",XL="Rolleri Ynet",WL="Kendi rolnden dk rolleri oluturma, dzenleme ve silme",ZL="yeleri At",e3="yeleri sunucudan karma",t3="yeleri Yasakla",n3="yeleri sunucudan kalc olarak yasaklama",i3="Mesajlar Ynet",s3="Dier yelerin mesajlarn silme ve dzenleme",a3="Mesaj Gnder",r3="Metin kanallarnda mesaj gnderme",o3="Mesajlar Oku",c3="Metin kanallarndaki mesajlar grntleme",l3="Balan",u3="Ses kanallarna katlma",d3="Konu",h3="Ses kanallarnda konuma",f3="Ekran Paylam",m3="Ses kanallarnda ekran paylam",p3="Ynetici",g3="Bu yetkiye sahip yeler tm yetkilere sahiptir ve kanal bazl kstlamalar atlayabilir",v3="Bu yetkiyi vermek tehlikeli olabilir!",y3="Deiiklikleri Kaydet",b3="Kaydedilmemi deiiklikler var",S3="Bu tm yelere atanan varsaylan roldr. Silinemez.",k3="Ayarlarn dzenlemek iin bir rol sein",C3="Genel",T3="Grnen Ad",E3="Dierlerinin sizi grd isim",x3="zel Durum",R3="zel bir durum belirleyin",_3="Avatar yklemek iin tklayn",w3="Maksimum 8MB. JPG, PNG, GIF veya WebP.",M3="Tercih ettiiniz dili sein",N3="English",D3="Trke",O3="Profil baaryla gncellendi",A3="Profil gncellenirken hata olutu",j3="Avatar gncellendi",P3="Avatar yklenirken hata olutu",L3="Sunucu Ad",I3="Sunucu Simgesi",U3="Sunucu ayarlar gncellendi",B3="Sunucu ayarlar gncellenirken hata olutu",z3="Yaknda",F3="Bu blme eriim yetkiniz yok",V3="k Yap",q3="k yapmak istediinizden emin misiniz?",H3="Rol baaryla gncellendi",$3="Rol baaryla oluturuldu",K3="Rol baaryla silindi",G3="Rol gncellenirken hata olutu",Y3="Davetleri Ynet",J3="Davet balantlar oluturma, grntleme ve silme",Q3="Geerlilik Sresi",X3="Maks. Kullanm",W3="Davet Olutur",Z3="Oluturuluyor...",eI="Davet oluturuldu",tI="Davet oluturulamad",nI="Davet kodu panoya kopyaland",iI="Davet kodu kopyalanamad",sI="Davet silindi",aI="Davet silinemedi",rI="Kopyala",oI="Sil",cI="Sresi dolmu",lI="{{count}} gn kald",uI="{{count}} saat kald",dI="{{count}} dk kald",hI="kullanm",fI="Henz davet balants yok",mI="Ykleniyor...",pI="30 dakika",gI="1 saat",vI="6 saat",yI="12 saat",bI="1 gn",SI="7 gn",kI="Sresiz",CI="Snrsz",TI="1 kullanm",EI="5 kullanm",xI="10 kullanm",RI="25 kullanm",_I="50 kullanm",wI="100 kullanm",MI="Davet Zorunlu",NI="Aktifken yeni yelerin kayt olmak iin davet kodu girmesi gerekir",DI="Giri Modu",OI="Ses Etkinlii",AI="Konutuunuzda otomatik iletim",jI="Bas-Konu",PI="Bir tuu basl tutarak iletim",LI="Bas-Konu Tuu",II="Tklayp bir tua basn",UI="Bir tua basn...",BI="Mikrofon Hassasiyeti",zI="Giri Cihaz",FI="k Cihaz",VI="Varsaylan",qI="k Sesi",HI="Giri/k Sesleri",$I="Biri ses kanalna girip ktnda ses al",KI="zinlerini dzenlemek iin bir kanal sein",GI="Override dzenlemek iin bir rol sein",YI="Metin zinleri",JI="Ses zinleri",QI="Bu kanal iin rol izinlerini geersiz kln. Devral, roln varsaylan ayarn kullanr.",XI="Kanal izni kaydedildi",WI="Kanal izni kaydedilemedi",ZI="Devral",eU="zin Ver",tU="Reddet",nU="Tema",iU="Arayz iin bir renk paleti sein",sU="Okyanus",aU="Souk tonlarda camgbei-teal paleti",rU="Aurora Borealis",oU="Kuzey klar yeili ile derin uzay mavisi",cU="Gece Mrekkebi",lU="Mavi vurgulu ntr koyu gri",uU="Scak Kor",dU="Turuncu vurgulu scak kahverengi-siyah",hU="Derin Teal",fU="Yksek kontrastl zengin teal paleti",mU="Rollerini ynetmek iin bir ye sein",pU="Mevcut Roller",gU="Atanm rol yok",vU="Rol Ata",yU="ye rolleri gncellendi",bU="ye rolleri gncellenirken hata olutu",SU="At",kU="Yasakla",CU='"{{name}}" adl yeyi atmak istediinizden emin misiniz? Davet balantsyla tekrar katlabilir.',TU='"{{name}}" adl yeyi yasaklamak istediinizden emin misiniz? Tekrar katlamayacak.',EU="ye sunucudan atld",xU="ye atlrken hata olutu",RU="ye yasakland",_U="ye yasaklanrken hata olutu",wU={title:wL,userSettings:ML,serverSettings:NL,voiceSettings:DL,appearance:OL,language:AL,selectLanguage:jL,profile:PL,changeAvatar:LL,roles:IL,members:UL,channels:BL,invites:zL,dangerZone:FL,createRole:VL,editRole:qL,roleName:HL,roleColor:$L,permissions:KL,deleteRole:GL,confirmDeleteRole:YL,permManageChannels:JL,permManageChannelsDesc:QL,permManageRoles:XL,permManageRolesDesc:WL,permKickMembers:ZL,permKickMembersDesc:e3,permBanMembers:t3,permBanMembersDesc:n3,permManageMessages:i3,permManageMessagesDesc:s3,permSendMessages:a3,permSendMessagesDesc:r3,permReadMessages:o3,permReadMessagesDesc:c3,permConnect:l3,permConnectDesc:u3,permSpeak:d3,permSpeakDesc:h3,permStream:f3,permStreamDesc:m3,permAdmin:p3,permAdminDesc:g3,permAdminWarning:v3,saveChanges:y3,unsavedChanges:b3,defaultRoleWarning:S3,noRoleSelected:k3,general:C3,displayName:T3,displayNamePlaceholder:E3,customStatus:x3,customStatusPlaceholder:R3,avatarUpload:_3,avatarMaxSize:w3,languageDescription:M3,english:N3,turkish:D3,profileSaved:O3,profileSaveError:A3,avatarUploaded:j3,avatarUploadError:P3,serverName:L3,serverIcon:I3,serverSaved:U3,serverSaveError:B3,comingSoon:z3,noPermission:F3,logOut:V3,logOutConfirm:q3,roleSaved:H3,roleCreated:$3,roleDeleted:K3,roleSaveError:G3,permManageInvites:Y3,permManageInvitesDesc:J3,inviteExpiry:Q3,inviteMaxUses:X3,inviteCreate:W3,inviteCreating:Z3,inviteCreated:eI,inviteCreateError:tI,inviteCopied:nI,inviteCopyError:iI,inviteDeleted:sI,inviteDeleteError:aI,inviteCopy:rI,inviteDelete:oI,inviteExpired:cI,inviteExpiresInDays:lI,inviteExpiresInHours:uI,inviteExpiresInMinutes:dI,inviteUsesLabel:hI,noInvites:fI,loading:mI,expiry30min:pI,expiry1h:gI,expiry6h:vI,expiry12h:yI,expiry1d:bI,expiry7d:SI,expiryNever:kI,usesNoLimit:CI,uses1:TI,uses5:EI,uses10:xI,uses25:RI,uses50:_I,uses100:wI,inviteRequired:MI,inviteRequiredDesc:NI,voiceInputMode:DI,voiceActivity:OI,voiceActivityDesc:AI,pushToTalk:jI,pushToTalkDesc:PI,pttKey:LI,pttKeyHint:II,pttListening:UI,micSensitivity:BI,inputDevice:zI,outputDevice:FI,defaultDevice:VI,masterVolume:qI,joinLeaveSounds:HI,joinLeaveSoundsDesc:$I,selectChannelToEdit:KI,selectRoleToEdit:GI,textPermissions:YI,voicePermissions:JI,channelPermDesc:QI,channelPermSaved:XI,channelPermSaveError:WI,permOverrideInherit:ZI,permOverrideAllow:eU,permOverrideDeny:tU,themeTitle:nU,themeDescription:iU,themeOcean:sU,themeOceanDesc:aU,themeAurora:rU,themeAuroraDesc:oU,themeMidnight:cU,themeMidnightDesc:lU,themeEmber:uU,themeEmberDesc:dU,themeDeepTeal:hU,themeDeepTealDesc:fU,noMemberSelected:mU,memberCurrentRoles:pU,memberNoRoles:gU,memberAssignRoles:vU,memberRolesSaved:yU,memberRolesSaveError:bU,kickMember:SU,banMember:kU,confirmKick:CU,confirmBan:TU,memberKicked:EU,memberKickError:xU,memberBanned:RU,memberBanError:_U},MU="Sese Katl",NU="Balanty Kes",DU="Sessiz",OU="Sesi A",AU="Sarlatr",jU="Sarlatrmay Kapat",PU="Ekran Payla",LU="Paylam Durdur",IU="Ses Bal",UU="Bu ses kanalnda kimse yok",BU="Maksimum 2 ekran paylamna ulald",zU="Bu ses kanal dolu",FU="Balanyor...",VU="Yeniden balanyor...",qU="Ses balants koptu",HU="Bu ses kanalna katlmak iin tklayn",$U="Tam Ekran",KU="Tam Ekrandan k",GU="Dzen Deitir",YU="Aramay Bitir",JU="Klt",QU="Ses sunucusuna balanlamad. Ltfen sunucunun altndan emin olun ve tekrar deneyin.",XU="Ses balants koptu  ses sunucusu eriilemez olabilir",WU={joinVoice:MU,leaveVoice:NU,mute:DU,unmute:OU,deafen:AU,undeafen:jU,screenShare:PU,stopScreenShare:LU,voiceConnected:IU,noOneInVoice:UU,screenShareLimit:BU,voiceChannelFull:zU,connectingToVoice:FU,reconnectingToVoice:VU,voiceDisconnected:qU,joinVoicePrompt:HU,fullscreen:$U,exitFullscreen:KU,toggleLayout:GU,endCall:YU,minimize:JU,livekitConnectionError:QU,voiceDisconnectedHint:XU},ZU={en:"English",tr:"Trke"},e4="en";Xt.use(WS).use(M_).init({resources:{en:{common:dM,auth:PM,channels:nN,chat:eD,settings:tA,voice:xA},tr:{common:Uj,auth:cP,channels:MP,chat:_L,settings:wU,voice:WU}},fallbackLng:e4,supportedLngs:Object.keys(ZU),defaultNS:"common",ns:["common","auth","channels","chat","settings","voice"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],lookupLocalStorage:"language",caches:["localStorage"]}});const Ub=n=>{let e;const t=new Set,i=(f,m)=>{const v=typeof f=="function"?f(e):f;if(!Object.is(v,e)){const b=e;e=m??(typeof v!="object"||v===null)?v:Object.assign({},e,v),t.forEach(C=>C(e,b))}},a=()=>e,u={setState:i,getState:a,getInitialState:()=>h,subscribe:f=>(t.add(f),()=>t.delete(f))},h=e=n(i,a,u);return u},t4=(n=>n?Ub(n):Ub),n4=n=>n;function i4(n,e=n4){const t=ol.useSyncExternalStore(n.subscribe,ol.useCallback(()=>e(n.getState()),[n,e]),ol.useCallback(()=>e(n.getInitialState()),[n,e]));return ol.useDebugValue(t),t}const Bb=n=>{const e=t4(n),t=i=>i4(e,i);return Object.assign(t,e),t},Pt=(n=>n?Bb(n):Bb),Df="/api",s4=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`,a4=3e4,r4=3,zb=50,o4=25*1024*1024,c4=["image/jpeg","image/png","image/gif","image/webp","video/mp4","video/webm","audio/mpeg","audio/ogg","application/pdf","text/plain"],l4=300*1e3,Fb=["mousemove","keydown","mousedown","scroll","touchstart"];function Of(){return localStorage.getItem("access_token")}function ZS(){return localStorage.getItem("refresh_token")}function Af(n,e){localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",e)}function Co(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}async function u4(){const n=ZS();if(!n)return!1;try{const e=await fetch(`${Df}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:n})});if(!e.ok)return Co(),!1;const t=await e.json();return t.success&&t.data?(Af(t.data.access_token,t.data.refresh_token),!0):(Co(),!1)}catch{return Co(),!1}}async function be(n,e={}){const{method:t="GET",body:i,headers:a}=e,o={...a},l=Of();l&&(o.Authorization=`Bearer ${l}`),i&&!(i instanceof FormData)&&(o["Content-Type"]="application/json");const u={method:t,headers:o};i&&(u.body=i instanceof FormData?i:JSON.stringify(i));let h=await fetch(`${Df}${n}`,u);return h.status===401&&ZS()&&await u4()&&(o.Authorization=`Bearer ${Of()}`,h=await fetch(`${Df}${n}`,{...u,headers:o})),await h.json()}async function d4(n){return be("/auth/register",{method:"POST",body:n})}async function h4(n){return be("/auth/login",{method:"POST",body:n})}async function f4(n){return be("/auth/logout",{method:"POST",body:{refresh_token:n}})}async function m4(){return be("/users/me")}const et=Pt(n=>({user:null,isLoading:!1,error:null,isInitialized:!1,register:async(e,t,i,a)=>{n({isLoading:!0,error:null});const o=await d4({username:e,password:t,display_name:i,invite_code:a});return o.success&&o.data?(Af(o.data.access_token,o.data.refresh_token),n({user:o.data.user,isLoading:!1}),!0):(n({error:o.error??"Registration failed",isLoading:!1}),!1)},login:async(e,t)=>{n({isLoading:!0,error:null});const i=await h4({username:e,password:t});return i.success&&i.data?(Af(i.data.access_token,i.data.refresh_token),n({user:i.data.user,isLoading:!1}),!0):(n({error:i.error??"Login failed",isLoading:!1}),!1)},logout:async()=>{const e=localStorage.getItem("refresh_token");e&&await f4(e),Co(),n({user:null})},initialize:async()=>{if(!localStorage.getItem("access_token")){n({isInitialized:!0});return}const t=await m4();t.success&&t.data?n({user:t.data,isInitialized:!0}):(Co(),n({isInitialized:!0}))},clearError:()=>n({error:null}),updateUser:e=>n(t=>({user:t.user?{...t.user,...e}:null}))}));function p4(){const{t:n}=ye("auth"),e=et(b=>b.login),t=et(b=>b.isLoading),i=et(b=>b.error),a=et(b=>b.clearError),o=iu(),[l,u]=E.useState(""),[h,f]=E.useState("");async function m(b){b.preventDefault(),await e(l,h)&&o("/channels")}function v(){i&&a()}return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-card",children:[g.jsx("h1",{className:"auth-title",children:n("welcomeBack")}),g.jsx("p",{className:"auth-subtitle",children:n("excitedToSeeYou")}),i&&g.jsx("div",{className:"auth-error",children:i}),g.jsxs("form",{onSubmit:m,children:[g.jsxs("div",{className:"auth-field",children:[g.jsx("label",{htmlFor:"username",className:"auth-label",children:n("username")}),g.jsx("input",{id:"username",type:"text",value:l,onChange:b=>{u(b.target.value),v()},required:!0,autoFocus:!0,className:"auth-input"})]}),g.jsxs("div",{className:"auth-field",children:[g.jsx("label",{htmlFor:"password",className:"auth-label",children:n("password")}),g.jsx("input",{id:"password",type:"password",value:h,onChange:b=>{f(b.target.value),v()},required:!0,className:"auth-input"})]}),g.jsx("button",{type:"submit",disabled:t,className:"auth-btn",children:n(t?"loggingIn":"login")})]}),g.jsxs("p",{className:"auth-link",children:[n("needAccount")," ",g.jsx(au,{to:"/register",children:n("registerLink")})]})]})})}function g4(){const{t:n}=ye("auth"),e=et(w=>w.register),t=et(w=>w.isLoading),i=et(w=>w.error),a=et(w=>w.clearError),o=iu(),[l,u]=E.useState(""),[h,f]=E.useState(""),[m,v]=E.useState(""),[b,C]=E.useState(""),[T,S]=E.useState(""),[R,_]=E.useState(null);async function D(w){if(w.preventDefault(),_(null),m!==b){_(n("passwordsDoNotMatch"));return}if(m.length<8){_(n("passwordTooShort"));return}await e(l,m,h||void 0,T||void 0)&&o("/channels")}function j(){i&&a(),R&&_(null)}const x=R??i;return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-card",children:[g.jsx("h1",{className:"auth-title",children:n("createAccount")}),x&&g.jsx("div",{className:"auth-error",children:x}),g.jsxs("form",{onSubmit:D,children:[g.jsxs("div",{className:"auth-field",children:[g.jsxs("label",{htmlFor:"username",className:"auth-label",children:[n("username")," ",g.jsx("span",{style:{color:"var(--red)"},children:"*"})]}),g.jsx("input",{id:"username",type:"text",value:l,onChange:w=>{u(w.target.value),j()},required:!0,autoFocus:!0,minLength:3,maxLength:32,pattern:"[a-zA-Z0-9_]+",title:"Letters, numbers, and underscores only",className:"auth-input"})]}),g.jsxs("div",{className:"auth-field",children:[g.jsx("label",{htmlFor:"displayName",className:"auth-label",children:n("displayName")}),g.jsx("input",{id:"displayName",type:"text",value:h,onChange:w=>{f(w.target.value),j()},maxLength:32,className:"auth-input"})]}),g.jsxs("div",{className:"auth-field",children:[g.jsx("label",{htmlFor:"inviteCode",className:"auth-label",children:n("inviteCode")}),g.jsx("input",{id:"inviteCode",type:"text",value:T,onChange:w=>{S(w.target.value),j()},placeholder:n("inviteCodePlaceholder"),maxLength:32,className:"auth-input"})]}),g.jsxs("div",{className:"auth-field",children:[g.jsxs("label",{htmlFor:"password",className:"auth-label",children:[n("password")," ",g.jsx("span",{style:{color:"var(--red)"},children:"*"})]}),g.jsx("input",{id:"password",type:"password",value:m,onChange:w=>{v(w.target.value),j()},required:!0,minLength:8,className:"auth-input"})]}),g.jsxs("div",{className:"auth-field",children:[g.jsxs("label",{htmlFor:"confirmPassword",className:"auth-label",children:[n("confirmPassword")," ",g.jsx("span",{style:{color:"var(--red)"},children:"*"})]}),g.jsx("input",{id:"confirmPassword",type:"password",value:b,onChange:w=>{C(w.target.value),j()},required:!0,className:"auth-input"})]}),g.jsx("button",{type:"submit",disabled:t,className:"auth-btn",children:n(t?"registering":"register")})]}),g.jsxs("p",{className:"auth-link",children:[n("alreadyHaveAccount")," ",g.jsx(au,{to:"/login",children:n("loginLink")})]})]})})}async function ek(){return be("/server")}async function v4(n){return be("/server",{method:"PATCH",body:n})}async function y4(n){const e=new FormData;return e.append("file",n),be("/server/icon",{method:"POST",body:e})}const ou=Pt(n=>({server:null,fetchServer:async()=>{const e=await ek();e.success&&e.data&&n({server:e.data})},handleServerUpdate:e=>{n({server:e})}}));async function b4(n){return be("/voice/token",{method:"POST",body:{channel_id:n}})}const tk="mqvi_voice_settings",Qh={inputMode:"voice_activity",pttKey:"Space",micSensitivity:50,userVolumes:{},inputDevice:"",outputDevice:"",masterVolume:100,soundsEnabled:!0};function S4(){try{const n=localStorage.getItem(tk);if(!n)return{...Qh};const e=JSON.parse(n);return{...Qh,...e}}catch{return{...Qh}}}function cs(n){try{localStorage.setItem(tk,JSON.stringify(n))}catch{}}const ls=S4(),ge=Pt((n,e)=>({voiceStates:{},currentVoiceChannelId:null,isMuted:!1,isDeafened:!1,isStreaming:!1,livekitUrl:null,livekitToken:null,inputMode:ls.inputMode,pttKey:ls.pttKey,micSensitivity:ls.micSensitivity,userVolumes:ls.userVolumes,inputDevice:ls.inputDevice,outputDevice:ls.outputDevice,masterVolume:ls.masterVolume,soundsEnabled:ls.soundsEnabled,_onLeaveCallback:null,registerOnLeave:t=>n({_onLeaveCallback:t}),joinVoiceChannel:async t=>{try{const i=await b4(t);if(!i.success||!i.data)return console.error("[voiceStore] Failed to get voice token:",i.error),null;console.log("[voiceStore] Voice token obtained, connecting to:",i.data.url);const a=e().inputMode==="push_to_talk";return n({currentVoiceChannelId:t,livekitUrl:i.data.url,livekitToken:i.data.token,isMuted:a,isDeafened:!1,isStreaming:!1}),i.data}catch(i){return console.error("[voiceStore] Voice join error:",i),null}},leaveVoiceChannel:()=>{n({currentVoiceChannelId:null,livekitUrl:null,livekitToken:null,isMuted:!1,isDeafened:!1,isStreaming:!1})},toggleMute:()=>{const{isMuted:t,isDeafened:i}=e();n(i?{isDeafened:!1,isMuted:!t}:{isMuted:!t})},toggleDeafen:()=>{const{isDeafened:t}=e();n(t?{isDeafened:!1}:{isDeafened:!0,isMuted:!0})},setStreaming:t=>{n({isStreaming:t})},setInputMode:t=>{n({inputMode:t});const i=e();cs({inputMode:t,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setPTTKey:t=>{n({pttKey:t});const i=e();cs({inputMode:i.inputMode,pttKey:t,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setMicSensitivity:t=>{n({micSensitivity:t});const i=e();cs({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:t,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setUserVolume:(t,i)=>{const a={...e().userVolumes,[t]:i};n({userVolumes:a});const o=e();cs({inputMode:o.inputMode,pttKey:o.pttKey,micSensitivity:o.micSensitivity,userVolumes:a,inputDevice:o.inputDevice,outputDevice:o.outputDevice,masterVolume:o.masterVolume,soundsEnabled:o.soundsEnabled})},setInputDevice:t=>{n({inputDevice:t});const i=e();cs({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:t,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setOutputDevice:t=>{n({outputDevice:t});const i=e();cs({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:t,masterVolume:i.masterVolume,soundsEnabled:i.soundsEnabled})},setMasterVolume:t=>{n({masterVolume:t});const i=e();cs({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:t,soundsEnabled:i.soundsEnabled})},setSoundsEnabled:t=>{n({soundsEnabled:t});const i=e();cs({inputMode:i.inputMode,pttKey:i.pttKey,micSensitivity:i.micSensitivity,userVolumes:i.userVolumes,inputDevice:i.inputDevice,outputDevice:i.outputDevice,masterVolume:i.masterVolume,soundsEnabled:t})},handleVoiceStateUpdate:t=>{n(i=>{const a={...i.voiceStates};switch(t.action){case"join":{for(const l of Object.keys(a))a[l]=a[l].filter(u=>u.user_id!==t.user_id),a[l].length===0&&delete a[l];const o=a[t.channel_id]??[];a[t.channel_id]=[...o,{user_id:t.user_id,channel_id:t.channel_id,username:t.username,avatar_url:t.avatar_url,is_muted:t.is_muted,is_deafened:t.is_deafened,is_streaming:t.is_streaming}];break}case"leave":{a[t.channel_id]&&(a[t.channel_id]=a[t.channel_id].filter(o=>o.user_id!==t.user_id),a[t.channel_id].length===0&&delete a[t.channel_id]);break}case"update":{a[t.channel_id]&&(a[t.channel_id]=a[t.channel_id].map(o=>o.user_id===t.user_id?{...o,is_muted:t.is_muted,is_deafened:t.is_deafened,is_streaming:t.is_streaming}:o));break}}return{voiceStates:a}})},handleVoiceStatesSync:t=>{const i={};for(const a of t)i[a.channel_id]||(i[a.channel_id]=[]),i[a.channel_id].push(a);n({voiceStates:i})}}));let Vb=0;function nk(){return Vb+=1,`panel-${Vb}`}let qb=0;function k4(){return qb+=1,`tab-${qb}`}function C4(n,e){for(const[t,i]of Object.entries(n)){const a=i.tabs.find(o=>o.channelId===e);if(a)return{panelId:t,tabId:a.id}}return null}function Ul(n,e){if(n.type==="leaf")return n.panelId===e?null:n;const t=Ul(n.children[0],e),i=Ul(n.children[1],e);return t===null&&i===null?null:t===null?i:i===null?t:{...n,children:[t,i]}}function ik(n,e,t){if(e.length===0&&n.type==="split")return{...n,ratio:t};if(n.type==="split"&&e.length>0){const[i,...a]=e,o=[...n.children];return o[i]=ik(o[i],a,t),{...n,children:o}}return n}function Xh(n){if(!n||n.type!=="voice"&&n.type!=="screen")return;const e=ge.getState();e.currentVoiceChannelId===n.channelId&&e._onLeaveCallback&&e._onLeaveCallback()}const yl=nk(),T4={id:yl,tabs:[],activeTabId:null},Ye=Pt((n,e)=>({panels:{[yl]:T4},layout:{type:"leaf",panelId:yl},activePanelId:yl,membersOpen:!0,quickSwitcherOpen:!1,openTab(t,i,a,o){const l=e(),u=C4(l.panels,t);if(u){n({activePanelId:u.panelId,panels:{...l.panels,[u.panelId]:{...l.panels[u.panelId],activeTabId:u.tabId}}});return}const h=l.panels[l.activePanelId];if(!h)return;const f={id:k4(),channelId:t,type:i,label:a,serverShort:o};n({panels:{...l.panels,[h.id]:{...h,tabs:[...h.tabs,f],activeTabId:f.id}}})},closeTab(t,i){const a=e(),o=a.panels[t];if(!o)return;const l=o.tabs.find(f=>f.id===i),u=o.tabs.filter(f=>f.id!==i);if(u.length===0){if(Object.keys(a.panels).length<=1){n({panels:{[t]:{...o,tabs:[],activeTabId:null}}}),Xh(l);return}const m=Ul(a.layout,t),v={...a.panels};delete v[t];const b=a.activePanelId===t?Object.keys(v)[0]:a.activePanelId;n({panels:v,layout:m??{type:"leaf",panelId:b},activePanelId:b}),Xh(l);return}const h=o.activeTabId===i?u[Math.max(0,u.findIndex(f=>f.id===i)-1)]?.id??u[0]?.id??null:o.activeTabId;n({panels:{...a.panels,[t]:{...o,tabs:u,activeTabId:h}}}),Xh(l)},closeVoiceTabs(t){const i=e(),a=[];for(const[o,l]of Object.entries(i.panels))for(const u of l.tabs)(u.type==="voice"||u.type==="screen")&&u.channelId===t&&a.push({panelId:o,tabId:u.id});for(const{panelId:o,tabId:l}of a)e().closeTab(o,l)},setActiveTab(t,i){const a=e(),o=a.panels[t];o&&n({activePanelId:t,panels:{...a.panels,[t]:{...o,activeTabId:i}}})},splitPanel(t,i,a,o="after"){const l=e(),u=l.panels[t];if(!u)return;const h=u.tabs.find(T=>T.id===a);if(!h)return;const f=u.tabs.filter(T=>T.id!==a),m=u.activeTabId===a?f[0]?.id??null:u.activeTabId,v=nk(),b={id:v,tabs:[h],activeTabId:h.id};function C(T){return T.type==="leaf"&&T.panelId===t?{type:"split",direction:i,children:[o==="before"?{type:"leaf",panelId:v}:{type:"leaf",panelId:t},o==="before"?{type:"leaf",panelId:t}:{type:"leaf",panelId:v}],ratio:.5}:T.type==="split"?{...T,children:[C(T.children[0]),C(T.children[1])]}:T}n({panels:{...l.panels,[t]:{...u,tabs:f,activeTabId:m},[v]:b},layout:C(l.layout),activePanelId:v})},moveTab(t,i,a){const o=e(),l=o.panels[t],u=o.panels[i];if(!l||!u)return;const h=l.tabs.find(b=>b.id===a);if(!h)return;const f=l.tabs.filter(b=>b.id!==a),m=l.activeTabId===a?f[0]?.id??null:l.activeTabId,v={...o.panels};if(f.length===0&&Object.keys(v).length>1){const b=Ul(o.layout,t);delete v[t],v[i]={...u,tabs:[...u.tabs,h],activeTabId:h.id},n({panels:v,layout:b??{type:"leaf",panelId:i},activePanelId:i});return}v[t]={...l,tabs:f,activeTabId:m},v[i]={...u,tabs:[...u.tabs,h],activeTabId:h.id},n({panels:v,activePanelId:i})},setSplitRatio(t,i){const a=Math.max(.15,Math.min(.85,i));n(o=>({layout:ik(o.layout,t,a)}))},setActivePanel(t){n({activePanelId:t})},toggleMembers(){n(t=>({membersOpen:!t.membersOpen}))},toggleQuickSwitcher(){n(t=>({quickSwitcherOpen:!t.quickSwitcherOpen}))},closeQuickSwitcher(){n({quickSwitcherOpen:!1})}}));function E4(n){const e=[];for(const t of Object.values(n))for(const i of t.tabs)e.push({...i,panelId:t.id,isActive:i.id===t.activeTabId});return e}function x4(){const{t:n}=ye("common"),e=ou(h=>h.server),t=Ye(h=>h.panels),i=Ye(h=>h.activePanelId),a=Ye(h=>h.setActiveTab),o=Ye(h=>h.closeTab),l=E4(t);function u(h,f){h.dataTransfer.setData("text/tab-id",f.id),h.dataTransfer.setData("text/panel-id",f.panelId),h.dataTransfer.effectAllowed="move"}return g.jsxs("div",{className:"top-bar",children:[g.jsxs("div",{className:"server-pill",children:[g.jsx("img",{src:"/mqvi-icon.svg",alt:"mqvi",className:"sp-avatar"}),g.jsx("span",{className:"sp-name",children:e?.name??"mqvi Server"}),g.jsx("span",{className:"sp-chevron",children:""})]}),g.jsx("div",{className:"tab-strip",children:l.map(h=>{const f=h.panelId===i&&h.isActive,m=h.type==="voice",v=h.type==="screen";let b="tab";return f&&(b+=" tab-active"),m&&(b+=" tab-voice"),v&&(b+=" tab-screen"),g.jsxs("div",{className:b,style:{maxWidth:170},draggable:!0,onDragStart:C=>u(C,h),onClick:()=>a(h.panelId,h.id),children:[g.jsx("span",{className:"tab-icon",children:h.type==="text"?"#":h.type==="voice"?"":""}),g.jsx("span",{className:"tab-label",children:h.label}),h.serverShort&&g.jsx("span",{className:"tab-srv",children:h.serverShort}),h.hasUnread&&!f&&g.jsx("span",{className:"tab-dot"}),g.jsx("button",{className:"tab-close",onClick:C=>{C.stopPropagation(),o(h.panelId,h.id)},title:n("closeTab"),children:""})]},h.id)})})]})}async function R4(){return be("/channels")}async function _4(n){return be("/channels",{method:"POST",body:n})}async function w4(n){return be(`/channels/${n}`,{method:"DELETE"})}async function M4(n){return be("/channels/reorder",{method:"PATCH",body:{items:n}})}const Ot=Pt((n,e)=>({categories:[],selectedChannelId:null,isLoading:!1,fetchChannels:async()=>{n({isLoading:!0});const t=await R4();if(t.success&&t.data){if(n({categories:t.data,isLoading:!1}),!e().selectedChannelId){const a=t.data.flatMap(o=>o.channels).find(o=>o.type==="text");a&&n({selectedChannelId:a.id})}}else n({isLoading:!1})},selectChannel:t=>{n({selectedChannelId:t})},handleChannelCreate:t=>{n(i=>{const a=i.categories.map(l=>l.category.id===(t.category_id??"")?{...l,channels:[...l.channels,t]}:l);if(!a.some(l=>l.channels.some(u=>u.id===t.id))&&a.length>0){const l={...a[0]};l.channels=[...l.channels,t],a[0]=l}return{categories:a}})},handleChannelUpdate:t=>{n(i=>({categories:i.categories.map(a=>({...a,channels:a.channels.map(o=>o.id===t.id?t:o)}))}))},handleChannelDelete:t=>{n(i=>{const a=i.categories.map(l=>({...l,channels:l.channels.filter(u=>u.id!==t)}));let o=i.selectedChannelId;return o===t&&(o=a.flatMap(u=>u.channels).find(u=>u.type==="text")?.id??null),{categories:a,selectedChannelId:o}})},handleCategoryCreate:t=>{n(i=>({categories:[...i.categories,{category:t,channels:[]}]}))},handleCategoryUpdate:t=>{n(i=>({categories:i.categories.map(a=>a.category.id===t.id?{...a,category:t}:a)}))},handleCategoryDelete:t=>{n(i=>({categories:i.categories.filter(a=>a.category.id!==t)}))},reorderChannels:async t=>{const i=e().categories,a=new Map(t.map(l=>[l.id,l.position]));return n(l=>({categories:l.categories.map(u=>({...u,channels:u.channels.map(h=>{const f=a.get(h.id);return f!==void 0?{...h,position:f}:h}).sort((h,f)=>h.position-f.position)}))})),(await M4(t)).success?!0:(n({categories:i}),!1)},handleChannelReorder:t=>{n({categories:t})}}));function N4({panelId:n}){const{t:e}=ye("common"),t=Ye(o=>o.panels[n]),i=Ye(o=>o.setActiveTab),a=Ye(o=>o.closeTab);return t?g.jsx("div",{className:"panel-tab-bar",children:t.tabs.map(o=>{const l=o.id===t.activeTabId,u=o.type==="voice",h=o.type==="screen";let f="panel-tab";return l&&(f+=" active"),u&&(f+=" tab-voice"),h&&(f+=" tab-screen"),g.jsxs("div",{className:f,draggable:!0,onDragStart:m=>{m.dataTransfer.setData("text/tab-id",o.id),m.dataTransfer.setData("text/panel-id",n),m.dataTransfer.effectAllowed="move"},onClick:()=>i(n,o.id),children:[g.jsx("span",{className:"tab-icon",children:o.type==="text"?"#":o.type==="voice"?"":""}),g.jsx("span",{className:"tab-label",children:o.label}),g.jsx("button",{className:"panel-tab-close",onClick:m=>{m.stopPropagation(),a(n,o.id)},title:e("closeTab"),children:""})]},o.id)})}):null}async function D4(n){return be(`/channels/${n}/pins`)}async function O4(n,e){return be(`/channels/${n}/messages/${e}/pin`,{method:"POST"})}async function A4(n,e){return be(`/channels/${n}/messages/${e}/pin`,{method:"DELETE"})}const j4=[],Kn=Pt((n,e)=>({pins:{},isLoading:!1,fetchPins:async t=>{n({isLoading:!0});const i=await D4(t);i.success&&i.data?n(a=>({pins:{...a.pins,[t]:i.data},isLoading:!1})):n({isLoading:!1})},pin:async(t,i)=>(await O4(t,i)).success,unpin:async(t,i)=>(await A4(t,i)).success,handleMessagePin:t=>{n(i=>{const a=i.pins[t.channel_id]??[];return a.some(o=>o.message_id===t.message_id)?i:{pins:{...i.pins,[t.channel_id]:[t,...a]}}})},handleMessageUnpin:t=>{n(i=>{const a=i.pins[t.channel_id];return a?{pins:{...i.pins,[t.channel_id]:a.filter(o=>o.message_id!==t.message_id)}}:i})},getPinsForChannel:t=>e().pins[t]??j4,isMessagePinned:(t,i)=>{const a=e().pins[t];return a?a.some(o=>o.message_id===i):!1}}));async function P4(n){return be(`/channels/${n}/permissions`)}async function L4(n,e,t,i){return be(`/channels/${n}/permissions/${e}`,{method:"PUT",body:{allow:t,deny:i}})}async function I4(n,e){return be(`/channels/${n}/permissions/${e}`,{method:"DELETE"})}const U4=[],Mo=Pt((n,e)=>({overridesByChannel:{},fetchedChannels:new Set,fetchOverrides:async t=>{if(e().fetchedChannels.has(t))return;const i=await P4(t);i.data&&n(a=>({overridesByChannel:{...a.overridesByChannel,[t]:i.data},fetchedChannels:new Set([...a.fetchedChannels,t])}))},setOverride:async(t,i,a,o)=>!!(await L4(t,i,a,o)).data,deleteOverride:async(t,i)=>!!(await I4(t,i)).data,getOverrides:t=>e().overridesByChannel[t]??U4,handleOverrideUpdate:t=>{n(i=>{const a=i.overridesByChannel[t.channel_id]??[],l=a.some(u=>u.role_id===t.role_id)?a.map(u=>u.role_id===t.role_id?t:u):[...a,t];return{overridesByChannel:{...i.overridesByChannel,[t.channel_id]:l}}})},handleOverrideDelete:(t,i)=>{n(a=>{const o=a.overridesByChannel[t];return o?{overridesByChannel:{...a.overridesByChannel,[t]:o.filter(l=>l.role_id!==i)}}:a})}}));async function B4(){return be("/members")}async function z4(n,e){return be(`/members/${n}/roles`,{method:"PATCH",body:{role_ids:e}})}async function ym(n){return be(`/members/${n}`,{method:"DELETE"})}async function bm(n,e){return be(`/members/${n}/ban`,{method:"POST",body:{reason:e}})}const mt=Pt(n=>({members:[],onlineUserIds:new Set,isLoading:!1,fetchMembers:async()=>{n({isLoading:!0});const e=await B4();e.data?n({members:e.data,isLoading:!1}):n({isLoading:!1})},handleReady:e=>{n({onlineUserIds:new Set(e)}),mt.getState().fetchMembers()},handlePresenceUpdate:(e,t)=>{n(i=>{const a=new Set(i.onlineUserIds);t==="offline"?a.delete(e):a.add(e);const o=i.members.map(l=>l.id===e?{...l,status:t}:l);return{onlineUserIds:a,members:o}})},handleMemberJoin:e=>{n(t=>t.members.some(i=>i.id===e.id)?t:{members:[...t.members,e]})},handleMemberLeave:e=>{n(t=>{const i=new Set(t.onlineUserIds);return i.delete(e),{members:t.members.filter(a=>a.id!==e),onlineUserIds:i}})},handleMemberUpdate:e=>{n(t=>({members:t.members.map(i=>i.id===e.id?e:i)}))},handleRoleCreate:e=>{},handleRoleUpdate:e=>{n(t=>({members:t.members.map(i=>({...i,roles:i.roles.map(a=>a.id===e.id?e:a)}))}))},handleRoleDelete:e=>{n(t=>({members:t.members.map(i=>({...i,roles:i.roles.filter(a=>a.id!==e)}))}))}})),Ne={ManageChannels:1,ManageRoles:2,KickMembers:4,BanMembers:8,ManageMessages:16,SendMessages:32,ConnectVoice:64,Speak:128,Stream:256,Admin:512,ManageInvites:1024,ReadMessages:2048};function cn(n,e){return(n&Ne.Admin)!==0?!0:(n&e)!==0}function F4(n,e,t){if((n&Ne.Admin)!==0)return 4095;const i=new Set(e);let a=0,o=0;for(const l of t)i.has(l.role_id)&&(a|=l.allow,o|=l.deny);return a===0&&o===0?n:n&~o|a}function V4(n){const e=et(f=>f.user),t=mt(f=>f.members),i=Mo(f=>f.getOverrides),a=E.useMemo(()=>t.find(f=>f.id===e?.id),[t,e?.id]),o=n?i(n):[],l=E.useMemo(()=>a?.roles.map(f=>f.id)??[],[a?.roles]),u=E.useMemo(()=>{const f=a?.effective_permissions??0;return!n||o.length===0?f:F4(f,l,o)},[a?.effective_permissions,n,l,o]),h=E.useMemo(()=>f=>(u&Ne.Admin)!==0?!0:(u&f)!==0,[u]);return{channelPerms:u,hasChannelPerm:h}}async function Hb(n,e,t){const i=new URLSearchParams;e&&i.set("before",e),i.set("limit",t.toString());const a=i.toString(),o=`/channels/${n}/messages${a?`?${a}`:""}`;return be(o)}async function q4(n,e,t,i){if(t&&t.length>0){const a=new FormData;a.append("content",e),i&&a.append("reply_to_id",i);for(const o of t)a.append("files",o);return be(`/channels/${n}/messages`,{method:"POST",body:a})}return be(`/channels/${n}/messages`,{method:"POST",body:{content:e,reply_to_id:i}})}async function H4(n,e){return be(`/messages/${n}`,{method:"PATCH",body:{content:e}})}async function $4(n){return be(`/messages/${n}`,{method:"DELETE"})}async function K4(n,e){return be(`/messages/${n}/reactions`,{method:"POST",body:{emoji:e}})}const G4=5e3,Wh=new Map,ut=Pt((n,e)=>({messagesByChannel:{},hasMoreByChannel:{},isLoading:!1,isLoadingMore:!1,typingUsers:{},replyingTo:null,scrollToMessageId:null,fetchMessages:async t=>{if(e().messagesByChannel[t])return;n({isLoading:!0});const i=await Hb(t,void 0,zb);i.success&&i.data?n(a=>({messagesByChannel:{...a.messagesByChannel,[t]:i.data.messages},hasMoreByChannel:{...a.hasMoreByChannel,[t]:i.data.has_more},isLoading:!1})):n({isLoading:!1})},fetchOlderMessages:async t=>{const i=e().messagesByChannel[t];if(!i||i.length===0||!e().hasMoreByChannel[t])return;n({isLoadingMore:!0});const a=i[0].id,o=await Hb(t,a,zb);o.success&&o.data?n(l=>({messagesByChannel:{...l.messagesByChannel,[t]:[...o.data.messages,...l.messagesByChannel[t]]},hasMoreByChannel:{...l.hasMoreByChannel,[t]:o.data.has_more},isLoadingMore:!1})):n({isLoadingMore:!1})},sendMessage:async(t,i,a,o)=>(await q4(t,i,a,o)).success,editMessage:async(t,i)=>(await H4(t,i)).success,deleteMessage:async t=>(await $4(t)).success,setReplyingTo:t=>n({replyingTo:t}),setScrollToMessageId:t=>n({scrollToMessageId:t}),toggleReaction:async(t,i,a)=>{await K4(t,a)},handleMessageCreate:t=>{n(i=>{const a=i.messagesByChannel[t.channel_id];if(!a||a.some(l=>l.id===t.id))return i;const o={...i.typingUsers};return o[t.channel_id]&&(o[t.channel_id]=o[t.channel_id].filter(l=>l!==t.author?.username)),{messagesByChannel:{...i.messagesByChannel,[t.channel_id]:[...a,t]},typingUsers:o}})},handleMessageUpdate:t=>{n(i=>{const a=i.messagesByChannel[t.channel_id];return a?{messagesByChannel:{...i.messagesByChannel,[t.channel_id]:a.map(o=>o.id===t.id?t:o)}}:i})},handleMessageDelete:t=>{n(i=>{const a=i.messagesByChannel[t.channel_id];if(!a)return i;const o=a.filter(l=>l.id!==t.id).map(l=>l.reply_to_id===t.id?{...l,referenced_message:{id:t.id,author:null,content:null}}:l);return{messagesByChannel:{...i.messagesByChannel,[t.channel_id]:o}}})},handleTypingStart:(t,i)=>{n(l=>{const u=l.typingUsers[t]??[];return u.includes(i)?l:{typingUsers:{...l.typingUsers,[t]:[...u,i]}}});const a=`${t}:${i}`,o=Wh.get(a);o&&clearTimeout(o),Wh.set(a,setTimeout(()=>{n(l=>({typingUsers:{...l.typingUsers,[t]:(l.typingUsers[t]??[]).filter(u=>u!==i)}})),Wh.delete(a)},G4))},handleReactionUpdate:t=>{n(i=>{const a=i.messagesByChannel[t.channel_id];return a?{messagesByChannel:{...i.messagesByChannel,[t.channel_id]:a.map(o=>o.id===t.message_id?{...o,reactions:t.reactions}:o)}}:i})}}));function Y4({count:n=5}){return g.jsx("div",{className:"sk-container",children:Array.from({length:n},(e,t)=>g.jsxs("div",{className:"sk-message",children:[g.jsx("div",{className:"sk-avatar"}),g.jsxs("div",{className:"sk-body",children:[g.jsx("div",{className:"sk-line sk-short"}),g.jsx("div",{className:"sk-line sk-long"}),t%2===0&&g.jsx("div",{className:"sk-line sk-medium"})]})]},t))})}function J4({count:n=8}){return g.jsx("div",{className:"sk-container",children:Array.from({length:n},(e,t)=>g.jsxs("div",{className:"sk-member",children:[g.jsx("div",{className:"sk-avatar-sm"}),g.jsx("div",{className:"sk-line sk-name"})]},t))})}const bl=Pt((n,e)=>({options:null,resolver:null,open:t=>new Promise(i=>{n({options:t,resolver:i})}),confirm:()=>{const{resolver:t}=e();t&&t(!0),n({options:null,resolver:null})},cancel:()=>{const{resolver:t}=e();t&&t(!1),n({options:null,resolver:null})}}));function cr(){const n=bl(e=>e.open);return E.useCallback(e=>n(e),[n])}const $b={isOpen:!1,x:0,y:0,items:[]};function sk(){const[n,e]=E.useState($b),t=E.useCallback((a,o)=>{a.preventDefault(),a.stopPropagation(),e({isOpen:!0,x:a.clientX,y:a.clientY,items:o})},[]),i=E.useCallback(()=>{e($b)},[]);return{menuState:n,openMenu:t,closeMenu:i}}function Q4(n){switch(n){case"admin":return"av-admin";case"mod":return"av-mod";default:return"av-default"}}function Cn({name:n,role:e,avatarUrl:t,size:i=30,isCircle:a=!1}){const o=a?"avatar avatar-round":"avatar",l=i*.37;return t?g.jsx("img",{src:t,alt:n,className:o,style:{width:i,height:i,objectFit:"cover"}}):g.jsx("div",{className:`${o} ${Q4(e)}`,style:{width:i,height:i,fontSize:l},children:n.charAt(0).toUpperCase()})}function ak({state:n,onClose:e}){const t=E.useRef(null);return E.useEffect(()=>{if(!n.isOpen)return;function i(o){t.current&&!t.current.contains(o.target)&&e()}function a(o){o.key==="Escape"&&e()}return requestAnimationFrame(()=>{document.addEventListener("mousedown",i),document.addEventListener("keydown",a)}),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("keydown",a)}},[n.isOpen,e]),E.useEffect(()=>{if(!n.isOpen||!t.current)return;const i=t.current,a=i.getBoundingClientRect(),o=window.innerWidth,l=window.innerHeight;let u=n.x,h=n.y;u+a.width>o-8&&(u=o-a.width-8),h+a.height>l-8&&(h=l-a.height-8),i.style.left=`${u}px`,i.style.top=`${h}px`},[n.isOpen,n.x,n.y]),n.isOpen?qS.createPortal(g.jsx("div",{ref:t,className:"ctx-menu",style:{left:n.x,top:n.y},children:n.items.map((i,a)=>g.jsxs("div",{children:[i.separator&&g.jsx("div",{className:"ctx-separator"}),g.jsx("button",{className:`ctx-item${i.danger?" ctx-danger":""}${i.disabled?" ctx-disabled":""}`,onClick:()=>{i.disabled||(i.onClick(),e())},disabled:i.disabled,children:i.label})]},a))}),document.body):null}const Kb=[{labelKey:"emojiFrequent",icon:"",emojis:["","","","","","","","","","","",""]},{labelKey:"emojiPeople",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{labelKey:"emojiGestures",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{labelKey:"emojiNature",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","",""]},{labelKey:"emojiFood",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","",""]},{labelKey:"emojiObjects",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}];function Gb({onSelect:n,onClose:e}){const{t}=ye("chat"),[i,a]=E.useState(0),o=E.useRef(null);E.useEffect(()=>{function h(m){o.current&&!o.current.contains(m.target)&&e()}const f=setTimeout(()=>{document.addEventListener("mousedown",h)},0);return()=>{clearTimeout(f),document.removeEventListener("mousedown",h)}},[e]),E.useEffect(()=>{function h(f){f.key==="Escape"&&e()}return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[e]);const l=E.useCallback(h=>{n(h),e()},[n,e]),u=Kb[i];return g.jsxs("div",{className:"emoji-picker",ref:o,children:[g.jsx("div",{className:"emoji-picker-tabs",children:Kb.map((h,f)=>g.jsx("button",{className:`emoji-picker-tab${f===i?" active":""}`,onClick:()=>a(f),title:t(h.labelKey),children:h.icon},h.labelKey))}),g.jsx("div",{className:"emoji-picker-grid",children:u.emojis.map(h=>g.jsx("button",{className:"emoji-picker-btn",onClick:()=>l(h),children:h},h))})]})}function X4(n){if(!n||n.roles.length===0)return null;const t=n.roles.reduce((i,a)=>a.position>i.position?a:i).name.toLowerCase();return t.includes("admin")||t.includes("owner")?"admin":t.includes("mod")?"mod":null}function W4(n){switch(n){case"admin":return"name-admin";case"mod":return"name-mod";default:return"name-default"}}function Z4({message:n,isCompact:e}){const{t}=ye("chat"),i=et(re=>re.user),a=ut(re=>re.editMessage),o=ut(re=>re.deleteMessage),l=ut(re=>re.toggleReaction),u=ut(re=>re.setReplyingTo),h=ut(re=>re.setScrollToMessageId),f=mt(re=>re.members),m=Kn(re=>re.pin),v=Kn(re=>re.unpin),b=Kn(re=>re.isMessagePinned),C=cr(),{menuState:T,openMenu:S,closeMenu:R}=sk(),[_,D]=E.useState(!1),[j,x]=E.useState(n.content??""),[w,M]=E.useState(null),I=i?.id===n.user_id,F=f.find(re=>re.id===n.user_id),L=X4(F),A=f.find(re=>re.id===i?.id),O=A?cn(A.effective_permissions,Ne.ManageMessages):!1,Y=b(n.channel_id,n.id),J=E.useCallback(re=>new Date(re).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),[]),le=E.useCallback(re=>new Date(re).toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),[]);async function Te(){j.trim()&&j.trim()!==n.content&&await a(n.id,j.trim()),D(!1)}function H(){x(n.content??""),D(!1)}async function ae(){await C({message:t("deleteMessageConfirm"),confirmLabel:t("deleteMessage"),danger:!0})&&await o(n.id)}async function de(){Y?await v(n.channel_id,n.id):await m(n.channel_id,n.id)}function Ee(){u(n)}function De(){n.reply_to_id&&h(n.reply_to_id)}function B(re){l(n.id,n.channel_id,re)}function W(re){const fe=[];fe.push({label:t("replyMessage"),onClick:Ee}),fe.push({label:t("addReaction"),onClick:()=>M("bar")}),fe.push({label:t("copyMessage"),onClick:()=>{n.content&&navigator.clipboard.writeText(n.content)}}),O&&fe.push({label:t(Y?"unpinMessage":"pinMessage"),onClick:de,separator:!0}),I&&fe.push({label:t("editMessage"),onClick:()=>{x(n.content??""),D(!0)},separator:!O}),(I||O)&&fe.push({label:t("deleteMessage"),onClick:ae,danger:!0}),fe.push({label:t("copyId"),onClick:()=>navigator.clipboard.writeText(n.id),separator:!0}),S(re,fe)}const oe=n.author?.display_name??n.author?.username??"Unknown";function he(re){return re?re.split(/(@\w+)/g).map((Je,$e)=>/^@\w+$/.test(Je)?g.jsx("span",{className:"msg-mention",children:Je},$e):Je):null}const Ce=`msg${e?" grouped":" first-of-group"}${w?" picker-open":""}`;return g.jsxs("div",{className:Ce,onContextMenu:W,children:[g.jsx("span",{className:"msg-gtime",children:J(n.created_at)}),g.jsxs("div",{className:"msg-row",children:[g.jsx("div",{className:"msg-avatar",children:g.jsx(Cn,{name:oe,role:L,avatarUrl:n.author?.avatar_url??void 0,size:30})}),g.jsxs("div",{className:"msg-body",children:[g.jsxs("div",{className:"msg-meta",children:[g.jsx("span",{className:`msg-name ${W4(L)}`,children:oe}),g.jsx("span",{className:"msg-time",title:le(n.created_at),children:J(n.created_at)})]}),n.reply_to_id&&g.jsxs("div",{className:"msg-reply-preview",onClick:De,children:[g.jsx("div",{className:"msg-reply-bar"}),n.referenced_message?.author?g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"msg-reply-author",children:n.referenced_message.author.display_name??n.referenced_message.author.username}),g.jsx("span",{className:"msg-reply-content",children:n.referenced_message.content??t("noContent")})]}):g.jsx("span",{className:"msg-reply-deleted",children:t("replyDeleted")})]}),Y&&g.jsxs("div",{className:"msg-pin-indicator",children:[g.jsx("svg",{style:{width:12,height:12},fill:"currentColor",viewBox:"0 0 24 24",stroke:"none",children:g.jsx("path",{d:"M16 4v4l2 2v4h-5v6l-1 1-1-1v-6H6v-4l2-2V4a1 1 0 011-1h6a1 1 0 011 1z"})}),g.jsx("span",{children:t("pinnedMessages")})]}),_?g.jsxs("div",{className:"msg-edit-area",children:[g.jsx("textarea",{value:j,onChange:re=>x(re.target.value),onKeyDown:re=>{re.key==="Enter"&&!re.shiftKey&&(re.preventDefault(),Te()),re.key==="Escape"&&H()},className:"msg-edit-textarea",rows:2,autoFocus:!0}),g.jsxs("p",{className:"msg-edit-hint",children:["escape = ",t("editCancel","cancel"),", enter = ",t("editSave","save")]})]}):g.jsxs("div",{className:"msg-text",children:[he(n.content),n.edited_at&&g.jsx("span",{className:"msg-edited",children:t("edited")})]}),n.attachments&&n.attachments.length>0&&g.jsx("div",{className:"msg-attachments",children:n.attachments.map(re=>re.mime_type?.startsWith("image/")?g.jsx("a",{href:re.file_url,target:"_blank",rel:"noopener noreferrer",children:g.jsx("img",{src:re.file_url,alt:re.filename,className:"msg-attachment-img",loading:"lazy"})},re.id):g.jsxs("a",{href:re.file_url,target:"_blank",rel:"noopener noreferrer",className:"msg-attachment-file",children:[g.jsx("svg",{className:"msg-attachment-file-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})}),g.jsxs("div",{style:{minWidth:0},children:[g.jsx("p",{className:"msg-attachment-file-name",children:re.filename}),re.file_size&&g.jsx("p",{className:"msg-attachment-file-size",children:e5(re.file_size)})]})]},re.id))}),(n.reactions&&n.reactions.length>0||w==="bar")&&g.jsxs("div",{className:"msg-reactions",children:[n.reactions?.map(re=>{const fe=i?re.users.includes(i.id):!1;return g.jsxs("button",{className:`msg-reaction-btn${fe?" active":""}`,onClick:()=>B(re.emoji),title:re.users.length.toString(),children:[g.jsx("span",{className:"msg-reaction-emoji",children:re.emoji}),g.jsx("span",{className:"msg-reaction-count",children:re.count})]},re.emoji)}),g.jsxs("div",{className:"msg-reaction-add-wrap",children:[g.jsx("button",{className:"msg-reaction-add",onClick:()=>M("bar"),title:t("addReaction"),children:"+"}),w==="bar"&&g.jsx(Gb,{onSelect:B,onClose:()=>M(null)})]})]})]})]}),g.jsx(ak,{state:T,onClose:R}),!_&&g.jsxs("div",{className:"msg-hover-actions",children:[g.jsx("button",{onClick:Ee,title:t("replyMessage"),children:g.jsx("svg",{style:{width:14,height:14},fill:"currentColor",viewBox:"0 0 24 24",stroke:"none",children:g.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"})})}),g.jsxs("div",{className:"msg-reaction-add-wrap",children:[g.jsx("button",{onClick:()=>M("hover"),title:t("addReaction"),children:g.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),w==="hover"&&g.jsx(Gb,{onSelect:B,onClose:()=>M(null)})]}),O&&g.jsx("button",{onClick:de,title:t(Y?"unpinMessage":"pinMessage"),children:g.jsx("svg",{style:{width:14,height:14},fill:Y?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 4v4l2 2v4h-5v6l-1 1-1-1v-6H6v-4l2-2V4a1 1 0 011-1h6a1 1 0 011 1z"})})}),I&&g.jsx("button",{onClick:()=>{x(n.content??""),D(!0)},title:t("editMessage"),children:g.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(I||O)&&g.jsx("button",{onClick:ae,title:t("deleteMessage"),children:g.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})}function e5(n){return n<1024?`${n} B`:n<1024*1024?`${(n/1024).toFixed(1)} KB`:`${(n/(1024*1024)).toFixed(1)} MB`}const t5=300*1e3,Yb=[],Jb=new Map;function n5({channelId:n}){const{t:e}=ye("chat"),t=Ot(D=>D.categories),i=ut(D=>n?D.messagesByChannel[n]??Yb:Yb),a=ut(D=>n?D.hasMoreByChannel[n]??!1:!1),o=ut(D=>D.isLoading),l=ut(D=>D.isLoadingMore),u=ut(D=>D.fetchMessages),h=ut(D=>D.fetchOlderMessages),f=ut(D=>D.scrollToMessageId),m=ut(D=>D.setScrollToMessageId),v=E.useRef(null),b=E.useRef(!0),C=E.useRef(0),T=t.flatMap(D=>D.channels).find(D=>D.id===n)?.name??"";E.useEffect(()=>{b.current=!1,n&&u(n)},[n,u]),E.useEffect(()=>{i.length>C.current&&b.current&&S(),C.current=i.length},[i.length]),E.useLayoutEffect(()=>{if(!o&&i.length>0&&v.current){const D=Jb.get(n);D!==void 0?v.current.scrollTop=D:S(),C.current=i.length;const{scrollTop:j,scrollHeight:x,clientHeight:w}=v.current;b.current=x-j-w<20}},[o,n]),E.useEffect(()=>{if(!f)return;const D=document.getElementById(`msg-${f}`);if(D){D.scrollIntoView({behavior:"smooth",block:"center"}),D.classList.add("msg-highlight");const j=setTimeout(()=>{D.classList.remove("msg-highlight")},2e3);return m(null),()=>clearTimeout(j)}m(null)},[f,m]);function S(){v.current&&(v.current.scrollTop=v.current.scrollHeight)}const R=E.useCallback(()=>{if(!v.current)return;const{scrollTop:D,scrollHeight:j,clientHeight:x}=v.current;if(b.current=j-D-x<20,n&&Jb.set(n,D),D<100&&a&&!l&&n){const w=v.current.scrollHeight;h(n).then(()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight-w)})}},[a,l,n,h]);function _(D){if(D===0)return!1;const j=i[D];if(j.reply_to_id)return!1;const x=i[D-1];return j.user_id!==x.user_id?!1:new Date(j.created_at).getTime()-new Date(x.created_at).getTime()<t5}return n?o?g.jsx("div",{className:"messages-scroll",children:g.jsx(Y4,{count:6})}):g.jsxs("div",{ref:v,onScroll:R,className:"messages-scroll",children:[l&&g.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"16px 0"},children:g.jsx("div",{className:"spinner"})}),i.length===0?g.jsxs("div",{className:"msg-welcome",children:[g.jsx("div",{className:"msg-welcome-icon",children:g.jsx("span",{children:"#"})}),g.jsx("h2",{children:e("welcomeChannel",{channel:T})}),g.jsx("p",{children:e("channelStart",{channel:T})})]}):g.jsx("div",{style:{display:"flex",flexDirection:"column",justifyContent:"flex-end",padding:"8px 0"},children:i.map((D,j)=>g.jsx("div",{id:`msg-${D.id}`,children:g.jsx(Z4,{message:D,isCompact:_(j)})},D.id))})]}):g.jsx("div",{className:"no-channel",children:"Select a channel"})}function i5({files:n,onRemove:e}){return n.length===0?null:g.jsx("div",{className:"file-preview",children:n.map((t,i)=>g.jsx(s5,{file:t,onRemove:()=>e(i)},i))})}function s5({file:n,onRemove:e}){const t=n.type.startsWith("image/"),i=E.useMemo(()=>t?URL.createObjectURL(n):null,[n,t]);return g.jsxs("div",{className:"file-preview-item",children:[g.jsx("button",{className:"file-preview-remove",onClick:e,children:""}),t&&i?g.jsx("img",{src:i,alt:n.name}):g.jsx("span",{className:"file-preview-name",children:n.name})]})}const a5=5;function r5({query:n,onSelect:e,onClose:t}){const i=mt(h=>h.members),[a,o]=E.useState(0),l=i.filter(h=>{const f=n.toLowerCase();return h.username.toLowerCase().includes(f)||(h.display_name?.toLowerCase().includes(f)??!1)}).slice(0,a5);E.useEffect(()=>{o(0)},[n]),E.useEffect(()=>{l.length===0&&n.length>0&&t()},[l.length,n.length,t]);const u=E.useCallback(h=>{if(l.length!==0)switch(h.key){case"ArrowUp":h.preventDefault(),o(f=>f>0?f-1:l.length-1);break;case"ArrowDown":h.preventDefault(),o(f=>f<l.length-1?f+1:0);break;case"Enter":case"Tab":h.preventDefault(),l[a]&&e(l[a].username);break;case"Escape":h.preventDefault(),t();break}},[l,a,e,t]);return E.useEffect(()=>(document.addEventListener("keydown",u,!0),()=>document.removeEventListener("keydown",u,!0)),[u]),l.length===0?null:g.jsx("div",{className:"mention-popup",children:l.map((h,f)=>g.jsxs("button",{className:`mention-item${f===a?" active":""}`,onMouseDown:m=>{m.preventDefault(),e(h.username)},onMouseEnter:()=>o(f),children:[g.jsx("div",{className:"mention-item-avatar",children:g.jsx(Cn,{name:h.display_name??h.username,avatarUrl:h.avatar_url??void 0,size:22})}),g.jsx("span",{className:"mention-item-name",children:h.display_name??h.username}),g.jsxs("span",{className:"mention-item-username",children:["@",h.username]})]},h.id))})}function o5({message:n,onCancel:e}){const{t}=ye("chat"),i=n.author?.display_name??n.author?.username??t("unknownUser"),a=n.content??t("noContent");return g.jsxs("div",{className:"reply-bar",children:[g.jsx("svg",{className:"reply-bar-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:g.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"})}),g.jsx("span",{className:"reply-bar-user",children:t("replyingTo",{user:i})}),g.jsx("span",{className:"reply-bar-text",children:a}),g.jsx("button",{className:"reply-bar-close",onClick:e,title:"Escape",children:g.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:g.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]})}function c5({sendTyping:n,channelId:e,channelName:t,canSend:i}){const{t:a}=ye("chat"),o=ut(A=>A.sendMessage),l=ut(A=>A.replyingTo),u=ut(A=>A.setReplyingTo),[h,f]=E.useState(""),[m,v]=E.useState([]),[b,C]=E.useState(!1),[T,S]=E.useState(null),R=E.useRef(-1),_=E.useRef(null),D=E.useRef(null);E.useEffect(()=>{l&&_.current?.focus()},[l]);const j=E.useCallback(async()=>{if(!e||!h.trim()&&m.length===0||b)return;C(!0);const A=l?.id;await o(e,h.trim(),m,A)&&(f(""),v([]),u(null),_.current&&(_.current.style.height="auto")),C(!1),requestAnimationFrame(()=>{_.current?.focus()})},[e,h,m,b,o,l,u]);function x(A){if(!(T!==null&&["Enter","Tab","ArrowUp","ArrowDown","Escape"].includes(A.key))){if(A.key==="Escape"&&l){A.preventDefault(),u(null);return}A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),j())}}function w(A){const O=A.target.value;f(O),e&&O.length>0&&n(e);const Y=A.target.selectionStart??O.length,J=O.slice(0,Y),le=J.lastIndexOf("@");if(le>=0){const Te=le>0?J[le-1]:" ";if(Te===" "||Te===`
`||le===0){const H=J.slice(le+1);!H.includes(" ")&&!H.includes(`
`)?(R.current=le,S(H)):S(null)}else S(null)}else S(null);_.current&&(_.current.style.height="auto",_.current.style.height=`${Math.min(_.current.scrollHeight,200)}px`)}function M(A){const O=R.current;if(O<0)return;const Y=_.current?.selectionStart??h.length,J=h.slice(0,O),le=h.slice(Y),Te=`${J}@${A} ${le}`;f(Te),S(null),R.current=-1,requestAnimationFrame(()=>{if(_.current){const H=O+A.length+2;_.current.selectionStart=H,_.current.selectionEnd=H,_.current.focus()}})}function I(){S(null),R.current=-1}function F(A){if(!A.target.files)return;const O=Array.from(A.target.files),Y=[];for(const J of O)J.size>o4||c4.includes(J.type)&&Y.push(J);v(J=>[...J,...Y]),A.target.value=""}function L(A){v(O=>O.filter((Y,J)=>J!==A))}return e?i?g.jsxs("div",{className:"input-area",children:[T!==null&&g.jsx(r5,{query:T,onSelect:M,onClose:I}),l&&g.jsx(o5,{message:l,onCancel:()=>u(null)}),g.jsx(i5,{files:m,onRemove:L}),g.jsxs("div",{className:"input-box",children:[g.jsx("button",{className:"input-action-btn",onClick:()=>D.current?.click(),title:a("attachFile"),children:g.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("circle",{cx:"12",cy:"12",r:"10"}),g.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),g.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]})}),g.jsx("input",{ref:D,type:"file",multiple:!0,style:{display:"none"},onChange:F}),g.jsx("textarea",{ref:_,value:h,onChange:w,onKeyDown:x,placeholder:a("messagePlaceholder",{channel:t}),rows:1,disabled:b}),g.jsx("button",{className:"input-action-btn",title:a("emoji"),children:g.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("circle",{cx:"12",cy:"12",r:"10"}),g.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),g.jsx("line",{x1:"9",y1:"9",x2:"9.01",y2:"9"}),g.jsx("line",{x1:"15",y1:"9",x2:"15.01",y2:"9"})]})})]})]}):g.jsx("div",{className:"input-area",children:g.jsx("div",{className:"input-box input-box-disabled",children:g.jsx("span",{className:"input-no-perm",children:a("noSendPermission")})})}):null}const Qb=[];function l5({channelId:n}){const{t:e}=ye("chat"),t=ut(a=>n?a.typingUsers[n]??Qb:Qb);if(t.length===0)return null;const i=t.length===1?e("typing",{user:t[0]}):e("typingMultiple",{count:t.length});return g.jsxs("div",{className:"typing-indicator",children:[g.jsxs("div",{className:"typing-dots",children:[g.jsx("i",{}),g.jsx("i",{}),g.jsx("i",{})]}),g.jsx("span",{children:i})]})}function u5({channelId:n,onClose:e}){const{t}=ye("chat"),i=Kn(T=>T.fetchPins),a=Kn(T=>T.getPinsForChannel),o=Kn(T=>T.unpin),l=Kn(T=>T.isLoading),u=mt(T=>T.members),h=et(T=>T.user),f=a(n),m=u.find(T=>T.id===h?.id),v=m?cn(m.effective_permissions,Ne.ManageMessages):!1;E.useEffect(()=>{i(n)},[n,i]);const b=E.useCallback(async T=>{await o(n,T)},[n,o]);function C(T){return new Date(T).toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}return g.jsxs("div",{className:"pinned-panel",children:[g.jsxs("div",{className:"pinned-header",children:[g.jsx("span",{className:"pinned-header-title",children:t("pinnedMessages")}),g.jsx("button",{onClick:e,className:"pinned-close",children:g.jsx("svg",{style:{width:16,height:16},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsx("div",{className:"pinned-list",children:l?g.jsx("p",{className:"pinned-empty",children:t("noPinnedMessages")}):f.length===0?g.jsx("p",{className:"pinned-empty",children:t("noPinnedMessages")}):f.map(T=>{const S=T.message?.author,R=S?.display_name??S?.username??"Unknown";return g.jsxs("div",{className:"pinned-item",children:[g.jsxs("div",{className:"pinned-item-header",children:[g.jsx(Cn,{name:R,avatarUrl:S?.avatar_url??void 0,size:20}),g.jsx("span",{className:"pinned-item-author",children:R}),g.jsx("span",{className:"pinned-item-time",children:C(T.message?.created_at??T.created_at)})]}),g.jsx("div",{className:"pinned-item-content",children:T.message?.content??""}),v&&g.jsx("button",{onClick:()=>b(T.message_id),className:"pinned-item-unpin",title:t("unpinMessage"),children:g.jsx("svg",{style:{width:12,height:12},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},T.id)})})]})}async function d5(n,e,t=25,i=0){const a=new URLSearchParams({q:n});return e&&a.set("channel_id",e),t!==25&&a.set("limit",String(t)),i>0&&a.set("offset",String(i)),be(`/search?${a.toString()}`)}const h5=300;function f5({channelId:n,onClose:e,onSelectResult:t}){const{t:i}=ye("chat"),[a,o]=E.useState(""),[l,u]=E.useState(null),[h,f]=E.useState(!1),[m,v]=E.useState(0),b=E.useRef(null),C=E.useRef(null),T=25;E.useEffect(()=>{C.current?.focus()},[]);const S=E.useCallback(async(M,I)=>{if(M.trim().length<1){u(null);return}f(!0);const F=await d5(M.trim(),n,T,I);F.success&&F.data?u(F.data):u({messages:[],total_count:0}),f(!1)},[n]);function R(M){o(M),v(0),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{S(M,0)},h5)}function _(){const M=m+T;v(M),S(a,M)}function D(){const M=Math.max(0,m-T);v(M),S(a,M)}function j(M){return new Date(M).toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}const x=l?Math.ceil(l.total_count/T):0,w=Math.floor(m/T)+1;return g.jsxs("div",{className:"search-panel",children:[g.jsxs("div",{className:"search-header",children:[g.jsx("span",{className:"search-header-title",children:i("searchMessages")}),g.jsx("button",{onClick:e,className:"search-close",children:g.jsx("svg",{style:{width:16,height:16},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"search-input-wrap",children:[g.jsx("svg",{className:"search-input-icon",style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),g.jsx("input",{ref:C,type:"text",value:a,onChange:M=>R(M.target.value),placeholder:i("searchPlaceholder"),className:"search-input"})]}),g.jsx("div",{className:"search-results",children:h?g.jsx("p",{className:"search-empty",children:i("searching")}):l?l.messages.length===0?g.jsx("p",{className:"search-empty",children:i("noSearchResults")}):g.jsxs(g.Fragment,{children:[g.jsx("p",{className:"search-count",children:i("searchResultCount",{count:l.total_count})}),l.messages.map(M=>{const I=M.author?.display_name??M.author?.username??"Unknown";return g.jsxs("div",{className:"search-result-item",onClick:()=>t?.(M),children:[g.jsxs("div",{className:"search-result-header",children:[g.jsx(Cn,{name:I,avatarUrl:M.author?.avatar_url??void 0,size:18}),g.jsx("span",{className:"search-result-author",children:I}),g.jsx("span",{className:"search-result-time",children:j(M.created_at)})]}),g.jsx("div",{className:"search-result-content",children:M.content??""})]},M.id)}),x>1&&g.jsxs("div",{className:"search-pagination",children:[g.jsx("button",{onClick:D,disabled:w<=1,className:"search-page-btn",children:i("searchPrev")}),g.jsxs("span",{className:"search-page-info",children:[w," / ",x]}),g.jsx("button",{onClick:_,disabled:w>=x,className:"search-page-btn",children:i("searchNext")})]})]}):g.jsx("p",{className:"search-empty",children:i("searchHint")})})]})}function m5({channelId:n,channel:e,sendTyping:t}){const{t:i}=ye("chat"),a=Ye(R=>R.toggleMembers),o=Ye(R=>R.membersOpen),l=Kn(R=>R.getPinsForChannel),u=Kn(R=>R.fetchPins),h=Mo(R=>R.fetchOverrides),{hasChannelPerm:f}=V4(n),[m,v]=E.useState(!1),[b,C]=E.useState(!1);E.useEffect(()=>{n&&(u(n),h(n))},[n,u,h]);const T=l(n).length,S=f(Ne.SendMessages);return g.jsxs("div",{className:"chat-area",children:[g.jsx("div",{className:"channel-bar",children:e?g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"ch-hash",children:"#"}),g.jsx("span",{className:"ch-name",children:e.name}),e.topic&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"ch-divider"}),g.jsx("span",{className:"ch-topic",children:e.topic})]}),g.jsxs("div",{className:"ch-actions",children:[g.jsx("button",{className:m?"active":"",onClick:()=>v(R=>!R),title:i("pinnedMessages"),children:g.jsx("svg",{style:{width:16,height:16},fill:T>0?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 4v4l2 2v4h-5v6l-1 1-1-1v-6H6v-4l2-2V4a1 1 0 011-1h6a1 1 0 011 1z"})})}),g.jsx("button",{className:b?"active":"",onClick:()=>C(R=>!R),title:i("searchMessages"),children:g.jsx("svg",{style:{width:16,height:16},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),g.jsx("button",{className:o?"active":"",onClick:a,children:g.jsx("svg",{style:{width:16,height:16},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})]})]}):g.jsx("span",{className:"ch-topic",children:i("channelStart",{channel:""})})}),m&&g.jsx(u5,{channelId:n,onClose:()=>v(!1)}),b&&g.jsx(f5,{channelId:n,onClose:()=>C(!1)}),g.jsx(n5,{channelId:n}),g.jsx(l5,{channelId:n}),g.jsx(c5,{sendTyping:t,channelId:n,channelName:e?.name??"",canSend:S})]})}var Xb={};function p5(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var a=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(n)}var g5=Object.defineProperty,v5=(n,e,t)=>e in n?g5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Wb=(n,e,t)=>v5(n,typeof e!="symbol"?e+"":e,t);class Qt{constructor(){Wb(this,"_locking"),Wb(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(a=>e=()=>{this._locks-=1,a()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),i}}function pt(n,e){if(!n)throw new Error(e)}const y5=34028234663852886e22,b5=-34028234663852886e22,S5=4294967295,k5=2147483647,C5=-2147483648;function Sl(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>k5||n<C5)throw new Error("invalid int 32: "+n)}function jf(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>S5||n<0)throw new Error("invalid uint 32: "+n)}function rk(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>y5||n<b5))throw new Error("invalid float 32: "+n)}const ok=Symbol("@bufbuild/protobuf/enum-type");function T5(n){const e=n[ok];return pt(e,"missing enum type on enum object"),e}function ck(n,e,t,i){n[ok]=lk(e,t.map(a=>({no:a.no,name:a.name,localName:n[a.no]})))}function lk(n,e,t){const i=Object.create(null),a=Object.create(null),o=[];for(const l of e){const u=uk(l);o.push(u),i[l.name]=u,a[l.no]=u}return{typeName:n,values:o,findName(l){return i[l]},findNumber(l){return a[l]}}}function E5(n,e,t){const i={};for(const a of e){const o=uk(a);i[o.localName]=o.no,i[o.no]=o.localName}return ck(i,n,e),i}function uk(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class Sm{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),a=i.runtime.bin,o=a.makeReadOptions(t);return a.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,t){const i=this.getType(),a=i.runtime.json,o=a.makeReadOptions(t);return a.readMessage(i,e,o,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(a){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(a instanceof Error?a.message:String(a)))}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,a=i.makeWriteOptions(e),o=a.writerFactory();return i.writeMessage(this,o,a),o.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,a=i.makeWriteOptions(e);return i.writeMessage(this,a)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e?.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function x5(n,e,t,i){var a;const o=(a=i?.localName)!==null&&a!==void 0?a:e.substring(e.lastIndexOf(".")+1),l={[o]:function(u){n.util.initFields(this),n.util.initPartial(u,this)}}[o];return Object.setPrototypeOf(l.prototype,new Sm),Object.assign(l,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(u,h){return new l().fromBinary(u,h)},fromJson(u,h){return new l().fromJson(u,h)},fromJsonString(u,h){return new l().fromJsonString(u,h)},equals(u,h){return n.util.equals(l,u,h)}}),l}function R5(){let n=0,e=0;for(let i=0;i<28;i+=7){let a=this.buf[this.pos++];if(n|=(a&127)<<i,(a&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let a=this.buf[this.pos++];if(e|=(a&127)<<i,(a&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function Zh(n,e,t){for(let o=0;o<28;o=o+7){const l=n>>>o,u=!(!(l>>>7)&&e==0),h=(u?l|128:l)&255;if(t.push(h),!u)return}const i=n>>>28&15|(e&7)<<4,a=e>>3!=0;if(t.push((a?i|128:i)&255),!!a){for(let o=3;o<31;o=o+7){const l=e>>>o,u=!!(l>>>7),h=(u?l|128:l)&255;if(t.push(h),!u)return}t.push(e>>>31&1)}}const kl=4294967296;function Zb(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,a=0;function o(l,u){const h=Number(n.slice(l,u));a*=t,i=i*t+h,i>=kl&&(a=a+(i/kl|0),i=i%kl)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?hk(i,a):km(i,a)}function _5(n,e){let t=km(n,e);const i=t.hi&2147483648;i&&(t=hk(t.lo,t.hi));const a=dk(t.lo,t.hi);return i?"-"+a:a}function dk(n,e){if({lo:n,hi:e}=w5(n,e),e<=2097151)return String(kl*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,a=e>>16&65535;let o=t+i*6777216+a*6710656,l=i+a*8147497,u=a*2;const h=1e7;return o>=h&&(l+=Math.floor(o/h),o%=h),l>=h&&(u+=Math.floor(l/h),l%=h),u.toString()+e0(l)+e0(o)}function w5(n,e){return{lo:n>>>0,hi:e>>>0}}function km(n,e){return{lo:n|0,hi:e|0}}function hk(n,e){return e=~e,n?n=~n+1:e+=1,km(n,e)}const e0=n=>{const e=String(n);return"0000000".slice(e.length)+e};function t0(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function M5(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function N5(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof Xb!="object"||Xb.BUF_BIGINT_DISABLE!=="1")){const a=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),l=BigInt("0"),u=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(h){const f=typeof h=="bigint"?h:BigInt(h);if(f>o||f<a)throw new Error("int64 invalid: ".concat(h));return f},uParse(h){const f=typeof h=="bigint"?h:BigInt(h);if(f>u||f<l)throw new Error("uint64 invalid: ".concat(h));return f},enc(h){return n.setBigInt64(0,this.parse(h),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(h){return n.setBigInt64(0,this.uParse(h),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(h,f){return n.setInt32(0,h,!0),n.setInt32(4,f,!0),n.getBigInt64(0,!0)},uDec(h,f){return n.setInt32(0,h,!0),n.setInt32(4,f,!0),n.getBigUint64(0,!0)}}}const t=a=>pt(/^-?[0-9]+$/.test(a),"int64 invalid: ".concat(a)),i=a=>pt(/^[0-9]+$/.test(a),"uint64 invalid: ".concat(a));return{zero:"0",supported:!1,parse(a){return typeof a!="string"&&(a=a.toString()),t(a),a},uParse(a){return typeof a!="string"&&(a=a.toString()),i(a),a},enc(a){return typeof a!="string"&&(a=a.toString()),t(a),Zb(a)},uEnc(a){return typeof a!="string"&&(a=a.toString()),i(a),Zb(a)},dec(a,o){return _5(a,o)},uDec(a,o){return dk(a,o)}}}const ct=N5();var se;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(se||(se={}));var bs;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(bs||(bs={}));function us(n,e,t){if(e===t)return!0;if(n==se.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case se.UINT64:case se.FIXED64:case se.INT64:case se.SFIXED64:case se.SINT64:return e==t}return!1}function tr(n,e){switch(n){case se.BOOL:return!1;case se.UINT64:case se.FIXED64:case se.INT64:case se.SFIXED64:case se.SINT64:return e==0?ct.zero:"0";case se.DOUBLE:case se.FLOAT:return 0;case se.BYTES:return new Uint8Array(0);case se.STRING:return"";default:return 0}}function fk(n,e){switch(n){case se.BOOL:return e===!1;case se.STRING:return e==="";case se.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var St;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(St||(St={}));class D5{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let a=0;a<this.chunks.length;a++)e+=this.chunks[a].length;let t=new Uint8Array(e),i=0;for(let a=0;a<this.chunks.length;a++)t.set(this.chunks[a],i),i+=this.chunks[a].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(jf(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Sl(e),t0(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){rk(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){jf(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Sl(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Sl(e),e=(e<<1^e>>31)>>>0,t0(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),a=ct.enc(e);return i.setInt32(0,a.lo,!0),i.setInt32(4,a.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),a=ct.uEnc(e);return i.setInt32(0,a.lo,!0),i.setInt32(4,a.hi,!0),this.raw(t)}int64(e){let t=ct.enc(e);return Zh(t.lo,t.hi,this.buf),this}sint64(e){let t=ct.enc(e),i=t.hi>>31,a=t.lo<<1^i,o=(t.hi<<1|t.lo>>>31)^i;return Zh(a,o,this.buf),this}uint64(e){let t=ct.uEnc(e);return Zh(t.lo,t.hi,this.buf),this}}class O5{constructor(e,t){this.varint64=R5,this.uint32=M5,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e,t){let i=this.pos;switch(e){case St.Varint:for(;this.buf[this.pos++]&128;);break;case St.Bit64:this.pos+=4;case St.Bit32:this.pos+=4;break;case St.LengthDelimited:let a=this.uint32();this.pos+=a;break;case St.StartGroup:for(;;){const[o,l]=this.tag();if(l===St.EndGroup){if(t!==void 0&&o!==t)throw new Error("invalid end group tag");break}this.skip(l,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ct.dec(...this.varint64())}uint64(){return ct.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,ct.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ct.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ct.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function A5(n,e,t,i){let a;return{typeName:e,extendee:t,get field(){if(!a){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),a=n.util.newFieldList([o]).list()[0]}return a},runtime:n}}function mk(n){const e=n.field.localName,t=Object.create(null);return t[e]=j5(n),[t,()=>t[e]]}function j5(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return tr(e.T,e.L);case"message":const t=e.T,i=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function P5(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),cu=[];for(let n=0;n<wi.length;n++)cu[wi[n].charCodeAt(0)]=n;cu[45]=wi.indexOf("+");cu[95]=wi.indexOf("/");const pk={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,a=0,o,l=0;for(let u=0;u<n.length;u++){if(o=cu[n.charCodeAt(u)],o===void 0)switch(n[u]){case"=":a=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:l=o,a=1;break;case 1:t[i++]=l<<2|(o&48)>>4,l=o,a=2;break;case 2:t[i++]=(l&15)<<4|(o&60)>>2,l=o,a=3;break;case 3:t[i++]=(l&3)<<6|o,a=0;break}}if(a==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,a=0;for(let o=0;o<n.length;o++)switch(i=n[o],t){case 0:e+=wi[i>>2],a=(i&3)<<4,t=1;break;case 1:e+=wi[a|i>>4],a=(i&15)<<2,t=2;break;case 2:e+=wi[a|i>>6],e+=wi[i&63],t=0;break}return t&&(e+=wi[a],e+="=",t==1&&(e+="=")),e}};function L5(n,e,t){vk(e,n);const i=e.runtime.bin.makeReadOptions(t),a=P5(n.getType().runtime.bin.listUnknownFields(n),e.field),[o,l]=mk(e);for(const u of a)e.runtime.bin.readField(o,i.readerFactory(u.data),e.field,u.wireType,i);return l()}function I5(n,e,t,i){vk(e,n);const a=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(gk(n,e)){const f=n.getType().runtime.bin.listUnknownFields(n).filter(m=>m.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const m of f)n.getType().runtime.bin.onUnknownField(n,m.no,m.wireType,m.data)}const l=o.writerFactory();let u=e.field;!u.opt&&!u.repeated&&(u.kind=="enum"||u.kind=="scalar")&&(u=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(u,t,l,o);const h=a.readerFactory(l.finish());for(;h.pos<h.len;){const[f,m]=h.tag(),v=h.skip(m,f);n.getType().runtime.bin.onUnknownField(n,f,m,v)}}function gk(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(i=>i.no==e.field.no)}function vk(n,e){pt(n.extendee.typeName==e.getType().typeName,"extension ".concat(n.typeName," can only be applied to message ").concat(n.extendee.typeName))}function yk(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!fk(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function n0(n,e){const t=n.localName,i=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=i?n.T.values[0].no:void 0;break;case"scalar":e[t]=i?tr(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function Mi(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(Sm.prototype).every(i=>i in n&&typeof n[i]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function bk(n,e){return Mi(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}se.DOUBLE,se.FLOAT,se.INT64,se.UINT64,se.INT32,se.UINT32,se.BOOL,se.STRING,se.BYTES;const i0={ignoreUnknownFields:!1},s0={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function U5(n){return n?Object.assign(Object.assign({},i0),n):i0}function B5(n){return n?Object.assign(Object.assign({},s0),n):s0}const Bl=Symbol(),Cl=Symbol();function z5(){return{makeReadOptions:U5,makeWriteOptions:B5,readMessage(n,e,t,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(n.typeName," from JSON: ").concat(ei(e)));i=i??new n;const a=new Map,o=t.typeRegistry;for(const[l,u]of Object.entries(e)){const h=n.fields.findJsonName(l);if(h){if(h.oneof){if(u===null&&h.kind=="scalar")continue;const f=a.get(h.oneof);if(f!==void 0)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: multiple keys for oneof "').concat(h.oneof.name,'" present: "').concat(f,'", "').concat(l,'"'));a.set(h.oneof,l)}a0(i,u,h,t,n)}else{let f=!1;if(o?.findExtension&&l.startsWith("[")&&l.endsWith("]")){const m=o.findExtension(l.substring(1,l.length-1));if(m&&m.extendee.typeName==n.typeName){f=!0;const[v,b]=mk(m);a0(v,u,m.field,t,m),I5(i,m,b(),t)}}if(!f&&!t.ignoreUnknownFields)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: key "').concat(l,'" is unknown'))}}return i},writeMessage(n,e){const t=n.getType(),i={};let a;try{for(a of t.fields.byNumber()){if(!yk(a,n)){if(a.req)throw"required field not set";if(!e.emitDefaultValues||!V5(a))continue}const l=a.oneof?n[a.oneof.localName].value:n[a.localName],u=r0(a,l,e);u!==void 0&&(i[e.useProtoFieldName?a.name:a.jsonName]=u)}const o=e.typeRegistry;if(o?.findExtensionFor)for(const l of t.runtime.bin.listUnknownFields(n)){const u=o.findExtensionFor(t.typeName,l.no);if(u&&gk(n,u)){const h=L5(n,u,e),f=r0(u.field,h,e);f!==void 0&&(i[u.field.jsonName]=f)}}}catch(o){const l=a?"cannot encode field ".concat(t.typeName,".").concat(a.name," to JSON"):"cannot encode message ".concat(t.typeName," to JSON"),u=o instanceof Error?o.message:String(o);throw new Error(l+(u.length>0?": ".concat(u):""))}return i},readScalar(n,e,t){return To(n,e,t??bs.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||fk(n,e)))return Tl(n,e)},debug:ei}}function ei(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function a0(n,e,t,i,a){let o=t.localName;if(t.repeated){if(pt(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(ei(e)));const l=n[o];for(const u of e){if(u===null)throw new Error("cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(ei(u)));switch(t.kind){case"message":l.push(t.T.fromJson(u,i));break;case"enum":const h=ef(t.T,u,i.ignoreUnknownFields,!0);h!==Cl&&l.push(h);break;case"scalar":try{l.push(To(t.T,u,t.L,!0))}catch(f){let m="cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(ei(u));throw f instanceof Error&&f.message.length>0&&(m+=": ".concat(f.message)),new Error(m)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(ei(e)));const l=n[o];for(const[u,h]of Object.entries(e)){if(h===null)throw new Error("cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: map value null"));let f;try{f=F5(t.K,u)}catch(m){let v="cannot decode map key for field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(ei(e));throw m instanceof Error&&m.message.length>0&&(v+=": ".concat(m.message)),new Error(v)}switch(t.V.kind){case"message":l[f]=t.V.T.fromJson(h,i);break;case"enum":const m=ef(t.V.T,h,i.ignoreUnknownFields,!0);m!==Cl&&(l[f]=m);break;case"scalar":try{l[f]=To(t.V.T,h,bs.BIGINT,!0)}catch(v){let b="cannot decode map value for field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(ei(e));throw v instanceof Error&&v.message.length>0&&(b+=": ".concat(v.message)),new Error(b)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:o},o="value"),t.kind){case"message":const l=t.T;if(e===null&&l.typeName!="google.protobuf.Value")return;let u=n[o];Mi(u)?u.fromJson(e,i):(n[o]=u=l.fromJson(e,i),l.fieldWrapper&&!t.oneof&&(n[o]=l.fieldWrapper.unwrapField(u)));break;case"enum":const h=ef(t.T,e,i.ignoreUnknownFields,!1);switch(h){case Bl:n0(t,n);break;case Cl:break;default:n[o]=h;break}break;case"scalar":try{const f=To(t.T,e,t.L,!1);f===Bl?n0(t,n):n[o]=f}catch(f){let m="cannot decode field ".concat(a.typeName,".").concat(t.name," from JSON: ").concat(ei(e));throw f instanceof Error&&f.message.length>0&&(m+=": ".concat(f.message)),new Error(m)}break}}function F5(n,e){if(n===se.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return To(n,e,bs.BIGINT,!0).toString()}function To(n,e,t,i){if(e===null)return i?tr(n,t):Bl;switch(n){case se.DOUBLE:case se.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const a=Number(e);if(Number.isNaN(a)||!Number.isFinite(a))break;return n==se.FLOAT&&rk(a),a;case se.INT32:case se.FIXED32:case se.SFIXED32:case se.SINT32:case se.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return n==se.UINT32||n==se.FIXED32?jf(o):Sl(o),o;case se.INT64:case se.SFIXED64:case se.SINT64:if(typeof e!="number"&&typeof e!="string")break;const l=ct.parse(e);return t?l.toString():l;case se.FIXED64:case se.UINT64:if(typeof e!="number"&&typeof e!="string")break;const u=ct.uParse(e);return t?u.toString():u;case se.BOOL:if(typeof e!="boolean")break;return e;case se.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case se.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return pk.dec(e)}throw new Error}function ef(n,e,t,i){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:i?n.values[0].no:Bl;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const a=n.findName(e);if(a!==void 0)return a.no;if(t)return Cl;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(ei(e)))}function V5(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function r0(n,e,t){if(n.kind=="map"){pt(typeof e=="object"&&e!=null);const i={},a=Object.entries(e);switch(n.V.kind){case"scalar":for(const[l,u]of a)i[l.toString()]=Tl(n.V.T,u);break;case"message":for(const[l,u]of a)i[l.toString()]=u.toJson(t);break;case"enum":const o=n.V.T;for(const[l,u]of a)i[l.toString()]=tf(o,u,t.enumAsInteger);break}return t.emitDefaultValues||a.length>0?i:void 0}if(n.repeated){pt(Array.isArray(e));const i=[];switch(n.kind){case"scalar":for(let a=0;a<e.length;a++)i.push(Tl(n.T,e[a]));break;case"enum":for(let a=0;a<e.length;a++)i.push(tf(n.T,e[a],t.enumAsInteger));break;case"message":for(let a=0;a<e.length;a++)i.push(e[a].toJson(t));break}return t.emitDefaultValues||i.length>0?i:void 0}switch(n.kind){case"scalar":return Tl(n.T,e);case"enum":return tf(n.T,e,t.enumAsInteger);case"message":return bk(n.T,e).toJson(t)}}function tf(n,e,t){var i;if(pt(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const a=n.findNumber(e);return(i=a?.name)!==null&&i!==void 0?i:e}function Tl(n,e){switch(n){case se.INT32:case se.SFIXED32:case se.SINT32:case se.FIXED32:case se.UINT32:return pt(typeof e=="number"),e;case se.FLOAT:case se.DOUBLE:return pt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case se.STRING:return pt(typeof e=="string"),e;case se.BOOL:return pt(typeof e=="boolean"),e;case se.UINT64:case se.FIXED64:case se.INT64:case se.SFIXED64:case se.SINT64:return pt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case se.BYTES:return pt(e instanceof Uint8Array),pk.enc(e)}}const Fa=Symbol("@bufbuild/protobuf/unknown-fields"),o0={readUnknownFields:!0,readerFactory:n=>new O5(n)},c0={writeUnknownFields:!0,writerFactory:()=>new D5};function q5(n){return n?Object.assign(Object.assign({},o0),n):o0}function H5(n){return n?Object.assign(Object.assign({},c0),n):c0}function $5(){return{makeReadOptions:q5,makeWriteOptions:H5,listUnknownFields(n){var e;return(e=n[Fa])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[Fa]},writeUnknownFields(n,e){const i=n[Fa];if(i)for(const a of i)e.tag(a.no,a.wireType).raw(a.data)},onUnknownField(n,e,t,i){const a=n;Array.isArray(a[Fa])||(a[Fa]=[]),a[Fa].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i,a){const o=n.getType(),l=a?e.len:e.pos+t;let u,h;for(;e.pos<l&&([u,h]=e.tag(),!(a===!0&&h==St.EndGroup));){const f=o.fields.find(u);if(!f){const m=e.skip(h,u);i.readUnknownFields&&this.onUnknownField(n,u,h,m);continue}l0(n,e,f,h,i)}if(a&&(h!=St.EndGroup||u!==t))throw new Error("invalid end group tag")},readField:l0,writeMessage(n,e,t){const i=n.getType();for(const a of i.fields.byNumber()){if(!yk(a,n)){if(a.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(a.name," to binary: required field not set"));continue}const o=a.oneof?n[a.oneof.localName].value:n[a.localName];u0(a,o,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,i){e!==void 0&&u0(n,e,t,i)}}}function l0(n,e,t,i,a){let{repeated:o,localName:l}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=l&&delete n.value,n.case=l,l="value"),t.kind){case"scalar":case"enum":const u=t.kind=="enum"?se.INT32:t.T;let h=zl;if(t.kind=="scalar"&&t.L>0&&(h=G5),o){let b=n[l];if(i==St.LengthDelimited&&u!=se.STRING&&u!=se.BYTES){let T=e.uint32()+e.pos;for(;e.pos<T;)b.push(h(e,u))}else b.push(h(e,u))}else n[l]=h(e,u);break;case"message":const f=t.T;o?n[l].push(El(e,new f,a,t)):Mi(n[l])?El(e,n[l],a,t):(n[l]=El(e,new f,a,t),f.fieldWrapper&&!t.oneof&&!t.repeated&&(n[l]=f.fieldWrapper.unwrapField(n[l])));break;case"map":let[m,v]=K5(t,e,a);n[l][m]=v;break}}function El(n,e,t,i){const a=e.getType().runtime.bin,o=i?.delimited;return a.readMessage(e,n,o?i.no:n.uint32(),t,o),e}function K5(n,e,t){const i=e.uint32(),a=e.pos+i;let o,l;for(;e.pos<a;){const[u]=e.tag();switch(u){case 1:o=zl(e,n.K);break;case 2:switch(n.V.kind){case"scalar":l=zl(e,n.V.T);break;case"enum":l=e.int32();break;case"message":l=El(e,new n.V.T,t,void 0);break}break}}if(o===void 0&&(o=tr(n.K,bs.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),l===void 0)switch(n.V.kind){case"scalar":l=tr(n.V.T,bs.BIGINT);break;case"enum":l=n.V.T.values[0].no;break;case"message":l=new n.V.T;break}return[o,l]}function G5(n,e){const t=zl(n,e);return typeof t=="bigint"?t.toString():t}function zl(n,e){switch(e){case se.STRING:return n.string();case se.BOOL:return n.bool();case se.DOUBLE:return n.double();case se.FLOAT:return n.float();case se.INT32:return n.int32();case se.INT64:return n.int64();case se.UINT64:return n.uint64();case se.FIXED64:return n.fixed64();case se.BYTES:return n.bytes();case se.FIXED32:return n.fixed32();case se.SFIXED32:return n.sfixed32();case se.SFIXED64:return n.sfixed64();case se.SINT64:return n.sint64();case se.UINT32:return n.uint32();case se.SINT32:return n.sint32()}}function u0(n,e,t,i){pt(e!==void 0);const a=n.repeated;switch(n.kind){case"scalar":case"enum":let o=n.kind=="enum"?se.INT32:n.T;if(a)if(pt(Array.isArray(e)),n.packed)J5(t,o,n.no,e);else for(const l of e)Eo(t,o,n.no,l);else Eo(t,o,n.no,e);break;case"message":if(a){pt(Array.isArray(e));for(const l of e)d0(t,i,n,l)}else d0(t,i,n,e);break;case"map":pt(typeof e=="object"&&e!=null);for(const[l,u]of Object.entries(e))Y5(t,i,n,l,u);break}}function Y5(n,e,t,i,a){n.tag(t.no,St.LengthDelimited),n.fork();let o=i;switch(t.K){case se.INT32:case se.FIXED32:case se.UINT32:case se.SFIXED32:case se.SINT32:o=Number.parseInt(i);break;case se.BOOL:pt(i=="true"||i=="false"),o=i=="true";break}switch(Eo(n,t.K,1,o),t.V.kind){case"scalar":Eo(n,t.V.T,2,a);break;case"enum":Eo(n,se.INT32,2,a);break;case"message":pt(a!==void 0),n.tag(2,St.LengthDelimited).bytes(a.toBinary(e));break}n.join()}function d0(n,e,t,i){const a=bk(t.T,i);t.delimited?n.tag(t.no,St.StartGroup).raw(a.toBinary(e)).tag(t.no,St.EndGroup):n.tag(t.no,St.LengthDelimited).bytes(a.toBinary(e))}function Eo(n,e,t,i){pt(i!==void 0);let[a,o]=Sk(e);n.tag(t,a)[o](i)}function J5(n,e,t,i){if(!i.length)return;n.tag(t,St.LengthDelimited).fork();let[,a]=Sk(e);for(let o=0;o<i.length;o++)n[a](i[o]);n.join()}function Sk(n){let e=St.Varint;switch(n){case se.BYTES:case se.STRING:e=St.LengthDelimited;break;case se.DOUBLE:case se.FIXED64:case se.SFIXED64:e=St.Bit64;break;case se.FIXED32:case se.SFIXED32:case se.FLOAT:e=St.Bit32;break}const t=se[n].toLowerCase();return[e,t]}function Q5(){return{setEnumType:ck,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const a=i.localName,o=e,l=n;if(l[a]!=null)switch(i.kind){case"oneof":const u=l[a].case;if(u===void 0)continue;const h=i.findField(u);let f=l[a].value;h&&h.kind=="message"&&!Mi(f,h.T)?f=new h.T(f):h&&h.kind==="scalar"&&h.T===se.BYTES&&(f=oo(f)),o[a]={case:u,value:f};break;case"scalar":case"enum":let m=l[a];i.T===se.BYTES&&(m=i.repeated?m.map(oo):oo(m)),o[a]=m;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===se.BYTES)for(const[C,T]of Object.entries(l[a]))o[a][C]=oo(T);else Object.assign(o[a],l[a]);break;case"message":const b=i.V.T;for(const C of Object.keys(l[a])){let T=l[a][C];b.fieldWrapper||(T=new b(T)),o[a][C]=T}break}break;case"message":const v=i.T;if(i.repeated)o[a]=l[a].map(b=>Mi(b,v)?b:new v(b));else{const b=l[a];v.fieldWrapper?v.typeName==="google.protobuf.BytesValue"?o[a]=oo(b):o[a]=b:o[a]=Mi(b,v)?b:new v(b)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const a=e[i.localName],o=t[i.localName];if(i.repeated){if(a.length!==o.length)return!1;switch(i.kind){case"message":return a.every((l,u)=>i.T.equals(l,o[u]));case"scalar":return a.every((l,u)=>us(i.T,l,o[u]));case"enum":return a.every((l,u)=>us(se.INT32,l,o[u]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let l=a,u=o;return i.T.fieldWrapper&&(l!==void 0&&!Mi(l)&&(l=i.T.fieldWrapper.wrapField(l)),u!==void 0&&!Mi(u)&&(u=i.T.fieldWrapper.wrapField(u))),i.T.equals(l,u);case"enum":return us(se.INT32,a,o);case"scalar":return us(i.T,a,o);case"oneof":if(a.case!==o.case)return!1;const h=i.findField(a.case);if(h===void 0)return!0;switch(h.kind){case"message":return h.T.equals(a.value,o.value);case"enum":return us(se.INT32,a.value,o.value);case"scalar":return us(h.T,a.value,o.value)}throw new Error("oneof cannot contain ".concat(h.kind));case"map":const f=Object.keys(a).concat(Object.keys(o));switch(i.V.kind){case"message":const m=i.V.T;return f.every(b=>m.equals(a[b],o[b]));case"enum":return f.every(b=>us(se.INT32,a[b],o[b]));case"scalar":const v=i.V.T;return f.every(b=>us(v,a[b],o[b]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const a of e.fields.byMember()){const o=n[a.localName];let l;if(a.repeated)l=o.map(dl);else if(a.kind=="map"){l=i[a.localName];for(const[u,h]of Object.entries(o))l[u]=dl(h)}else a.kind=="oneof"?l=a.findField(o.case)?{case:o.case,value:dl(o.value)}:{case:void 0}:l=dl(o);i[a.localName]=l}for(const a of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(i,a.no,a.wireType,a.data);return t}}}function dl(n){if(n===void 0)return n;if(Mi(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function oo(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function X5(n,e,t){return{syntax:n,json:z5(),bin:$5(),util:Object.assign(Object.assign({},Q5()),{newFieldList:e,initFields:t}),makeMessageType(i,a,o){return x5(this,i,a,o)},makeEnum:E5,makeEnumType:lk,getEnumType:T5,makeExtension(i,a,o){return A5(this,i,a,o)}}}class W5{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}}function kk(n,e){const t=Ck(n);return e?t:s6(i6(t))}function Z5(n){return kk(n,!1)}const e6=Ck;function Ck(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let a=n.charAt(i);switch(a){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(a),e=!1;break;default:e&&(e=!1,a=a.toUpperCase()),t.push(a);break}}return t.join("")}const t6=new Set(["constructor","toString","toJSON","valueOf"]),n6=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Tk=n=>"".concat(n,"$"),i6=n=>n6.has(n)?Tk(n):n,s6=n=>t6.has(n)?Tk(n):n;class a6{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Z5(e)}addField(e){pt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function r6(n,e){var t,i,a,o,l,u;const h=[];let f;for(const m of typeof n=="function"?n():n){const v=m;if(v.localName=kk(m.name,m.oneof!==void 0),v.jsonName=(t=m.jsonName)!==null&&t!==void 0?t:e6(m.name),v.repeated=(i=m.repeated)!==null&&i!==void 0?i:!1,m.kind=="scalar"&&(v.L=(a=m.L)!==null&&a!==void 0?a:bs.BIGINT),v.delimited=(o=m.delimited)!==null&&o!==void 0?o:!1,v.req=(l=m.req)!==null&&l!==void 0?l:!1,v.opt=(u=m.opt)!==null&&u!==void 0?u:!1,m.packed===void 0&&(v.packed=m.kind=="enum"||m.kind=="scalar"&&m.T!=se.BYTES&&m.T!=se.STRING),m.oneof!==void 0){const b=typeof m.oneof=="string"?m.oneof:m.oneof.name;(!f||f.name!=b)&&(f=new a6(b)),v.oneof=f,f.addField(v)}h.push(v)}return h}const q=X5("proto3",n=>new W5(n,e=>r6(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=tr(e.T,e.L);break}}});class on extends Sm{constructor(e){super(),this.seconds=ct.zero,this.nanos=0,q.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(q.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const a=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(a))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(a<Date.parse("0001-01-01T00:00:00Z")||a>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ct.parse(a/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const a=(this.nanos+1e9).toString().substring(1);a.substring(3)==="000000"?i="."+a.substring(0,3)+"Z":a.substring(6)==="000"?i="."+a.substring(0,6)+"Z":i="."+a+"Z"}return new Date(t).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return on.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new on({seconds:ct.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new on().fromBinary(e,t)}static fromJson(e,t){return new on().fromJson(e,t)}static fromJsonString(e,t){return new on().fromJsonString(e,t)}static equals(e,t){return q.util.equals(on,e,t)}}on.runtime=q;on.typeName="google.protobuf.Timestamp";on.fields=q.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const o6=q.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:on},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:c6,repeated:!0},{no:5,name:"events",kind:"message",T:u6,repeated:!0}]),c6=q.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:l6,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),l6=q.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:on},{no:3,name:"value",kind:"scalar",T:2}]),u6=q.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:on},{no:7,name:"normalized_end_timestamp",kind:"message",T:on,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Ek=q.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),qn=q.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Rt=q.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Cm=q.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),yo=q.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),No=q.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Ln=q.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Hs=q.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),d6=q.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),At=q.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),lu=q.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Fl,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Ik}]),Fl=q.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),h6=q.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:q.getEnumType(Rt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Qs=q.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:q.getEnumType(Ka)},{no:4,name:"tracks",kind:"message",T:qa,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:h6},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:q.getEnumType(Do)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:q.getEnumType(Ln)},{no:18,name:"kind_details",kind:"enum",T:q.getEnumType(f6),repeated:!0},{no:19,name:"data_tracks",kind:"message",T:Tm,repeated:!0}]),Ka=q.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Do=q.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"},{no:8,name:"BRIDGE"}]),f6=q.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"},{no:2,name:"CONNECTOR_WHATSAPP"},{no:3,name:"CONNECTOR_TWILIO"},{no:4,name:"BRIDGE_RTSP"}]),kt=q.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),m6=q.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ps,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:q.getEnumType(xk)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),qa=q.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:q.getEnumType(qn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:q.getEnumType(Rt)},{no:10,name:"layers",kind:"message",T:ps,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:m6,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:q.getEnumType(kt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Ik},{no:19,name:"audio_features",kind:"enum",T:q.getEnumType(At),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:q.getEnumType(Ek)}]),Tm=q.makeMessageType("livekit.DataTrackInfo",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"sid",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"encryption",kind:"enum",T:q.getEnumType(kt)}]),p6=q.makeMessageType("livekit.DataTrackSubscriptionOptions",()=>[{no:1,name:"target_fps",kind:"scalar",T:13,opt:!0}]),ps=q.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:q.getEnumType(Cm)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9},{no:8,name:"repair_ssrc",kind:"scalar",T:13}]),xk=q.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Jt=q.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:q.getEnumType(Oe)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Em,oneof:"value"},{no:3,name:"speaker",kind:"message",T:g6,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Mk,oneof:"value"},{no:7,name:"transcription",kind:"message",T:v6,oneof:"value"},{no:8,name:"metrics",kind:"message",T:o6,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Vl,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:xm,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Rm,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:_m,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:ql,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Hl,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:$l,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Rk,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Oe=q.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Rk=q.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:q.getEnumType(kt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),_k=q.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Em,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Vl,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:xm,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Rm,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:_m,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:ql,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Hl,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:$l,oneof:"value"}]),g6=q.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:wk,repeated:!0}]),wk=q.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Em=q.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Mk=q.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),v6=q.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:y6,repeated:!0}]),y6=q.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Vl=q.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),xm=q.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Rm=q.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),_m=q.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Nk,oneof:"value"}]),Nk=q.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Dk=q.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Ok=q.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:q.getEnumType(Ak)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Ak=q.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),jk=q.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:q.getEnumType(Pk)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Pk=q.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Lk=q.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:h0},{no:2,name:"screen",kind:"message",T:h0},{no:3,name:"resume_connection",kind:"enum",T:q.getEnumType(No)},{no:4,name:"disabled_codecs",kind:"message",T:b6},{no:5,name:"force_relay",kind:"enum",T:q.getEnumType(No)}]),h0=q.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:q.getEnumType(No)}]),b6=q.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Fl,repeated:!0},{no:2,name:"publish",kind:"message",T:Fl,repeated:!0}]),Ik=q.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Pf=q.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Uk=q.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:q.getEnumType(Pf)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Bk=q.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),ql=q.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:q.getEnumType(kt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Uk,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Bk,oneof:"content_header"}],{localName:"DataStream_Header"}),Hl=q.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),$l=q.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),S6=q.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Hn=q.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Lf=q.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),k6=q.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),C6=q.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Ss,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ss,oneof:"message"},{no:3,name:"trickle",kind:"message",T:uu,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Oo,oneof:"message"},{no:5,name:"mute",kind:"message",T:du,oneof:"message"},{no:6,name:"subscription",kind:"message",T:hu,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:qk,oneof:"message"},{no:8,name:"leave",kind:"message",T:fu,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:$k,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Yk,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Om,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Zn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Nm,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Xk,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Mm,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Hk,oneof:"message"},{no:19,name:"publish_data_track_request",kind:"message",T:zk,oneof:"message"},{no:20,name:"unpublish_data_track_request",kind:"message",T:Vk,oneof:"message"},{no:21,name:"update_data_subscription",kind:"message",T:N6,oneof:"message"}]),f0=q.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:R6,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ss,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ss,oneof:"message"},{no:4,name:"trickle",kind:"message",T:uu,oneof:"message"},{no:5,name:"update",kind:"message",T:M6,oneof:"message"},{no:6,name:"track_published",kind:"message",T:wm,oneof:"message"},{no:8,name:"leave",kind:"message",T:fu,oneof:"message"},{no:9,name:"mute",kind:"message",T:du,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:O6,oneof:"message"},{no:11,name:"room_update",kind:"message",T:A6,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:P6,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:I6,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:B6,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:F6,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:w6,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:_6,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:q6,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:K6,oneof:"message"},{no:22,name:"request_response",kind:"message",T:G6,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Y6,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:V6,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:W6,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:z6,oneof:"message"},{no:27,name:"publish_data_track_response",kind:"message",T:Fk,oneof:"message"},{no:28,name:"unpublish_data_track_response",kind:"message",T:T6,oneof:"message"},{no:29,name:"data_track_subscriber_handles",kind:"message",T:E6,oneof:"message"}]),If=q.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ps,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:q.getEnumType(xk)}]),Oo=q.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:q.getEnumType(qn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:q.getEnumType(Rt)},{no:9,name:"layers",kind:"message",T:ps,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:If,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:q.getEnumType(kt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:q.getEnumType(Ek)},{no:17,name:"audio_features",kind:"enum",T:q.getEnumType(At),repeated:!0}]),zk=q.makeMessageType("livekit.PublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"encryption",kind:"enum",T:q.getEnumType(kt)}]),Fk=q.makeMessageType("livekit.PublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:Tm}]),Vk=q.makeMessageType("livekit.UnpublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13}]),T6=q.makeMessageType("livekit.UnpublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:Tm}]),E6=q.makeMessageType("livekit.DataTrackSubscriberHandles",()=>[{no:1,name:"sub_handles",kind:"map",K:13,V:{kind:"message",T:x6}}]),x6=q.makeMessageType("livekit.DataTrackSubscriberHandles.PublishedDataTrack",()=>[{no:1,name:"publisher_identity",kind:"scalar",T:9},{no:2,name:"publisher_sid",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9}],{localName:"DataTrackSubscriberHandles_PublishedDataTrack"}),uu=q.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:q.getEnumType(Hn)},{no:3,name:"final",kind:"scalar",T:8}]),du=q.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),R6=q.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:lu},{no:2,name:"participant",kind:"message",T:Qs},{no:3,name:"other_participants",kind:"message",T:Qs,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Kk,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Lk},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Ok},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Fl,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),_6=q.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Kk,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Lk},{no:3,name:"server_info",kind:"message",T:Ok},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),wm=q.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:qa}]),w6=q.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Ss=q.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),M6=q.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Qs,repeated:!0}]),hu=q.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Dk,repeated:!0}]),N6=q.makeMessageType("livekit.UpdateDataSubscription",()=>[{no:1,name:"updates",kind:"message",T:D6,repeated:!0}]),D6=q.makeMessageType("livekit.UpdateDataSubscription.Update",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"options",kind:"message",T:p6}],{localName:"UpdateDataSubscription_Update"}),qk=q.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:q.getEnumType(Cm)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Mm=q.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:q.getEnumType(At),repeated:!0}]),Hk=q.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),fu=q.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:q.getEnumType(Ln)},{no:3,name:"action",kind:"enum",T:q.getEnumType(Ga)},{no:4,name:"regions",kind:"message",T:H6}]),Ga=q.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),$k=q.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ps,repeated:!0}]),Nm=q.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Kk=q.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),O6=q.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:wk,repeated:!0}]),A6=q.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:lu}]),j6=q.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:q.getEnumType(yo)},{no:3,name:"score",kind:"scalar",T:2}]),P6=q.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:j6,repeated:!0}]),L6=q.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:q.getEnumType(Lf)}]),I6=q.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:L6,repeated:!0}]),Dm=q.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:q.getEnumType(Cm)},{no:2,name:"enabled",kind:"scalar",T:8}]),U6=q.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Dm,repeated:!0}]),B6=q.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Dm,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:U6,repeated:!0}]),z6=q.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:S6,repeated:!0}]),Gk=q.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Yk=q.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Gk,repeated:!0}]),F6=q.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),V6=q.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:lu},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Qs},{no:4,name:"other_participants",kind:"message",T:Qs,repeated:!0}]),Om=q.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Ss},{no:2,name:"subscription",kind:"message",T:hu},{no:3,name:"publish_tracks",kind:"message",T:wm,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Qk,repeated:!0},{no:5,name:"offer",kind:"message",T:Ss},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Jk,repeated:!0},{no:8,name:"publish_data_tracks",kind:"message",T:Fk,repeated:!0}]),Jk=q.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Qk=q.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:q.getEnumType(Hn)}]),Zn=q.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:q.getEnumType(k6),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Xk=q.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),q6=q.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),H6=q.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:$6,repeated:!0}]),$6=q.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),K6=q.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:q.getEnumType(d6)}]),G6=q.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:q.getEnumType(Am)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:uu,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Oo,oneof:"request"},{no:6,name:"mute",kind:"message",T:du,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Nm,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Mm,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Hk,oneof:"request"},{no:10,name:"publish_data_track",kind:"message",T:zk,oneof:"request"},{no:11,name:"unpublish_data_track",kind:"message",T:Vk,oneof:"request"}]),Am=q.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"},{no:7,name:"INVALID_HANDLE"},{no:8,name:"INVALID_NAME"},{no:9,name:"DUPLICATE_HANDLE"},{no:10,name:"DUPLICATE_NAME"}]),Y6=q.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Wk=q.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8},{no:5,name:"auto_subscribe_data_track",kind:"scalar",T:8,opt:!0}]),J6=q.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:jk},{no:2,name:"connection_settings",kind:"message",T:Wk},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Oo,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Ss},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:q.getEnumType(Hs)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Om}]),Q6=q.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:q.getEnumType(X6)},{no:2,name:"join_request",kind:"scalar",T:12}]),X6=q.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),W6=q.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function Z6(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var xl={exports:{}},eB=xl.exports,m0;function tB(){return m0||(m0=1,(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(eB,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],o={},l=null;function u(S,R){var _=S[R];if(typeof _.bind=="function")return _.bind(S);try{return Function.prototype.bind.call(_,S)}catch{return function(){return Function.prototype.apply.apply(_,[S,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function f(S){return S==="debug"&&(S="log"),typeof console===t?!1:S==="trace"&&i?h:console[S]!==void 0?u(console,S):console.log!==void 0?u(console,"log"):e}function m(){for(var S=this.getLevel(),R=0;R<a.length;R++){var _=a[R];this[_]=R<S?e:this.methodFactory(_,S,this.name)}if(this.log=this.debug,typeof console===t&&S<this.levels.SILENT)return"No console available for logging"}function v(S){return function(){typeof console!==t&&(m.call(this),this[S].apply(this,arguments))}}function b(S,R,_){return f(S)||v.apply(this,arguments)}function C(S,R){var _=this,D,j,x,w="loglevel";typeof S=="string"?w+=":"+S:typeof S=="symbol"&&(w=void 0);function M(O){var Y=(a[O]||"silent").toUpperCase();if(!(typeof window===t||!w)){try{window.localStorage[w]=Y;return}catch{}try{window.document.cookie=encodeURIComponent(w)+"="+Y+";"}catch{}}}function I(){var O;if(!(typeof window===t||!w)){try{O=window.localStorage[w]}catch{}if(typeof O===t)try{var Y=window.document.cookie,J=encodeURIComponent(w),le=Y.indexOf(J+"=");le!==-1&&(O=/^([^;]+)/.exec(Y.slice(le+J.length+1))[1])}catch{}return _.levels[O]===void 0&&(O=void 0),O}}function F(){if(!(typeof window===t||!w)){try{window.localStorage.removeItem(w)}catch{}try{window.document.cookie=encodeURIComponent(w)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function L(O){var Y=O;if(typeof Y=="string"&&_.levels[Y.toUpperCase()]!==void 0&&(Y=_.levels[Y.toUpperCase()]),typeof Y=="number"&&Y>=0&&Y<=_.levels.SILENT)return Y;throw new TypeError("log.setLevel() called with invalid level: "+O)}_.name=S,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=R||b,_.getLevel=function(){return x??j??D},_.setLevel=function(O,Y){return x=L(O),Y!==!1&&M(x),m.call(_)},_.setDefaultLevel=function(O){j=L(O),I()||_.setLevel(O,!1)},_.resetLevel=function(){x=null,F(),m.call(_)},_.enableAll=function(O){_.setLevel(_.levels.TRACE,O)},_.disableAll=function(O){_.setLevel(_.levels.SILENT,O)},_.rebuild=function(){if(l!==_&&(D=L(l.getLevel())),m.call(_),l===_)for(var O in o)o[O].rebuild()},D=L(l?l.getLevel():"WARN");var A=I();A!=null&&(x=L(A)),m.call(_)}l=new C,l.getLogger=function(R){if(typeof R!="symbol"&&typeof R!="string"||R==="")throw new TypeError("You must supply a name when creating a logger.");var _=o[R];return _||(_=o[R]=new C(R,l.methodFactory)),_};var T=typeof window!==t?window.log:void 0;return l.noConflict=function(){return typeof window!==t&&window.log===l&&(window.log=T),l},l.getLoggers=function(){return o},l.default=l,l})})(xl)),xl.exports}var mu=tB(),Uf;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(Uf||(Uf={}));var Yn;(function(n){n.Default="livekit",n.Room="livekit-room",n.TokenSource="livekit-token-source",n.Participant="livekit-participant",n.Track="livekit-track",n.Publication="livekit-track-publication",n.Engine="livekit-engine",n.Signal="livekit-signal",n.PCManager="livekit-pc-manager",n.PCTransport="livekit-pc-transport",n.E2EE="lk-e2ee"})(Yn||(Yn={}));let Me=mu.getLogger("livekit");Object.values(Yn).map(n=>mu.getLogger(n));Me.setDefaultLevel(Uf.info);function ji(n){const e=mu.getLogger(n);return e.setDefaultLevel(Me.getLevel()),e}const nB=mu.getLogger("lk-e2ee"),co=7e3,iB=[0,300,4*300,9*300,16*300,co,co,co,co,co];class sB{constructor(e){this._retryDelays=e!==void 0?[...e]:iB}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function aB(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(n);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(n,i[a])&&(t[i[a]]=n[i[a]]);return t}function P(n,e,t,i){function a(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function u(m){try{f(i.next(m))}catch(v){l(v)}}function h(m){try{f(i.throw(m))}catch(v){l(v)}}function f(m){m.done?o(m.value):a(m.value).then(u,h)}f((i=i.apply(n,e||[])).next())})}function p0(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ni(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof p0=="function"?p0(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(l){return new Promise(function(u,h){l=n[o](l),a(u,h,l.done,l.value)})}}function a(o,l,u,h){Promise.resolve(h).then(function(f){o({value:f,done:u})},l)}}var hl={exports:{}},g0;function rB(){if(g0)return hl.exports;g0=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(w,M,I){return Function.prototype.apply.call(w,M,I)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:t=function(w){return Object.getOwnPropertyNames(w)};function i(x){console&&console.warn&&console.warn(x)}var a=Number.isNaN||function(w){return w!==w};function o(){o.init.call(this)}hl.exports=o,hl.exports.once=_,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function u(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(x){if(typeof x!="number"||x<0||a(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");l=x}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(w){if(typeof w!="number"||w<0||a(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this};function h(x){return x._maxListeners===void 0?o.defaultMaxListeners:x._maxListeners}o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(w){for(var M=[],I=1;I<arguments.length;I++)M.push(arguments[I]);var F=w==="error",L=this._events;if(L!==void 0)F=F&&L.error===void 0;else if(!F)return!1;if(F){var A;if(M.length>0&&(A=M[0]),A instanceof Error)throw A;var O=new Error("Unhandled error."+(A?" ("+A.message+")":""));throw O.context=A,O}var Y=L[w];if(Y===void 0)return!1;if(typeof Y=="function")e(Y,this,M);else for(var J=Y.length,le=T(Y,J),I=0;I<J;++I)e(le[I],this,M);return!0};function f(x,w,M,I){var F,L,A;if(u(M),L=x._events,L===void 0?(L=x._events=Object.create(null),x._eventsCount=0):(L.newListener!==void 0&&(x.emit("newListener",w,M.listener?M.listener:M),L=x._events),A=L[w]),A===void 0)A=L[w]=M,++x._eventsCount;else if(typeof A=="function"?A=L[w]=I?[M,A]:[A,M]:I?A.unshift(M):A.push(M),F=h(x),F>0&&A.length>F&&!A.warned){A.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=x,O.type=w,O.count=A.length,i(O)}return x}o.prototype.addListener=function(w,M){return f(this,w,M,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(w,M){return f(this,w,M,!0)};function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(x,w,M){var I={fired:!1,wrapFn:void 0,target:x,type:w,listener:M},F=m.bind(I);return F.listener=M,I.wrapFn=F,F}o.prototype.once=function(w,M){return u(M),this.on(w,v(this,w,M)),this},o.prototype.prependOnceListener=function(w,M){return u(M),this.prependListener(w,v(this,w,M)),this},o.prototype.removeListener=function(w,M){var I,F,L,A,O;if(u(M),F=this._events,F===void 0)return this;if(I=F[w],I===void 0)return this;if(I===M||I.listener===M)--this._eventsCount===0?this._events=Object.create(null):(delete F[w],F.removeListener&&this.emit("removeListener",w,I.listener||M));else if(typeof I!="function"){for(L=-1,A=I.length-1;A>=0;A--)if(I[A]===M||I[A].listener===M){O=I[A].listener,L=A;break}if(L<0)return this;L===0?I.shift():S(I,L),I.length===1&&(F[w]=I[0]),F.removeListener!==void 0&&this.emit("removeListener",w,O||M)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(w){var M,I,F;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[w]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[w]),this;if(arguments.length===0){var L=Object.keys(I),A;for(F=0;F<L.length;++F)A=L[F],A!=="removeListener"&&this.removeAllListeners(A);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(M=I[w],typeof M=="function")this.removeListener(w,M);else if(M!==void 0)for(F=M.length-1;F>=0;F--)this.removeListener(w,M[F]);return this};function b(x,w,M){var I=x._events;if(I===void 0)return[];var F=I[w];return F===void 0?[]:typeof F=="function"?M?[F.listener||F]:[F]:M?R(F):T(F,F.length)}o.prototype.listeners=function(w){return b(this,w,!0)},o.prototype.rawListeners=function(w){return b(this,w,!1)},o.listenerCount=function(x,w){return typeof x.listenerCount=="function"?x.listenerCount(w):C.call(x,w)},o.prototype.listenerCount=C;function C(x){var w=this._events;if(w!==void 0){var M=w[x];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function T(x,w){for(var M=new Array(w),I=0;I<w;++I)M[I]=x[I];return M}function S(x,w){for(;w+1<x.length;w++)x[w]=x[w+1];x.pop()}function R(x){for(var w=new Array(x.length),M=0;M<w.length;++M)w[M]=x[M].listener||x[M];return w}function _(x,w){return new Promise(function(M,I){function F(A){x.removeListener(w,L),I(A)}function L(){typeof x.removeListener=="function"&&x.removeListener("error",F),M([].slice.call(arguments))}j(x,w,L,{once:!0}),w!=="error"&&D(x,F,{once:!0})})}function D(x,w,M){typeof x.on=="function"&&j(x,"error",w,M)}function j(x,w,M,I){if(typeof x.on=="function")I.once?x.once(w,M):x.on(w,M);else if(typeof x.addEventListener=="function")x.addEventListener(w,function F(L){I.once&&x.removeEventListener(w,F),M(L)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}return hl.exports}var oi=rB();let Zk=!0,eC=!0;function bo(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseFloat(i[t],10)}function Zs(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,a=i.addEventListener;i.addEventListener=function(l,u){if(l!==e)return a.apply(this,arguments);const h=f=>{const m=t(f);m&&(u.handleEvent?u.handleEvent(m):u(m))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(u,h),a.apply(this,[l,h])};const o=i.removeEventListener;i.removeEventListener=function(l,u){if(l!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(u))return o.apply(this,arguments);const h=this._eventMap[e].get(u);return this._eventMap[e].delete(u),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[l,h])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(l){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),l&&this.addEventListener(e,this["_on"+e]=l)},enumerable:!0,configurable:!0})}function oB(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Zk=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function cB(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(eC=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function tC(){if(typeof window=="object"){if(Zk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function jm(n,e){eC&&console.warn(n+" is deprecated, please use "+e+" instead.")}function lB(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const i=t.userAgentData.brands.find(a=>a.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(bo(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(bo(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(bo(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=bo(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function v0(n){return Object.prototype.toString.call(n)==="[object Object]"}function nC(n){return v0(n)?Object.keys(n).reduce(function(e,t){const i=v0(n[t]),a=i?nC(n[t]):n[t],o=i&&!Object.keys(a).length;return a===void 0||o?e:Object.assign(e,{[t]:a})},{}):n}function Bf(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Bf(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(a=>{Bf(n,n.get(a),t)})}))}function y0(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",a=new Map;if(e===null)return a;const o=[];return n.forEach(l=>{l.type==="track"&&l.trackIdentifier===e.id&&o.push(l)}),o.forEach(l=>{n.forEach(u=>{u.type===i&&u.trackId===l.id&&Bf(n,u,a)})}),a}const b0=tC;function iC(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const h={};return Object.keys(u).forEach(f=>{if(f==="require"||f==="advanced"||f==="mediaSource")return;const m=typeof u[f]=="object"?u[f]:{ideal:u[f]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const v=function(b,C){return b?b+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(m.ideal!==void 0){h.optional=h.optional||[];let b={};typeof m.ideal=="number"?(b[v("min",f)]=m.ideal,h.optional.push(b),b={},b[v("max",f)]=m.ideal,h.optional.push(b)):(b[v("",f)]=m.ideal,h.optional.push(b))}m.exact!==void 0&&typeof m.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[v("",f)]=m.exact):["min","max"].forEach(b=>{m[b]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[v(b,f)]=m[b])})}),u.advanced&&(h.optional=(h.optional||[]).concat(u.advanced)),h},a=function(u,h){if(e.version>=61)return h(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const f=function(m,v,b){v in m&&!(b in m)&&(m[b]=m[v],delete m[v])};u=JSON.parse(JSON.stringify(u)),f(u.audio,"autoGainControl","googAutoGainControl"),f(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=i(u.audio)}if(u&&typeof u.video=="object"){let f=u.video.facingMode;f=f&&(typeof f=="object"?f:{ideal:f});const m=e.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!m)){delete u.video.facingMode;let v;if(f.exact==="environment"||f.ideal==="environment"?v=["back","rear"]:(f.exact==="user"||f.ideal==="user")&&(v=["front"]),v)return t.mediaDevices.enumerateDevices().then(b=>{b=b.filter(T=>T.kind==="videoinput");let C=b.find(T=>v.some(S=>T.label.toLowerCase().includes(S)));return!C&&b.length&&v.includes("back")&&(C=b[b.length-1]),C&&(u.video.deviceId=f.exact?{exact:C.deviceId}:{ideal:C.deviceId}),u.video=i(u.video),b0("chrome: "+JSON.stringify(u)),h(u)})}u.video=i(u.video)}return b0("chrome: "+JSON.stringify(u)),h(u)},o=function(u){return e.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},l=function(u,h,f){a(u,m=>{t.webkitGetUserMedia(m,h,v=>{f&&f(o(v))})})};if(t.getUserMedia=l.bind(t),t.mediaDevices.getUserMedia){const u=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(h){return a(h,f=>u(f).then(m=>{if(f.audio&&!m.getAudioTracks().length||f.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return m},m=>Promise.reject(o(m))))}}}function sC(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function aC(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",a=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(u=>u.track&&u.track.id===a.track.id):o={track:a.track};const l=new Event("track");l.track=a.track,l.receiver=o,l.transceiver={receiver:o},l.streams=[i.stream],this.dispatchEvent(l)}),i.stream.getTracks().forEach(a=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(u=>u.track&&u.track.id===a.id):o={track:a};const l=new Event("track");l.track=a,l.receiver=o,l.transceiver={receiver:o},l.streams=[i.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Zs(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function rC(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(a,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=a.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:a}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(u,h){let f=a.apply(this,arguments);return f||(f=e(this,u),this._senders.push(f)),f};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(u){o.apply(this,arguments);const h=this._senders.indexOf(u);h!==-1&&this._senders.splice(h,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(l=>{this._senders.push(e(this,l))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(l=>{const u=this._senders.find(h=>h.track===l);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function oC(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(l=>l._pc=this),o});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>y0(l,o.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a}),Zs(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(o=>y0(o,a.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let a,o,l;return this.getSenders().forEach(u=>{u.track===i&&(a?l=!0:a=u)}),this.getReceivers().forEach(u=>(u.track===i&&(o?l=!0:o=u),u.track===i)),l||a&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function cC(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(l,u){if(!u)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=e.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(h)===-1&&this._shimmedLocalStreams[u.id].push(h):this._shimmedLocalStreams[u.id]=[u,h],h};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(f=>{if(this.getSenders().find(v=>v.track===f))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();t.apply(this,arguments);const h=this.getSenders().filter(f=>u.indexOf(f)===-1);this._shimmedLocalStreams[l.id]=[l].concat(h)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],i.apply(this,arguments)};const a=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const h=this._shimmedLocalStreams[u].indexOf(l);h!==-1&&this._shimmedLocalStreams[u].splice(h,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),a.apply(this,arguments)}}function lC(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return cC(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const m=t.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(v=>this._reverseStreams[v.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(v=>{if(this.getSenders().find(C=>C.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const v=new n.MediaStream(m.getTracks());this._streams[m.id]=v,this._reverseStreams[v.id]=m,m=v}i.apply(this,[m])};const a=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},n.RTCPeerConnection.prototype.addTrack=function(m,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(S=>S===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const T=this._streams[v.id];if(T)T.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new n.MediaStream([m]);this._streams[v.id]=S,this._reverseStreams[S.id]=v,this.addStream(S)}return this.getSenders().find(S=>S.track===m)};function o(f,m){let v=m.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{const C=f._reverseStreams[b],T=f._streams[C.id];v=v.replace(new RegExp(T.id,"g"),C.id)}),new RTCSessionDescription({type:m.type,sdp:v})}function l(f,m){let v=m.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{const C=f._reverseStreams[b],T=f._streams[C.id];v=v.replace(new RegExp(C.id,"g"),T.id)}),new RTCSessionDescription({type:m.type,sdp:v})}["createOffer","createAnswer"].forEach(function(f){const m=n.RTCPeerConnection.prototype[f],v={[f](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[T=>{const S=o(this,T);b[0].apply(null,[S])},T=>{b[1]&&b[1].apply(null,T)},arguments[2]]):m.apply(this,arguments).then(T=>o(this,T))}};n.RTCPeerConnection.prototype[f]=v[f]});const u=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=l(this,arguments[0]),u.apply(this,arguments))};const h=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const f=h.get.apply(this);return f.type===""?f:o(this,f)}}),n.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(m._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(C=>{this._streams[C].getTracks().find(S=>m.track===S)&&(b=this._streams[C])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function zf(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],a={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=a[t]})}function uC(n,e){Zs(n,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}var S0=Object.freeze({__proto__:null,fixNegotiationNeeded:uC,shimAddTrackRemoveTrack:lC,shimAddTrackRemoveTrackWithNative:cC,shimGetSendersWithDtmf:rC,shimGetUserMedia:iC,shimMediaStream:sC,shimOnTrack:aC,shimPeerConnection:zf,shimSenderReceiverGetStats:oC});function dC(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(a,o,l){jm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(a).then(o,l)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const a=function(l,u,h){u in l&&!(h in l)&&(l[h]=l[u],delete l[u])},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),a(l.audio,"autoGainControl","mozAutoGainControl"),a(l.audio,"noiseSuppression","mozNoiseSuppression")),o(l)},i&&i.prototype.getSettings){const l=i.prototype.getSettings;i.prototype.getSettings=function(){const u=l.apply(this,arguments);return a(u,"mozAutoGainControl","autoGainControl"),a(u,"mozNoiseSuppression","noiseSuppression"),u}}if(i&&i.prototype.applyConstraints){const l=i.prototype.applyConstraints;i.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),a(u,"autoGainControl","mozAutoGainControl"),a(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function uB(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function hC(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ff(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const o=n.RTCPeerConnection.prototype[a],l={[a](){return arguments[0]=new(a==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[a]=l[a]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[o,l,u]=arguments;return i.apply(this,[o||null]).then(h=>{if(e.version<53&&!l)try{h.forEach(f=>{f.type=t[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;h.forEach((m,v)=>{h.set(v,Object.assign({},m,{type:t[m.type]||m.type}))})}return h}).then(l,u)}}function fC(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const a=e.apply(this,[]);return a.forEach(o=>o._pc=this),a});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const a=t.apply(this,arguments);return a._pc=this,a}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function mC(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i}),Zs(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function pC(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){jm("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function gC(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function vC(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const a=i.length>0;a&&i.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(a){const{sender:l}=o,u=l.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=i,l.sendEncodings=i,this.setParametersPromises.push(l.setParameters(u).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return o})}function yC(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function bC(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function SC(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var k0=Object.freeze({__proto__:null,shimAddTransceiver:vC,shimCreateAnswer:SC,shimCreateOffer:bC,shimGetDisplayMedia:uB,shimGetParameters:yC,shimGetUserMedia:dC,shimOnTrack:hC,shimPeerConnection:Ff,shimRTCDataChannel:gC,shimReceiverGetStats:mC,shimRemoveStream:pC,shimSenderGetStats:fC});function kC(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(a=>e.call(this,a,i)),i.getVideoTracks().forEach(a=>e.call(this,a,i))},n.RTCPeerConnection.prototype.addTrack=function(i){for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];return o&&o.forEach(u=>{this._localStreams?this._localStreams.includes(u)||this._localStreams.push(u):this._localStreams=[u]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const a=t.getTracks();this.getSenders().forEach(o=>{a.includes(o.track)&&this.removeTrack(o)})})}}function CC(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const o=new Event("addstream");o.stream=a,this.dispatchEvent(o)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,i.dispatchEvent(l)})}),e.apply(i,arguments)}}}function TC(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,a=e.setLocalDescription,o=e.setRemoteDescription,l=e.addIceCandidate;e.createOffer=function(f,m){const v=arguments.length>=2?arguments[2]:arguments[0],b=t.apply(this,[v]);return m?(b.then(f,m),Promise.resolve()):b},e.createAnswer=function(f,m){const v=arguments.length>=2?arguments[2]:arguments[0],b=i.apply(this,[v]);return m?(b.then(f,m),Promise.resolve()):b};let u=function(h,f,m){const v=a.apply(this,[h]);return m?(v.then(f,m),Promise.resolve()):v};e.setLocalDescription=u,u=function(h,f,m){const v=o.apply(this,[h]);return m?(v.then(f,m),Promise.resolve()):v},e.setRemoteDescription=u,u=function(h,f,m){const v=l.apply(this,[h]);return m?(v.then(f,m),Promise.resolve()):v},e.addIceCandidate=u}function EC(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=a=>i(xC(a))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,a,o){e.mediaDevices.getUserMedia(i).then(a,o)}).bind(e))}function xC(n){return n&&n.video!==void 0?Object.assign({},n,{video:nC(n.video)}):n}function RC(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,a){if(i&&i.iceServers){const o=[];for(let l=0;l<i.iceServers.length;l++){let u=i.iceServers[l];u.urls===void 0&&u.url?(jm("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,o.push(u)):o.push(i.iceServers[l])}i.iceServers=o}return new e(i,a)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function _C(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wC(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const a=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):i.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(l=>l.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function MC(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var C0=Object.freeze({__proto__:null,shimAudioContext:MC,shimCallbacksAPI:TC,shimConstraints:xC,shimCreateOfferLegacy:wC,shimGetUserMedia:EC,shimLocalStreamsAPI:kC,shimRTCIceServerUrls:RC,shimRemoteStreamsAPI:CC,shimTrackEventTransceiver:_C}),nf={exports:{}},T0;function dB(){return T0||(T0=1,(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(t){return t.split(`
m=`).map((a,o)=>(o>0?"m="+a:a).trim()+`\r
`)},e.getDescription=function(t){const i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){const i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(a=>a.indexOf(i)===0)},e.parseCandidate=function(t){let i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");const a={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":a.relatedAddress=i[o+1];break;case"rport":a.relatedPort=parseInt(i[o+1],10);break;case"tcptype":a.tcpType=i[o+1];break;case"ufrag":a.ufrag=i[o+1],a.usernameFragment=i[o+1];break;default:a[i[o]]===void 0&&(a[i[o]]=i[o+1]);break}return a},e.writeCandidate=function(t){const i=[];i.push(t.foundation);const a=t.component;a==="rtp"?i.push(1):a==="rtcp"?i.push(2):i.push(a),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);const o=t.type;return i.push("typ"),i.push(o),o!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let i=t.substring(9).split(" ");const a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},e.writeRtpMap=function(t){let i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);const a=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(a!==1?"/"+a:"")+`\r
`},e.parseExtmap=function(t){const i=t.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const i={};let a;const o=t.substring(t.indexOf(" ")+1).split(";");for(let l=0;l<o.length;l++)a=o[l].trim().split("="),i[a[0].trim()]=a[1];return i},e.writeFmtp=function(t){let i="",a=t.payloadType;if(t.preferredPayloadType!==void 0&&(a=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const o=[];Object.keys(t.parameters).forEach(l=>{t.parameters[l]!==void 0?o.push(l+"="+t.parameters[l]):o.push(l)}),i+="a=fmtp:"+a+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){const i=t.substring(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){let i="",a=t.payloadType;return t.preferredPayloadType!==void 0&&(a=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+a+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){const i=t.indexOf(" "),a={ssrc:parseInt(t.substring(7,i),10)},o=t.indexOf(":",i);return o>-1?(a.attribute=t.substring(i+1,o),a.value=t.substring(o+1)):a.attribute=t.substring(i+1),a},e.parseSsrcGroup=function(t){const i=t.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(a=>parseInt(a,10))}},e.getMid=function(t){const i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(t){const i=t.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:e.matchPrefix(t+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){let a="a=setup:"+i+`\r
`;return t.fingerprints.forEach(o=>{a+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),a},e.parseCryptoLine=function(t){const i=t.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const i=t.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){return e.matchPrefix(t+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,i){const a=e.matchPrefix(t+i,"a=ice-ufrag:")[0],o=e.matchPrefix(t+i,"a=ice-pwd:")[0];return a&&o?{usernameFragment:a.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(t){let i="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(t){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(t)[0].split(" ");i.profile=o[2];for(let u=3;u<o.length;u++){const h=o[u],f=e.matchPrefix(t,"a=rtpmap:"+h+" ")[0];if(f){const m=e.parseRtpMap(f),v=e.matchPrefix(t,"a=fmtp:"+h+" ");switch(m.parameters=v.length?e.parseFmtp(v[0]):{},m.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+h+" ").map(e.parseRtcpFb),i.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(m.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(u=>{i.headerExtensions.push(e.parseExtmap(u))});const l=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(u=>{l.forEach(h=>{u.rtcpFeedback.find(m=>m.type===h.type&&m.parameter===h.parameter)||u.rtcpFeedback.push(h)})}),i},e.writeRtpDescription=function(t,i){let a="";a+="m="+t+" ",a+=i.codecs.length>0?"9":"0",a+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=i.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(l=>{a+=e.writeRtpMap(l),a+=e.writeFmtp(l),a+=e.writeRtcpFb(l)});let o=0;return i.codecs.forEach(l=>{l.maxptime>o&&(o=l.maxptime)}),o>0&&(a+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(l=>{a+=e.writeExtmap(l)}),a},e.parseRtpEncodingParameters=function(t){const i=[],a=e.parseRtpParameters(t),o=a.fecMechanisms.indexOf("RED")!==-1,l=a.fecMechanisms.indexOf("ULPFEC")!==-1,u=e.matchPrefix(t,"a=ssrc:").map(b=>e.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),h=u.length>0&&u[0].ssrc;let f;const m=e.matchPrefix(t,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(T=>parseInt(T,10)));m.length>0&&m[0].length>1&&m[0][0]===h&&(f=m[0][1]),a.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let C={ssrc:h,codecPayloadType:parseInt(b.parameters.apt,10)};h&&f&&(C.rtx={ssrc:f}),i.push(C),o&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:h,mechanism:l?"red+ulpfec":"red"},i.push(C))}}),i.length===0&&h&&i.push({ssrc:h});let v=e.matchPrefix(t,"b=");return v.length&&(v[0].indexOf("b=TIAS:")===0?v=parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?v=parseInt(v[0].substring(5),10)*1e3*.95-2e3*8:v=void 0,i.forEach(b=>{b.maxBitrate=v})),i},e.parseRtcpParameters=function(t){const i={},a=e.matchPrefix(t,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);const o=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const l=e.matchPrefix(t,"a=rtcp-mux");return i.mux=l.length>0,i},e.writeRtcpParameters=function(t){let i="";return t.reducedSize&&(i+=`a=rtcp-rsize\r
`),t.mux&&(i+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(i+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),i},e.parseMsid=function(t){let i;const a=e.matchPrefix(t,"a=msid:");if(a.length===1)return i=a[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(t,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){const i=e.parseMLine(t),a=e.matchPrefix(t,"a=max-message-size:");let o;a.length>0&&(o=parseInt(a[0].substring(19),10)),isNaN(o)&&(o=65536);const l=e.matchPrefix(t,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const u=e.matchPrefix(t,"a=sctpmap:");if(u.length>0){const h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:o}}},e.writeSctpDescription=function(t,i){let a=[];return t.protocol!=="DTLS/SCTP"?a=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:a=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,i,a){let o;const l=i!==void 0?i:2;return t?o=t:o=e.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+o+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,i){const a=e.splitLines(t);for(let o=0;o<a.length;o++)switch(a[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const a=e.splitLines(t)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},e.parseOLine=function(t){const a=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const i=e.splitLines(t);for(let a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},n.exports=e})(nf)),nf.exports}var NC=dB(),Ya=Z6(NC),hB=p5({__proto__:null,default:Ya},[NC]);function Rl(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const a=new e(i),o=Ya.parseCandidate(i.candidate);for(const l in o)l in a||Object.defineProperty(a,l,{value:o[l]});return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,Zs(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Vf(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Zs(n,"icecandidate",e=>{if(e.candidate){const t=Ya.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function _l(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(u){if(!u||!u.sdp)return!1;const h=Ya.splitSections(u.sdp);return h.shift(),h.some(f=>{const m=Ya.parseMLine(f);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},i=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const f=parseInt(h[1],10);return f!==f?-1:f},a=function(u){let h=65536;return e.browser==="firefox"&&(e.version<57?u===-1?h=16384:h=2147483637:e.version<60?h=e.version===57?65535:65536:h=2147483637),h},o=function(u,h){let f=65536;e.browser==="firefox"&&e.version===57&&(f=65535);const m=Ya.matchPrefix(u.sdp,"a=max-message-size:");return m.length>0?f=parseInt(m[0].substring(19),10):e.browser==="firefox"&&h!==-1&&(f=2147483637),f},l=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const h=i(arguments[0]),f=a(h),m=o(arguments[0],h);let v;f===0&&m===0?v=Number.POSITIVE_INFINITY:f===0||m===0?v=Math.max(f,m):v=Math.min(f,m);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return v}}),this._sctp=b}return l.apply(this,arguments)}}function wl(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,a){const o=i.send;i.send=function(){const u=arguments[0],h=u.length||u.size||u.byteLength;if(i.readyState==="open"&&a.sctp&&h>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const a=t.apply(this,arguments);return e(a,this),a},Zs(n,"datachannel",i=>(e(i.channel,i.target),i))}function qf(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const o=a.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const l=new Event("connectionstatechange",a);o.dispatchEvent(l)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Hf(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=a.sdp.split(`
`).filter(l=>l.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&a instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:a.type,sdp:o}):a.sdp=o}return t.apply(this,arguments)}}function Ml(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Nl(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return t.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?t.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(l=>t.apply(this,[l]))})}var fB=Object.freeze({__proto__:null,removeExtmapAllowMixed:Hf,shimAddIceCandidateNullOrEmpty:Ml,shimConnectionState:qf,shimMaxMessageSize:_l,shimParameterlessSetLocalDescription:Nl,shimRTCIceCandidate:Rl,shimRTCIceCandidateRelayProtocol:Vf,shimSendThrowTypeError:wl});function mB(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=tC,i=lB(n),a={browserDetails:i,commonShim:fB,extractVersion:bo,disableLog:oB,disableWarnings:cB,sdp:hB};switch(i.browser){case"chrome":if(!S0||!zf||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),a;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),a;t("adapter.js shimming chrome."),a.browserShim=S0,Ml(n,i),Nl(n),iC(n,i),sC(n),zf(n,i),aC(n),lC(n,i),rC(n),oC(n),uC(n,i),Rl(n),Vf(n),qf(n),_l(n,i),wl(n),Hf(n,i);break;case"firefox":if(!k0||!Ff||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),a;t("adapter.js shimming firefox."),a.browserShim=k0,Ml(n,i),Nl(n),dC(n,i),Ff(n,i),hC(n),pC(n),fC(n),mC(n),gC(n),vC(n),yC(n),bC(n),SC(n),Rl(n),qf(n),_l(n,i),wl(n);break;case"safari":if(!C0||!e.shimSafari)return t("Safari shim is not included in this adapter release."),a;t("adapter.js shimming safari."),a.browserShim=C0,Ml(n,i),Nl(n),RC(n),wC(n),TC(n),kC(n),CC(n),_C(n),EC(n),MC(n),Rl(n),Vf(n),_l(n,i),wl(n),Hf(n,i);break;default:t("Unsupported browser!");break}return a}mB({window:typeof window>"u"?void 0:window});var $f,DC;class $t extends(DC=Promise){constructor(e){super(e)}catch(e){return super.catch(e)}static reject(e){return super.reject(e)}static all(e){return super.all(e)}static race(e){return super.race(e)}}$f=$t;$t.resolve=n=>Reflect.get(DC,"resolve",$f).call($f,n);const pB=/version\/(\d+(\.?_?\d+)+)/i;let sf;function un(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const t=navigator.userAgent.toLowerCase();if(sf===void 0||e){const i=gB.find(a=>{let{test:o}=a;return o.test(t)});sf=i?.describe(t)}return sf}const gB=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:Dl(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:af(n)}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:Dl(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0,osVersion:af(n)}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:Dl(pB,n),os:n.includes("mobile/")?"iOS":"macOS",osVersion:af(n)}}}];function Dl(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(n);return i&&i.length>=t&&i[t]||""}function af(n){return n.includes("mac os")?Dl(/\(.+?(\d+_\d+(:?_\d+)?)/,n,1).replace(/_/g,"."):void 0}var vB="2.17.1";const yB=vB,bB=16;class Cs extends Error{constructor(e,t,i){super(t||"an error has occurred"),this.name="LiveKitError",this.code=e,typeof i?.cause<"u"&&(this.cause=i?.cause)}}class Pm extends Cs{}var it;(function(n){n[n.NotAllowed=0]="NotAllowed",n[n.ServerUnreachable=1]="ServerUnreachable",n[n.InternalError=2]="InternalError",n[n.Cancelled=3]="Cancelled",n[n.LeaveRequest=4]="LeaveRequest",n[n.Timeout=5]="Timeout",n[n.WebSocket=6]="WebSocket",n[n.ServiceNotFound=7]="ServiceNotFound"})(it||(it={}));class ke extends Pm{constructor(e,t,i,a){super(1,e),this.name="ConnectionError",this.status=i,this.reason=t,this.context=a,this.reasonName=it[t]}static notAllowed(e,t,i){return new ke(e,it.NotAllowed,t,i)}static timeout(e){return new ke(e,it.Timeout)}static leaveRequest(e,t){return new ke(e,it.LeaveRequest,void 0,t)}static internal(e,t){return new ke(e,it.InternalError,void 0,t)}static cancelled(e){return new ke(e,it.Cancelled)}static serverUnreachable(e,t){return new ke(e,it.ServerUnreachable,t)}static websocket(e,t,i){return new ke(e,it.WebSocket,t,i)}static serviceNotFound(e,t){return new ke(e,it.ServiceNotFound,void 0,t)}}class Lm extends Cs{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Di extends Cs{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class SB extends Cs{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class bt extends Cs{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Ja extends Cs{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class E0 extends Cs{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class x0 extends Pm{constructor(e,t){super(15,e),this.name="SignalRequestError",this.reason=t,this.reasonName=typeof t=="string"?t:Am[t]}}var Yt;(function(n){n[n.AlreadyOpened=0]="AlreadyOpened",n[n.AbnormalEnd=1]="AbnormalEnd",n[n.DecodeFailed=2]="DecodeFailed",n[n.LengthExceeded=3]="LengthExceeded",n[n.Incomplete=4]="Incomplete",n[n.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",n[n.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Yt||(Yt={}));class Pn extends Pm{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=Yt[t]}}class Va extends Cs{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Ao;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(Ao||(Ao={}));(function(n){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(Ao||(Ao={}));class Ft{}Ft.setTimeout=function(){return setTimeout(...arguments)};Ft.setInterval=function(){return setInterval(...arguments)};Ft.clearTimeout=function(){return clearTimeout(...arguments)};Ft.clearInterval=function(){return clearInterval(...arguments)};var X;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.Moved="moved",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.ParticipantAttributesChanged="participantAttributesChanged",n.ParticipantActive="participantActive",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.VideoPlaybackStatusChanged="videoPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged",n.ChatMessage="chatMessage",n.LocalTrackSubscribed="localTrackSubscribed",n.MetricsReceived="metricsReceived"})(X||(X={}));var ie;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackCpuConstrained="localTrackCpuConstrained",n.LocalSenderCreated="localSenderCreated",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.TrackCpuConstrained="trackCpuConstrained",n.MediaDevicesError="mediaDevicesError",n.AudioStreamAcquired="audioStreamAcquired",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded",n.AttributesChanged="attributesChanged",n.LocalTrackSubscribed="localTrackSubscribed",n.ChatMessage="chatMessage",n.Active="active"})(ie||(ie={}));var ue;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",n.RemoteMute="remoteMute",n.SubscribedQualityUpdate="subscribedQualityUpdate",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackSubscribed="localTrackSubscribed",n.Offline="offline",n.SignalRequestResponse="signalRequestResponse",n.SignalConnected="signalConnected",n.RoomMoved="roomMoved"})(ue||(ue={}));var ce;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.CpuConstrained="cpuConstrained",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.VideoPlaybackStarted="videoPlaybackStarted",n.VideoPlaybackFailed="videoPlaybackFailed",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed",n.TrackProcessorUpdate="trackProcessorUpdate",n.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",n.TranscriptionReceived="transcriptionReceived",n.TimeSyncUpdate="timeSyncUpdate",n.PreConnectBufferFlushed="preConnectBufferFlushed"})(ce||(ce={}));function kB(n){return typeof n>"u"?n:typeof structuredClone=="function"?typeof n=="object"&&n!==null?structuredClone(Object.assign({},n)):structuredClone(n):JSON.parse(JSON.stringify(n))}class Ze{constructor(e,t,i,a,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(t!==void 0&&i!==void 0)this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:i,maxFramerate:a,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const CB=["vp8","h264"],TB=["vp8","h264","vp9","av1","h265"];function EB(n){return!!CB.find(e=>e===n)}const xB=EB;var R0;(function(n){n[n.PREFER_REGRESSION=0]="PREFER_REGRESSION",n[n.SIMULCAST=1]="SIMULCAST",n[n.REGRESSION=2]="REGRESSION"})(R0||(R0={}));var Kf;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:24e3},n.music={maxBitrate:48e3},n.musicStereo={maxBitrate:64e3},n.musicHighQuality={maxBitrate:96e3},n.musicHighQualityStereo={maxBitrate:128e3}})(Kf||(Kf={}));const jo={h90:new Ze(160,90,9e4,20),h180:new Ze(320,180,16e4,20),h216:new Ze(384,216,18e4,20),h360:new Ze(640,360,45e4,20),h540:new Ze(960,540,8e5,25),h720:new Ze(1280,720,17e5,30),h1080:new Ze(1920,1080,3e6,30),h1440:new Ze(2560,1440,5e6,30),h2160:new Ze(3840,2160,8e6,30)},Gf={h120:new Ze(160,120,7e4,20),h180:new Ze(240,180,125e3,20),h240:new Ze(320,240,14e4,20),h360:new Ze(480,360,33e4,20),h480:new Ze(640,480,5e5,20),h540:new Ze(720,540,6e5,25),h720:new Ze(960,720,13e5,30),h1080:new Ze(1440,1080,23e5,30),h1440:new Ze(1920,1440,38e5,30)},Im={h360fps3:new Ze(640,360,2e5,3,"medium"),h360fps15:new Ze(640,360,4e5,15,"medium"),h720fps5:new Ze(1280,720,8e5,5,"medium"),h720fps15:new Ze(1280,720,15e5,15,"medium"),h720fps30:new Ze(1280,720,2e6,30,"medium"),h1080fps15:new Ze(1920,1080,25e5,15,"medium"),h1080fps30:new Ze(1920,1080,5e6,30,"medium"),original:new Ze(0,0,7e6,30,"medium")};function OC(n,e,t){var i,a,o,l;const{optionsWithoutProcessor:u,audioProcessor:h,videoProcessor:f}=PC(n??{}),m=e?.processor,v=t?.processor,b=u??{};return b.audio===!0&&(b.audio={}),b.video===!0&&(b.video={}),b.audio&&(Yf(b.audio,e),(i=(o=b.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(h||m)&&(b.audio.processor=h??m)),b.video&&(Yf(b.video,t),(a=(l=b.video).deviceId)!==null&&a!==void 0||(l.deviceId={ideal:"default"}),(f||v)&&(b.video.processor=f??v)),b}function Yf(n,e){return Object.keys(e).forEach(t=>{n[t]===void 0&&(n[t]=e[t])}),n}function Um(n){var e,t,i,a;const o={};if(n.video)if(typeof n.video=="object"){const l={},u=l,h=n.video;Object.keys(h).forEach(f=>{f==="resolution"?Yf(u,h.resolution):u[f]=h[f]}),o.video=l,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=n.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return n.audio?typeof n.audio=="object"?(o.audio=n.audio,(t=(a=o.audio).deviceId)!==null&&t!==void 0||(a.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function AC(n){return P(this,arguments,void 0,function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=jC();if(i){const a=i.createAnalyser();a.fftSize=2048;const o=a.frequencyBinCount,l=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(a),yield Vt(t),a.getByteTimeDomainData(l);const h=l.some(f=>f!==128&&f!==0);return i.close(),!h}return!1})()})}function jC(){var n;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const t=new e({latencyHint:"interactive"});if(t.state==="suspended"&&typeof window<"u"&&(!((n=window.document)===null||n===void 0)&&n.body)){const i=()=>P(this,void 0,void 0,function*(){var a;try{t.state==="suspended"&&(yield t.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}finally{(a=window.document.body)===null||a===void 0||a.removeEventListener("click",i)}});t.addEventListener("statechange",()=>{var a;t.state==="closed"&&((a=window.document.body)===null||a===void 0||a.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return t}}function RB(n){return n==="audioinput"?ee.Source.Microphone:n==="videoinput"?ee.Source.Camera:ee.Source.Unknown}function Jf(n){return n===ee.Source.Microphone?"audioinput":n===ee.Source.Camera?"videoinput":void 0}function _B(n){var e,t;let i=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&n.resolution.width>0&&n.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Ws()?i=Object.assign(Object.assign({},i),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(t=n.audio)!==null&&t!==void 0?t:!1,video:i,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio,preferCurrentTab:n.preferCurrentTab}}function xo(n){return n.split("/")[1].toLowerCase()}function wB(n){const e=[];return n.forEach(t=>{t.track!==void 0&&e.push(new wm({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function Pe(n){return"mediaStreamTrack"in n?{trackID:n.sid,source:n.source,muted:n.isMuted,enabled:n.mediaStreamTrack.enabled,kind:n.kind,streamID:n.mediaStreamID,streamTrackID:n.mediaStreamTrack.id}:{trackID:n.trackSid,enabled:n.isEnabled,muted:n.isMuted,trackInfo:Object.assign({mimeType:n.mimeType,name:n.trackName,encrypted:n.isEncrypted,kind:n.kind,source:n.source},n.track?Pe(n.track):{})}}function MB(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function NB(n,e){var t;n===void 0&&(n={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(n)],a={};for(const o of i)n[o]!==e[o]&&(a[o]=(t=e[o])!==null&&t!==void 0?t:"");return a}function PC(n){const e=Object.assign({},n);let t,i;return typeof e.audio=="object"&&e.audio.processor&&(t=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:t,videoProcessor:i,optionsWithoutProcessor:kB(e)}}function DB(n){switch(n){case Rt.CAMERA:return ee.Source.Camera;case Rt.MICROPHONE:return ee.Source.Microphone;case Rt.SCREEN_SHARE:return ee.Source.ScreenShare;case Rt.SCREEN_SHARE_AUDIO:return ee.Source.ScreenShareAudio;default:return ee.Source.Unknown}}function _0(n,e){return n.width*n.height<e.width*e.height}function OB(n,e){var t;return(t=n.layers)===null||t===void 0?void 0:t.find(i=>i.quality===e)}const AB=5e3,lo=[];var kn;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH"})(kn||(kn={}));class ee extends oi.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var a;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=ee.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Me,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),AB):this.handleAppVisibilityChanged()},this.log=ji((a=i.loggerName)!==null&&a!==void 0?a:Yn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=ee.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Pe(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===ee.Kind.Video&&(t="video"),this.attachedElements.length===0&&this.kind===ee.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(lo.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&lo.splice(lo.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ha(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),a=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(a?ce.AudioPlaybackStarted:ce.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(a?ce.AudioPlaybackFailed:ce.VideoPlaybackFailed,o):o.name==="AbortError"?Me.debug("".concat(a?"audio":"video"," playback aborted, likely due to new play request")):Me.warn("could not playback ".concat(a?"audio":"video"),o),a&&e&&i.some(l=>l.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ce.ElementAttached,e),e}detach(e){try{if(e){Qa(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(ce.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(i=>{Qa(this.mediaStreamTrack,i),t.push(i),this.recycleElement(i),this.emit(ce.ElementDetached,i)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=ji(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),lo.forEach(i=>{i.parentElement||(t=!1)}),t&&lo.push(e)}}handleAppVisibilityChanged(){return P(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===ee.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){ln()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ln()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ha(n,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let i;n.kind==="audio"?i=t.getAudioTracks():i=t.getVideoTracks(),i.includes(n)||(i.forEach(a=>{t.removeTrack(a)}),t.addTrack(n)),(!Ws()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(Ws()||Xs())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function Qa(n,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(n),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(n){let e;(function(f){f.Audio="audio",f.Video="video",f.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let t;(function(f){f.Camera="camera",f.Microphone="microphone",f.ScreenShare="screen_share",f.ScreenShareAudio="screen_share_audio",f.Unknown="unknown"})(t=n.Source||(n.Source={}));let i;(function(f){f.Active="active",f.Paused="paused",f.Unknown="unknown"})(i=n.StreamState||(n.StreamState={}));function a(f){switch(f){case e.Audio:return qn.AUDIO;case e.Video:return qn.VIDEO;default:return qn.DATA}}n.kindToProto=a;function o(f){switch(f){case qn.AUDIO:return e.Audio;case qn.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=o;function l(f){switch(f){case t.Camera:return Rt.CAMERA;case t.Microphone:return Rt.MICROPHONE;case t.ScreenShare:return Rt.SCREEN_SHARE;case t.ScreenShareAudio:return Rt.SCREEN_SHARE_AUDIO;default:return Rt.UNKNOWN}}n.sourceToProto=l;function u(f){switch(f){case Rt.CAMERA:return t.Camera;case Rt.MICROPHONE:return t.Microphone;case Rt.SCREEN_SHARE:return t.ScreenShare;case Rt.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}n.sourceFromProto=u;function h(f){switch(f){case Lf.ACTIVE:return i.Active;case Lf.PAUSED:return i.Paused;default:return i.Unknown}}n.streamStateFromProto=h})(ee||(ee={}));const jB="|",w0="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function PB(n){const e=n.split(jB);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function Vt(n){return new $t(e=>Ft.setTimeout(e,n))}function Qf(){return"addTransceiver"in RTCPeerConnection.prototype}function Xf(){return"addTrack"in RTCPeerConnection.prototype}function LB(){if(!("getCapabilities"in RTCRtpSender)||Ws()||Xs())return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function IB(){if(!("getCapabilities"in RTCRtpSender)||Xs())return!1;if(Ws()){const t=un();if(t?.version&&si(t.version,"16")<0||t?.os==="iOS"&&t?.osVersion&&si(t.osVersion,"16")<0)return!1}const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function $n(n){return n==="av1"||n==="vp9"}function Wf(n){return!document||Po()?!1:(n||(n=document.createElement("audio")),"setSinkId"in n)}function UB(){return typeof RTCPeerConnection>"u"?!1:Qf()||Xf()}function Xs(){var n;return((n=un())===null||n===void 0?void 0:n.name)==="Firefox"}function M0(){const n=un();return!!n&&n.name==="Chrome"&&n.os!=="iOS"}function Ws(){var n;return((n=un())===null||n===void 0?void 0:n.name)==="Safari"}function Po(){const n=un();return n?.name==="Safari"||n?.os==="iOS"}function BB(){const n=un();return n?.name==="Safari"&&n.version.startsWith("17.")||n?.os==="iOS"&&!!n?.osVersion&&si(n.osVersion,"17")>=0}function zB(n){return n||(n=un()),n?.name==="Safari"&&si(n.version,"18.3")>0||n?.os==="iOS"&&!!n?.osVersion&&si(n.osVersion,"18.3")>0}function LC(){var n,e;return ln()?(e=(n=navigator.userAgentData)===null||n===void 0?void 0:n.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function FB(){const n=un(),e="17.2";if(n)return n.name!=="Safari"&&n.os!=="iOS"||n.os==="iOS"&&n.osVersion&&si(n.osVersion,e)>=0?!0:n.name==="Safari"&&si(n.version,e)>=0}function ln(){return typeof document<"u"}function ii(){return navigator.product=="ReactNative"}function nr(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function rf(n){return nr(n)?n.hostname.split(".")[0]:null}function IC(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function UC(){if(!ii())return;let n=IC();if(n)return n.platform}function N0(){if(ln())return window.devicePixelRatio;if(ii()){let n=IC();if(n)return n.devicePixelRatio}return 1}function si(n,e){const t=n.split("."),i=e.split("."),a=Math.min(t.length,i.length);for(let o=0;o<a;++o){const l=parseInt(t[o],10),u=parseInt(i[o],10);if(l>u)return 1;if(l<u)return-1;if(o===a-1&&l===u)return 0}return n===""&&e!==""?-1:e===""?1:t.length==i.length?0:t.length<i.length?-1:1}function VB(n){for(const e of n)e.target.handleResize(e)}function qB(n){for(const e of n)e.target.handleVisibilityChanged(e)}let of=null;const D0=()=>(of||(of=new ResizeObserver(VB)),of);let cf=null;const O0=()=>(cf||(cf=new IntersectionObserver(qB,{root:null,rootMargin:"0px"})),cf);function HB(){var n;const e=new jk({sdk:Pk.JS,protocol:bB,version:yB});return ii()&&(e.os=(n=UC())!==null&&n!==void 0?n:""),e}function A0(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=document.createElement("canvas");a.width=n,a.height=e;const o=a.getContext("2d");o?.fillRect(0,0,a.width,a.height),i&&o&&(o.beginPath(),o.arc(n/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const l=a.captureStream(),[u]=l.getTracks();if(!u)throw Error("Could not get empty media stream video track");return u.enabled=t,u}let uo;function lf(){if(!uo){const n=new AudioContext,e=n.createOscillator(),t=n.createGain();t.gain.setValueAtTime(0,0);const i=n.createMediaStreamDestination();if(e.connect(t),t.connect(i),e.start(),[uo]=i.stream.getAudioTracks(),!uo)throw Error("Could not get empty media stream audio track");uo.enabled=!1}return uo.clone()}class In{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise((i,a)=>P(this,void 0,void 0,function*(){this.resolve=i,this.reject=a,e&&(yield e(i,a))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function $B(n){return TB.includes(n)}function gs(n){if(typeof n=="string"||typeof n=="number")return n;if(Array.isArray(n))return n[0];if(n.exact!==void 0)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal!==void 0)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function KB(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function Lo(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}function GB(n,e){return n.segments.map(t=>{let{id:i,text:a,language:o,startTime:l,endTime:u,final:h}=t;var f;const m=(f=e.get(i))!==null&&f!==void 0?f:Date.now(),v=Date.now();return h?e.delete(i):e.set(i,m),{id:i,text:a,startTime:Number.parseInt(l.toString()),endTime:Number.parseInt(u.toString()),final:h,language:o,firstReceivedTime:m,lastReceivedTime:v}})}function YB(n){const{id:e,timestamp:t,message:i,editTimestamp:a}=n;return{id:e,timestamp:Number.parseInt(t.toString()),editTimestamp:a?Number.parseInt(a.toString()):void 0,message:i}}function j0(n){switch(n.reason){case it.LeaveRequest:return n.context;case it.Cancelled:return Ln.CLIENT_INITIATED;case it.NotAllowed:return Ln.USER_REJECTED;case it.ServerUnreachable:return Ln.JOIN_FAILURE;default:return Ln.UNKNOWN_REASON}}function Ol(n){return n!==void 0?Number(n):void 0}function $s(n){return n!==void 0?BigInt(n):void 0}function Xa(n){return!!n&&!(n instanceof MediaStreamTrack)&&n.isLocal}function ni(n){return!!n&&n.kind==ee.Kind.Audio}function Ts(n){return!!n&&n.kind==ee.Kind.Video}function ds(n){return Xa(n)&&Ts(n)}function Ri(n){return Xa(n)&&ni(n)}function Zf(n){return!!n&&!n.isLocal}function JB(n){return!!n&&!n.isLocal}function uf(n){return Zf(n)&&Ts(n)}function QB(n){return n.isLocal}function XB(n,e){const t=[];let i=new TextEncoder().encode(n);for(;i.length>e;){let a=e;for(;a>0;){const o=i[a];if(o!==void 0&&(o&192)!==128)break;a--}t.push(i.slice(0,a)),i=i.slice(a)}return i.length>0&&t.push(i),t}function WB(n){var e;const t=n.get("Cache-Control");if(t){const i=(e=t.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function ZB(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=e8(n,e);return t?i:Bm(i,"v1")}function e8(n,e){const t=new URL(KB(n));return e.forEach((i,a)=>{t.searchParams.set(a,i)}),Bm(t,"rtc")}function t8(n){const e=new URL(Lo(n));return Bm(e,"validate")}function BC(n){return n.endsWith("/")?n:"".concat(n,"/")}function Bm(n,e){return n.pathname="".concat(BC(n.pathname)).concat(e),n}function P0(n){if(typeof n=="string")return f0.fromJson(JSON.parse(n),{ignoreUnknownFields:!0});if(n instanceof ArrayBuffer)return f0.fromBinary(new Uint8Array(n));throw new Error("could not decode websocket message: ".concat(typeof n))}function n8(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(n instanceof AbortSignal))return e;const t=n.reason;switch(typeof t){case"string":return t;case"object":return t instanceof Error?t.message:e;default:return"toString"in t?t.toString():e}}const i8=10,ho="lk_e2ee",s8="LKFrameEncryptionKey",a8={sharedKey:!1,ratchetSalt:s8,ratchetWindowSize:8,failureTolerance:i8,keyringSize:16};var vs;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(vs||(vs={}));var L0;(function(n){n.KeyRatcheted="keyRatcheted"})(L0||(L0={}));var ms;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(ms||(ms={}));var I0;(function(n){n.Error="cryptorError"})(I0||(I0={}));function r8(){return o8()||em()}function em(){return typeof window.RTCRtpScriptTransform<"u"}function o8(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function c8(n){var e,t,i,a,o;if(((e=n.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((t=n.value)===null||t===void 0?void 0:t.case)!=="metrics"&&((i=n.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((a=n.value)===null||a===void 0?void 0:a.case)!=="transcription"&&((o=n.value)===null||o===void 0?void 0:o.case)!=="encryptedPacket")return new _k({value:n.value})}class L7 extends oi.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,i,a)=>{Me.debug("key ratcheted event received",{ratchetResult:t,participantId:i,keyIndex:a})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},a8),e),this.on(vs.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,i){const a={key:e,participantIdentity:t,keyIndex:i};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(i??0),a),this.emit(vs.SetKey,a)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(vs.RatchetRequest,e,t)}}var U0;(function(n){n[n.InvalidKey=0]="InvalidKey",n[n.MissingKey=1]="MissingKey",n[n.InternalError=2]="InternalError"})(U0||(U0={}));class l8 extends oi.EventEmitter{constructor(e,t){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var a,o;const{kind:l,data:u}=i.data;switch(l){case"error":if(Me.error(u.error.message),u.uuid){const m=this.decryptDataRequests.get(u.uuid);if(m?.reject){m.reject(u.error);break}const v=this.encryptDataRequests.get(u.uuid);if(v?.reject){v.reject(u.error);break}}this.emit(ms.EncryptionError,u.error,u.participantIdentity);break;case"initAck":u.enabled&&this.keyProvider.getKeys().forEach(m=>{this.postKey(m)});break;case"enable":if(u.enabled&&this.keyProvider.getKeys().forEach(m=>{this.postKey(m)}),this.encryptionEnabled!==u.enabled&&u.participantIdentity===((a=this.room)===null||a===void 0?void 0:a.localParticipant.identity))this.emit(ms.ParticipantEncryptionStatusChanged,u.enabled,this.room.localParticipant),this.encryptionEnabled=u.enabled;else if(u.participantIdentity){const m=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(u.participantIdentity);if(!m)throw TypeError("couldn't set encryption status, participant not found".concat(u.participantIdentity));this.emit(ms.ParticipantEncryptionStatusChanged,u.enabled,m)}break;case"ratchetKey":this.keyProvider.emit(vs.KeyRatcheted,u.ratchetResult,u.participantIdentity,u.keyIndex);break;case"decryptDataResponse":const h=this.decryptDataRequests.get(u.uuid);h?.resolve&&h.resolve(u);break;case"encryptDataResponse":const f=this.encryptDataRequests.get(u.uuid);f?.resolve&&f.resolve(u);break}},this.onWorkerError=i=>{Me.error("e2ee worker encountered an error:",{error:i.error}),this.emit(ms.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=t}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!r8())throw new Lm("tried to setup end-to-end encryption on an unsupported browser");if(Me.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:nB.getLevel()}};this.worker&&(Me.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Me.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?Me.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(ue.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(X.TrackPublished,(i,a)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==kt.NONE,a.identity)),e.on(X.ConnectionStateChanged,i=>{i===Be.Connected&&e.remoteParticipants.forEach(a=>{a.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==kt.NONE,a.identity)})})}).on(X.TrackUnsubscribed,(i,a,o)=>{var l;const u={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(l=this.worker)===null||l===void 0||l.postMessage(u)}).on(X.TrackSubscribed,(i,a,o)=>{this.setupE2EEReceiver(i,o.identity,a.trackInfo)}).on(X.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ie.LocalSenderCreated,(i,a)=>P(this,void 0,void 0,function*(){this.setupE2EESender(a,i)})),e.localParticipant.on(ie.LocalTrackPublished,i=>{if(!Ts(i.track)||!Po())return;const a={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:xo(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}),t.on(vs.SetKey,i=>this.postKey(i)).on(vs.RatchetRequest,(i,a)=>this.postRatchetRequest(i,a))}encryptData(e){return P(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const t=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:t,payload:e,participantIdentity:this.room.localParticipant.identity}},a=new In;return a.onFinally=()=>{this.encryptDataRequests.delete(t)},this.encryptDataRequests.set(t,a),this.worker.postMessage(i),a.promise})}handleEncryptedData(e,t,i,a){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),l={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:t,participantIdentity:i,keyIndex:a}},u=new In;return u.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,u),this.worker.postMessage(l),u.promise}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(i)}postKey(e){let{key:t,participantIdentity:i,keyIndex:a}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const l={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:t,keyIndex:a}};this.worker.postMessage(l)}postEnable(e,t){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,i){if(e.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?xo(i.mimeType):void 0)}}setupE2EESender(e,t){if(!Xa(e)||!t){t||Me.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,i,a){return P(this,void 0,void 0,function*(){if(this.worker){if(em()&&!M0()){const o={kind:"decode",participantIdentity:i,trackId:t,codec:a};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(ho in e&&a){const h={kind:"updateCodec",data:{trackId:t,codec:a,participantIdentity:i}};this.worker.postMessage(h);return}let o=e.writableStream,l=e.readableStream;if(!o||!l){const h=e.createEncodedStreams();e.writableStream=h.writable,o=h.writable,e.readableStream=h.readable,l=h.readable}const u={kind:"decode",data:{readableStream:l,writableStream:o,trackId:t,codec:a,participantIdentity:i,isReuse:ho in e}};this.worker.postMessage(u,[l,o])}e[ho]=!0}})}handleSender(e,t,i){var a;if(!(ho in e||!this.worker)){if(!(!((a=this.room)===null||a===void 0)&&a.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(em()&&!M0()){Me.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{Me.info("initialize encoded streams");const o=e.createEncodedStreams(),l={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(l,[o.readable,o.writable])}e[ho]=!0}}}const u8=500,d8=15e3;class Wa{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new Wa),this._instance}addFailedConnectionAttempt(e){var t;const i=new URL(e),a=rf(i);if(!a)return;let o=(t=this.failedConnectionAttempts.get(a))!==null&&t!==void 0?t:0;this.failedConnectionAttempts.set(a,o+1),this.backOffPromises.set(a,Vt(Math.min(u8*Math.pow(2,o),d8)))}getBackOffPromise(e){const t=new URL(e),i=t&&rf(t);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const t=new URL(e),i=t&&rf(t);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}Wa._instance=null;const df="default";class jt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new jt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return P(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=jt.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){Me.debug("awaiting getUserMedia promise");try{t?yield jt.userMediaPromiseMap.get(t):yield Promise.all(jt.userMediaPromiseMap.values())}catch{Me.warn("error waiting for media permissons")}}let l=yield navigator.mediaDevices.enumerateDevices();if(a&&!(Ws()&&i.hasDeviceInUse(t))&&(l.filter(h=>h.kind===t).length===0||l.some(h=>{const f=h.label==="",m=t?h.kind===t:!0;return f&&m}))){const h={video:t!=="audioinput"&&t!=="audiooutput",audio:t!=="videoinput"&&{deviceId:{ideal:"default"}}},f=yield navigator.mediaDevices.getUserMedia(h);l=yield navigator.mediaDevices.enumerateDevices(),f.getTracks().forEach(m=>{m.stop()})}return i._previousDevices=l,t&&(l=l.filter(u=>u.kind===t)),l})()})}normalizeDeviceId(e,t,i){return P(this,void 0,void 0,function*(){if(t!==df)return t;const a=yield this.getDevices(e),o=a.find(u=>u.deviceId===df);if(!o){Me.warn("could not reliably determine default device");return}const l=a.find(u=>u.deviceId!==df&&u.groupId===(i??o.groupId));if(!l){Me.warn("could not reliably determine default device");return}return l?.deviceId})}hasDeviceInUse(e){return e?jt.userMediaPromiseMap.has(e):jt.userMediaPromiseMap.size>0}}jt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];jt.userMediaPromiseMap=new Map;var Ro;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})(Ro||(Ro={}));class h8{constructor(){this.pendingTasks=new Map,this.taskMutex=new Qt,this.nextTaskIndex=0}run(e){return P(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ro.WAITING};this.pendingTasks.set(t.id,t);const i=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Ro.RUNNING,yield e()}finally{t.status=Ro.COMPLETED,this.pendingTasks.delete(t.id),i()}})}flush(){return P(this,void 0,void 0,function*(){return this.run(()=>P(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class f8{get readyState(){return this.ws.readyState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,a;if(!((i=t.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,(a=t.protocols)!==null&&a!==void 0?a:[]);o.binaryType="arraybuffer",this.ws=o;const l=function(){let{closeCode:u,reason:h}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.close(u,h)};this.opened=new $t((u,h)=>{const f=()=>{h(ke.websocket("Encountered websocket error during connection establishment"))};o.onopen=()=>{u({readable:new ReadableStream({start(m){o.onmessage=v=>{let{data:b}=v;return m.enqueue(b)},o.onerror=v=>m.error(v)},cancel:l}),writable:new WritableStream({write(m){o.send(m)},abort(){o.close()},close:l}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",f)},o.addEventListener("error",f)}),this.closed=new $t((u,h)=>{const f=()=>P(this,void 0,void 0,function*(){const m=new $t(b=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",C=>{b(C)},{once:!0})}),v=yield $t.race([Vt(250),m]);v?u(v):h(ke.websocket("Encountered unspecified websocket error without a timely close event"))});o.onclose=m=>{let{code:v,reason:b}=m;u({closeCode:v,reason:b}),o.removeEventListener("error",f)},o.addEventListener("error",f)}),t.signal&&(t.signal.onabort=()=>o.close()),this.close=l}}const m8=["syncState","trickle","offer","answer","simulate","leave"];function p8(n){const e=m8.indexOf(n.case)>=0;return Me.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}var nt;(function(n){n[n.CONNECTING=0]="CONNECTING",n[n.CONNECTED=1]="CONNECTED",n[n.RECONNECTING=2]="RECONNECTING",n[n.DISCONNECTING=3]="DISCONNECTING",n[n.DISCONNECTED=4]="DISCONNECTED"})(nt||(nt={}));const g8=250;class zm{get currentState(){return this.state}get isDisconnected(){return this.state===nt.DISCONNECTING||this.state===nt.DISCONNECTED}get isEstablishingConnection(){return this.state===nt.CONNECTING||this.state===nt.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=nt.DISCONNECTED,this.log=Me,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=ji((i=t.loggerName)!==null&&i!==void 0?i:Yn.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new h8,this.queuedRequests=[],this.closingLock=new Qt,this.connectionLock=new Qt,this.state=nt.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,i,a){return P(this,arguments,void 0,function(o,l,u,h){var f=this;let m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){return f.state=nt.CONNECTING,f.options=u,yield f.connect(o,l,u,h,m)})()})}reconnect(e,t,i,a){return P(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=nt.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:a}),void 0,this.useV0SignalPath)})}connect(e,t,i,a){return P(this,arguments,void 0,function(o,l,u,h){var f=this;let m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){const v=yield f.connectionLock.lock();f.connectOptions=u,f.useV0SignalPath=m;const b=HB(),C=m?v8(l,b,u):y8(l,b,u),T=ZB(o,C,m).toString(),S=t8(T).toString();return new Promise((R,_)=>P(f,void 0,void 0,function*(){var D,j;try{let x=!1;const w=A=>P(this,void 0,void 0,function*(){if(x)return;x=!0;const O=A instanceof Event?A.currentTarget:A,Y=n8(O,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(Y)).catch(J=>{this.log.error(J),this.close()}):this.close(),M(),_(ke.cancelled(Y))});h?.addEventListener("abort",w);const M=()=>{clearTimeout(I),h?.removeEventListener("abort",w)},I=setTimeout(()=>{w(ke.timeout("room connection has timed out (signal)"))},u.websocketTimeout),F=(A,O)=>{this.handleSignalConnected(A,I,O)},L=new URL(T);L.searchParams.has("access_token")&&L.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(L),Object.assign({reconnect:u.reconnect,reconnectReason:u.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new f8(T);try{this.ws.closed.then(H=>{var ae;this.isEstablishingConnection&&_(ke.internal("Websocket got closed during a (re)connection attempt: ".concat(H.reason))),H.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:H.reason,code:H.closeCode,wasClean:H.closeCode===1e3,state:this.state})),this.state===nt.CONNECTED&&this.handleOnClose((ae=H.reason)!==null&&ae!==void 0?ae:"Unexpected WS error"))}).catch(H=>{this.isEstablishingConnection&&_(ke.internal("Websocket error during a (re)connection attempt: ".concat(H)))});const A=yield this.ws.opened.catch(H=>P(this,void 0,void 0,function*(){if(this.state!==nt.CONNECTED){this.state=nt.DISCONNECTED,clearTimeout(I);const ae=yield this.handleConnectionError(H,S);_(ae);return}this.handleWSError(H),_(H)}));if(clearTimeout(I),!A)return;const O=A.readable.getReader();this.streamWriter=A.writable.getWriter();const Y=yield O.read();if(O.releaseLock(),!Y.value)throw ke.internal("no message received as first message");const J=P0(Y.value),le=this.validateFirstMessage(J,(D=u.reconnect)!==null&&D!==void 0?D:!1);if(!le.isValid){_(le.error);return}((j=J.message)===null||j===void 0?void 0:j.case)==="join"&&(this.pingTimeoutDuration=J.message.value.pingTimeout,this.pingIntervalDuration=J.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const Te=le.shouldProcessFirstMessage?J:void 0;F(A,Te),R(le.response)}catch(A){_(A)}finally{M()}}finally{v()}}))})()})}startReadingLoop(e,t){return P(this,void 0,void 0,function*(){for(t&&this.handleSignalResponse(t);;){this.signalLatency&&(yield Vt(this.signalLatency));const{done:i,value:a}=yield e.read();if(i)break;const o=P0(a);this.handleSignalResponse(o)}})}close(){return P(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([nt.DISCONNECTING||nt.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const a=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=nt.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const o=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([o,Vt(g8)])}}catch(o){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:o}))}finally{t&&(e.state=nt.DISCONNECTED),a()}})()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:$a(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:$a(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new uu({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new du({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return P(this,arguments,void 0,function(i,a){var o=this;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const u=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new Nm({requestId:u,metadata:i,name:a,attributes:l})}),u})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new $k({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new Yk({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ct.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Xk({timestamp:ct.parse(Date.now()),rtt:ct.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new Mm({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new fu({reason:Ln.CLIENT_INITIATED,action:Ga.DISCONNECT})})}sendRequest(e){return P(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!a&&!p8(t)&&i.state===nt.RECONNECTING){i.queuedRequests.push(()=>P(i,void 0,void 0,function*(){yield this.sendRequest(t,!0)}));return}if(a||(yield i.requestQueue.flush()),i.signalLatency&&(yield Vt(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(t.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(t?.case),i.logContext);return}const l=new C6({message:t});try{i.useJSON?yield i.streamWriter.write(l.toJsonString()):yield i.streamWriter.write(l.toBinary())}catch(u){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:u}))}})()})}handleSignalResponse(e){var t,i;const a=e.message;if(a==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(a.case==="answer"){const l=B0(a.value);this.onAnswer&&this.onAnswer(l,a.value.id,a.value.midToTrackId)}else if(a.case==="offer"){const l=B0(a.value);this.onOffer&&this.onOffer(l,a.value.id,a.value.midToTrackId)}else if(a.case==="trickle"){const l=JSON.parse(a.value.candidateInit);this.onTrickle&&this.onTrickle(l,a.value.target)}else a.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=a.value.participants)!==null&&t!==void 0?t:[]):a.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(a.value):a.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=a.value.speakers)!==null&&i!==void 0?i:[]):a.case==="leave"?this.onLeave&&this.onLeave(a.value):a.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(a.value.sid,a.value.muted):a.case==="roomUpdate"?this.onRoomUpdate&&a.value.room&&this.onRoomUpdate(a.value.room):a.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(a.value):a.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(a.value):a.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(a.value):a.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(a.value):a.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(a.value):a.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(a.value):a.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(a.value):a.case==="pong"||(a.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(a.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):a.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(a.value):a.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(a.value.trackSid):a.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(a.value.token),this.onRoomMoved&&this.onRoomMoved(a.value)):a.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(a.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:a.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return P(this,void 0,void 0,function*(){if(this.state===nt.DISCONNECTED)return;const t=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Ft.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Ft.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Ft.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ft.clearInterval(this.pingInterval)}handleSignalConnected(e,t,i){this.state=nt.CONNECTED,clearTimeout(t),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,t){var i,a,o,l,u;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===nt.RECONNECTING&&((a=e.message)===null||a===void 0?void 0:a.case)!=="leave"?((o=e.message)===null||o===void 0?void 0:o.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((l=e.message)===null||l===void 0?void 0:l.case)==="leave"?{isValid:!1,error:ke.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:t?{isValid:!1,error:ke.internal("Unexpected first message")}:{isValid:!1,error:ke.internal("did not receive join response, got ".concat((u=e.message)===null||u===void 0?void 0:u.case," instead"))}}handleConnectionError(e,t){return P(this,void 0,void 0,function*(){try{const i=yield fetch(t);switch(i.status){case 404:return ke.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const a=yield i.text();return ke.notAllowed(a,i.status);default:break}return e instanceof ke?e:ke.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof ke?i:ke.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function B0(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function $a(n,e){return new Ss({sdp:n.sdp,type:n.type,id:e})}function v8(n,e,t){var i;const a=new URLSearchParams;return a.set("access_token",n),t.reconnect&&(a.set("reconnect","1"),t.sid&&a.set("sid",t.sid)),a.set("auto_subscribe",t.autoSubscribe?"1":"0"),a.set("sdk",ii()?"reactnative":"js"),a.set("version",e.version),a.set("protocol",e.protocol.toString()),e.deviceModel&&a.set("device_model",e.deviceModel),e.os&&a.set("os",e.os),e.osVersion&&a.set("os_version",e.osVersion),e.browser&&a.set("browser",e.browser),e.browserVersion&&a.set("browser_version",e.browserVersion),t.adaptiveStream&&a.set("adaptive_stream","1"),t.reconnectReason&&a.set("reconnect_reason",t.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&a.set("network",navigator.connection.type),a}function y8(n,e,t){const i=new URLSearchParams;i.set("access_token",n);const a=new J6({clientInfo:e,connectionSettings:new Wk({autoSubscribe:!!t.autoSubscribe,adaptiveStream:!!t.adaptiveStream}),reconnect:!!t.reconnect,participantSid:t.sid?t.sid:void 0});t.reconnectReason&&(a.reconnectReason=t.reconnectReason);const o=new Q6({joinRequest:a.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(o.toBinary()))),i}class z0{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class b8{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const a=i+this.ttl;return this._map.set(e,{value:t,expiresAt:a}),this}get(e){const t=this._map.get(e);if(t){if(t.expiresAt<Date.now()){this._map.delete(e);return}return t.value}}has(e){const t=this._map.get(e);return t?t.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,i]of this._map.entries())i.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],i=this.asValueMap();for(const[a,o]of i.entries())t.push(e(o,a,i));return t}asValueMap(){const e=new Map;for(const[t,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(t,i.value);return e}}var Fn={},hf={},ff={exports:{}},F0;function Fm(){if(F0)return ff.exports;F0=1;var n=ff.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),ff.exports}var V0;function S8(){return V0||(V0=1,(function(n){var e=function(u){return String(Number(u))===u?Number(u):u},t=function(u,h,f,m){if(m&&!f)h[m]=e(u[1]);else for(var v=0;v<f.length;v+=1)u[v+1]!=null&&(h[f[v]]=e(u[v+1]))},i=function(u,h,f){var m=u.name&&u.names;u.push&&!h[u.push]?h[u.push]=[]:m&&!h[u.name]&&(h[u.name]={});var v=u.push?{}:m?h[u.name]:h;t(f.match(u.reg),v,u.names,u.name),u.push&&h[u.push].push(v)},a=Fm(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(u){var h={},f=[],m=h;return u.split(/(\r\n|\r|\n)/).filter(o).forEach(function(v){var b=v[0],C=v.slice(2);b==="m"&&(f.push({rtp:[],fmtp:[]}),m=f[f.length-1]);for(var T=0;T<(a[b]||[]).length;T+=1){var S=a[b][T];if(S.reg.test(C))return i(S,m,C)}}),h.media=f,h};var l=function(u,h){var f=h.split(/=(.+)/,2);return f.length===2?u[f[0]]=e(f[1]):f.length===1&&h.length>1&&(u[f[0]]=void 0),u};n.parseParams=function(u){return u.split(/;\s?/).reduce(l,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(u){return u.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(u){for(var h=[],f=u.split(" ").map(e),m=0;m<f.length;m+=3)h.push({component:f[m],ip:f[m+1],port:f[m+2]});return h},n.parseImageAttributes=function(u){return u.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(l,{})})},n.parseSimulcastStreamList=function(u){return u.split(";").map(function(h){return h.split(",").map(function(f){var m,v=!1;return f[0]!=="~"?m=e(f):(m=e(f.substring(1,f.length)),v=!0),{scid:m,paused:v}})})}})(hf)),hf}var mf,q0;function k8(){if(q0)return mf;q0=1;var n=Fm(),e=/%[sdv%]/g,t=function(l){var u=1,h=arguments,f=h.length;return l.replace(e,function(m){if(u>=f)return m;var v=h[u];switch(u+=1,m){case"%%":return"%";case"%s":return String(v);case"%d":return Number(v);case"%v":return""}})},i=function(l,u,h){var f=u.format instanceof Function?u.format(u.push?h:h[u.name]):u.format,m=[l+"="+f];if(u.names)for(var v=0;v<u.names.length;v+=1){var b=u.names[v];u.name?m.push(h[u.name][b]):m.push(h[u.names[v]])}else m.push(h[u.name]);return t.apply(null,m)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return mf=function(l,u){u=u||{},l.version==null&&(l.version=0),l.name==null&&(l.name=" "),l.media.forEach(function(v){v.payloads==null&&(v.payloads="")});var h=u.outerOrder||a,f=u.innerOrder||o,m=[];return h.forEach(function(v){n[v].forEach(function(b){b.name in l&&l[b.name]!=null?m.push(i(v,b,l)):b.push in l&&l[b.push]!=null&&l[b.push].forEach(function(C){m.push(i(v,b,C))})})}),l.media.forEach(function(v){m.push(i("m",n.m[0],v)),f.forEach(function(b){n[b].forEach(function(C){C.name in v&&v[C.name]!=null?m.push(i(b,C,v)):C.push in v&&v[C.push]!=null&&v[C.push].forEach(function(T){m.push(i(b,C,T))})})})}),m.join(`\r
`)+`\r
`},mf}var H0;function C8(){if(H0)return Fn;H0=1;var n=S8(),e=k8(),t=Fm();return Fn.grammar=t,Fn.write=e,Fn.parse=n.parse,Fn.parseParams=n.parseParams,Fn.parseFmtpConfig=n.parseFmtpConfig,Fn.parsePayloads=n.parsePayloads,Fn.parseRemoteCandidates=n.parseRemoteCandidates,Fn.parseImageAttributes=n.parseImageAttributes,Fn.parseSimulcastStreamList=n.parseSimulcastStreamList,Fn}var hs=C8();function Vm(n,e,t){var i,a,o;e===void 0&&(e=50),t===void 0&&(t={});var l=(i=t.isImmediate)!=null&&i,u=(a=t.callback)!=null&&a,h=t.maxWait,f=Date.now(),m=[];function v(){if(h!==void 0){var C=Date.now()-f;if(C+e>=h)return h-C}return e}var b=function(){var C=[].slice.call(arguments),T=this;return new Promise(function(S,R){var _=l&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,f=Date.now(),!l){var j=n.apply(T,C);u&&u(j),m.forEach(function(x){return(0,x.resolve)(j)}),m=[]}},v()),_){var D=n.apply(T,C);return u&&u(D),S(D)}m.push({resolve:S,reject:R})})};return b.cancel=function(C){o!==void 0&&clearTimeout(o),m.forEach(function(T){return(0,T.reject)(C)}),m=[]},b}const T8=.7,E8=20,Za={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class $0 extends oi.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Me,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Vm(a=>P(this,void 0,void 0,function*(){this.emit(Za.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(a)a(o);else throw o}}),E8),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ji((i=t.loggerName)!==null&&i!==void 0?i:Yn.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new Qt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var i;t.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,t.candidate))},e.onicecandidateerror=t=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,t)},e.ontrack=t=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return P(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return P(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let a;if(e.type==="offer"){let{stereoMids:o,nackMids:l}=x8(e);this.remoteStereoMids=o,this.remoteNackMids=l}else if(e.type==="answer"){const o=hs.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(l=>{const u=qm(l.mid);l.type==="audio"&&this.trackBitrates.some(h=>{if(!h.transceiver||u!=h.transceiver.mid)return!1;let f=0;if(l.rtp.some(v=>v.codec.toUpperCase()===h.codec.toUpperCase()?(f=v.payload,!0):!1),f===0)return!0;let m=!1;for(const v of l.fmtp)if(v.payload===f){v.config=v.config.split(";").filter(b=>!b.includes("maxaveragebitrate")).join(";"),h.maxbr>0&&(v.config+=";maxaveragebitrate=".concat(h.maxbr*1e3)),m=!0;break}return m||h.maxbr>0&&l.fmtp.push({payload:f,config:"maxaveragebitrate=".concat(h.maxbr*1e3)}),!0})}),a=hs.write(o)}return yield this.setMungedSDP(e,a,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Za.NegotiationComplete),e.sdp&&hs.parse(e.sdp).media.forEach(l=>{l.type==="video"&&this.emit(Za.RTPVideoPayloadTypes,l.rtp)})),!0})}createAndSendOffer(e){return P(this,void 0,void 0,function*(){var t;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const u=this._pc.remoteDescription;if(e?.iceRestart&&u)yield this._pc.setRemoteDescription(u);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const a=this.latestOfferId+1;this.latestOfferId=a;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const l=hs.parse((t=o.sdp)!==null&&t!==void 0?t:"");if(l.media.forEach(u=>{G0(u),u.type==="audio"?K0(u,["all"],[]):u.type==="video"&&this.trackBitrates.some(h=>{if(!u.msid||!h.cid||!u.msid.includes(h.cid))return!1;let f=0;if(u.rtp.some(v=>v.codec.toUpperCase()===h.codec.toUpperCase()?(f=v.payload,!0):!1),f===0||($n(h.codec)&&!Ws()&&this.ensureVideoDDExtensionForSVC(u,l),!$n(h.codec)))return!0;const m=Math.round(h.maxbr*T8);for(const v of u.fmtp)if(v.payload===f){v.config.includes("x-google-start-bitrate")||(v.config+=";x-google-start-bitrate=".concat(m));break}return!0})}),this.latestOfferId>a){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:a}));return}yield this.setMungedSDP(o,hs.write(l)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return P(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),i=hs.parse((e=t.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(a=>{G0(a),a.type==="audio"&&K0(a,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,hs.write(i)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTransceiverOfKind(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new bt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new bt("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return P(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const i=new Map,a=new Map;if((yield this._pc.getStats()).forEach(u=>{switch(u.type){case"transport":t=u.selectedCandidatePairId;break;case"candidate-pair":t===""&&u.selected&&(t=u.id),i.set(u.id,u);break;case"remote-candidate":a.set(u.id,"".concat(u.address,":").concat(u.port));break}}),t==="")return;const l=(e=i.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(l!==void 0)return a.get(l)})}setMungedSDP(e,t,i){return P(this,void 0,void 0,function*(){if(t){const a=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:t})),e.sdp=a}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(a){let o="unknown error";a instanceof Error?o=a.message:typeof a=="string"&&(o=a);const l={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(l.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:l})),new Ja(o)}})}ensureVideoDDExtensionForSVC(e,t){var i,a;if(!((i=e.ext)===null||i===void 0?void 0:i.some(l=>l.uri===w0))){if(this.ddExtID===0){let l=0;t.media.forEach(u=>{var h;u.type==="video"&&((h=u.ext)===null||h===void 0||h.forEach(f=>{f.value>l&&(l=f.value)}))}),this.ddExtID=l+1}(a=e.ext)===null||a===void 0||a.push({value:this.ddExtID,uri:w0})}}}function K0(n,e,t){const i=qm(n.mid);let a=0;n.rtp.some(o=>o.codec==="opus"?(a=o.payload,!0):!1),a>0&&(n.rtcpFb||(n.rtcpFb=[]),t.includes(i)&&!n.rtcpFb.some(o=>o.payload===a&&o.type==="nack")&&n.rtcpFb.push({payload:a,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&n.fmtp.some(o=>o.payload===a?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function x8(n){var e;const t=[],i=[],a=hs.parse((e=n.sdp)!==null&&e!==void 0?e:"");let o=0;return a.media.forEach(l=>{var u;const h=qm(l.mid);l.type==="audio"&&(l.rtp.some(f=>f.codec==="opus"?(o=f.payload,!0):!1),!((u=l.rtcpFb)===null||u===void 0)&&u.some(f=>f.payload===o&&f.type==="nack")&&i.push(h),l.fmtp.some(f=>f.payload===o?(f.config.includes("sprop-stereo=1")&&t.push(h),!0):!1))}),{stereoMids:t,nackMids:i}}function G0(n){if(n.connection){const e=n.connection.ip.indexOf(":")>=0;(n.connection.version===4&&e||n.connection.version===6&&!e)&&(n.connection.ip="0.0.0.0",n.connection.version=4)}}function qm(n){return typeof n=="number"?n.toFixed(0):n}const tm="vp8",R8={audioPreset:Kf.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Im.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:tm,backupCodec:!0,preConnectBuffer:!1},zC={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},FC={deviceId:{ideal:"default"},resolution:jo.h720.resolution},_8={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new sB,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},Hm={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ft;(function(n){n[n.NEW=0]="NEW",n[n.CONNECTING=1]="CONNECTING",n[n.CONNECTED=2]="CONNECTED",n[n.FAILED=3]="FAILED",n[n.CLOSING=4]="CLOSING",n[n.CLOSED=5]="CLOSED"})(ft||(ft={}));class w8{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(e,t,i){var a;this.peerConnectionTimeout=Hm.peerConnectionTimeout,this.log=Me,this.updateState=()=>{var o,l;const u=this.state,h=this.requiredTransports.map(f=>f.getConnectionState());h.every(f=>f==="connected")?this.state=ft.CONNECTED:h.some(f=>f==="failed")?this.state=ft.FAILED:h.some(f=>f==="connecting")?this.state=ft.CONNECTING:h.every(f=>f==="closed")?this.state=ft.CLOSED:h.some(f=>f==="closed")?this.state=ft.CLOSING:h.every(f=>f==="new")&&(this.state=ft.NEW),u!==this.state&&(this.log.debug("pc state change: from ".concat(ft[u]," to ").concat(ft[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),(l=this.subscriber)===null||l===void 0?void 0:l.getConnectionState()))},this.log=ji((a=i.loggerName)!==null&&a!==void 0?a:Yn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=t!=="subscriber-primary",this.isSubscriberConnectionRequired=t==="subscriber-primary",this.publisher=new $0(e,i),this._mode=t,t!=="publisher-only"&&(this.subscriber=new $0(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=o=>{var l;(l=this.onIceCandidate)===null||l===void 0||l.call(this,o,Hn.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var l;(l=this.onDataChannel)===null||l===void 0||l.call(this,o)},this.subscriber.onTrack=o=>{var l;(l=this.onTrack)===null||l===void 0||l.call(this,o)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var l;(l=this.onIceCandidate)===null||l===void 0||l.call(this,o,Hn.PUBLISHER)},this.publisher.onTrack=o=>{var l;(l=this.onTrack)===null||l===void 0||l.call(this,o)},this.publisher.onOffer=(o,l)=>{var u;(u=this.onPublisherOffer)===null||u===void 0||u.call(this,o,l)},this.state=ft.NEW,this.connectionLock=new Qt,this.remoteOfferLock=new Qt}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return P(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const t=this.publisher;for(const i of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(i)}catch(a){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:a}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return P(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return P(this,void 0,void 0,function*(){var i;t===Hn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return P(this,void 0,void 0,function*(){var i,a,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const l=yield this.remoteOfferLock.lock();try{return(yield(a=this.subscriber)===null||a===void 0?void 0:a.setRemoteDescription(e,t))?yield(o=this.subscriber)===null||o===void 0?void 0:o.createAndSetAnswer():void 0}finally{l()}})}updateConfiguration(e,t){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return P(this,void 0,void 0,function*(){var i;const a=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,t)))}finally{a()}})}negotiate(e){return P(this,void 0,void 0,function*(){return new $t((t,i)=>P(this,void 0,void 0,function*(){const a=setTimeout(()=>{i(new Ja("negotiation timed out"))},this.peerConnectionTimeout),o=()=>{clearTimeout(a),i(new Ja("negotiation aborted"))};e.signal.addEventListener("abort",o),this.publisher.once(Za.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Za.NegotiationComplete,()=>{clearTimeout(a),t()})}),yield this.publisher.negotiate(l=>{clearTimeout(a),l instanceof Error?i(l):i(new Error(String(l)))})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTransceiverOfKind(e,t){return this.publisher.addTransceiverOfKind(e,t)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(a=>a.receiver===e);return i?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Hn.PUBLISHER?this.publisher.getConnectedAddress():e===Hn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return P(this,arguments,void 0,function(i,a){var o=this;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((h,f)=>P(o,void 0,void 0,function*(){const m=()=>{this.log.warn("abort transport connection",this.logContext),Ft.clearTimeout(v),f(ke.cancelled("room connection has been cancelled"))};a?.signal.aborted&&m(),a?.signal.addEventListener("abort",m);const v=Ft.setTimeout(()=>{a?.signal.removeEventListener("abort",m),f(ke.internal("could not establish pc connection"))},l);for(;this.state!==ft.CONNECTED;)if(yield Vt(50),a?.signal.aborted){f(ke.cancelled("room connection has been cancelled"));return}Ft.clearTimeout(v),a?.signal.removeEventListener("abort",m),h()}))})()})}}const VC=5e3,M8=3e4;class Fe{static fetchRegionSettings(e,t,i){return P(this,void 0,void 0,function*(){const a=yield Fe.fetchLock.lock();try{const o=yield fetch("".concat(N8(e),"/regions"),{headers:{authorization:"Bearer ".concat(t)},signal:i});if(o.ok){const l=WB(o.headers),u=l?l*1e3:VC;return{regionSettings:yield o.json(),updatedAtInMs:Date.now(),maxAgeInMs:u}}else throw o.status===401?ke.notAllowed("Could not fetch region settings: ".concat(o.statusText),o.status):ke.internal("Could not fetch region settings: ".concat(o.statusText))}catch(o){throw o instanceof ke?o:i?.aborted?ke.cancelled("Region fetching was aborted"):ke.serverUnreachable("Could not fetch region settings, ".concat(o instanceof Error?"".concat(o.name,": ").concat(o.message):o))}finally{a()}})}static scheduleRefetch(e,t,i){return P(this,void 0,void 0,function*(){const a=Fe.settingsTimeouts.get(e.hostname);clearTimeout(a),Fe.settingsTimeouts.set(e.hostname,setTimeout(()=>P(this,void 0,void 0,function*(){try{const o=yield Fe.fetchRegionSettings(e,t);Fe.updateCachedRegionSettings(e,t,o)}catch(o){if(o instanceof ke&&o.reason===it.NotAllowed){Me.debug("token is not valid, cancelling auto region refresh");return}Me.debug("auto refetching of region settings failed",{error:o}),Fe.scheduleRefetch(e,t,i)}}),i))})}static updateCachedRegionSettings(e,t,i){Fe.cache.set(e.hostname,i),Fe.scheduleRefetch(e,t,i.maxAgeInMs)}static stopRefetch(e){const t=Fe.settingsTimeouts.get(e);t&&(clearTimeout(t),Fe.settingsTimeouts.delete(e))}static scheduleCleanup(e){let t=Fe.connectionTrackers.get(e);t&&(t.cleanupTimeout&&clearTimeout(t.cleanupTimeout),t.cleanupTimeout=setTimeout(()=>{const i=Fe.connectionTrackers.get(e);i&&i.connectionCount===0&&(Me.debug("stopping region refetch after disconnect delay",{hostname:e}),Fe.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},M8))}static cancelCleanup(e){const t=Fe.connectionTrackers.get(e);t?.cleanupTimeout&&(clearTimeout(t.cleanupTimeout),t.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let t=Fe.connectionTrackers.get(e);t||(t={connectionCount:0},Fe.connectionTrackers.set(e,t)),t.connectionCount++,Fe.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,t=Fe.connectionTrackers.get(e);t&&(t.connectionCount=Math.max(0,t.connectionCount-1),t.connectionCount===0&&Fe.scheduleCleanup(e))}constructor(e,t){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return nr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return P(this,void 0,void 0,function*(){return Fe.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return P(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let t=Fe.cache.get(this.serverUrl.hostname);(!t||Date.now()-t.updatedAtInMs>t.maxAgeInMs)&&(t=yield this.fetchRegionSettings(e),Fe.updateCachedRegionSettings(this.serverUrl,this.token,t));const i=t.regionSettings.regions.filter(a=>!this.attemptedRegions.find(o=>o.url===a.url));if(i.length>0){const a=i[0];return this.attemptedRegions.push(a),Me.debug("next region: ".concat(a.region)),a.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Fe.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Fe.cache=new Map;Fe.settingsTimeouts=new Map;Fe.connectionTrackers=new Map;Fe.fetchLock=new Qt;function N8(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}class gt extends Error{constructor(e,t,i){super(t),this.code=e,this.message=Y0(t,gt.MAX_MESSAGE_BYTES),this.data=i?Y0(i,gt.MAX_DATA_BYTES):void 0}static fromProto(e){return new gt(e.code,e.message,e.data)}toProto(){return new Nk({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new gt(gt.ErrorCode[e],gt.ErrorMessage[e],t)}}gt.MAX_MESSAGE_BYTES=256;gt.MAX_DATA_BYTES=15360;gt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};gt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const qC=15360;function $m(n){return new TextEncoder().encode(n).length}function Y0(n,e){if($m(n)<=e)return n;let t=0,i=n.length;const a=new TextEncoder;for(;t<i;){const o=Math.floor((t+i+1)/2);a.encode(n.slice(0,o)).length<=e?t=o:i=o-1}return n.slice(0,t)}const Km=2e3;function pu(n,e){if(!e)return 0;let t,i;return"bytesReceived"in n?(t=n.bytesReceived,i=e.bytesReceived):"bytesSent"in n&&(t=n.bytesSent,i=e.bytesSent),t===void 0||i===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(t-i)*8*1e3/(n.timestamp-e.timestamp)}const Gm=typeof MediaRecorder<"u";class D8{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const O8=Gm?MediaRecorder:D8;class A8 extends O8{constructor(e,t){if(!Gm)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),t);let i,a;const o=()=>a===void 0,l=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",l),this.removeEventListener("error",u),a?.close(),a=void 0},u=h=>{a?.error(h),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",l),this.removeEventListener("error",u),a=void 0};this.byteStream=new ReadableStream({start:h=>{a=h,i=f=>P(this,void 0,void 0,function*(){let m;if(f.data.arrayBuffer){const v=yield f.data.arrayBuffer();m=new Uint8Array(v)}else if(f.data.byteArray)m=f.data.byteArray;else throw new Error("no data available!");o()||h.enqueue(m)}),this.addEventListener("dataavailable",i)},cancel:()=>{l()}}),this.addEventListener("stop",l),this.addEventListener("error",u)}}function j8(){return Gm}const P8=1e3,L8=1e4;class HC extends ee{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,t,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Vm(()=>P(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>P(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ce.Ended,this)},this.reacquireTrack=!1,this.providedByUser=a,this.muteLock=new Qt,this.pauseUpstreamLock=new Qt,this.trackChangeLock=new Qt,this.trackChangeLock.lock().then(l=>P(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{l()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==ee.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return P(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{Qa(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let a;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ha(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),a=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(a??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{Ha(a??e,o)}))})}waitForDimensions(){return P(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P8;return(function*(){var i;if(e.kind===ee.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=un())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Vt(10));const a=Date.now();for(;Date.now()-a<t;){const o=e.dimensions;if(o)return o;yield Vt(50)}throw new Di("unable to get track dimensions after timeout")})()})}setDeviceId(e){return P(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===gs(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),gs(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return P(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===ee.Source.ScreenShare)return;const{deviceId:i,groupId:a}=e._mediaStreamTrack.getSettings(),o=e.kind===ee.Kind.Audio?"audioinput":"videoinput";return t?jt.getInstance().normalizeDeviceId(o,i,a):i})()})}mute(){return P(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return P(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return P(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Di("unable to replace an unpublished track");let a,o;return typeof t=="boolean"?a=t:t!==void 0&&(a=t.userProvidedTrack,o=t.stopProcessor),this.providedByUser=a??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return P(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:a}=e,o=aB(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const l={audio:!1,video:!1};this.kind===ee.Kind.Video?l.video=i||a?{deviceId:i,facingMode:a}:!0:l.audio=i?Object.assign({deviceId:i},o):!0,this.attachedElements.forEach(f=>{Qa(this.mediaStreamTrack,f)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const h=(yield navigator.mediaDevices.getUserMedia(l)).getTracks()[0];return this.kind===ee.Kind.Video&&(yield h.applyConstraints(o)),h.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(h),this._constraints=e,this.emit(ce.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ce.Muted:ce.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return P(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),LC()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return P(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ce.UpstreamPaused,this);const i=un();if(i?.name==="Safari"&&si(i.version,"12.0")<0)throw new Lm("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return P(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ce.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return P(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return P(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const l=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const u=document.createElement(i.kind),h={kind:i.kind,track:i._mediaStreamTrack,element:u,audioContext:i.audioContext};if(yield t.init(h),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Ha(i._mediaStreamTrack,u),u.muted=!0,u.play().catch(f=>{f instanceof DOMException&&f.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:f})),setTimeout(()=>{u.play().catch(m=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:m}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:f}))}),i.processor=t,i.processorElement=u,i.processor.processedTrack){for(const f of i.attachedElements)f!==i.processorElement&&a&&(Qa(i._mediaStreamTrack,f),Ha(i.processor.processedTrack,f));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(ce.TrackProcessorUpdate,i.processor)}finally{l()}})()})}getProcessor(){return this.processor}stopProcessor(){return P(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{i()}})()})}internalStopProcessor(){return P(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,a;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,t||((a=e.processorElement)===null||a===void 0||a.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(ce.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!j8()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let t="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(t)||(t="video/mp4"),this.localTrackRecorder=new A8(this,{mimeType:t})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},L8)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Kl extends HC{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,ee.Kind.Audio,t,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>P(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(u){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:u}));return}l&&this.prevStats&&(this._currentBitrate=pu(l,this.prevStats)),this.prevStats=l}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ce.AudioTrackFeatureUpdate,this,At.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ce.AudioTrackFeatureUpdate,this,At.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=a,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return P(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ee.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return P(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==gs(this._constraints.deviceId);return this.source===ee.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return P(this,void 0,void 0,function*(){let t;if(e){const i=Um({audio:e});typeof i.audio!="boolean"&&(t=i.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return P(this,void 0,void 0,function*(){const i=yield t.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){ln()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Km)))}setProcessor(e){return P(this,void 0,void 0,function*(){var t;const i=yield this.trackChangeLock.lock();try{if(!ii()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const a={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(a),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ce.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return P(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let i;return t.forEach(a=>{a.type==="outbound-rtp"&&(i={type:"audio",streamId:a.id,packetsSent:a.packetsSent,packetsLost:a.packetsLost,bytesSent:a.bytesSent,timestamp:a.timestamp,roundTripTime:a.roundTripTime,jitter:a.jitter})}),i})}checkForSilence(){return P(this,void 0,void 0,function*(){const e=yield AC(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ce.AudioSilenceDetected)),e})}}function I8(n,e,t){switch(n.kind){case"audio":return new Kl(n,e,!1,void 0,t);case"video":return new Gl(n,e,!1,t);default:throw new Di("unsupported track type: ".concat(n.kind))}}const U8=Object.values(jo),B8=Object.values(Gf),z8=Object.values(Im),F8=[jo.h180,jo.h360],V8=[Gf.h180,Gf.h360],q8=n=>[{scaleResolutionDownBy:2,fps:n.encoding.maxFramerate}].map(t=>{var i,a;return new Ze(Math.floor(n.width/t.scaleResolutionDownBy),Math.floor(n.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((i=n.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((a=t.fps)!==null&&a!==void 0?a:30))))),t.fps,n.encoding.priority)}),nm=["q","h","f"];function im(n,e,t,i){var a,o;let l=i?.videoEncoding;n&&(l=i?.screenShareEncoding);const u=i?.simulcast,h=i?.scalabilityMode,f=i?.videoCodec;if(!l&&!u&&!h||!e||!t)return[{}];l||(l=$8(n,e,t,f),Me.debug("using video encoding",l));const m=l.maxFramerate,v=new Ze(e,t,l.maxBitrate,l.maxFramerate,l.priority);if(h&&$n(f)){const T=new $C(h),S=[];if(T.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(h));const R=un();if(Po()||ii()||R?.name==="Chrome"&&si(R?.version,"113")<0){const _=T.suffix=="h"?2:3,D=zB(R);for(let j=0;j<T.spatial;j+=1)S.push({rid:nm[2-j],maxBitrate:l.maxBitrate/Math.pow(_,j),maxFramerate:v.encoding.maxFramerate,scaleResolutionDownBy:D?Math.pow(2,j):void 0});S[0].scalabilityMode=h}else S.push({maxBitrate:l.maxBitrate,maxFramerate:v.encoding.maxFramerate,scalabilityMode:h});return v.encoding.priority&&(S[0].priority=v.encoding.priority,S[0].networkPriority=v.encoding.priority),Me.debug("using svc encoding",{encodings:S}),S}if(!u)return[l];let b=[];n?b=(a=Q0(i?.screenShareSimulcastLayers))!==null&&a!==void 0?a:J0(n,v):b=(o=Q0(i?.videoSimulcastLayers))!==null&&o!==void 0?o:J0(n,v);let C;if(b.length>0){const T=b[0];b.length>1&&([,C]=b);const S=Math.max(e,t);if(S>=960&&C)return pf(e,t,[T,C,v],m);if(S>=480)return pf(e,t,[T,v],m)}return pf(e,t,[v])}function H8(n,e,t){var i,a,o,l;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&Me.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const u=n.mediaStreamTrack.getSettings(),h=(i=u.width)!==null&&i!==void 0?i:(a=n.dimensions)===null||a===void 0?void 0:a.width,f=(o=u.height)!==null&&o!==void 0?o:(l=n.dimensions)===null||l===void 0?void 0:l.height;return n.source===ee.Source.ScreenShare&&t.simulcast&&(t.simulcast=!1),im(n.source===ee.Source.ScreenShare,h,f,t)}function $8(n,e,t,i){const a=K8(n,e,t);let{encoding:o}=a[0];const l=Math.max(e,t);for(let u=0;u<a.length;u+=1){const h=a[u];if(o=h.encoding,h.width>=l)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function K8(n,e,t){if(n)return z8;const i=e>t?e/t:t/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?U8:B8}function J0(n,e){if(n)return q8(e);const{width:t,height:i}=e,a=t>i?t/i:i/t;return Math.abs(a-16/9)<Math.abs(a-4/3)?F8:V8}function pf(n,e,t,i){const a=[];if(t.forEach((o,l)=>{if(l>=nm.length)return;const u=Math.min(n,e),f={rid:nm[l],scaleResolutionDownBy:Math.max(1,u/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},m=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;m&&(f.maxFramerate=m);const v=Xs()||l===0;o.encoding.priority&&v&&(f.priority=o.encoding.priority,f.networkPriority=o.encoding.priority),a.push(f)}),ii()&&UC()==="ios"){let o;a.forEach(u=>{o?u.maxFramerate&&u.maxFramerate>o&&(o=u.maxFramerate):o=u.maxFramerate});let l=!0;a.forEach(u=>{var h;u.maxFramerate!=o&&(l&&(l=!1,Me.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Me.info('Setting framerate of encoding "'.concat((h=u.rid)!==null&&h!==void 0?h:"",'" to ').concat(o)),u.maxFramerate=o)})}return a}function Q0(n){if(n)return n.sort((e,t)=>{const{encoding:i}=e,{encoding:a}=t;return i.maxBitrate>a.maxBitrate?1:i.maxBitrate<a.maxBitrate?-1:i.maxBitrate===a.maxBitrate&&i.maxFramerate&&a.maxFramerate?i.maxFramerate>a.maxFramerate?1:-1:0})}class $C{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function G8(n){return n.source===ee.Source.ScreenShare||n.constraints.height&&gs(n.constraints.height)>=1080?"maintain-resolution":"balanced"}const Y8=5e3;class Gl extends HC{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0;super(e,ee.Kind.Video,t,i,a),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>P(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(h){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:h}));return}const l=new Map(o.map(h=>[h.rid,h])),u=o.some(h=>h.qualityLimitationReason==="cpu");if(u!==this.isCpuConstrained&&(this.isCpuConstrained=u,this.isCpuConstrained&&this.emit(ce.CpuConstrained)),this.prevStats){let h=0;l.forEach((f,m)=>{var v;const b=(v=this.prevStats)===null||v===void 0?void 0:v.get(m);h+=pu(f,b)}),this._currentBitrate=h}this.prevStats=l}),this.senderLock=new Qt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!ln())return;const i=(t=this.sender)===null||t===void 0?void 0:t.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Km))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return P(this,void 0,void 0,function*(){var t,i,a,o,l;yield e.pauseUpstream.call(this);try{for(var u=!0,h=Ni(this.simulcastCodecs.values()),f;f=yield h.next(),t=f.done,!t;u=!0)o=f.value,u=!1,yield(l=o.sender)===null||l===void 0?void 0:l.replaceTrack(null)}catch(m){i={error:m}}finally{try{!u&&!t&&(a=h.return)&&(yield a.call(h))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return P(this,void 0,void 0,function*(){var t,i,a,o,l;yield e.resumeUpstream.call(this);try{for(var u=!0,h=Ni(this.simulcastCodecs.values()),f;f=yield h.next(),t=f.done,!t;u=!0){o=f.value,u=!1;const m=o;yield(l=m.sender)===null||l===void 0?void 0:l.replaceTrack(m.mediaStreamTrack)}}catch(m){i={error:m}}finally{try{!u&&!t&&(a=h.return)&&(yield a.call(h))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return P(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ee.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return P(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===ee.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return P(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],i=yield this.sender.getStats();return i.forEach(a=>{var o;if(a.type==="outbound-rtp"){const l={type:"video",streamId:a.id,frameHeight:a.frameHeight,frameWidth:a.frameWidth,framesPerSecond:a.framesPerSecond,framesSent:a.framesSent,firCount:a.firCount,pliCount:a.pliCount,nackCount:a.nackCount,packetsSent:a.packetsSent,bytesSent:a.bytesSent,qualityLimitationReason:a.qualityLimitationReason,qualityLimitationDurations:a.qualityLimitationDurations,qualityLimitationResolutionChanges:a.qualityLimitationResolutionChanges,rid:(o=a.rid)!==null&&o!==void 0?o:a.id,retransmittedPacketsSent:a.retransmittedPacketsSent,targetBitrate:a.targetBitrate,timestamp:a.timestamp},u=i.get(a.remoteId);u&&(l.jitter=u.jitter,l.packetsLost=u.packetsLost,l.roundTripTime=u.roundTripTime),t.push(l)}}),t.sort((a,o)=>{var l,u;return((l=o.frameWidth)!==null&&l!==void 0?l:0)-((u=a.frameWidth)!==null&&u!==void 0?u:0)}),t})}setPublishingQuality(e){const t=[];for(let i=kn.LOW;i<=kn.HIGH;i+=1)t.push(new Dm({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers($n(this.codec),t)}restartTrack(e){return P(this,void 0,void 0,function*(){var t,i,a,o,l;let u;if(e){const v=Um({video:e});typeof v.video!="boolean"&&(u=v.video)}yield this.restart(u),this.isCpuConstrained=!1;try{for(var h=!0,f=Ni(this.simulcastCodecs.values()),m;m=yield f.next(),t=m.done,!t;h=!0){o=m.value,h=!1;const v=o;v.sender&&((l=v.sender.transport)===null||l===void 0?void 0:l.state)!=="closed"&&(v.mediaStreamTrack=this.mediaStreamTrack.clone(),yield v.sender.replaceTrack(v.mediaStreamTrack))}}catch(v){i={error:v}}finally{try{!h&&!t&&(a=f.return)&&(yield a.call(f))}finally{if(i)throw i.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return P(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l,u,h,f,m,v;if(yield t.setProcessor.call(a,i,o),!((m=a.processor)===null||m===void 0)&&m.processedTrack)try{for(var b=!0,C=Ni(a.simulcastCodecs.values()),T;T=yield C.next(),l=T.done,!l;b=!0)f=T.value,b=!1,yield(v=f.sender)===null||v===void 0?void 0:v.replaceTrack(a.processor.processedTrack)}catch(S){u={error:S}}finally{try{!b&&!l&&(h=C.return)&&(yield h.call(C))}finally{if(u)throw u.error}}})()})}setDegradationPreference(e){return P(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,t){const i=this.simulcastCodecs.get(e);i&&(i.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},Y8))}setPublishingCodecs(e){return P(this,void 0,void 0,function*(){var t,i,a,o,l,u,h;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers($n(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const f=[];try{for(t=!0,i=Ni(e);a=yield i.next(),o=a.done,!o;t=!0){h=a.value,t=!1;const m=h;if(!this.codec||this.codec===m.codec)yield this.setPublishingLayers($n(m.codec),m.qualities);else{const v=this.simulcastCodecs.get(m.codec);if(this.log.debug("try setPublishingCodec for ".concat(m.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:v})),!v||!v.sender){for(const b of m.qualities)if(b.enabled){f.push(m.codec);break}}else v.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(m.codec),this.logContext),yield X0(v.sender,v.encodings,m.qualities,this.senderLock,$n(m.codec),this.log,this.logContext))}}}catch(m){l={error:m}}finally{try{!t&&!o&&(u=i.return)&&(yield u.call(i))}finally{if(l)throw l.error}}return f})}setPublishingLayers(e,t){return P(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),!(!this.sender||!this.encodings)&&(yield X0(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return P(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const t=this.sender.getParameters();t.encodings=t.encodings.map((i,a)=>{var o;return Object.assign(Object.assign({},i),{active:a===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:a===0&&$n(this.codec)?"L1T3":void 0,maxFramerate:a===0?15:0,maxBitrate:a===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:t.encodings})),this.encodings=t.encodings,yield this.sender.setParameters(t)}catch(t){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:t})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return P(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),LC()&&this.isInBackground&&this.source===ee.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function X0(n,e,t,i,a,o,l){return P(this,void 0,void 0,function*(){const u=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},l),{sender:n,qualities:t,senderEncodings:e}));try{const h=n.getParameters(),{encodings:f}=h;if(!f)return;if(f.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},l),{encodings:f,senderEncodings:e}));return}let m=!1;!1&&f[0].scalabilityMode||(a&&t.some(C=>C.enabled)&&t.forEach(C=>C.enabled=!0),f.forEach((b,C)=>{var T;let S=(T=b.rid)!==null&&T!==void 0?T:"";S===""&&(S="q");const R=KC(S),_=t.find(D=>D.quality===R);_&&b.active!==_.enabled&&(m=!0,b.active=_.enabled,o.debug("setting layer ".concat(_.quality," to ").concat(b.active?"enabled":"disabled"),l),Xs()&&(_.enabled?(b.scaleResolutionDownBy=e[C].scaleResolutionDownBy,b.maxBitrate=e[C].maxBitrate,b.maxFrameRate=e[C].maxFrameRate):(b.scaleResolutionDownBy=4,b.maxBitrate=10,b.maxFrameRate=2)))})),m&&(h.encodings=f,o.debug("setting encodings",Object.assign(Object.assign({},l),{encodings:h.encodings})),yield n.setParameters(h))}finally{u()}})}function KC(n){switch(n){case"f":return kn.HIGH;case"h":return kn.MEDIUM;case"q":return kn.LOW;default:return kn.HIGH}}function W0(n,e,t,i){if(!t)return[new ps({quality:kn.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(i){const a=t[0].scalabilityMode,o=new $C(a),l=[],u=o.suffix=="h"?1.5:2,h=o.suffix=="h"?2:3;for(let f=0;f<o.spatial;f+=1)l.push(new ps({quality:Math.min(kn.HIGH,o.spatial-1)-f,width:Math.ceil(n/Math.pow(u,f)),height:Math.ceil(e/Math.pow(u,f)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(h,f)):0,ssrc:0}));return l}return t.map(a=>{var o,l,u;const h=(o=a.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let f=KC((l=a.rid)!==null&&l!==void 0?l:"");return new ps({quality:f,width:Math.ceil(n/h),height:Math.ceil(e/h),bitrate:(u=a.maxBitrate)!==null&&u!==void 0?u:0,ssrc:0})})}const Z0="_lossy",eS="_reliable",J8=2*1e3,gf="leave-reconnect",Q8=3e4,X8=8*1024,W8=256*1024;var jn;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(jn||(jn={}));class Z8 extends oi.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Hm.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=jn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Me,this.reliableDataSequence=1,this.reliableMessageBuffer=new z0,this.reliableReceivedState=new b8(Q8),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>P(this,[i],void 0,function(a){var o=this;let{channel:l}=a;return(function*(){if(l){if(l.label===eS)o.reliableDCSub=l;else if(l.label===Z0)o.lossyDCSub=l;else return;o.log.debug("on data channel ".concat(l.id,", ").concat(l.label),o.logContext),l.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=i=>P(this,void 0,void 0,function*(){var a,o,l,u,h;const f=yield this.dataProcessLock.lock();try{let m;if(i.data instanceof ArrayBuffer)m=i.data;else if(i.data instanceof Blob)m=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const v=Jt.fromBinary(new Uint8Array(m));if(v.sequence>0&&v.participantSid!==""){const b=this.reliableReceivedState.get(v.participantSid);if(b&&v.sequence<=b)return;this.reliableReceivedState.set(v.participantSid,v.sequence)}if(((a=v.value)===null||a===void 0?void 0:a.case)==="speaker")this.emit(ue.ActiveSpeakersUpdate,v.value.value.speakers);else if(((o=v.value)===null||o===void 0?void 0:o.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const b=yield(l=this.e2eeManager)===null||l===void 0?void 0:l.handleEncryptedData(v.value.value.encryptedValue,v.value.value.iv,v.participantIdentity,v.value.value.keyIndex),C=_k.fromBinary(b.payload),T=new Jt({value:C.value,participantIdentity:v.participantIdentity,participantSid:v.participantSid});((u=T.value)===null||u===void 0?void 0:u.case)==="user"&&tS(T,T.value.value),this.emit(ue.DataPacketReceived,T,v.value.value.encryptionType)}else((h=v.value)===null||h===void 0?void 0:h.case)==="user"&&tS(v,v.value.value),this.emit(ue.DataPacketReceived,v,kt.NONE)}finally{f()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:l}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:l}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?Oe.LOSSY:Oe.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,a)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=h=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(h,"ms. giving up"),this.logContext),this.emit(ue.Disconnected),this.close()},l=Date.now()-this.reconnectStart;let u=this.getNextRetryDelay({elapsedMs:l,retryCount:this.reconnectAttempts});if(u===null){o(l);return}i===gf&&(u=0),this.log.debug("reconnecting in ".concat(u,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ft.setTimeout(()=>this.attemptReconnect(a).finally(()=>this.reconnectTimeout=void 0),u)},this.waitForRestarted=()=>new Promise((i,a)=>{this.pcState===jn.Connected&&i();const o=()=>{this.off(ue.Disconnected,l),i()},l=()=>{this.off(ue.Restarted,o),a()};this.once(ue.Restarted,o),this.once(ue.Disconnected,l)}),this.updateAndEmitDCBufferStatus=i=>{if(i===Oe.RELIABLE){const o=this.dataChannelForKind(i);o&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount)}const a=this.isBufferStatusLow(i);typeof a<"u"&&a!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,a),this.emit(ue.DCBufferStatusChanged,a,i))},this.isBufferStatusLow=i=>{const a=this.dataChannelForKind(i);if(a)return a.bufferedAmount<=a.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>P(this,void 0,void 0,function*(){!this.url||!(yield fetch(Lo(this.url),{method:"HEAD"}).then(a=>a.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===nt.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===nt.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Hs.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>P(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Lo(this.url),{method:"HEAD"}),Vt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=ji((t=e.loggerName)!==null&&t!==void 0?t:Yn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new zm(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Qt,this.dataProcessLock=new Qt,this.dcBufferStatus=new Map([[Oe.LOSSY,!0],[Oe.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(ue.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(ue.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(ue.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(ue.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(ue.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(ue.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(ue.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(ue.SignalRequestResponse,i)}get logContext(){var e,t,i,a,o,l;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomID:(a=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||a===void 0?void 0:a.sid,participant:(l=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||l===void 0?void 0:l.identity,pID:this.participantSid}}join(e,t,i,a){return P(this,arguments,void 0,function(o,l,u,h){var f=this;let m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){f.url=o,f.token=l,f.signalOpts=u,f.maxJoinAttempts=u.maxRetries;try{f.joinAttempts+=1,f.setupSignalClientCallbacks();const v=yield f.client.join(o,l,u,h,m);return f._isClosed=!1,f.latestJoinResponse=v,f.subscriberPrimary=v.subscriberPrimary,f.pcManager||(yield f.configure(v,!m)),(!f.subscriberPrimary||v.fastPublish)&&f.negotiate().catch(b=>{Me.error(b,f.logContext)}),f.registerOnLineListener(),f.clientConfiguration=v.clientConfiguration,f.emit(ue.SignalConnected,v),v}catch(v){if(v instanceof ke){if(v.reason===it.ServerUnreachable){if(f.log.warn("Couldn't connect to server, attempt ".concat(f.joinAttempts," of ").concat(f.maxJoinAttempts),f.logContext),f.joinAttempts<f.maxJoinAttempts)return f.join(o,l,u,h,m)}else if(v.reason===it.ServiceNotFound)return f.log.warn("Initial connection failed: ".concat(v.message,"  Retrying")),f.join(o,l,u,h,!0)}throw v}})()})}close(){return P(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(ue.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return P(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new z0,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return P(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Di("a track with the same ID has already been published");return new Promise((t,i)=>{const a=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(ke.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(a),t(o)},reject:()=>{clearTimeout(a),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return P(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e,t){return P(this,void 0,void 0,function*(){var i,a;if(this.pcManager&&this.pcManager.currentState!==ft.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const o=this.makeRTCConfiguration(e);this.pcManager=new w8(o,t?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(ue.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(l,u)=>{this.client.sendIceCandidate(l,u)},this.pcManager.onPublisherOffer=(l,u)=>{this.client.sendOffer(l,u)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(l,u,h)=>P(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(l),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),l===ft.CONNECTED){const v=this.pcState===jn.New;this.pcState=jn.Connected,v&&this.emit(ue.Connected,e)}else l===ft.FAILED&&(this.pcState===jn.Connected||this.pcState===jn.Reconnecting)&&(this.pcState=jn.Disconnected,this.handleDisconnect("peerconnection failed",h==="failed"?Hs.RR_SUBSCRIBER_FAILED:Hs.RR_PUBLISHER_FAILED));const f=this.client.isDisconnected||this.client.currentState===nt.RECONNECTING,m=[ft.FAILED,ft.CLOSING,ft.CLOSED].includes(l);f&&m&&!this._isClosed&&this.emit(ue.Offline)}),this.pcManager.onTrack=l=>{l.streams.length!==0&&this.emit(ue.MediaTrackAdded,l.track,l.streams[0],l.receiver)},ez((a=e.serverInfo)===null||a===void 0?void 0:a.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t,i)=>P(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t,i)=>P(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;this.midToTrackId=i;const a=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);a&&this.client.sendAnswer(a,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(ue.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(ue.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var t;this.token=e,(t=this.regionUrlProvider)===null||t===void 0||t.updateToken(e)},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(ue.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(ue.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(ue.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var t,i;const a={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)(t=this.pcManager)===null||t===void 0||t.addPublisherTransceiverOfKind("audio",a);for(let o=0;o<e.numVideos;o++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",a);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Hs.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:VC,regionSettings:e.regions})),e.action){case Ga.DISCONNECT:this.emit(ue.Disconnected,e?.reason),this.close();break;case Ga.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(gf);break;case Ga.RESUME:this.handleDisconnect(gf)}}}makeRTCConfiguration(e){var t;const i=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const a=[];e.iceServers.forEach(o=>{const l={urls:o.urls};o.username&&(l.username=o.username),o.credential&&(l.credential=o.credential),a.push(l)}),i.iceServers=a}return e.clientConfiguration&&e.clientConfiguration.forceRelay===No.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Z0,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(eS,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(Oe.LOSSY);if(e){const t=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(t,X8),W8)}},1e3))}createSender(e,t,i){return P(this,void 0,void 0,function*(){if(Qf())return yield this.createTransceiverRTCRtpSender(e,t,i);if(Xf())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new bt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,i,a){return P(this,void 0,void 0,function*(){if(Qf())return this.createSimulcastTransceiverSender(e,t,i,a);if(Xf())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new bt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,i){return P(this,void 0,void 0,function*(){if(!this.pcManager)throw new bt("publisher is closed");const a=[];e.mediaStream&&a.push(e.mediaStream),Ts(e)&&(e.codec=t.videoCodec);const o={direction:"sendonly",streams:a};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,t,i,a){return P(this,void 0,void 0,function*(){if(!this.pcManager)throw new bt("publisher is closed");const o={direction:"sendonly"};a&&(o.sendEncodings=a);const l=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,l.sender),l.sender})}createRTCRtpSender(e){return P(this,void 0,void 0,function*(){if(!this.pcManager)throw new bt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return P(this,void 0,void 0,function*(){var t,i,a;if(!this._isClosed){if(this.attemptingReconnect){Me.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===No.DISABLED||((a=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&a!==void 0?a:ft.NEW)===ft.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let l=!0;o instanceof bt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),l=!1):o instanceof Va||(this.fullReconnectOnNext=!0),l?this.handleDisconnect("reconnect",Hs.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(ue.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return P(this,void 0,void 0,function*(){var t,i,a;try{if(!this.url||!this.token)throw new bt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(ue.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Va;o=yield this.join(e??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(l){throw l instanceof ke&&l.reason===it.NotAllowed?new bt("could not reconnect, token might be expired"):new Va}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(ue.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==nt.CONNECTED)throw new Va("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(ue.Restarted)}catch(o){const l=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(l){yield this.restartConnection(l);return}else throw(a=this.regionUrlProvider)===null||a===void 0||a.resetAttempts(),o}})}resumeConnection(e){return P(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new bt("could not reconnect, url or token not saved");if(!this.pcManager)throw new bt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(ue.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(a){let o="";throw a instanceof Error&&(o=a.message,this.log.error(a.message,Object.assign(Object.assign({},this.logContext),{error:a}))),a instanceof ke&&a.reason===it.NotAllowed?new bt("could not reconnect, token might be expired"):a instanceof ke&&a.reason===it.LeaveRequest?a:new Va(o)}if(this.emit(ue.SignalResumed),i){const a=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(a),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==nt.CONNECTED)throw new Va("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(ue.Resumed)})}waitForPCInitialConnection(e,t){return P(this,void 0,void 0,function*(){if(!this.pcManager)throw new bt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return P(this,void 0,void 0,function*(){this.pcState=jn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Vt(J8),!this.pcManager)throw new bt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=jn.Connected}catch(e){throw this.pcState=jn.Disconnected,ke.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,t,i,a){return P(this,void 0,void 0,function*(){const o=new Jt({destinationIdentities:[e],kind:Oe.RELIABLE,value:{case:"rpcResponse",value:new _m({requestId:t,value:a?{case:"error",value:a.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,Oe.RELIABLE)})}publishRpcAck(e,t){return P(this,void 0,void 0,function*(){const i=new Jt({destinationIdentities:[e],kind:Oe.RELIABLE,value:{case:"rpcAck",value:new Rm({requestId:t})}});yield this.sendDataPacket(i,Oe.RELIABLE)})}sendDataPacket(e,t){return P(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(t),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const o=c8(e);if(o){const l=yield this.e2eeManager.encryptData(o.toBinary());e.value={case:"encryptedPacket",value:new Rk({encryptedValue:l.payload,iv:l.iv,keyIndex:l.keyIndex})}}}t===Oe.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),a=this.dataChannelForKind(t);if(a){if(t===Oe.RELIABLE)yield this.waitForBufferStatusLow(t),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(t)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;a.send(i)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return P(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Oe.RELIABLE);const t=this.dataChannelForKind(Oe.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{t.send(i.data)})),this.updateAndEmitDCBufferStatus(Oe.RELIABLE)})}waitForBufferStatusLow(e){return new $t((t,i)=>P(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const a=()=>i(new bt("engine closed"));for(this.once(ue.Closing,a);!this.dcBufferStatus.get(e);)yield Vt(10);this.off(ue.Closing,a),t()}}))}ensureDataTransportConnected(e){return P(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!i.pcManager)throw new bt("PC manager is closed");const l=a?i.pcManager.subscriber:i.pcManager.publisher,u=a?"Subscriber":"Publisher";if(!l)throw ke.internal("".concat(u," connection not set"));let h=!1;!a&&!i.dataChannelForKind(t,a)&&(i.createDataChannels(),h=!0),!h&&!a&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(h=!0),h&&i.negotiate().catch(v=>{Me.error(v,i.logContext)});const f=i.dataChannelForKind(t,a);if(f?.readyState==="open")return;const m=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<m;){if(l.isICEConnected&&((o=i.dataChannelForKind(t,a))===null||o===void 0?void 0:o.readyState)==="open")return;yield Vt(50)}throw ke.internal("could not establish ".concat(u," connection, state: ").concat(l.getICEConnectionState()))})()})}ensurePublisherConnected(e){return P(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ft.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return P(this,void 0,void 0,function*(){return new $t((e,t)=>P(this,void 0,void 0,function*(){if(!this.pcManager){t(new Ja("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,a=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t(new Ja("cannot negotiate on closed engine")),this.on(ue.Closing,a),this.pcManager.publisher.once(Za.RTPVideoPayloadTypes,o=>{const l=new Map;o.forEach(u=>{const h=u.codec.toLowerCase();$B(h)&&l.set(u.payload,h)}),this.emit(ue.RTPVideoMapUpdate,l)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof Ja&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Hs.RR_UNKNOWN),o instanceof Error?t(o):t(new Error(String(o)))}finally{this.off(ue.Closing,a)}}))})}dataChannelForKind(e,t){if(t){if(e===Oe.LOSSY)return this.lossyDCSub;if(e===Oe.RELIABLE)return this.reliableDCSub}else{if(e===Oe.LOSSY)return this.lossyDC;if(e===Oe.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var i,a,o,l;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const u=this.pcManager.publisher.getLocalDescription(),h=this.pcManager.publisher.getRemoteDescription(),f=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),m=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getLocalDescription(),v=(l=(o=this.signalOpts)===null||o===void 0?void 0:o.autoSubscribe)!==null&&l!==void 0?l:!0,b=new Array,C=new Array;e.forEach(T=>{T.isDesired!==v&&b.push(T.trackSid),T.isEnabled||C.push(T.trackSid)}),this.client.sendSyncState(new Om({answer:this.pcManager.mode==="publisher-only"?h?$a({sdp:h.sdp,type:h.type}):void 0:m?$a({sdp:m.sdp,type:m.type}):void 0,offer:this.pcManager.mode==="publisher-only"?u?$a({sdp:u.sdp,type:u.type}):void 0:f?$a({sdp:f.sdp,type:f.type}):void 0,subscription:new hu({trackSids:b,subscribe:!v,participantTracks:[]}),publishTracks:wB(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:C,datachannelReceiveStates:this.reliableReceivedState.map((T,S)=>new Jk({publisherSid:S,lastSeq:T}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(i,a)=>{i?.id!==void 0&&i.id!==null&&e.push(new Qk({label:i.label,id:i.id,target:a}))};return t(this.dataChannelForKind(Oe.LOSSY),Hn.PUBLISHER),t(this.dataChannelForKind(Oe.RELIABLE),Hn.PUBLISHER),t(this.dataChannelForKind(Oe.LOSSY,!0),Hn.SUBSCRIBER),t(this.dataChannelForKind(Oe.RELIABLE,!0),Hn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ft.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ln()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){ln()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var t;const i=(t=this.pcManager)===null||t===void 0?void 0:t.getMidForReceiver(e);if(i){const a=Object.entries(this.midToTrackId).find(o=>{let[l]=o;return l===i});if(a)return a[1]}}}function ez(n){return n!==void 0&&n>13}function tS(n,e){const t=n.participantIdentity?n.participantIdentity:e.participantIdentity;n.participantIdentity=t,e.participantIdentity=t;const i=n.destinationIdentities.length!==0?n.destinationIdentities:e.destinationIdentities;n.destinationIdentities=i,e.destinationIdentities=i}class GC{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Pn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Yt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Pn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Yt.LengthExceeded)}}constructor(e,t,i,a){this.reader=t,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=a}}class tz extends GC{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new In,i=null,a=null;if(this.signal){const l=this.signal;a=()=>{var u;(u=t.reject)===null||u===void 0||u.call(t,l.reason)},l.addEventListener("abort",a),i=l}const o=()=>{e.releaseLock(),i&&a&&i.removeEventListener("abort",a),this.signal=void 0};return{next:()=>P(this,void 0,void 0,function*(){var l,u;try{const{done:h,value:f}=yield Promise.race([e.read(),t.promise,(u=(l=this.outOfBandFailureRejectingFuture)===null||l===void 0?void 0:l.promise)!==null&&u!==void 0?u:new Promise(()=>{})]);return h?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(f),{done:!1,value:f.content})}catch(h){throw o(),h}}),return(){return P(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return P(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,a,o,l;let u=new Set;const h=t.signal?e.withAbortSignal(t.signal):e;try{for(var f=!0,m=Ni(h),v;v=yield m.next(),i=v.done,!i;f=!0){l=v.value,f=!1;const b=l;u.add(b)}}catch(b){a={error:b}}finally{try{!f&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(a)throw a.error}}return Array.from(u)})()})}}class nz extends GC{constructor(e,t,i,a){super(e,t,i,a),this.receivedChunks=new Map}handleChunkReceived(e){var t;const i=Ol(e.chunkIndex),a=this.receivedChunks.get(i);if(a&&a.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let i=new In,a=null,o=null;if(this.signal){const u=this.signal;o=()=>{var h;(h=i.reject)===null||h===void 0||h.call(i,u.reason)},u.addEventListener("abort",o),a=u}const l=()=>{e.releaseLock(),a&&o&&a.removeEventListener("abort",o),this.signal=void 0};return{next:()=>P(this,void 0,void 0,function*(){var u,h;try{const{done:f,value:m}=yield Promise.race([e.read(),i.promise,(h=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&h!==void 0?h:new Promise(()=>{})]);if(f)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(m);let v;try{v=t.decode(m.content)}catch(b){throw new Pn("Cannot decode datastream chunk ".concat(m.chunkIndex," as text: ").concat(b),Yt.DecodeFailed)}return{done:!1,value:v}}}catch(f){throw l(),f}}),return(){return P(this,void 0,void 0,function*(){return l(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return P(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,a,o,l;let u="";const h=t.signal?e.withAbortSignal(t.signal):e;try{for(var f=!0,m=Ni(h),v;v=yield m.next(),i=v.done,!i;f=!0)l=v.value,f=!1,u+=l}catch(b){a={error:b}}finally{try{!f&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(a)throw a.error}}return u})()})}}class iz{constructor(){this.log=Me,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new Pn('A text stream handler for topic "'.concat(e,'" has already been set.'),Yt.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new Pn('A byte stream handler for topic "'.concat(e,'" has already been set.'),Yt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,i,a,o;const l=Array.from(this.textStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e),u=Array.from(this.byteStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e);if(l.length>0||u.length>0){const h=new Pn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Yt.AbnormalEnd);for(const[f,m]of u)(i=(t=m.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(t,h),this.byteStreamControllers.delete(f);for(const[f,m]of l)(o=(a=m.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(a,h),this.textStreamControllers.delete(f)}}handleDataStreamPacket(e,t){return P(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,t);case"streamChunk":return this.handleStreamChunk(e.value.value,t);case"streamTrailer":return this.handleStreamTrailer(e.value.value,t);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,t,i){return P(this,void 0,void 0,function*(){var a;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let l;const u=new In;u.promise.catch(m=>{this.log.error(m)});const h={id:e.streamId,name:(a=e.contentHeader.value.name)!==null&&a!==void 0?a:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Ol(e.timestamp),attributes:e.attributes,encryptionType:i},f=new ReadableStream({start:m=>{if(l=m,this.textStreamControllers.has(e.streamId))throw new Pn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Yt.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:h,controller:l,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:u})}});o(new tz(h,f,Ol(e.totalLength),u),{identity:t})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let l;const u=new In;u.promise.catch(m=>{this.log.error(m)});const h={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i,attachedStreamIds:e.contentHeader.value.attachedStreamIds},f=new ReadableStream({start:m=>{if(l=m,this.textStreamControllers.has(e.streamId))throw new Pn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Yt.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:h,controller:l,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:u})}});o(new nz(h,f,Ol(e.totalLength),u),{identity:t})}})}handleStreamChunk(e,t){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?(i.controller.error(new Pn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),Yt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const a=this.textStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==t?(a.controller.error(new Pn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(a.info.encryptionType),Yt.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&a.controller.enqueue(e))}handleStreamTrailer(e,t){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?i.controller.error(new Pn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),Yt.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const a=this.byteStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==t?a.controller.error(new Pn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(a.info.encryptionType),Yt.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),e.attributes),a.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class YC{constructor(e,t,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return P(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class sz extends YC{}class az extends YC{}const nS=15e3;class rz{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return P(this,void 0,void 0,function*(){var i;const a=crypto.randomUUID(),l=new TextEncoder().encode(e).byteLength,u=(i=t?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),h=new Array(u?u.length+1:1).fill(0),f=(v,b)=>{var C;h[b]=v;const T=h.reduce((S,R)=>S+R,0);(C=t?.onProgress)===null||C===void 0||C.call(t,T)},m=yield this.streamText({streamId:a,totalSize:l,destinationIdentities:t?.destinationIdentities,topic:t?.topic,attachedStreamIds:u,attributes:t?.attributes});return yield m.write(e),f(1,0),yield m.close(),t?.attachments&&u&&(yield Promise.all(t.attachments.map((v,b)=>P(this,void 0,void 0,function*(){return this._sendFile(u[b],v,{topic:t.topic,mimeType:v.type,onProgress:C=>{f(C,b+1)}})})))),m.info})}streamText(e){return P(this,void 0,void 0,function*(){var t,i,a;const o=(t=e?.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),l={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e?.topic)!==null&&i!==void 0?i:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?kt.GCM:kt.NONE,attachedStreamIds:e?.attachedStreamIds},u=new ql({streamId:o,mimeType:l.mimeType,topic:l.topic,timestamp:$s(l.timestamp),totalLength:$s(e?.totalSize),attributes:l.attributes,contentHeader:{case:"textHeader",value:new Uk({version:e?.version,attachedStreamIds:l.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?Pf.UPDATE:Pf.CREATE})}}),h=e?.destinationIdentities,f=new Jt({destinationIdentities:h,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(f,Oe.RELIABLE);let m=0;const v=this.engine,b=new WritableStream({write(S){return P(this,void 0,void 0,function*(){for(const R of XB(S,nS)){const _=new Hl({content:R,streamId:o,chunkIndex:$s(m)}),D=new Jt({destinationIdentities:h,value:{case:"streamChunk",value:_}});yield v.sendDataPacket(D,Oe.RELIABLE),m+=1}})},close(){return P(this,void 0,void 0,function*(){const S=new $l({streamId:o}),R=new Jt({destinationIdentities:h,value:{case:"streamTrailer",value:S}});yield v.sendDataPacket(R,Oe.RELIABLE)})},abort(S){console.log("Sink error:",S)}});let C=()=>P(this,void 0,void 0,function*(){yield T.close()});v.once(ue.Closing,C);const T=new sz(b,l,()=>this.engine.off(ue.Closing,C));return T})}sendFile(e,t){return P(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,t),{id:i}})}_sendFile(e,t,i){return P(this,void 0,void 0,function*(){var a;const o=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:(a=i?.mimeType)!==null&&a!==void 0?a:t.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),l=t.stream().getReader();for(;;){const{done:u,value:h}=yield l.read();if(u)break;yield o.write(h)}return yield o.close(),o.info})}streamBytes(e){return P(this,void 0,void 0,function*(){var t,i,a,o,l,u;const h=(t=e?.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),f=e?.destinationIdentities,m={id:h,mimeType:(i=e?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(a=e?.topic)!==null&&a!==void 0?a:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(o=e?.name)!==null&&o!==void 0?o:"unknown",encryptionType:!((l=this.engine.e2eeManager)===null||l===void 0)&&l.isDataChannelEncryptionEnabled?kt.GCM:kt.NONE},v=new ql({totalLength:$s((u=m.size)!==null&&u!==void 0?u:0),mimeType:m.mimeType,streamId:h,topic:m.topic,timestamp:$s(Date.now()),attributes:m.attributes,contentHeader:{case:"byteHeader",value:new Bk({name:m.name})}}),b=new Jt({destinationIdentities:f,value:{case:"streamHeader",value:v}});yield this.engine.sendDataPacket(b,Oe.RELIABLE);let C=0;const T=new Qt,S=this.engine,R=this.log,_=new WritableStream({write(j){return P(this,void 0,void 0,function*(){const x=yield T.lock();let w=0;try{for(;w<j.byteLength;){const M=j.slice(w,w+nS),I=new Jt({destinationIdentities:f,value:{case:"streamChunk",value:new Hl({content:M,streamId:h,chunkIndex:$s(C)})}});yield S.sendDataPacket(I,Oe.RELIABLE),C+=1,w+=M.byteLength}}finally{x()}})},close(){return P(this,void 0,void 0,function*(){const j=new $l({streamId:h}),x=new Jt({destinationIdentities:f,value:{case:"streamTrailer",value:j}});yield S.sendDataPacket(x,Oe.RELIABLE)})},abort(j){R.error("Sink error:",j)}});return new az(_,m)})}}class JC extends ee{constructor(e,t,i,a,o){super(e,i,o),this.sid=t,this.receiver=a}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ce.Muted:ce.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ce.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return P(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Km)),MB()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(t=this.receiver)===null||t===void 0?void 0:t.getSynchronizationSources()[0];if(i){const{timestamp:a,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(ce.TimeSyncUpdate,{timestamp:a,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class QC extends JC{constructor(e,t,i,a,o,l){super(e,t,ee.Kind.Audio,i,l),this.monitorReceiver=()=>P(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=pu(u,this.prevStats)),this.prevStats=u}),this.audioContext=a,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var t;for(const i of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):i.volume=e;ii()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ii())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return P(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(Wf(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Wf(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(a=>{i.connect(a),i=a}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(ce.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(a=>{this.emit(ce.AudioPlaybackFailed,a)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return P(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(i=>{i.type==="inbound-rtp"&&(t={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),t})}}const vf=100;class oz extends JC{constructor(e,t,i,a,o){super(e,t,ee.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>P(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=pu(l,this.prevStats)),this.prevStats=l}),this.debouncedHandleResize=Vm(()=>{this.updateDimensions()},vf),this.adaptiveStreamSettings=a}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===ee.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?Qa(this._mediaStreamTrack,t):Ha(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new cz(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(i=>i===e);for(const i of t)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const i of t)this.stopObservingElement(i);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return P(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,i="",a=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,t={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&a.set(o.id,o)}),t&&i!==""&&a.get(i)&&(t.mimeType=a.get(i).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(i=>i.element===e);for(const i of t)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return P(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var t,i;const a=this.elementInfos.reduce((h,f)=>Math.max(h,f.visibilityChangedAt||0),0),o=!((i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,l=this.elementInfos.some(h=>h.pictureInPicture),u=this.elementInfos.some(h=>h.visible)&&!o||l;if(!(this.lastVisible===u&&!e)){if(!u&&Date.now()-a<vf){Ft.setTimeout(()=>{this.updateVisibility()},vf);return}this.lastVisible=u,this.emit(ce.VisibilityChanged,u,this)}}updateDimensions(){var e,t;let i=0,a=0;const o=this.getPixelDensity();for(const l of this.elementInfos){const u=l.width()*o,h=l.height()*o;u+h>i+a&&(i=u,a=h)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===a||(this.lastDimensions={width:i,height:a},this.emit(ce.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?N0():t||(N0()>2?2:1)}}class cz{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=i=>{var a;const{target:o,isIntersecting:l}=i;o===this.element&&(this.isIntersecting=l,this.isPiP=fo(this.element),this.visibilityChangedAt=Date.now(),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this))},this.onEnterPiP=()=>{var i,a,o;(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP),this.isPiP=fo(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=fo(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=t??sm(e),this.isPiP=ln()&&fo(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,i;this.isIntersecting=sm(this.element),this.isPiP=fo(this.element),this.element.handleResize=()=>{var a;(a=this.handleResize)===null||a===void 0||a.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,O0().observe(this.element),D0().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,i,a,o;(e=O0())===null||e===void 0||e.unobserve(this.element),(t=D0())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function fo(n){var e,t;return document.pictureInPictureElement===n?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?sm(n,(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window):!1}function sm(n,e){const t=e||window;let i=n.offsetTop,a=n.offsetLeft;const o=n.offsetWidth,l=n.offsetHeight,{hidden:u}=n,{display:h}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,i+=n.offsetTop,a+=n.offsetLeft;return i<t.pageYOffset+t.innerHeight&&a<t.pageXOffset+t.innerWidth&&i+l>t.pageYOffset&&a+o>t.pageXOffset&&!u&&h!=="none"}class _i extends oi.EventEmitter{constructor(e,t,i,a){var o;super(),this.metadataMuted=!1,this.encryption=kt.NONE,this.log=Me,this.handleMuted=()=>{this.emit(ce.Muted)},this.handleUnmuted=()=>{this.emit(ce.Unmuted)},this.log=ji((o=a?.loggerName)!==null&&o!==void 0?o:Yn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=i,this.source=ee.Source.Unknown}setTrack(e){this.track&&(this.track.off(ce.Muted,this.handleMuted),this.track.off(ce.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ce.Muted,this.handleMuted),e.on(ce.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Pe(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==kt.NONE}get audioTrack(){if(ni(this.track))return this.track}get videoTrack(){if(Ts(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=ee.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===ee.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(n.PermissionStatus||(n.PermissionStatus={}))})(_i||(_i={}));class am extends _i{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,i,a){super(e,t.sid,t.name,a),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ce.Ended)},this.handleCpuConstrained=()=>{this.track&&Ts(this.track)&&this.emit(ce.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(ce.Ended,this.handleTrackEnded),this.track.off(ce.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(ce.Ended,this.handleTrackEnded),e.on(ce.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return P(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return P(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return P(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return P(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ni(this.track)){const t=this.track.getSourceTrackSettings(),i=new Set;return t.autoGainControl&&i.add(At.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&i.add(At.TF_ECHO_CANCELLATION),t.noiseSuppression&&i.add(At.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&i.add(At.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(At.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(At.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function gu(n,e){return P(this,void 0,void 0,function*(){n??(n={});let t=!1;const{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:o}=PC(n);let l=o.audio,u=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),a&&typeof o.video=="object"&&(o.video.processor=a),n.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const v=o.audio.deviceId;o.audio.deviceId={exact:v},t=!0,l=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:v}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const v=o.video.deviceId;o.video.deviceId={exact:v},t=!0,u=Object.assign(Object.assign({},o.video),{deviceId:{ideal:v}})}o.audio===!0?o.audio={deviceId:"default"}:typeof o.audio=="object"&&o.audio!==null&&(o.audio=Object.assign(Object.assign({},o.audio),{deviceId:o.audio.deviceId||"default"})),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const h=OC(o,zC,FC),f=Um(h),m=navigator.mediaDevices.getUserMedia(f);o.audio&&(jt.userMediaPromiseMap.set("audioinput",m),m.catch(()=>jt.userMediaPromiseMap.delete("audioinput"))),o.video&&(jt.userMediaPromiseMap.set("videoinput",m),m.catch(()=>jt.userMediaPromiseMap.delete("videoinput")));try{const v=yield m;return yield Promise.all(v.getTracks().map(b=>P(this,void 0,void 0,function*(){const C=b.kind==="audio";let T=C?h.audio:h.video;(typeof T=="boolean"||!T)&&(T={});let S;const R=C?f.audio:f.video;typeof R!="boolean"&&(S=R);const _=b.getSettings().deviceId;S?.deviceId&&gs(S.deviceId)!==_?S.deviceId=_:S||(S={deviceId:_});const D=I8(b,S,e);return D.kind===ee.Kind.Video?D.source=ee.Source.Camera:D.kind===ee.Kind.Audio&&(D.source=ee.Source.Microphone),D.mediaStream=v,ni(D)&&i?yield D.setProcessor(i):Ts(D)&&a&&(yield D.setProcessor(a)),D})))}catch(v){if(!t)throw v;return gu(Object.assign(Object.assign({},n),{audio:l,video:u}),e)}})}function lz(n){return P(this,void 0,void 0,function*(){return(yield gu({audio:!1,video:!0}))[0]})}function uz(n){return P(this,void 0,void 0,function*(){return(yield gu({audio:!0,video:!1}))[0]})}var fs;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Lost="lost",n.Unknown="unknown"})(fs||(fs={}));function dz(n){switch(n){case yo.EXCELLENT:return fs.Excellent;case yo.GOOD:return fs.Good;case yo.POOR:return fs.Poor;case yo.LOST:return fs.Lost;default:return fs.Unknown}}class XC extends oi.EventEmitter{get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Do.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Ka.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,i,a,o,l){let u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Do.STANDARD;var h;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=fs.Unknown,this.log=Me,this.log=ji((h=l?.loggerName)!==null&&h!==void 0?h:Yn.Participant),this.loggerOptions=l,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=i,this.metadata=a,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=u,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new In,this.once(ie.Active,()=>{var e,t;(t=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||t===void 0||t.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(ee.Source.Camera);return!(!((e=t?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(ee.Source.Microphone);return!(!((e=t?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(ee.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var t;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Ka.ACTIVE&&((t=this.participantInfo)===null||t===void 0?void 0:t.state)!==Ka.ACTIVE&&this.emit(ie.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,i=this.metadata;this.metadata=e,t&&this.emit(ie.ParticipantMetadataChanged,i)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ie.ParticipantNameChanged,e)}_setAttributes(e){const t=NB(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(ie.AttributesChanged,t)}setPermissions(e){var t,i,a,o,l,u;const h=this.permissions,f=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((a=this.permissions)===null||a===void 0?void 0:a.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((l=this.permissions)===null||l===void 0?void 0:l.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((m,v)=>{var b;return m!==((b=this.permissions)===null||b===void 0?void 0:b.canPublishSources[v])})||e.canSubscribeMetrics!==((u=this.permissions)===null||u===void 0?void 0:u.canSubscribeMetrics);return this.permissions=e,f&&this.emit(ie.ParticipantPermissionsChanged,h),f}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ie.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=dz(e),t!==this._connectionQuality&&this.emit(ie.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&((t=(e=this.activeFuture).reject)===null||t===void 0||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>ni(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(ce.Muted,()=>{this.emit(ie.TrackMuted,e)}),e.on(ce.Unmuted,()=>{this.emit(ie.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case ee.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case ee.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function hz(n){var e,t,i;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Gk({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=n.participantSid)!==null&&t!==void 0?t:"",allTracks:(i=n.allowAll)!==null&&i!==void 0?i:!1,trackSids:n.allowedTrackSids||[]})}class fz extends XC{constructor(e,t,i,a,o,l){super(e,t,void 0,void 0,void 0,{loggerName:a.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=kt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new In)},this.handleReconnected=()=>{var u,h;(h=(u=this.reconnectFuture)===null||u===void 0?void 0:u.resolve)===null||h===void 0||h.call(u),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var u,h,f,m,v,b;this.reconnectFuture&&(this.reconnectFuture.promise.catch(C=>this.log.warn(C.message,this.logContext)),(h=(u=this.reconnectFuture)===null||u===void 0?void 0:u.reject)===null||h===void 0||h.call(u,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((m=(f=this.signalConnectedFuture).reject)===null||m===void 0||m.call(f,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(b=(v=this.activeAgentFuture)===null||v===void 0?void 0:v.reject)===null||b===void 0||b.call(v,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=u=>{var h,f;u.participant&&this.updateInfo(u.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new In),(f=(h=this.signalConnectedFuture).resolve)===null||f===void 0||f.call(h)},this.handleSignalRequestResponse=u=>{const{requestId:h,reason:f,message:m}=u,v=this.pendingSignalRequests.get(h);v&&(f!==Am.OK&&v.reject(new x0(m,f)),this.pendingSignalRequests.delete(h))},this.handleDataPacket=u=>{switch(u.value.case){case"rpcResponse":let h=u.value.value,f=null,m=null;h.value.case==="payload"?f=h.value.value:h.value.case==="error"&&(m=gt.fromProto(h.value.value)),this.handleIncomingRpcResponse(h.requestId,f,m);break;case"rpcAck":let v=u.value.value;this.handleIncomingRpcAck(v.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(u=>hz(u)))},this.onTrackUnmuted=u=>{this.onTrackMuted(u,u.isUpstreamPaused)},this.onTrackMuted=(u,h)=>{if(h===void 0&&(h=!0),!u.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Pe(u)));return}this.engine.updateMuteStatus(u.sid,h)},this.onTrackUpstreamPaused=u=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Pe(u))),this.onTrackMuted(u,!0)},this.onTrackUpstreamResumed=u=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Pe(u))),this.onTrackMuted(u,u.isMuted)},this.onTrackFeatureUpdate=u=>{const h=this.audioTrackPublications.get(u.sid);if(!h){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(u.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(h.trackSid,h.getTrackFeatures())},this.onTrackCpuConstrained=(u,h)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Pe(h))),this.emit(ie.LocalTrackCpuConstrained,u,h)},this.handleSubscribedQualityUpdate=u=>P(this,void 0,void 0,function*(){var h,f,m,v,b;if(!(!((b=this.roomOptions)===null||b===void 0)&&b.dynacast))return;const C=this.videoTrackPublications.get(u.trackSid);if(!C){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}if(!C.videoTrack)return;const T=yield C.videoTrack.setPublishingCodecs(u.subscribedCodecs);try{for(var S=!0,R=Ni(T),_;_=yield R.next(),h=_.done,!h;S=!0){v=_.value,S=!1;const D=v;xB(D)&&(this.log.debug("publish ".concat(D," for ").concat(C.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Pe(C))),yield this.publishAdditionalCodecForTrack(C.videoTrack,D,C.options))}}catch(D){f={error:D}}finally{try{!S&&!h&&(m=R.return)&&(yield m.call(R))}finally{if(f)throw f.error}}}),this.handleLocalTrackUnpublished=u=>{const h=this.trackPublications.get(u.trackSid);if(!h){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}this.unpublishTrack(h.track)},this.handleTrackEnded=u=>P(this,void 0,void 0,function*(){if(u.source===ee.Source.ScreenShare||u.source===ee.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Pe(u))),this.unpublishTrack(u);else if(u.isUserProvided)yield u.mute();else if(Ri(u)||ds(u))try{if(ln())try{const h=yield navigator?.permissions.query({name:u.source===ee.Source.Camera?"camera":"microphone"});if(h&&h.state==="denied")throw this.log.warn("user has revoked access to ".concat(u.source),Object.assign(Object.assign({},this.logContext),Pe(u))),h.onchange=()=>{h.state!=="denied"&&(u.isMuted||u.restartTrack(),h.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}u.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Pe(u))),Ri(u)?yield u.restartTrack({deviceId:"default"}):yield u.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Pe(u))),yield u.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=a,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=l}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==kt.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(ue.RemoteMute,(i,a)=>{const o=this.trackPublications.get(i);!o||!o.track||(a?o.mute():o.unmute())}),!((t=this.signalConnectedFuture)===null||t===void 0)&&t.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(ue.Connected,this.handleReconnected).on(ue.SignalConnected,this.handleSignalConnected).on(ue.SignalRestarted,this.handleReconnected).on(ue.SignalResumed,this.handleReconnected).on(ue.Restarting,this.handleReconnecting).on(ue.Resuming,this.handleReconnecting).on(ue.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(ue.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(ue.Closing,this.handleClosing).on(ue.SignalRequestResponse,this.handleSignalRequestResponse).on(ue.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return P(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return P(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return P(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return P(this,arguments,void 0,function(t){var i=this;let{metadata:a,name:o,attributes:l}=t;return(function*(){return new $t((u,h)=>P(i,void 0,void 0,function*(){var f,m;try{let v=!1;const b=yield this.engine.client.sendUpdateLocalMetadata((f=a??this.metadata)!==null&&f!==void 0?f:"",(m=o??this.name)!==null&&m!==void 0?m:"",l),C=performance.now();for(this.pendingSignalRequests.set(b,{resolve:u,reject:T=>{h(T),v=!0},values:{name:o,metadata:a,attributes:l}});performance.now()-C<5e3&&!v;){if((!o||this.name===o)&&(!a||this.metadata===a)&&(!l||Object.entries(l).every(T=>{let[S,R]=T;return this.attributes[S]===R||R===""&&!this.attributes[S]}))){this.pendingSignalRequests.delete(b),u();return}yield Vt(50)}h(new x0("Request to update local metadata timed out","TimeoutError"))}catch(v){v instanceof Error?h(v):h(new Error(String(v)))}}))})()})}setCameraEnabled(e,t,i){return this.setTrackEnabled(ee.Source.Camera,e,t,i)}setMicrophoneEnabled(e,t,i){return this.setTrackEnabled(ee.Source.Microphone,e,t,i)}setScreenShareEnabled(e,t,i){return this.setTrackEnabled(ee.Source.ScreenShare,e,t,i)}setE2EEEnabled(e){return P(this,void 0,void 0,function*(){this.encryptionType=e?kt.GCM:kt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,i,a){return P(this,void 0,void 0,function*(){var o,l;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let u=this.getTrackPublication(e);if(t)if(u)yield u.unmute();else{let h;if(this.pendingPublishing.has(e)){const f=yield this.waitForPendingPublicationOfSource(e);return f||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield f?.unmute(),f}this.pendingPublishing.add(e);try{switch(e){case ee.Source.Camera:h=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case ee.Source.Microphone:h=yield this.createTracks({audio:(l=i)!==null&&l!==void 0?l:!0});break;case ee.Source.ScreenShare:h=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Di(e)}}catch(f){throw h?.forEach(m=>{m.stop()}),f instanceof Error&&this.emit(ie.MediaDevicesError,f,Jf(e)),this.pendingPublishing.delete(e),f}for(const f of h){const m=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===ee.Source.Microphone&&ni(f)&&m.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),f.startPreConnectBuffer())}try{const f=[];for(const v of h)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Pe(v))),f.push(this.publishTrack(v,a));[u]=yield Promise.all(f)}catch(f){throw h?.forEach(m=>{m.stop()}),f}finally{this.pendingPublishing.delete(e)}}else if(!u?.track&&this.pendingPublishing.has(e)&&(u=yield this.waitForPendingPublicationOfSource(e),u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),u&&u.track)if(e===ee.Source.ScreenShare){u=yield this.unpublishTrack(u.track);const h=this.getTrackPublication(ee.Source.ScreenShareAudio);h&&h.track&&this.unpublishTrack(h.track)}else yield u.mute();return u})}enableCameraAndMicrophone(){return P(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(ee.Source.Camera)||this.pendingPublishing.has(ee.Source.Microphone))){this.pendingPublishing.add(ee.Source.Camera),this.pendingPublishing.add(ee.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(ee.Source.Camera),this.pendingPublishing.delete(ee.Source.Microphone)}}})}createTracks(e){return P(this,void 0,void 0,function*(){var t,i;e??(e={});const a=OC(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield gu(a,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(u=>(ni(u)&&(this.microphoneError=void 0,u.setAudioContext(this.audioContext),u.source=ee.Source.Microphone,this.emit(ie.AudioStreamAcquired)),Ts(u)&&(this.cameraError=void 0,u.source=ee.Source.Camera),u))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return P(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Lm("getDisplayMedia not supported");e.resolution===void 0&&!BB()&&(e.resolution=Im.h1080fps30.resolution);const t=_B(e),i=yield navigator.mediaDevices.getDisplayMedia(t),a=i.getVideoTracks();if(a.length===0)throw new Di("no video track found");const o=new Gl(a[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=ee.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const l=[o];if(i.getAudioTracks().length>0){this.emit(ie.AudioStreamAcquired);const u=new Kl(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});u.source=ee.Source.ScreenShareAudio,l.push(u)}return l})}publishTrack(e,t){return P(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return P(this,arguments,void 0,function(i,a){var o=this;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var u,h,f,m;Ri(i)&&i.setAudioContext(o.audioContext),yield(u=o.reconnectFuture)===null||u===void 0?void 0:u.promise,o.republishPromise&&!l&&(yield o.republishPromise),Xa(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let v;if(i instanceof MediaStreamTrack)v=i.getConstraints();else{v=i.constraints;let _;switch(i.source){case ee.Source.Microphone:_="audioinput";break;case ee.Source.Camera:_="videoinput"}_&&o.activeDeviceMap.has(_)&&(v=Object.assign(Object.assign({},v),{deviceId:o.activeDeviceMap.get(_)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Kl(i,v,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new Gl(i,v,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new Di("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let b;if(o.trackPublications.forEach(_=>{_.track&&_.track===i&&(b=_)}),b)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),Pe(b))),b;const C=Object.assign(Object.assign({},o.roomOptions.publishDefaults),a),T="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,S=(h=C.forceStereo)!==null&&h!==void 0?h:T;S&&(C.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),Pe(i))),C.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(f=C.dtx)!==null&&f!==void 0||(C.dtx=!1),(m=C.red)!==null&&m!==void 0||(C.red=!1)),!FB()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),C.simulcast=!1),C.source&&(i.source=C.source);const R=new Promise((_,D)=>P(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==nt.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Pe(i)}));let j=!1;const x=setTimeout(()=>{j=!0,i.stop(),D(new E0("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(x),j)return;const w=yield this.publish(i,C,S);_(w)}else try{const j=yield this.publish(i,C,S);_(j)}catch(j){D(j)}}catch(j){D(j)}}));o.pendingPublishPromises.set(i,R);try{return yield R}catch(_){throw _}finally{o.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new In),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Pe(e))),!1;const{canPublish:t,canPublishSources:i}=this.permissions;return t&&(i.length===0||i.map(a=>DB(a)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Pe(e))),!1)}publish(e,t,i){return P(this,void 0,void 0,function*(){var a,o,l,u,h,f,m,v,b,C;if(!this.hasPermissionsToPublish(e))throw new E0("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(L=>Xa(e)&&L.source===e.source)&&e.source!==ee.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Pe(e))),t.stopMicTrackOnMute&&ni(e)&&(e.stopOnMute=!0),e.source===ee.Source.ScreenShare&&Xs()&&(t.simulcast=!1),t.videoCodec==="av1"&&!LB()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!IB()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=tm),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(L=>t.videoCodec===xo(L.mime))||(t.videoCodec=xo(this.enabledPublishVideoCodecs[0].mime)));const S=t.videoCodec;e.on(ce.Muted,this.onTrackMuted),e.on(ce.Unmuted,this.onTrackUnmuted),e.on(ce.Ended,this.handleTrackEnded),e.on(ce.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ce.UpstreamResumed,this.onTrackUpstreamResumed),e.on(ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const R=[],_=!(!((a=t.dtx)!==null&&a!==void 0)||a),D=e.getSourceTrackSettings();D.autoGainControl&&R.push(At.TF_AUTO_GAIN_CONTROL),D.echoCancellation&&R.push(At.TF_ECHO_CANCELLATION),D.noiseSuppression&&R.push(At.TF_NOISE_SUPPRESSION),D.channelCount&&D.channelCount>1&&R.push(At.TF_STEREO),_&&R.push(At.TF_NO_DTX),Ri(e)&&e.hasPreConnectBuffer&&R.push(At.TF_PRECONNECT_BUFFER);const j=new Oo({cid:e.mediaStreamTrack.id,name:t.name,type:ee.kindToProto(e.kind),muted:e.isMuted,source:ee.sourceToProto(e.source),disableDtx:_,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=t.red)!==null&&o!==void 0)||o),stream:t?.stream,backupCodecPolicy:t?.backupCodecPolicy,audioFeatures:R});let x;if(e.kind===ee.Kind.Video){let L={width:0,height:0};try{L=yield e.waitForDimensions()}catch{const O=(u=(l=this.roomOptions.videoCaptureDefaults)===null||l===void 0?void 0:l.resolution)!==null&&u!==void 0?u:jo.h720.resolution;L={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(e)),{dims:L}))}j.width=L.width,j.height=L.height,ds(e)&&($n(S)&&(e.source===ee.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Pe(e))))),t.scalabilityMode=(h=t.scalabilityMode)!==null&&h!==void 0?h:"L3T3_KEY"),j.simulcastCodecs=[new If({codec:S,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:tm}),t.backupCodec&&S!==t.backupCodec.codec&&j.encryption===kt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),j.simulcastCodecs.push(new If({codec:t.backupCodec.codec,cid:""})))),x=im(e.source===ee.Source.ScreenShare,j.width,j.height,t),j.layers=W0(j.width,j.height,x,$n(t.videoCodec))}else e.kind===ee.Kind.Audio&&(x=[{maxBitrate:(f=t.audioPreset)===null||f===void 0?void 0:f.maxBitrate,priority:(v=(m=t.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&v!==void 0?v:"high",networkPriority:(C=(b=t.audioPreset)===null||b===void 0?void 0:b.priority)!==null&&C!==void 0?C:"high"}]);if(!this.engine||this.engine.isClosed)throw new bt("cannot publish track when not connected");const w=()=>P(this,void 0,void 0,function*(){var L,A,O;if(!this.engine.pcManager)throw new bt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,x),this.emit(ie.LocalSenderCreated,e.sender,e),ds(e)&&((L=t.degradationPreference)!==null&&L!==void 0||(t.degradationPreference=G8(e)),e.setDegradationPreference(t.degradationPreference)),x)if(Xs()&&e.kind===ee.Kind.Audio){let Y;for(const J of this.engine.pcManager.publisher.getTransceivers())if(J.sender===e.sender){Y=J;break}Y&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:Y,codec:"opus",maxbr:!((A=x[0])===null||A===void 0)&&A.maxBitrate?x[0].maxBitrate/1e3:0})}else e.codec&&$n(e.codec)&&(!((O=x[0])===null||O===void 0)&&O.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:j.cid,codec:e.codec,maxbr:x[0].maxBitrate/1e3});yield this.engine.negotiate()});let M;const I=new Promise((L,A)=>P(this,void 0,void 0,function*(){var O;try{M=yield this.engine.addTrack(j),L(M)}catch(Y){e.sender&&(!((O=this.engine.pcManager)===null||O===void 0)&&O.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(J=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(e)),{error:J}))})),A(Y)}}));if(this.enabledPublishVideoCodecs.length>0)M=(yield Promise.all([I,w()]))[0];else{M=yield I;let L;if(M.codecs.forEach(A=>{L===void 0&&(L=A.mimeType)}),L&&e.kind===ee.Kind.Video){const A=xo(L);A!==S&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(e)),{codec:A})),t.videoCodec=A,x=im(e.source===ee.Source.ScreenShare,j.width,j.height,t))}yield w()}const F=new am(e.kind,M,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(F.on(ce.CpuConstrained,L=>this.onTrackCpuConstrained(L,F)),F.options=t,e.sid=M.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:x,trackInfo:M})),ds(e)?e.startMonitor(this.engine.client):Ri(e)&&e.startMonitor(),this.addTrackPublication(F),this.emit(ie.LocalTrackPublished,F),Ri(e)&&M.audioFeatures.includes(At.TF_PRECONNECT_BUFFER)){const L=e.getPreConnectBuffer(),A=e.getPreConnectBufferMimeType();this.on(ie.LocalTrackSubscribed,O=>{if(O.trackSid===M.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Pe(e))),e.stopPreConnectBuffer()}}),L&&new Promise((Y,J)=>P(this,void 0,void 0,function*(){var le,Te,H,ae,de,Ee;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Pe(e)));const oe=setTimeout(()=>{J(new Error("agent not active within 10 seconds"))},1e4),he=yield this.waitUntilActiveAgentPresent();clearTimeout(oe),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Pe(e)));const Ce=yield this.streamBytes({name:"preconnect-buffer",mimeType:A,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[he.identity],attributes:{trackId:F.trackSid,sampleRate:String((de=D.sampleRate)!==null&&de!==void 0?de:"48000"),channels:String((Ee=D.channelCount)!==null&&Ee!==void 0?Ee:"1")}});try{for(var De=!0,B=Ni(L),W;W=yield B.next(),le=W.done,!le;De=!0){ae=W.value,De=!1;const re=ae;yield Ce.write(re)}}catch(re){Te={error:re}}finally{try{!De&&!le&&(H=B.return)&&(yield H.call(B))}finally{if(Te)throw Te.error}}yield Ce.close(),Y()}catch(oe){J(oe)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Pe(e)))}).catch(Y=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(e)),{error:Y}))})}return F})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,i){return P(this,void 0,void 0,function*(){var a;if(this.encryptionType!==kt.NONE)return;let o;if(this.trackPublications.forEach(C=>{C.track&&C.track===e&&(o=C)}),!o)throw new Di("track is not published");if(!ds(e))throw new Di("track is not a video track");const l=Object.assign(Object.assign({},(a=this.roomOptions)===null||a===void 0?void 0:a.publishDefaults),i),u=H8(e,t,l);if(!u){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Pe(e)));return}const h=e.addSimulcastTrack(t,u);if(!h)return;const f=new Oo({cid:h.mediaStreamTrack.id,type:ee.kindToProto(e.kind),muted:e.isMuted,source:ee.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:l.videoCodec,cid:h.mediaStreamTrack.id}]});if(f.layers=W0(f.width,f.height,u),!this.engine||this.engine.isClosed)throw new bt("cannot publish track when not connected");const m=()=>P(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,h,l,u),yield this.engine.negotiate()}),b=(yield Promise.all([this.engine.addTrack(f),m()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:u,trackInfo:b}))})}unpublishTrack(e,t){return P(this,void 0,void 0,function*(){var i,a;if(Xa(e)){const f=this.pendingPublishPromises.get(e);f&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Pe(e))),yield f)}const o=this.getPublicationForTrack(e),l=o?Pe(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),l)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),l));return}e=o.track,e.off(ce.Muted,this.onTrackMuted),e.off(ce.Unmuted,this.onTrackUnmuted),e.off(ce.Ended,this.handleTrackEnded),e.off(ce.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ce.UpstreamResumed,this.onTrackUpstreamResumed),e.off(ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),t===void 0&&(t=(a=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&a!==void 0?a:!0),t?e.stop():e.stopMonitor();let u=!1;const h=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ft.FAILED&&h)try{for(const f of this.engine.pcManager.publisher.getTransceivers())f.sender===h&&(f.direction="inactive",u=!0);if(this.engine.removeTrack(h)&&(u=!0),ds(e)){for(const[,f]of e.simulcastCodecs)f.sender&&(this.engine.removeTrack(f.sender)&&(u=!0),f.sender=void 0);e.simulcastCodecs.clear()}}catch(f){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),l),{error:f}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case ee.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case ee.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(ie.LocalTrackUnpublished,o),o.setTrack(void 0),u&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return P(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return P(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new $t((o,l)=>P(i,void 0,void 0,function*(){try{const u=[];this.trackPublications.forEach(h=>{h.track&&(t&&(h.options=Object.assign(Object.assign({},h.options),t)),u.push(h))}),yield Promise.all(u.map(h=>P(this,void 0,void 0,function*(){const f=h.track;yield this.unpublishTrack(f,!1),a&&!f.isMuted&&f.source!==ee.Source.ScreenShare&&f.source!==ee.Source.ScreenShareAudio&&(Ri(f)||ds(f))&&!f.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:h.trackSid})),yield f.restartTrack()),yield this.publishOrRepublishTrack(f,h.options,!0)}))),o()}catch(u){u instanceof Error?l(u):l(new Error(String(u)))}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return P(this,arguments,void 0,function(t){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=a.reliable?Oe.RELIABLE:Oe.LOSSY,l=a.destinationIdentities,u=a.topic;let h=new Em({participantIdentity:i.identity,payload:t,destinationIdentities:l,topic:u});const f=new Jt({kind:o,value:{case:"user",value:h}});yield i.engine.sendDataPacket(f,o)})()})}publishDtmf(e,t){return P(this,void 0,void 0,function*(){const i=new Jt({kind:Oe.RELIABLE,value:{case:"sipDtmf",value:new Mk({code:e,digit:t})}});yield this.engine.sendDataPacket(i,Oe.RELIABLE)})}sendChatMessage(e,t){return P(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:t?.attachments},a=new Jt({value:{case:"chatMessage",value:new Vl(Object.assign(Object.assign({},i),{timestamp:ct.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(a,Oe.RELIABLE),this.emit(ie.ChatMessage,i),i})}editChatMessage(e,t){return P(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),a=new Jt({value:{case:"chatMessage",value:new Vl(Object.assign(Object.assign({},i),{timestamp:ct.parse(i.timestamp),editTimestamp:ct.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(a,Oe.RELIABLE),this.emit(ie.ChatMessage,i),i})}sendText(e,t){return P(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)})}streamText(e){return P(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,t){return P(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)})}streamBytes(e){return P(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){let{destinationIdentity:t,method:i,payload:a,responseTimeout:o=15e3}=e;const l=7e3,u=l+1e3;return new $t((h,f)=>P(this,void 0,void 0,function*(){var m,v,b,C;if($m(a)>qC){f(gt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((v=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||v===void 0)&&v.version&&si((C=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||C===void 0?void 0:C.version,"1.8.0")<0){f(gt.builtIn("UNSUPPORTED_SERVER"));return}const T=Math.max(o,u),S=crypto.randomUUID();yield this.publishRpcRequest(t,S,i,a,T);const R=setTimeout(()=>{this.pendingAcks.delete(S),f(gt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(S),clearTimeout(_)},l);this.pendingAcks.set(S,{resolve:()=>{clearTimeout(R)},participantIdentity:t});const _=setTimeout(()=>{this.pendingResponses.delete(S),f(gt.builtIn("RESPONSE_TIMEOUT"))},o);this.pendingResponses.set(S,{resolve:(D,j)=>{clearTimeout(_),this.pendingAcks.has(S)&&(this.log.warn("RPC response received before ack",S),this.pendingAcks.delete(S),clearTimeout(R)),j?f(j):h(D??"")},participantIdentity:t})}))}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,i){const a=this.pendingResponses.get(e);a?(a.resolve(t,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,i,a,o){return P(this,void 0,void 0,function*(){const l=new Jt({destinationIdentities:[e],kind:Oe.RELIABLE,value:{case:"rpcRequest",value:new xm({id:t,method:i,payload:a,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(l,Oe.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:i,resolve:a}]of this.pendingResponses)i===e&&(a(null,gt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(t=>t.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(t=>{var i,a;const o=this.trackPublications.get(t.sid);if(o){const l=o.isMuted||((a=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&a!==void 0?a:!1);l!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(o)),{mutedOnServer:l})),this.engine.client.sendMuteTrack(t.sid,l))}}),!0):!1}setActiveAgent(e){var t,i,a,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(t=this.activeAgentFuture)===null||t===void 0?void 0:t.resolve)===null||i===void 0||i.call(t,e):(o=(a=this.activeAgentFuture)===null||a===void 0?void 0:a.reject)===null||o===void 0||o.call(a,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new In),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(i=>{const a=i.track;a&&(e instanceof MediaStreamTrack?(Ri(a)||ds(a))&&a.mediaStreamTrack===e&&(t=i):e===a&&(t=i))}),t}waitForPendingPublicationOfSource(e){return P(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const a=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[l]=o;return l.source===e});if(a)return a[1];yield Vt(20)}})}}class Yl extends _i{constructor(e,t,i,a){super(e,t.sid,t.name,a),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(ce.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const a=new hu({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Dk({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ce.UpdateSubscription,a),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?_i.SubscriptionStatus.Unsubscribed:super.isSubscribed?_i.SubscriptionStatus.Subscribed:_i.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?_i.PermissionStatus.Allowed:_i.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,i;this.isManualOperationAllowed()&&(((t=this.requestedVideoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(uf(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&uf(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:kn.HIGH}setTrack(e){const t=this.subscriptionStatus,i=this.permissionStatus,a=this.track;a!==e&&(a&&(a.off(ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),a.off(ce.VisibilityChanged,this.handleVisibilityChange),a.off(ce.Ended,this.handleEnded),a.detach(),a.stopMonitor(),this.emit(ce.Unsubscribed,a)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ce.VisibilityChanged,this.handleVisibilityChange),e.on(ce.Ended,this.handleEnded),this.emit(ce.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(ce.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?ce.Muted:ce.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(ce.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ce.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return uf(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new qk({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===ee.Kind.Video){let t=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(t)_0(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=OB(this.trackInfo,this.requestedMaxQuality);i&&_0(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:kn.HIGH})),e.quality=kn.HIGH)}this.emit(ce.UpdateSettings,e)}}class Jl extends XC{static fromParticipantInfo(e,t,i){return new Jl(e,t.sid,t.identity,t.name,t.metadata,t.attributes,i,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,i,a,o,l,u){let h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Do.STANDARD;super(t,i||"",a,o,l,u,h),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ce.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(ce.UpdateSubscription,t=>{t.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(ce.SubscriptionPermissionChanged,t=>{this.emit(ie.TrackSubscriptionPermissionChanged,e,t)}),e.on(ce.SubscriptionStatusChanged,t=>{this.emit(ie.TrackSubscriptionStatusChanged,e,t)}),e.on(ce.Subscribed,t=>{this.emit(ie.TrackSubscribed,t,e)}),e.on(ce.Unsubscribed,t=>{this.emit(ie.TrackUnsubscribed,t,e)}),e.on(ce.SubscriptionFailed,t=>{this.emit(ie.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ee.Source.Microphone;this.volumeMap.set(t,e);const i=this.getTrackPublication(t);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ee.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,i,a,o,l){let u=this.getTrackPublicationBySid(t);if(u||t.startsWith("TR")||this.trackPublications.forEach(m=>{!u&&e.kind===m.kind.toString()&&(u=m)}),!u){if(l===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(ie.TrackSubscriptionFailed,t);return}l===void 0&&(l=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,i,a,o,l-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Pe(u))),this.emit(ie.TrackSubscriptionFailed,t);return}const h=e.kind==="video";let f;return h?f=new oz(e,t,a,o):f=new QC(e,t,a,this.audioContext,this.audioOutput),f.source=u.source,f.isMuted=u.isMuted,f.setMediaStream(i),f.start(),u.setTrack(f),this.volumeMap.has(u.source)&&Zf(f)&&ni(f)&&f.setVolume(this.volumeMap.get(u.source)),u}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,i=new Map;return e.tracks.forEach(a=>{var o,l;let u=this.getTrackPublicationBySid(a.sid);if(u)u.updateInfo(a);else{const h=ee.kindFromProto(a.type);if(!h)return;u=new Yl(h,a,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(l=this.loggerOptions)===null||l===void 0?void 0:l.loggerName}),u.updateInfo(a),i.set(a.sid,u);const f=Array.from(this.trackPublications.values()).find(m=>m.source===u?.source);f&&u.source!==ee.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(u.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Pe(f),newTrack:Pe(u)})),this.addTrackPublication(u)}t.set(a.sid,u)}),this.trackPublications.forEach(a=>{t.has(a.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Pe(a))),this.unpublishTrack(a.trackSid,!0))}),i.forEach(a=>{this.emit(ie.TrackPublished,a)}),!0}unpublishTrack(e,t){const i=this.trackPublications.get(e);if(!i)return;const{track:a}=i;switch(a&&(a.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case ee.Kind.Audio:this.audioTrackPublications.delete(e);break;case ee.Kind.Video:this.videoTrackPublications.delete(e);break}t&&this.emit(ie.TrackUnpublished,i)}setAudioOutput(e){return P(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(i=>{var a;ni(i.track)&&Zf(i.track)&&t.push(i.track.setSinkId((a=e.deviceId)!==null&&a!==void 0?a:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Be;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting"})(Be||(Be={}));const mz=4*1e3;class ir extends oi.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var t,i,a,o,l;if(super(),t=this,this.state=Be.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Me,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(u,h,f)=>P(this,void 0,void 0,function*(){var m;if(!UB())throw ii()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const v=yield this.disconnectLock.lock();if(this.state===Be.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),v(),Promise.resolve();if(this.connectFuture)return v(),this.connectFuture.promise;this.setAndEmitConnectionState(Be.Connecting),((m=this.regionUrlProvider)===null||m===void 0?void 0:m.getServerUrl().toString())!==BC(u)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),nr(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Fe(u,h):this.regionUrlProvider.updateToken(h),this.regionUrlProvider.fetchRegionSettings().then(T=>{var S;(S=this.regionUrlProvider)===null||S===void 0||S.setServerReportedRegions(T)}).catch(T=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:T}))}));const b=(T,S,R)=>P(this,void 0,void 0,function*(){var _,D;this.abortController&&this.abortController.abort();const j=new AbortController;this.abortController=j,v?.();try{if(yield Wa.getInstance().getBackOffPromise(u),j.signal.aborted)throw ke.cancelled("Connection attempt aborted");yield this.attemptConnection(R??u,h,f,j),this.abortController=void 0,T()}catch(x){if(this.regionUrlProvider&&x instanceof ke&&x.reason!==it.Cancelled&&x.reason!==it.NotAllowed){let w=null;try{this.log.debug("Fetching next region"),w=yield this.regionUrlProvider.getNextBestRegionUrl((_=this.abortController)===null||_===void 0?void 0:_.signal)}catch(M){if(M instanceof ke&&(M.status===401||M.reason===it.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),S(M);return}}[it.InternalError,it.ServerUnreachable,it.Timeout].includes(x.reason)&&(this.log.debug("Adding failed connection attempt to back off"),Wa.getInstance().addFailedConnectionAttempt(u)),w&&!(!((D=this.abortController)===null||D===void 0)&&D.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(x.message,". Retrying with another region: ").concat(w),this.logContext),this.recreateEngine(),yield b(T,S,w)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,j0(x)),S(x))}else{let w=Ln.UNKNOWN_REASON;x instanceof ke&&(w=j0(x)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,w),S(x)}}}),C=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new In((T,S)=>{b(T,S,C)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,h,f,m,v,b)=>P(this,void 0,void 0,function*(){var C,T,S;const R=yield f.join(u,h,{autoSubscribe:m.autoSubscribe,adaptiveStream:typeof v.adaptiveStream=="object"?!0:v.adaptiveStream,maxRetries:m.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:m.websocketTimeout},b.signal,!v.singlePeerConnection);let _=R.serverInfo;if(_||(_={version:R.serverVersion,region:R.serverRegion}),this.serverInfo=_,this.log.debug("connected to Livekit Server ".concat(Object.entries(_).map(D=>{let[j,x]=D;return"".concat(j,": ").concat(x)}).join(", ")),{room:(C=R.room)===null||C===void 0?void 0:C.name,roomSid:(T=R.room)===null||T===void 0?void 0:T.sid,identity:(S=R.participant)===null||S===void 0?void 0:S.identity}),!_.version)throw new SB("unknown server version");return _.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),v.dynacast=!1),R}),this.applyJoinResponse=u=>{const h=u.participant;if(this.localParticipant.sid=h.sid,this.localParticipant.identity=h.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(f){this.log.error(f instanceof Error?f.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:f}))}this.handleParticipantUpdates([h,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,h,f,m)=>P(this,void 0,void 0,function*(){var v,b;this.state===Be.Reconnecting||this.isResuming||!((v=this.engine)===null||v===void 0)&&v.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((b=this.regionUrlProvider)===null||b===void 0)&&b.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Hm),f),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const C=yield this.connectSignal(u,h,this.engine,this.connOptions,this.options,m);this.applyJoinResponse(C),this.setupLocalParticipantEvents(),this.emit(X.SignalConnected)}catch(C){yield this.engine.close(),this.recreateEngine();const T=m.signal.aborted?ke.cancelled("Signal connection aborted"):ke.serverUnreachable("could not establish signal connection");throw C instanceof Error&&(T.message="".concat(T.message,": ").concat(C.message)),C instanceof ke&&(T.reason=C.reason,T.status=C.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:C})),T}if(m.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),ke.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,m)}catch(C){throw yield this.engine.close(),this.recreateEngine(),C}ln()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ln()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Be.Connected),this.emit(X.Connected),Wa.getInstance().resetFailedConnectionAttempts(u),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];return P(t,[...h],void 0,function(){var m=this;let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var b,C,T;const S=yield m.disconnectLock.lock();try{if(m.state===Be.Disconnected){m.log.debug("already disconnected",m.logContext);return}if(m.log.info("disconnect from room",Object.assign({},m.logContext)),m.state===Be.Connecting||m.state===Be.Reconnecting||m.isResuming){const R="Abort connection attempt due to user initiated disconnect";m.log.warn(R,m.logContext),(b=m.abortController)===null||b===void 0||b.abort(R),(T=(C=m.connectFuture)===null||C===void 0?void 0:C.reject)===null||T===void 0||T.call(C,ke.cancelled("Client initiated disconnect")),m.connectFuture=void 0}m.engine&&(m.engine.client.isDisconnected||(yield m.engine.client.sendLeave()),yield m.engine.close()),m.handleDisconnect(v,Ln.CLIENT_INITIATED),m.engine=void 0}finally{S()}})()})},this.onPageLeave=()=>P(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>P(this,void 0,void 0,function*(){const u=[],h=un();if(h&&h.os==="iOS"){const f="livekit-dummy-audio-el";let m=document.getElementById(f);if(!m){m=document.createElement("audio"),m.id=f,m.autoplay=!0,m.hidden=!0;const v=lf();v.enabled=!0;const b=new MediaStream([v]);m.srcObject=b,document.addEventListener("visibilitychange",()=>{m&&(m.srcObject=document.hidden?null:b,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(m),this.once(X.Disconnected,()=>{m?.remove(),m=null})}u.push(m)}this.remoteParticipants.forEach(f=>{f.audioTrackPublications.forEach(m=>{m.track&&m.track.attachedElements.forEach(v=>{u.push(v)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(f=>(f.muted=!1,f.play()))]),this.handleAudioPlaybackStarted()}catch(f){throw this.handleAudioPlaybackFailed(f),f}}),this.startVideo=()=>P(this,void 0,void 0,function*(){const u=[];for(const h of this.remoteParticipants.values())h.videoTrackPublications.forEach(f=>{var m;(m=f.track)===null||m===void 0||m.attachedElements.forEach(v=>{u.includes(v)||u.push(v)})});yield Promise.all(u.map(h=>h.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(h=>{h.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(Be.Reconnecting)&&this.emit(X.Reconnecting)},this.handleSignalRestarted=u=>P(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(h){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:h}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(Be.Connected),this.emit(X.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(h=>{var f;if(h.identity===this.localParticipant.identity){this.localParticipant.updateInfo(h);return}h.identity===""&&(h.identity=(f=this.sidToIdentity.get(h.sid))!==null&&f!==void 0?f:"");let m=this.remoteParticipants.get(h.identity);h.state===Ka.DISCONNECTED?this.handleParticipantDisconnected(h.identity,m):m=this.getOrCreateParticipant(h.identity,h)})},this.handleActiveSpeakersUpdate=u=>{const h=[],f={};u.forEach(m=>{if(f[m.sid]=!0,m.sid===this.localParticipant.sid)this.localParticipant.audioLevel=m.level,this.localParticipant.setIsSpeaking(!0),h.push(this.localParticipant);else{const v=this.getRemoteParticipantBySid(m.sid);v&&(v.audioLevel=m.level,v.setIsSpeaking(!0),h.push(v))}}),f[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(m=>{f[m.sid]||(m.audioLevel=0,m.setIsSpeaking(!1))}),this.activeSpeakers=h,this.emitWhenConnected(X.ActiveSpeakersChanged,h)},this.handleSpeakersChanged=u=>{const h=new Map;this.activeSpeakers.forEach(m=>{const v=this.remoteParticipants.get(m.identity);v&&v.sid!==m.sid||h.set(m.sid,m)}),u.forEach(m=>{let v=this.getRemoteParticipantBySid(m.sid);m.sid===this.localParticipant.sid&&(v=this.localParticipant),v&&(v.audioLevel=m.level,v.setIsSpeaking(m.active),m.active?h.set(m.sid,v):h.delete(m.sid))});const f=Array.from(h.values());f.sort((m,v)=>v.audioLevel-m.audioLevel),this.activeSpeakers=f,this.emitWhenConnected(X.ActiveSpeakersChanged,f)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(h=>{const f=this.getRemoteParticipantBySid(h.participantSid);if(!f)return;const m=f.getTrackPublicationBySid(h.trackSid);if(!m||!m.track)return;const v=ee.streamStateFromProto(h.state);m.track.setStreamState(v),v!==m.track.streamState&&(f.emit(ie.TrackStreamStateChanged,m,m.track.streamState),this.emitWhenConnected(X.TrackStreamStateChanged,m,m.track.streamState,f))})},this.handleSubscriptionPermissionUpdate=u=>{const h=this.getRemoteParticipantBySid(u.participantSid);if(!h)return;const f=h.getTrackPublicationBySid(u.trackSid);f&&f.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const h=Array.from(this.remoteParticipants.values()).find(m=>m.trackPublications.has(u.trackSid));if(!h)return;const f=h.getTrackPublicationBySid(u.trackSid);f&&f.setSubscriptionError(u.err)},this.handleDataPacket=(u,h)=>{const f=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(f,u.value.value,u.kind,h);else if(u.value.case==="transcription")this.handleTranscription(f,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(f,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(f,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,f);else if(u.value.case==="streamHeader"||u.value.case==="streamChunk"||u.value.case==="streamTrailer")this.handleDataStream(u,h);else if(u.value.case==="rpcRequest"){const m=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,m.id,m.method,m.payload,m.responseTimeoutMs,m.version)}},this.handleUserPacket=(u,h,f,m)=>{this.emit(X.DataReceived,h.payload,u,f,h.topic,m),u?.emit(ie.DataReceived,h.payload,f,m)},this.handleSipDtmf=(u,h)=>{this.emit(X.SipDTMFReceived,h,u),u?.emit(ie.SipDTMFReceived,h)},this.handleTranscription=(u,h)=>{const f=h.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(h.transcribedParticipantIdentity),m=f?.trackPublications.get(h.trackId),v=GB(h,this.transcriptionReceivedTimes);m?.emit(ce.TranscriptionReceived,v),f?.emit(ie.TranscriptionReceived,v,m),this.emit(X.TranscriptionReceived,v,f,m)},this.handleChatMessage=(u,h)=>{const f=YB(h);this.emit(X.ChatMessage,f,u)},this.handleMetrics=(u,h)=>{this.emit(X.MetricsReceived,u,h)},this.handleDataStream=(u,h)=>{this.incomingDataStreamManager.handleDataStreamPacket(u,h)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(X.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(X.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(X.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(X.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>P(this,void 0,void 0,function*(){var u;((u=un())===null||u===void 0?void 0:u.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(X.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const h=this.roomInfo;this.roomInfo=u,h&&h.metadata!==u.metadata&&this.emitWhenConnected(X.RoomMetadataChanged,u.metadata),h?.activeRecording!==u.activeRecording&&this.emitWhenConnected(X.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(h=>{if(h.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(h.quality);return}const f=this.getRemoteParticipantBySid(h.participantSid);f&&f.setConnectionQuality(h.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(X.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(X.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(X.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(X.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(X.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var h;(h=u?.onPublish)===null||h===void 0||h.call(u,this)},this.onLocalTrackPublished=u=>P(this,void 0,void 0,function*(){var h,f,m,v,b,C;(h=u.track)===null||h===void 0||h.on(ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(f=u.track)===null||f===void 0||f.on(ce.Restarted,this.onLocalTrackRestarted),(b=(v=(m=u.track)===null||m===void 0?void 0:m.getProcessor())===null||v===void 0?void 0:v.onPublish)===null||b===void 0||b.call(v,this),this.emit(X.LocalTrackPublished,u,this.localParticipant),Ri(u.track)&&(yield u.track.checkForSilence())&&this.emit(X.LocalAudioSilenceDetected,u);const T=yield(C=u.track)===null||C===void 0?void 0:C.getDeviceId(!1),S=Jf(u.source);S&&T&&T!==this.localParticipant.activeDeviceMap.get(S)&&(this.localParticipant.activeDeviceMap.set(S,T),this.emit(X.ActiveDeviceChanged,S,T))}),this.onLocalTrackUnpublished=u=>{var h,f;(h=u.track)===null||h===void 0||h.off(ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(f=u.track)===null||f===void 0||f.off(ce.Restarted,this.onLocalTrackRestarted),this.emit(X.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>P(this,void 0,void 0,function*(){const h=yield u.getDeviceId(!1),f=Jf(u.source);f&&h&&h!==this.localParticipant.activeDeviceMap.get(f)&&(this.log.debug("local track restarted, setting ".concat(f," ").concat(h," active"),this.logContext),this.localParticipant.activeDeviceMap.set(f,h),this.emit(X.ActiveDeviceChanged,f,h))}),this.onLocalConnectionQualityChanged=u=>{this.emit(X.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=(u,h)=>{this.emit(X.MediaDevicesError,u,h)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(X.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(X.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},_8),e),this.log=ji((i=this.options.loggerName)!==null&&i!==void 0?i:Yn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},zC),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},FC),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},R8),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new iz,this.outgoingDataStreamManager=new rz(this.engine,this.log),this.disconnectLock=new Qt,this.localParticipant=new fz("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",gs(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",gs(this.options.audioCaptureDefaults.deviceId)),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&this.switchActiveDevice("audiooutput",gs(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),ln()){const u=new AbortController;(l=(o=navigator.mediaDevices)===null||o===void 0?void 0:o.addEventListener)===null||l===void 0||l.call(o,"devicechange",this.handleDeviceChange,{signal:u.signal}),ir.cleanupRegistry&&ir.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return P(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const t=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=t):this.e2eeManager=new l8(i,t),this.e2eeManager.on(ms.ParticipantEncryptionStatusChanged,(a,o)=>{QB(o)&&(this.isE2EEEnabled=a),this.emit(X.ParticipantEncryptionStatusChanged,a,o)}),this.e2eeManager.on(ms.EncryptionError,(a,o)=>{const l=o?this.getParticipantByIdentity(o):void 0;this.emit(X.EncryptionError,a,l)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}getSid(){return this.state===Be.Disconnected?$t.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?$t.resolve(this.roomInfo.sid):new $t((e,t)=>{const i=a=>{a.sid!==""&&(this.engine.off(ue.RoomUpdate,i),e(a.sid))};this.engine.on(ue.RoomUpdate,i),this.once(X.Disconnected,()=>{this.engine.off(ue.RoomUpdate,i),t(new bt("Room disconnected before room server id was available"))})})}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Z8(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(ue.ParticipantUpdate,this.handleParticipantUpdates).on(ue.RoomUpdate,this.handleRoomUpdate).on(ue.SpeakersChanged,this.handleSpeakersChanged).on(ue.StreamStateChanged,this.handleStreamStateUpdate).on(ue.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(ue.SubscriptionError,this.handleSubscriptionError).on(ue.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(ue.MediaTrackAdded,(e,t,i)=>{this.onTrackAdded(e,t,i)}).on(ue.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(ue.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(ue.DataPacketReceived,this.handleDataPacket).on(ue.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Be.SignalReconnecting)&&this.emit(X.SignalReconnecting)}).on(ue.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Be.Connected)&&this.emit(X.Reconnected)}).on(ue.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Be.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(ue.Restarting,this.handleRestarting).on(ue.SignalRestarted,this.handleSignalRestarted).on(ue.Offline,()=>{this.setAndEmitConnectionState(Be.Reconnecting)&&this.emit(X.Reconnecting)}).on(ue.DCBufferStatusChanged,(e,t)=>{this.emit(X.DCBufferStatusChanged,e,t)}).on(ue.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:a}=i;return a===e});if(!t){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ie.LocalTrackSubscribed,t),this.emitWhenConnected(X.LocalTrackSubscribed,t,this.localParticipant)}).on(ue.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((t,i)=>{this.handleParticipantDisconnected(i,t)}),this.emit(X.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return jt.getInstance().getDevices(e,t)}prepareConnection(e,t){return P(this,void 0,void 0,function*(){if(this.state===Be.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(nr(new URL(e))&&t){this.regionUrlProvider=new Fe(e,t);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Be.Disconnected&&(this.regionUrl=i,yield fetch(Lo(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Lo(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return P(this,void 0,void 0,function*(){let i=()=>P(this,void 0,void 0,function*(){}),a;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":a=new Zn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":a=new Zn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":a=new Zn({scenario:{case:"serverLeave",value:!0}});break;case"migration":a=new Zn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>P(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new Zn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>P(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new Zn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":a=new Zn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>P(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new fu({reason:Ln.CLIENT_INITIATED,action:Ga.RECONNECT}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");a=new Zn({scenario:{case:"subscriberBandwidth",value:$s(t)}});break;case"leave-full-reconnect":a=new Zn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}a&&(yield this.engine.client.sendSimulateScenario(a),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return P(this,arguments,void 0,function(i,a){var o=this;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var u,h,f,m,v,b,C;let T=!0,S=!1;const R=l?{exact:a}:a;if(i==="audioinput"){S=o.localParticipant.audioTrackPublications.size===0;const _=(u=o.getActiveDevice(i))!==null&&u!==void 0?u:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=R;const D=Array.from(o.localParticipant.audioTrackPublications.values()).filter(x=>x.source===ee.Source.Microphone);try{T=(yield Promise.all(D.map(x=>{var w;return(w=x.audioTrack)===null||w===void 0?void 0:w.setDeviceId(R)}))).every(x=>x===!0)}catch(x){throw o.options.audioCaptureDefaults.deviceId=_,x}const j=D.some(x=>{var w,M;return(M=(w=x.track)===null||w===void 0?void 0:w.isMuted)!==null&&M!==void 0?M:!1});T&&j&&(S=!0)}else if(i==="videoinput"){S=o.localParticipant.videoTrackPublications.size===0;const _=(h=o.getActiveDevice(i))!==null&&h!==void 0?h:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=R;const D=Array.from(o.localParticipant.videoTrackPublications.values()).filter(x=>x.source===ee.Source.Camera);try{T=(yield Promise.all(D.map(x=>{var w;return(w=x.videoTrack)===null||w===void 0?void 0:w.setDeviceId(R)}))).every(x=>x===!0)}catch(x){throw o.options.videoCaptureDefaults.deviceId=_,x}const j=D.some(x=>{var w,M;return(M=(w=x.track)===null||w===void 0?void 0:w.isMuted)!==null&&M!==void 0?M:!1});T&&j&&(S=!0)}else if(i==="audiooutput"){if(S=!0,!Wf()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(a=(f=yield jt.getInstance().normalizeDeviceId("audiooutput",a))!==null&&f!==void 0?f:""),(m=(C=o.options).audioOutput)!==null&&m!==void 0||(C.audioOutput={});const _=(v=o.getActiveDevice(i))!==null&&v!==void 0?v:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=a;try{o.options.webAudioMix&&((b=o.audioContext)===null||b===void 0||b.setSinkId(a)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(D=>D.setAudioOutput({deviceId:a})))}catch(D){throw o.options.audioOutput.deviceId=_,D}}return S&&(o.localParticipant.activeDeviceMap.set(i,a),o.emit(X.ActiveDeviceChanged,i,a)),T})()})}setupLocalParticipantEvents(){this.localParticipant.on(ie.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ie.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ie.AttributesChanged,this.onLocalAttributesChanged).on(ie.TrackMuted,this.onLocalTrackMuted).on(ie.TrackUnmuted,this.onLocalTrackUnmuted).on(ie.LocalTrackPublished,this.onLocalTrackPublished).on(ie.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ie.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ie.MediaDevicesError,this.onMediaDevicesError).on(ie.AudioStreamAcquired,this.startAudio).on(ie.ChatMessage,this.onLocalChatMessageSent).on(ie.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,i){if(this.state===Be.Connecting||this.state===Be.Reconnecting){const v=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:t.id,tracksInStream:t.getTracks().map(C=>C.id)}),this.onTrackAdded(e,t,i),b()},b=()=>{this.off(X.Reconnected,v),this.off(X.Connected,v),this.off(X.Disconnected,b)};this.once(X.Reconnected,v),this.once(X.Connected,v),this.once(X.Disconnected,b);return}if(this.state===Be.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const a=PB(t.id),o=a[0];let l=a[1],u=e.id;if(l&&l.startsWith("TR")&&(u=l),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const h=Array.from(this.remoteParticipants.values()).find(v=>v.sid===o);if(!h){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}if(!u.startsWith("TR")){const v=this.engine.getTrackIdForReceiver(i);if(!v){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);return}u=v}u.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(l,", trackId: ").concat(u),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:l,trackId:u}));let f;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?f=this.options.adaptiveStream:f={});const m=h.addSubscribedMediaTrack(e,u,t,i,f);m?.isEncrypted&&!this.e2eeManager&&this.emit(X.EncryptionError,new Error("Encrypted ".concat(m.source," track received from participant ").concat(h.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var i,a;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Be.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{o.unpublishTrack(l.trackSid)})}),this.localParticipant.trackPublications.forEach(o=>{var l,u,h;o.track&&this.localParticipant.unpublishTrack(o.track,e),e?((l=o.track)===null||l===void 0||l.detach(),(u=o.track)===null||u===void 0||u.stop()):(h=o.track)===null||h===void 0||h.stopMonitor()}),this.localParticipant.off(ie.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ie.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ie.AttributesChanged,this.onLocalAttributesChanged).off(ie.TrackMuted,this.onLocalTrackMuted).off(ie.TrackUnmuted,this.onLocalTrackUnmuted).off(ie.LocalTrackPublished,this.onLocalTrackPublished).off(ie.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ie.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ie.MediaDevicesError,this.onMediaDevicesError).off(ie.AudioStreamAcquired,this.startAudio).off(ie.ChatMessage,this.onLocalChatMessageSent).off(ie.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ln()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(a=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||a===void 0||a.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Be.Disconnected),this.emit(X.Disconnected,t)}}}handleParticipantDisconnected(e,t){var i;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach(a=>{t.unpublishTrack(a.trackSid,!0)}),this.emit(X.ParticipantDisconnected,t),t.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,i,a,o,l){return P(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),l!==1){yield this.engine.publishRpcResponse(e,t,null,gt.builtIn("UNSUPPORTED_VERSION"));return}const u=this.rpcHandlers.get(i);if(!u){yield this.engine.publishRpcResponse(e,t,null,gt.builtIn("UNSUPPORTED_METHOD"));return}let h=null,f=null;try{const m=yield u({requestId:t,callerIdentity:e,payload:a,responseTimeout:o});$m(m)>qC?(h=gt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):f=m}catch(m){m instanceof gt?h=m:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),m),h=gt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,f,h)})}selectDefaultDevices(){return P(this,void 0,void 0,function*(){var e,t,i;const a=jt.getInstance().previousDevices,o=yield jt.getInstance().getDevices(void 0,!1),l=un();if(l?.name==="Chrome"&&l.os!=="iOS")for(let h of o){const f=a.find(m=>m.deviceId===h.deviceId);f&&f.label!==""&&f.kind===h.kind&&f.label!==h.label&&this.getActiveDevice(h.kind)==="default"&&this.emit(X.ActiveDeviceChanged,h.kind,h.deviceId)}const u=["audiooutput","audioinput","videoinput"];for(let h of u){const f=RB(h),m=this.localParticipant.getTrackPublication(f);if(m&&(!((e=m.track)===null||e===void 0)&&e.isUserProvided))continue;const v=o.filter(C=>C.kind===h),b=this.getActiveDevice(h);if(b===((t=a.filter(C=>C.kind===h)[0])===null||t===void 0?void 0:t.deviceId)&&v.length>0&&((i=v[0])===null||i===void 0?void 0:i.deviceId)!==b){yield this.switchActiveDevice(h,v[0].deviceId);continue}h==="audioinput"&&!Po()||h==="videoinput"||v.length>0&&!v.find(C=>C.deviceId===this.getActiveDevice(h))&&(h!=="audiooutput"||!Po())&&(yield this.switchActiveDevice(h,v[0].deviceId))}})}acquireAudioContext(){return P(this,void 0,void 0,function*(){var e,t;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=jC())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(a=>a.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Vt(200)])}catch(a){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:a}))}const i=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(X.AudioPlaybackStatusChanged,i))})}createParticipant(e,t){var i;let a;return t?a=Jl.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):a=new Jl(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&a.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&a.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),a}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const a=this.remoteParticipants.get(e);return t&&a.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),a}const i=this.createParticipant(e,t);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(X.ParticipantConnected,i),i.on(ie.TrackPublished,a=>{this.emitWhenConnected(X.TrackPublished,a,i)}).on(ie.TrackSubscribed,(a,o)=>{a.kind===ee.Kind.Audio?(a.on(ce.AudioPlaybackStarted,this.handleAudioPlaybackStarted),a.on(ce.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):a.kind===ee.Kind.Video&&(a.on(ce.VideoPlaybackFailed,this.handleVideoPlaybackFailed),a.on(ce.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(X.TrackSubscribed,a,o,i)}).on(ie.TrackUnpublished,a=>{this.emit(X.TrackUnpublished,a,i)}).on(ie.TrackUnsubscribed,(a,o)=>{this.emit(X.TrackUnsubscribed,a,o,i)}).on(ie.TrackMuted,a=>{this.emitWhenConnected(X.TrackMuted,a,i)}).on(ie.TrackUnmuted,a=>{this.emitWhenConnected(X.TrackUnmuted,a,i)}).on(ie.ParticipantMetadataChanged,a=>{this.emitWhenConnected(X.ParticipantMetadataChanged,a,i)}).on(ie.ParticipantNameChanged,a=>{this.emitWhenConnected(X.ParticipantNameChanged,a,i)}).on(ie.AttributesChanged,a=>{this.emitWhenConnected(X.ParticipantAttributesChanged,a,i)}).on(ie.ConnectionQualityChanged,a=>{this.emitWhenConnected(X.ConnectionQualityChanged,a,i)}).on(ie.ParticipantPermissionsChanged,a=>{this.emitWhenConnected(X.ParticipantPermissionsChanged,a,i)}).on(ie.TrackSubscriptionStatusChanged,(a,o)=>{this.emitWhenConnected(X.TrackSubscriptionStatusChanged,a,o,i)}).on(ie.TrackSubscriptionFailed,(a,o)=>{this.emit(X.TrackSubscriptionFailed,a,i,o)}).on(ie.TrackSubscriptionPermissionChanged,(a,o)=>{this.emitWhenConnected(X.TrackSubscriptionPermissionChanged,a,o,i)}).on(ie.Active,()=>{this.emitWhenConnected(X.ParticipantActive,i),i.kind===Do.AGENT&&this.localParticipant.setActiveAgent(i)}),t&&i.updateInfo(t),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,a)=>(i.push(...a.getTrackPublications()),i),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&JB(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ft.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ln.STATE_MISMATCH))):e=0},mz)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ft.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(X.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,i]=e;this.emit(t,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];if(this.state===Be.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Be.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return P(this,void 0,void 0,function*(){var t,i,a,o;const l=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),u=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new lu({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ct.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Qs({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(X.SignalConnected),this.emit(X.Connected),this.setAndEmitConnectionState(Be.Connected),l.video){const h=new am(ee.Kind.Video,new qa({source:Rt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:qn.AUDIO,name:"video-dummy"}),new Gl(l.useRealTracks&&(!((t=window.navigator.mediaDevices)===null||t===void 0)&&t.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:A0(160*((i=u.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(h),this.localParticipant.emit(ie.LocalTrackPublished,h)}if(l.audio){const h=new am(ee.Kind.Audio,new qa({source:Rt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:qn.AUDIO}),new Kl(l.useRealTracks&&(!((a=navigator.mediaDevices)===null||a===void 0)&&a.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:lf(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(h),this.localParticipant.emit(ie.LocalTrackPublished,h)}for(let h=0;h<u.count-1;h+=1){let f=new Qs({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(h),state:Ka.ACTIVE,tracks:[],joinedAt:ct.parse(Date.now())});const m=this.getOrCreateParticipant(f.identity,f);if(u.video){const v=A0(160*((o=u.aspectRatios[h%u.aspectRatios.length])!==null&&o!==void 0?o:1),160,!1,!0),b=new qa({source:Rt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:qn.AUDIO});m.addSubscribedMediaTrack(v,b.sid,new MediaStream([v]),new RTCRtpReceiver),f.tracks=[...f.tracks,b]}if(u.audio){const v=lf(),b=new qa({source:Rt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:qn.AUDIO});m.addSubscribedMediaTrack(v,b.sid,new MediaStream([v]),new RTCRtpReceiver),f.tracks=[...f.tracks,b]}m.updateInfo(f)}})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];if(e!==X.ActiveSpeakersChanged&&e!==X.TranscriptionReceived){const o=WC(i).filter(l=>l!==void 0);(e===X.TrackSubscribed||e===X.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}ir.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(n=>{n()});function WC(n){return n.map(e=>{if(e)return Array.isArray(e)?WC(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Vn;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(Vn||(Vn={}));class Es extends oi.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Vn.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new ir(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return P(this,void 0,void 0,function*(){if(this.status!==Vn.IDLE)throw Error("check is running already");this.setStatus(Vn.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==Vn.SKIPPED&&this.setStatus(this.isSuccess()?Vn.SUCCESS:Vn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return P(this,void 0,void 0,function*(){return this.room.state===Be.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return P(this,void 0,void 0,function*(){this.room&&this.room.state!==Be.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Vn.SKIPPED)}switchProtocol(e){return P(this,void 0,void 0,function*(){let t=!1,i=!1;if(this.room.on(X.Reconnecting,()=>{t=!0}),this.room.once(X.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!t)return;const a=Date.now()+1e4;for(;Date.now()<a;){if(i)return;yield Vt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class pz extends Es{get description(){return"Cloud regions"}perform(){return P(this,void 0,void 0,function*(){const e=new Fe(this.url,this.token);if(!e.isCloud()){this.skip();return}const t=[],i=new Set;for(let o=0;o<3;o++){const l=yield e.getNextBestRegionUrl();if(!l)break;if(i.has(l))continue;i.add(l);const u=yield this.checkCloudRegion(l);this.appendMessage("".concat(u.region," RTT: ").concat(u.rtt,"ms, duration: ").concat(u.duration,"ms")),t.push(u)}t.sort((o,l)=>(o.duration-l.duration)*.5+(o.rtt-l.rtt)*.5);const a=t[0];this.bestStats=a,this.appendMessage("best Cloud region: ".concat(a.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return P(this,void 0,void 0,function*(){var t,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const a=(t=this.room.serverInfo)===null||t===void 0?void 0:t.region;if(!a)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),l=1e3,h=1e6/l,f="A".repeat(l),m=Date.now();for(let T=0;T<h;T++)yield o.write(f);yield o.close();const v=Date.now(),b=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),C={region:a,rtt:1e4,duration:v-m};return b?.forEach(T=>{T.type==="candidate-pair"&&T.nominated&&(C.rtt=T.currentRoundTripTime*1e3)}),yield this.disconnect(),C})}}const yf=1e4;class gz extends Es{get description(){return"Connection via UDP vs TCP"}perform(){return P(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(yf/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(yf/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return P(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const i=t.getContext("2d");if(!i)throw new Error("Could not get canvas context");let a=0;const o=()=>{a=(a+1)%360,i.fillStyle="hsl(".concat(a,", 100%, 50%)"),i.fillRect(0,0,t.width,t.height),requestAnimationFrame(o)};o();const u=t.captureStream(30).getVideoTracks()[0],f=(yield this.room.localParticipant.publishTrack(u,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,m={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},v=setInterval(()=>P(this,void 0,void 0,function*(){const b=yield f.getRTCStatsReport();b?.forEach(C=>{C.type==="outbound-rtp"?(m.packetsSent=C.packetsSent,m.qualityLimitationDurations=C.qualityLimitationDurations,m.bitrateTotal+=C.targetBitrate,m.count++):C.type==="remote-inbound-rtp"&&(m.packetsLost=C.packetsLost,m.rttTotal+=C.roundTripTime,m.jitterTotal+=C.jitter)})}),1e3);return yield new Promise(b=>setTimeout(b,yf)),clearInterval(v),u.stop(),t.remove(),yield this.disconnect(),m})}}class vz extends Es{get description(){return"Can publish audio"}perform(){return P(this,void 0,void 0,function*(){var e;const t=yield this.connect(),i=yield uz();if(yield AC(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(i),yield new Promise(u=>setTimeout(u,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let l=0;if(o.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="audio"||!u.kind&&u.mediaType==="audio")&&(l=u.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," audio packets"))})}}class yz extends Es{get description(){return"Can publish video"}perform(){return P(this,void 0,void 0,function*(){var e;const t=yield this.connect(),i=yield lz();yield this.checkForVideo(i.mediaStreamTrack),t.localParticipant.publishTrack(i),yield new Promise(l=>setTimeout(l,5e3));const a=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!a)throw new Error("Could not get RTCStats");let o=0;if(a.forEach(l=>{l.type==="outbound-rtp"&&(l.kind==="video"||!l.kind&&l.mediaType==="video")&&(o+=l.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return P(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const i=document.createElement("video");i.srcObject=t,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(a=>{i.onplay=()=>{setTimeout(()=>{var o,l,u,h;const f=document.createElement("canvas"),m=e.getSettings(),v=(l=(o=m.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&l!==void 0?l:1280,b=(h=(u=m.height)!==null&&u!==void 0?u:i.videoHeight)!==null&&h!==void 0?h:720;f.width=v,f.height=b;const C=f.getContext("2d");C.drawImage(i,0,0);const S=C.getImageData(0,0,f.width,f.height).data;let R=!0;for(let _=0;_<S.length;_+=4)if(S[_]!==0||S[_+1]!==0||S[_+2]!==0){R=!1;break}R?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),a()},1e3)},i.play()}),t.getTracks().forEach(a=>a.stop()),i.remove()})}}class bz extends Es{get description(){return"Resuming connection after interruption"}perform(){return P(this,void 0,void 0,function*(){var e;const t=yield this.connect();let i=!1,a=!1,o;const l=new Promise(f=>{setTimeout(f,5e3),o=f}),u=()=>{i=!0};t.on(X.SignalReconnecting,u).on(X.Reconnecting,u).on(X.Reconnected,()=>{a=!0,o(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const h=t.engine.client.onClose;if(h&&h(""),yield l,i){if(!a||t.state!==Be.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class Sz extends Es{get description(){return"Can connect via TURN"}perform(){return P(this,void 0,void 0,function*(){var e,t,i;nr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Fe(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const a=new zm,o=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let l=!1,u=!1,h=!1;for(let f of o.iceServers)for(let m of f.urls)m.startsWith("turn:")?(u=!0,h=!0):m.startsWith("turns:")&&(u=!0,h=!0,l=!0),m.startsWith("stun:")&&(h=!0);h?u&&!l&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield a.close(),!((i=(t=this.connectOptions)===null||t===void 0?void 0:t.rtcConfig)===null||i===void 0)&&i.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(f=>setTimeout(f,0)))})}}class kz extends Es{get description(){return"Establishing WebRTC connection"}perform(){return P(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(X.SignalConnected,()=>{var i;const a=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,l)=>{if(o.candidate){const u=new RTCIceCandidate(o);let h="".concat(u.protocol," ").concat(u.address,":").concat(u.port," ").concat(u.type);u.address&&(Cz(u.address)?h+=" (private)":u.protocol==="tcp"&&u.tcpType==="passive"?(e=!0,h+=" (passive)"):u.protocol==="udp"&&(t=!0)),this.appendMessage(h)}a&&a(o,l)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),Me.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function Cz(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class Tz extends Es{get description(){return"Connecting to signal connection via WebSocket"}perform(){return P(this,void 0,void 0,function*(){var e,t,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let a=new zm,o;try{o=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(l){if(nr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(l.message,". Retrying with region fallback"));const h=yield new Fe(this.url,this.token).getNextBestRegionUrl();h&&(o=yield a.join(h,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}o?(this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===Ak.Cloud&&(!((t=o.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield a.close()})}}class I7 extends oi.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Vn.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Vn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return P(this,void 0,void 0,function*(){const t=this.getNextCheckId(),i=new e(this.url,this.token,this.options),a=l=>{this.updateCheck(t,l)};i.on("update",a);const o=yield i.run();return i.off("update",a),o})}checkWebsocket(){return P(this,void 0,void 0,function*(){return this.createAndRunCheck(Tz)})}checkWebRTC(){return P(this,void 0,void 0,function*(){return this.createAndRunCheck(kz)})}checkTURN(){return P(this,void 0,void 0,function*(){return this.createAndRunCheck(Sz)})}checkReconnect(){return P(this,void 0,void 0,function*(){return this.createAndRunCheck(bz)})}checkPublishAudio(){return P(this,void 0,void 0,function*(){return this.createAndRunCheck(vz)})}checkPublishVideo(){return P(this,void 0,void 0,function*(){return this.createAndRunCheck(yz)})}checkConnectionProtocol(){return P(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(gz);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return P(this,void 0,void 0,function*(){return this.createAndRunCheck(pz)})}}function Le(n,e,t){return(e=xz(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ez(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function xz(n){var e=Ez(n,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Wt extends Error{constructor(e,t){var i;super(e,t),Le(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}Le(Wt,"code","ERR_JOSE_GENERIC");class Rz extends Wt{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:a,payload:t}}),Le(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Le(this,"claim",void 0),Le(this,"reason",void 0),Le(this,"payload",void 0),this.claim=i,this.reason=a,this.payload=t}}Le(Rz,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class _z extends Wt{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:a,payload:t}}),Le(this,"code","ERR_JWT_EXPIRED"),Le(this,"claim",void 0),Le(this,"reason",void 0),Le(this,"payload",void 0),this.claim=i,this.reason=a,this.payload=t}}Le(_z,"code","ERR_JWT_EXPIRED");class wz extends Wt{constructor(){super(...arguments),Le(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Le(wz,"code","ERR_JOSE_ALG_NOT_ALLOWED");class Mz extends Wt{constructor(){super(...arguments),Le(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Le(Mz,"code","ERR_JOSE_NOT_SUPPORTED");class Nz extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",t=arguments.length>1?arguments[1]:void 0;super(e,t),Le(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Le(Nz,"code","ERR_JWE_DECRYPTION_FAILED");class Dz extends Wt{constructor(){super(...arguments),Le(this,"code","ERR_JWE_INVALID")}}Le(Dz,"code","ERR_JWE_INVALID");class Oz extends Wt{constructor(){super(...arguments),Le(this,"code","ERR_JWS_INVALID")}}Le(Oz,"code","ERR_JWS_INVALID");class Az extends Wt{constructor(){super(...arguments),Le(this,"code","ERR_JWT_INVALID")}}Le(Az,"code","ERR_JWT_INVALID");class jz extends Wt{constructor(){super(...arguments),Le(this,"code","ERR_JWK_INVALID")}}Le(jz,"code","ERR_JWK_INVALID");class Pz extends Wt{constructor(){super(...arguments),Le(this,"code","ERR_JWKS_INVALID")}}Le(Pz,"code","ERR_JWKS_INVALID");class Lz extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",t=arguments.length>1?arguments[1]:void 0;super(e,t),Le(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Le(Lz,"code","ERR_JWKS_NO_MATCHING_KEY");class Iz extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",t=arguments.length>1?arguments[1]:void 0;super(e,t),Le(this,Symbol.asyncIterator,void 0),Le(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Le(Iz,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class Uz extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",t=arguments.length>1?arguments[1]:void 0;super(e,t),Le(this,"code","ERR_JWKS_TIMEOUT")}}Le(Uz,"code","ERR_JWKS_TIMEOUT");class Bz extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",t=arguments.length>1?arguments[1]:void 0;super(e,t),Le(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Le(Bz,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");var iS;(function(n){n[n.Reserved=0]="Reserved",n[n.TooLarge=1]="TooLarge"})(iS||(iS={}));var sS;(function(n){n[n.TooShort=0]="TooShort",n[n.HeaderOverrun=1]="HeaderOverrun",n[n.MissingExtWords=2]="MissingExtWords",n[n.UnsupportedVersion=3]="UnsupportedVersion",n[n.InvalidHandle=4]="InvalidHandle",n[n.MalformedExt=5]="MalformedExt"})(sS||(sS={}));var aS;(function(n){n[n.TooSmallForHeader=0]="TooSmallForHeader",n[n.TooSmallForPayload=1]="TooSmallForPayload"})(aS||(aS={}));var Ql;(function(n){n[n.UserTimestamp=2]="UserTimestamp",n[n.E2ee=1]="E2ee"})(Ql||(Ql={}));Ql.UserTimestamp;Ql.E2ee;var rS;(function(n){n[n.Start=0]="Start",n[n.Inter=1]="Inter",n[n.Final=2]="Final",n[n.Single=3]="Single"})(rS||(rS={}));var fl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ZC(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var rm={exports:{}},zz=rm.exports,oS;function Fz(){return oS||(oS=1,(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(zz,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],o={},l=null;function u(S,R){var _=S[R];if(typeof _.bind=="function")return _.bind(S);try{return Function.prototype.bind.call(_,S)}catch{return function(){return Function.prototype.apply.apply(_,[S,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function f(S){return S==="debug"&&(S="log"),typeof console===t?!1:S==="trace"&&i?h:console[S]!==void 0?u(console,S):console.log!==void 0?u(console,"log"):e}function m(){for(var S=this.getLevel(),R=0;R<a.length;R++){var _=a[R];this[_]=R<S?e:this.methodFactory(_,S,this.name)}if(this.log=this.debug,typeof console===t&&S<this.levels.SILENT)return"No console available for logging"}function v(S){return function(){typeof console!==t&&(m.call(this),this[S].apply(this,arguments))}}function b(S,R,_){return f(S)||v.apply(this,arguments)}function C(S,R){var _=this,D,j,x,w="loglevel";typeof S=="string"?w+=":"+S:typeof S=="symbol"&&(w=void 0);function M(O){var Y=(a[O]||"silent").toUpperCase();if(!(typeof window===t||!w)){try{window.localStorage[w]=Y;return}catch{}try{window.document.cookie=encodeURIComponent(w)+"="+Y+";"}catch{}}}function I(){var O;if(!(typeof window===t||!w)){try{O=window.localStorage[w]}catch{}if(typeof O===t)try{var Y=window.document.cookie,J=encodeURIComponent(w),le=Y.indexOf(J+"=");le!==-1&&(O=/^([^;]+)/.exec(Y.slice(le+J.length+1))[1])}catch{}return _.levels[O]===void 0&&(O=void 0),O}}function F(){if(!(typeof window===t||!w)){try{window.localStorage.removeItem(w)}catch{}try{window.document.cookie=encodeURIComponent(w)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function L(O){var Y=O;if(typeof Y=="string"&&_.levels[Y.toUpperCase()]!==void 0&&(Y=_.levels[Y.toUpperCase()]),typeof Y=="number"&&Y>=0&&Y<=_.levels.SILENT)return Y;throw new TypeError("log.setLevel() called with invalid level: "+O)}_.name=S,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=R||b,_.getLevel=function(){return x??j??D},_.setLevel=function(O,Y){return x=L(O),Y!==!1&&M(x),m.call(_)},_.setDefaultLevel=function(O){j=L(O),I()||_.setLevel(O,!1)},_.resetLevel=function(){x=null,F(),m.call(_)},_.enableAll=function(O){_.setLevel(_.levels.TRACE,O)},_.disableAll=function(O){_.setLevel(_.levels.SILENT,O)},_.rebuild=function(){if(l!==_&&(D=L(l.getLevel())),m.call(_),l===_)for(var O in o)o[O].rebuild()},D=L(l?l.getLevel():"WARN");var A=I();A!=null&&(x=L(A)),m.call(_)}l=new C,l.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var R=o[S];return R||(R=o[S]=new C(S,l.methodFactory)),R};var T=typeof window!==t?window.log:void 0;return l.noConflict=function(){return typeof window!==t&&window.log===l&&(window.log=T),l},l.getLoggers=function(){return o},l.default=l,l})})(rm)),rm.exports}var Vz=Fz();const qz=ZC(Vz);var om=function(n,e){return om=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])},om(n,e)};function Pi(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");om(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Hz(n,e,t,i){function a(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function u(m){try{f(i.next(m))}catch(v){l(v)}}function h(m){try{f(i.throw(m))}catch(v){l(v)}}function f(m){m.done?o(m.value):a(m.value).then(u,h)}f((i=i.apply(n,[])).next())})}function eT(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,a,o,l=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return l.next=u(0),l.throw=u(1),l.return=u(2),typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function u(f){return function(m){return h([f,m])}}function h(f){if(i)throw new TypeError("Generator is already executing.");for(;l&&(l=0,f[0]&&(t=0)),t;)try{if(i=1,a&&(o=f[0]&2?a.return:f[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,f[1])).done)return o;switch(a=0,o&&(f=[f[0]&2,o.value]),f[0]){case 0:case 1:o=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,a=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!o||f[1]>o[0]&&f[1]<o[3])){t.label=f[1];break}if(f[0]===6&&t.label<o[1]){t.label=o[1],o=f;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(f);break}o[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(n,t)}catch(m){f=[6,m],a=0}finally{i=o=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function sr(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xl(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),a,o=[],l;try{for(;(e===void 0||e-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(u){l={error:u}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(l)throw l.error}}return o}function Wl(n,e,t){if(arguments.length===2)for(var i=0,a=e.length,o;i<a;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return n.concat(o||Array.prototype.slice.call(e))}function er(n){return this instanceof er?(this.v=n,this):new er(n)}function $z(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",l),a[Symbol.asyncIterator]=function(){return this},a;function l(C){return function(T){return Promise.resolve(T).then(C,v)}}function u(C,T){i[C]&&(a[C]=function(S){return new Promise(function(R,_){o.push([C,S,R,_])>1||h(C,S)})},T&&(a[C]=T(a[C])))}function h(C,T){try{f(i[C](T))}catch(S){b(o[0][3],S)}}function f(C){C.value instanceof er?Promise.resolve(C.value.v).then(m,v):b(o[0][2],C)}function m(C){h("next",C)}function v(C){h("throw",C)}function b(C,T){C(T),o.shift(),o.length&&h(o[0][0],o[0][1])}}function Kz(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof sr=="function"?sr(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(l){return new Promise(function(u,h){l=n[o](l),a(u,h,l.done,l.value)})}}function a(o,l,u,h){Promise.resolve(h).then(function(f){o({value:f,done:u})},l)}}function wt(n){return typeof n=="function"}function Ym(n){var e=function(i){Error.call(i),i.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var bf=Ym(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,i){return i+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Zl(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var zo=(function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,i,a,o;if(!this.closed){this.closed=!0;var l=this._parentage;if(l)if(this._parentage=null,Array.isArray(l))try{for(var u=sr(l),h=u.next();!h.done;h=u.next()){var f=h.value;f.remove(this)}}catch(S){e={error:S}}finally{try{h&&!h.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else l.remove(this);var m=this.initialTeardown;if(wt(m))try{m()}catch(S){o=S instanceof bf?S.errors:[S]}var v=this._finalizers;if(v){this._finalizers=null;try{for(var b=sr(v),C=b.next();!C.done;C=b.next()){var T=C.value;try{cS(T)}catch(S){o=o??[],S instanceof bf?o=Wl(Wl([],Xl(o)),Xl(S.errors)):o.push(S)}}}catch(S){i={error:S}}finally{try{C&&!C.done&&(a=b.return)&&a.call(b)}finally{if(i)throw i.error}}}if(o)throw new bf(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)cS(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Zl(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&Zl(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=(function(){var e=new n;return e.closed=!0,e})(),n})(),tT=zo.EMPTY;function nT(n){return n instanceof zo||n&&"closed"in n&&wt(n.remove)&&wt(n.add)&&wt(n.unsubscribe)}function cS(n){wt(n)?n():n.unsubscribe()}var Gz={Promise:void 0},Yz={setTimeout:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setTimeout.apply(void 0,Wl([n,e],Xl(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function iT(n){Yz.setTimeout(function(){throw n})}function lS(){}function Al(n){n()}var Jm=(function(n){Pi(e,n);function e(t){var i=n.call(this)||this;return i.isStopped=!1,t?(i.destination=t,nT(t)&&t.add(i)):i.destination=Xz,i}return e.create=function(t,i,a){return new cm(t,i,a)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(zo),Jz=(function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(i){ml(i)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(i){ml(i)}else ml(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){ml(t)}},n})(),cm=(function(n){Pi(e,n);function e(t,i,a){var o=n.call(this)||this,l;return wt(t)||!t?l={next:t??void 0,error:i??void 0,complete:a??void 0}:l=t,o.destination=new Jz(l),o}return e})(Jm);function ml(n){iT(n)}function Qz(n){throw n}var Xz={closed:!0,next:lS,error:Qz,complete:lS},Qm=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function sT(n){return n}function Wz(n){return n.length===0?sT:n.length===1?n[0]:function(e){return n.reduce(function(t,i){return i(t)},e)}}var Kt=(function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,i){var a=this,o=e9(e)?e:new cm(e,t,i);return Al(function(){var l=a,u=l.operator,h=l.source;o.add(u?u.call(o,h):h?a._subscribe(o):a._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var i=this;return t=uS(t),new t(function(a,o){var l=new cm({next:function(u){try{e(u)}catch(h){o(h),l.unsubscribe()}},error:o,complete:a});i.subscribe(l)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[Qm]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Wz(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=uS(e),new e(function(i,a){var o;t.subscribe(function(l){return o=l},function(l){return a(l)},function(){return i(o)})})},n.create=function(e){return new n(e)},n})();function uS(n){var e;return(e=n??Gz.Promise)!==null&&e!==void 0?e:Promise}function Zz(n){return n&&wt(n.next)&&wt(n.error)&&wt(n.complete)}function e9(n){return n&&n instanceof Jm||Zz(n)&&nT(n)}function t9(n){return wt(n?.lift)}function Fo(n){return function(e){if(t9(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function eu(n,e,t,i,a){return new n9(n,e,t,i,a)}var n9=(function(n){Pi(e,n);function e(t,i,a,o,l,u){var h=n.call(this,t)||this;return h.onFinalize=l,h.shouldUnsubscribe=u,h._next=i?function(f){try{i(f)}catch(m){t.error(m)}}:n.prototype._next,h._error=o?function(f){try{o(f)}catch(m){t.error(m)}finally{this.unsubscribe()}}:n.prototype._error,h._complete=a?function(){try{a()}catch(f){t.error(f)}finally{this.unsubscribe()}}:n.prototype._complete,h}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;n.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e})(Jm),i9=Ym(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),aT=(function(n){Pi(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new dS(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new i9},e.prototype.next=function(t){var i=this;Al(function(){var a,o;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var l=sr(i.currentObservers),u=l.next();!u.done;u=l.next()){var h=u.value;h.next(t)}}catch(f){a={error:f}}finally{try{u&&!u.done&&(o=l.return)&&o.call(l)}finally{if(a)throw a.error}}}})},e.prototype.error=function(t){var i=this;Al(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var a=i.observers;a.length;)a.shift().error(t)}})},e.prototype.complete=function(){var t=this;Al(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,a=this,o=a.hasError,l=a.isStopped,u=a.observers;return o||l?tT:(this.currentObservers=null,u.push(t),new zo(function(){i.currentObservers=null,Zl(u,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,a=i.hasError,o=i.thrownError,l=i.isStopped;a?t.error(o):l&&t.complete()},e.prototype.asObservable=function(){var t=new Kt;return t.source=this,t},e.create=function(t,i){return new dS(t,i)},e})(Kt),dS=(function(n){Pi(e,n);function e(t,i){var a=n.call(this)||this;return a.destination=t,a.source=i,a}return e.prototype.next=function(t){var i,a;(a=(i=this.destination)===null||i===void 0?void 0:i.next)===null||a===void 0||a.call(i,t)},e.prototype.error=function(t){var i,a;(a=(i=this.destination)===null||i===void 0?void 0:i.error)===null||a===void 0||a.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,a;return(a=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&a!==void 0?a:tT},e})(aT);(function(n){Pi(e,n);function e(t){var i=n.call(this)||this;return i._value=t,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var i=n.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},e.prototype.getValue=function(){var t=this,i=t.hasError,a=t.thrownError,o=t._value;if(i)throw a;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e})(aT);var s9={now:function(){return Date.now()}},a9=(function(n){Pi(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e})(zo),hS={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setInterval.apply(void 0,Wl([n,e],Xl(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},r9=(function(n){Pi(e,n);function e(t,i){var a=n.call(this,t,i)||this;return a.scheduler=t,a.work=i,a.pending=!1,a}return e.prototype.schedule=function(t,i){var a;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var o=this.id,l=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(l,o,i)),this.pending=!0,this.delay=i,this.id=(a=this.id)!==null&&a!==void 0?a:this.requestAsyncId(l,this.id,i),this},e.prototype.requestAsyncId=function(t,i,a){return a===void 0&&(a=0),hS.setInterval(t.flush.bind(t,this),a)},e.prototype.recycleAsyncId=function(t,i,a){if(a===void 0&&(a=0),a!=null&&this.delay===a&&this.pending===!1)return i;i!=null&&hS.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var a=this._execute(t,i);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var a=!1,o;try{this.work(t)}catch(l){a=!0,o=l||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,a=t.scheduler,o=a.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Zl(o,this),i!=null&&(this.id=this.recycleAsyncId(a,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e})(a9),fS=(function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=s9.now,n})(),o9=(function(n){Pi(e,n);function e(t,i){i===void 0&&(i=fS.now);var a=n.call(this,t,i)||this;return a.actions=[],a._active=!1,a}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var a;this._active=!0;do if(a=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,a){for(;t=i.shift();)t.unsubscribe();throw a}},e})(fS);new o9(r9);function c9(n){return n&&wt(n.schedule)}function l9(n){return n[n.length-1]}function rT(n){return c9(l9(n))?n.pop():void 0}var oT=(function(n){return n&&typeof n.length=="number"&&typeof n!="function"});function cT(n){return wt(n?.then)}function lT(n){return wt(n[Qm])}function uT(n){return Symbol.asyncIterator&&wt(n?.[Symbol.asyncIterator])}function dT(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function u9(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var hT=u9();function fT(n){return wt(n?.[hT])}function mT(n){return $z(this,arguments,function(){var e,t,i,a;return eT(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,er(e.read())];case 3:return t=o.sent(),i=t.value,a=t.done,a?[4,er(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,er(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function pT(n){return wt(n?.getReader)}function Vo(n){if(n instanceof Kt)return n;if(n!=null){if(lT(n))return d9(n);if(oT(n))return h9(n);if(cT(n))return f9(n);if(uT(n))return gT(n);if(fT(n))return m9(n);if(pT(n))return p9(n)}throw dT(n)}function d9(n){return new Kt(function(e){var t=n[Qm]();if(wt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function h9(n){return new Kt(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function f9(n){return new Kt(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,iT)})}function m9(n){return new Kt(function(e){var t,i;try{for(var a=sr(n),o=a.next();!o.done;o=a.next()){var l=o.value;if(e.next(l),e.closed)return}}catch(u){t={error:u}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}e.complete()})}function gT(n){return new Kt(function(e){g9(n,e).catch(function(t){return e.error(t)})})}function p9(n){return gT(mT(n))}function g9(n,e){var t,i,a,o;return Hz(this,void 0,void 0,function(){var l,u;return eT(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,11]),t=Kz(n),h.label=1;case 1:return[4,t.next()];case 2:if(i=h.sent(),!!i.done)return[3,4];if(l=i.value,e.next(l),e.closed)return[2];h.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=h.sent(),a={error:u},[3,11];case 6:return h.trys.push([6,,9,10]),i&&!i.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:h.sent(),h.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Ks(n,e,t,i,a){i===void 0&&(i=0),a===void 0&&(a=!1);var o=e.schedule(function(){t(),a?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!a)return o}function vT(n,e){return e===void 0&&(e=0),Fo(function(t,i){t.subscribe(eu(i,function(a){return Ks(i,n,function(){return i.next(a)},e)},function(){return Ks(i,n,function(){return i.complete()},e)},function(a){return Ks(i,n,function(){return i.error(a)},e)}))})}function yT(n,e){return e===void 0&&(e=0),Fo(function(t,i){i.add(n.schedule(function(){return t.subscribe(i)},e))})}function v9(n,e){return Vo(n).pipe(yT(e),vT(e))}function y9(n,e){return Vo(n).pipe(yT(e),vT(e))}function b9(n,e){return new Kt(function(t){var i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function S9(n,e){return new Kt(function(t){var i;return Ks(t,e,function(){i=n[hT](),Ks(t,e,function(){var a,o,l;try{a=i.next(),o=a.value,l=a.done}catch(u){t.error(u);return}l?t.complete():t.next(o)},0,!0)}),function(){return wt(i?.return)&&i.return()}})}function bT(n,e){if(!n)throw new Error("Iterable cannot be null");return new Kt(function(t){Ks(t,e,function(){var i=n[Symbol.asyncIterator]();Ks(t,e,function(){i.next().then(function(a){a.done?t.complete():t.next(a.value)})},0,!0)})})}function k9(n,e){return bT(mT(n),e)}function C9(n,e){if(n!=null){if(lT(n))return v9(n,e);if(oT(n))return b9(n,e);if(cT(n))return y9(n,e);if(uT(n))return bT(n,e);if(fT(n))return S9(n,e);if(pT(n))return k9(n,e)}throw dT(n)}function T9(n,e){return e?C9(n,e):Vo(n)}Ym(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function lr(n,e){return Fo(function(t,i){var a=0;t.subscribe(eu(i,function(o){i.next(n.call(e,o,a++))}))})}function E9(n,e,t,i,a,o,l,u){var h=[],f=0,m=0,v=!1,b=function(){v&&!h.length&&!f&&e.complete()},C=function(S){return f<i?T(S):h.push(S)},T=function(S){f++;var R=!1;Vo(t(S,m++)).subscribe(eu(e,function(_){e.next(_)},function(){R=!0},void 0,function(){if(R)try{f--;for(var _=function(){var D=h.shift();l||T(D)};h.length&&f<i;)_();b()}catch(D){e.error(D)}}))};return n.subscribe(eu(e,C,function(){v=!0,b()})),function(){}}function ST(n,e,t){return t===void 0&&(t=1/0),wt(e)?ST(function(i,a){return lr(function(o,l){return e(i,o,a,l)})(Vo(n(i,a)))},t):(typeof e=="number"&&(t=e),Fo(function(i,a){return E9(i,a,n,t)}))}function x9(n){return ST(sT,n)}function R9(){return x9(1)}function mS(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return R9()(T9(n,rT(n)))}function ur(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=rT(n);return Fo(function(i,a){(t?mS(n,i,t):mS(n,i)).subscribe(a)})}var _9="lk";function Xm(n){return typeof n>"u"?!1:w9(n)||M9(n)}function w9(n){var e;return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("track")&&typeof((e=n.publication)==null?void 0:e.track)<"u":!1}function M9(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("publication")&&typeof n.publication<"u":!1}function N9(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&typeof n.publication>"u":!1}function D9(n){if(typeof n=="string"||typeof n=="number")return`${n}`;if(N9(n))return`${n.participant.identity}_${n.source}_placeholder`;if(Xm(n))return`${n.participant.identity}_${n.publication.source}_${n.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${n}`)}var O9=[X.ConnectionStateChanged,X.RoomMetadataChanged,X.ActiveSpeakersChanged,X.ConnectionQualityChanged,X.ParticipantConnected,X.ParticipantDisconnected,X.ParticipantPermissionsChanged,X.ParticipantMetadataChanged,X.ParticipantNameChanged,X.ParticipantAttributesChanged,X.TrackMuted,X.TrackUnmuted,X.TrackPublished,X.TrackUnpublished,X.TrackStreamStateChanged,X.TrackSubscriptionFailed,X.TrackSubscriptionPermissionChanged,X.TrackSubscriptionStatusChanged],kT=[...O9,X.LocalTrackPublished,X.LocalTrackUnpublished];ie.TrackPublished,ie.TrackUnpublished,ie.TrackMuted,ie.TrackUnmuted,ie.TrackStreamStateChanged,ie.TrackSubscribed,ie.TrackUnsubscribed,ie.TrackSubscriptionPermissionChanged,ie.TrackSubscriptionFailed,ie.LocalTrackPublished,ie.LocalTrackUnpublished;var A9=[ie.ConnectionQualityChanged,ie.IsSpeakingChanged,ie.ParticipantMetadataChanged,ie.ParticipantPermissionsChanged,ie.TrackMuted,ie.TrackUnmuted,ie.TrackPublished,ie.TrackUnpublished,ie.TrackStreamStateChanged,ie.TrackSubscriptionFailed,ie.TrackSubscriptionPermissionChanged,ie.TrackSubscriptionStatusChanged];[...A9,ie.LocalTrackPublished,ie.LocalTrackUnpublished];var Ht=qz.getLogger("lk-components-js");Ht.setDefaultLevel("WARN");var CT=(n=>(n.AgentState="lk.agent.state",n.PublishOnBehalf="lk.publish_on_behalf",n.TranscriptionFinal="lk.transcription_final",n.TranscriptionSegmentId="lk.segment_id",n.TranscribedTrackId="lk.transcribed_track_id",n))(CT||{});function TT(n){return typeof n=="object"}function ET(n){return Array.isArray(n)&&n.filter(TT).length>0}function j9(n){return`${_9}-${n}`}function P9(n){const e=lm(n),t=RT(n.participant).pipe(lr(()=>lm(n)),ur(e));return{className:j9(n.source===ee.Source.Camera||n.source===ee.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:t}}function lm(n){if(Xm(n))return n.publication;{const{source:e,name:t,participant:i}=n;if(e&&t)return i.getTrackPublications().find(a=>a.source===e&&a.trackName===t);if(t)return i.getTrackPublicationByName(t);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function xT(n,...e){return new Kt(t=>{const i=()=>{t.next(n)};return e.forEach(a=>{n.on(a,i)}),()=>{e.forEach(a=>{n.off(a,i)})}}).pipe(ur(n))}function L9(n,e){return new Kt(t=>{const i=(...a)=>{t.next(a)};return n.on(e,i),()=>{n.off(e,i)}})}function I9(n){return L9(n,X.ConnectionStateChanged).pipe(lr(([e])=>e),ur(n.state))}function U9(n,...e){return new Kt(t=>{const i=()=>{t.next(n)};return e.forEach(a=>{n.on(a,i)}),()=>{e.forEach(a=>{n.off(a,i)})}}).pipe(ur(n))}function RT(n){return U9(n,ie.TrackMuted,ie.TrackUnmuted,ie.ParticipantPermissionsChanged,ie.TrackPublished,ie.TrackUnpublished,ie.LocalTrackPublished,ie.LocalTrackUnpublished,ie.MediaDevicesError,ie.TrackSubscriptionStatusChanged).pipe(lr(e=>{const{isMicrophoneEnabled:t,isCameraEnabled:i,isScreenShareEnabled:a}=e,o=e.getTrackPublication(ee.Source.Microphone),l=e.getTrackPublication(ee.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:t,isScreenShareEnabled:a,cameraTrack:l,microphoneTrack:o,participant:e}}))}function B9(n,e){return new Kt(t=>{const i=(...a)=>{t.next(a)};return n.on(e,i),()=>{n.off(e,i)}})}function z9(n){return B9(n,ie.IsSpeakingChanged).pipe(lr(([e])=>e))}function F9(n,e={}){var t;let i;const a=new Kt(h=>(i=h,()=>u.unsubscribe())).pipe(ur(Array.from(n.remoteParticipants.values()))),o=(t=e.additionalRoomEvents)!=null?t:kT,l=Array.from(new Set([X.ParticipantConnected,X.ParticipantDisconnected,X.ConnectionStateChanged,...o])),u=xT(n,...l).subscribe(h=>i?.next(Array.from(h.remoteParticipants.values())));return n.remoteParticipants.size>0&&i?.next(Array.from(n.remoteParticipants.values())),a}function V9(){return{className:"lk-room-container"}}function pS(n,e,t=!0){const i=[n.localParticipant,...Array.from(n.remoteParticipants.values())],a=[];return i.forEach(o=>{e.forEach(l=>{const u=Array.from(o.trackPublications.values()).filter(h=>h.source===l&&(!t||h.track)).map(h=>({participant:o,publication:h,source:h.source}));a.push(...u)})}),{trackReferences:a,participants:i}}function q9(n,e,t){var i,a;const o=(i=t.additionalRoomEvents)!=null?i:kT,l=(a=t.onlySubscribed)!=null?a:!0,u=Array.from(new Set([X.ParticipantConnected,X.ParticipantDisconnected,X.ConnectionStateChanged,X.LocalTrackPublished,X.LocalTrackUnpublished,X.TrackPublished,X.TrackUnpublished,X.TrackSubscriptionStatusChanged,...o]).values());return xT(n,...u).pipe(lr(h=>{const f=pS(h,e,l);return Ht.debug(`TrackReference[] was updated. (length ${f.trackReferences.length})`,f),f}),ur(pS(n,e,l)))}E.createContext(void 0);const H9=E.createContext(void 0);function _T(){return E.useContext(H9)}function wT(n){const e=_T(),t=n??e;if(!t)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return t}const $9=E.createContext(void 0);function K9(){return E.useContext($9)}function G9(n){const e=K9(),t=_T(),i=n??e??t?.participant;if(!i)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return i}const Wm=E.createContext(void 0);function Y9(){const n=E.useContext(Wm);if(!n)throw Error("tried to access room context outside of livekit room component");return n}function J9(){return E.useContext(Wm)}function vu(n){const e=J9(),t=n??e;if(!t)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return t}E.createContext(void 0);const Q9=E.createContext(void 0);function MT(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var a=n.length;for(e=0;e<a;e++)n[e]&&(t=MT(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function X9(){for(var n,e,t=0,i="",a=arguments.length;t<a;t++)(n=arguments[t])&&(e=MT(n))&&(i&&(i+=" "),i+=e);return i}function W9(...n){return(...e)=>{for(const t of n)if(typeof t=="function")try{t(...e)}catch(i){console.error(i)}}}function NT(...n){const e={...n[0]};for(let t=1;t<n.length;t++){const i=n[t];for(const a in i){const o=e[a],l=i[a];typeof o=="function"&&typeof l=="function"&&a[0]==="o"&&a[1]==="n"&&a.charCodeAt(2)>=65&&a.charCodeAt(2)<=90?e[a]=W9(o,l):(a==="className"||a==="UNSAFE_className")&&typeof o=="string"&&typeof l=="string"?e[a]=X9(o,l):e[a]=l!==void 0?l:o}}return e}function Z9(n){return n!==void 0}function eF(...n){return NT(...n.filter(Z9))}function tF(n,e){return n==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:n==="e2ee"&&e?"e2ee-enabled":e}const nF={connect:!0,audio:!1,video:!1};function iF(n){const{token:e,serverUrl:t,options:i,room:a,connectOptions:o,connect:l,audio:u,video:h,screen:f,onConnected:m,onDisconnected:v,onError:b,onMediaDeviceFailure:C,onEncryptionError:T,simulateParticipants:S,...R}={...nF,...n};i&&a&&Ht.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[_,D]=E.useState(),j=E.useRef(l);E.useEffect(()=>{D(a??new ir(i))},[a,JSON.stringify(i,tF)]);const x=E.useMemo(()=>{const{className:w}=V9();return NT(R,{className:w})},[R]);return E.useEffect(()=>{if(!_)return;const w=()=>{const A=_.localParticipant;Ht.debug("trying to publish local tracks"),Promise.all([A.setMicrophoneEnabled(!!u,typeof u!="boolean"?u:void 0),A.setCameraEnabled(!!h,typeof h!="boolean"?h:void 0),A.setScreenShareEnabled(!!f,typeof f!="boolean"?f:void 0)]).catch(O=>{Ht.warn(O),b?.(O)})},M=(A,O)=>{const Y=Ao.getFailure(A);C?.(Y,O)},I=A=>{T?.(A)},F=A=>{v?.(A)},L=()=>{m?.()};return _.on(X.SignalConnected,w).on(X.MediaDevicesError,M).on(X.EncryptionError,I).on(X.Disconnected,F).on(X.Connected,L),()=>{_.off(X.SignalConnected,w).off(X.MediaDevicesError,M).off(X.EncryptionError,I).off(X.Disconnected,F).off(X.Connected,L)}},[_,u,h,f,b,T,C,m,v]),E.useEffect(()=>{if(_){if(S){_.simulateParticipants({participants:{count:S},publish:{audio:!0,useRealTracks:!0}});return}if(l){if(j.current=!0,Ht.debug("connecting"),!e){Ht.debug("no token yet");return}if(!t){Ht.warn("no livekit url provided"),b?.(Error("no livekit url provided"));return}_.connect(t,e,o).catch(w=>{Ht.warn(w),j.current===!0&&b?.(w)})}else Ht.debug("disconnecting because connect is false"),j.current=!1,_.disconnect()}},[l,e,JSON.stringify(o),_,b,t,S]),E.useEffect(()=>{if(_)return()=>{Ht.info("disconnecting on onmount"),_.disconnect()}},[_]),{room:_,htmlProps:x}}const sF=E.forwardRef(function(n,e){const{room:t,htmlProps:i}=iF(n);return E.createElement("div",{ref:e,...i},t&&E.createElement(Wm.Provider,{value:t},E.createElement(Q9.Provider,{value:n.featureFlags},n.children)))});function DT(n,e,t=!0){const[i,a]=E.useState(e);return E.useEffect(()=>{if(t&&a(e),typeof window>"u"||!n)return;const o=n.subscribe(a);return()=>o.unsubscribe()},[n,t]),i}function aF(n){const e=vu(n),t=E.useMemo(()=>I9(e),[e]);return DT(t,e.state)}function rF(n){const e=G9(n),t=E.useMemo(()=>z9(e),[e]);return DT(t,e.isSpeaking)}function OT(n={}){const e=vu(n.room),[t,i]=E.useState(e.localParticipant),[a,o]=E.useState(t.isMicrophoneEnabled),[l,u]=E.useState(t.isCameraEnabled),[h,f]=E.useState(t.isScreenShareEnabled),[m,v]=E.useState(t.lastMicrophoneError),[b,C]=E.useState(t.lastCameraError),[T,S]=E.useState(void 0),[R,_]=E.useState(void 0),D=j=>{u(j.isCameraEnabled),o(j.isMicrophoneEnabled),f(j.isScreenShareEnabled),_(j.cameraTrack),S(j.microphoneTrack),v(j.participant.lastMicrophoneError),C(j.participant.lastCameraError),i(j.participant)};return E.useEffect(()=>{const j=RT(e.localParticipant).subscribe(D);return()=>j.unsubscribe()},[e]),{isMicrophoneEnabled:a,isScreenShareEnabled:h,isCameraEnabled:l,microphoneTrack:T,cameraTrack:R,lastMicrophoneError:m,lastCameraError:b,localParticipant:t}}function oF(n={}){const e=vu(n.room),[t,i]=E.useState([]);return E.useEffect(()=>{const a=F9(e,{additionalRoomEvents:n.updateOnlyOn}).subscribe(i);return()=>a.unsubscribe()},[e,JSON.stringify(n.updateOnlyOn)]),t}function cF(n={}){const e=oF(n),{localParticipant:t}=OT(n);return E.useMemo(()=>[t,...e],[t,e])}function Zm(n=[ee.Source.Camera,ee.Source.Microphone,ee.Source.ScreenShare,ee.Source.ScreenShareAudio,ee.Source.Unknown],e={}){const t=vu(e.room),[i,a]=E.useState([]),[o,l]=E.useState([]),u=E.useMemo(()=>n.map(h=>TT(h)?h.source:h),[JSON.stringify(n)]);return E.useEffect(()=>{const h=q9(t,u,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:f,participants:m})=>{Ht.debug("setting track bundles",f,m),a(f),l(m)});return()=>h.unsubscribe()},[t,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(n)]),E.useMemo(()=>{if(ET(n)){const h=uF(n,o),f=Array.from(i);return o.forEach(m=>{h.has(m.identity)&&(h.get(m.identity)??[]).forEach(v=>{if(i.find(({participant:C,publication:T})=>m.identity===C.identity&&T.source===v))return;Ht.debug(`Add ${v} placeholder for participant ${m.identity}.`);const b={participant:m,source:v};f.push(b)})}),f}else return i},[i,o,n])}function lF(n,e){const t=new Set(n);for(const i of e)t.delete(i);return t}function uF(n,e){const t=new Map;if(ET(n)){const i=n.filter(a=>a.withPlaceholder).map(a=>a.source);e.forEach(a=>{const o=a.getTrackPublications().map(u=>{var h;return(h=u.track)==null?void 0:h.source}).filter(u=>u!==void 0),l=Array.from(lF(new Set(i),new Set(o)));l.length>0&&t.set(a.identity,l)})}return t}CT.AgentState;var pl={exports:{}},gS;function dF(){if(gS)return pl.exports;gS=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(x,w,M){return Function.prototype.apply.call(x,w,M)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:t=function(x){return Object.getOwnPropertyNames(x)};function i(x){console&&console.warn&&console.warn(x)}var a=Number.isNaN||function(x){return x!==x};function o(){o.init.call(this)}pl.exports=o,pl.exports.once=_,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function u(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(x){if(typeof x!="number"||x<0||a(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");l=x}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||a(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function h(x){return x._maxListeners===void 0?o.defaultMaxListeners:x._maxListeners}o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(x){for(var w=[],M=1;M<arguments.length;M++)w.push(arguments[M]);var I=x==="error",F=this._events;if(F!==void 0)I=I&&F.error===void 0;else if(!I)return!1;if(I){var L;if(w.length>0&&(L=w[0]),L instanceof Error)throw L;var A=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw A.context=L,A}var O=F[x];if(O===void 0)return!1;if(typeof O=="function")e(O,this,w);else for(var Y=O.length,J=T(O,Y),M=0;M<Y;++M)e(J[M],this,w);return!0};function f(x,w,M,I){var F,L,A;if(u(M),L=x._events,L===void 0?(L=x._events=Object.create(null),x._eventsCount=0):(L.newListener!==void 0&&(x.emit("newListener",w,M.listener?M.listener:M),L=x._events),A=L[w]),A===void 0)A=L[w]=M,++x._eventsCount;else if(typeof A=="function"?A=L[w]=I?[M,A]:[A,M]:I?A.unshift(M):A.push(M),F=h(x),F>0&&A.length>F&&!A.warned){A.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=x,O.type=w,O.count=A.length,i(O)}return x}o.prototype.addListener=function(x,w){return f(this,x,w,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(x,w){return f(this,x,w,!0)};function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(x,w,M){var I={fired:!1,wrapFn:void 0,target:x,type:w,listener:M},F=m.bind(I);return F.listener=M,I.wrapFn=F,F}o.prototype.once=function(x,w){return u(w),this.on(x,v(this,x,w)),this},o.prototype.prependOnceListener=function(x,w){return u(w),this.prependListener(x,v(this,x,w)),this},o.prototype.removeListener=function(x,w){var M,I,F,L,A;if(u(w),I=this._events,I===void 0)return this;if(M=I[x],M===void 0)return this;if(M===w||M.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete I[x],I.removeListener&&this.emit("removeListener",x,M.listener||w));else if(typeof M!="function"){for(F=-1,L=M.length-1;L>=0;L--)if(M[L]===w||M[L].listener===w){A=M[L].listener,F=L;break}if(F<0)return this;F===0?M.shift():S(M,F),M.length===1&&(I[x]=M[0]),I.removeListener!==void 0&&this.emit("removeListener",x,A||w)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(x){var w,M,I;if(M=this._events,M===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete M[x]),this;if(arguments.length===0){var F=Object.keys(M),L;for(I=0;I<F.length;++I)L=F[I],L!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=M[x],typeof w=="function")this.removeListener(x,w);else if(w!==void 0)for(I=w.length-1;I>=0;I--)this.removeListener(x,w[I]);return this};function b(x,w,M){var I=x._events;if(I===void 0)return[];var F=I[w];return F===void 0?[]:typeof F=="function"?M?[F.listener||F]:[F]:M?R(F):T(F,F.length)}o.prototype.listeners=function(x){return b(this,x,!0)},o.prototype.rawListeners=function(x){return b(this,x,!1)},o.listenerCount=function(x,w){return typeof x.listenerCount=="function"?x.listenerCount(w):C.call(x,w)},o.prototype.listenerCount=C;function C(x){var w=this._events;if(w!==void 0){var M=w[x];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function T(x,w){for(var M=new Array(w),I=0;I<w;++I)M[I]=x[I];return M}function S(x,w){for(;w+1<x.length;w++)x[w]=x[w+1];x.pop()}function R(x){for(var w=new Array(x.length),M=0;M<w.length;++M)w[M]=x[M].listener||x[M];return w}function _(x,w){return new Promise(function(M,I){function F(A){x.removeListener(w,L),I(A)}function L(){typeof x.removeListener=="function"&&x.removeListener("error",F),M([].slice.call(arguments))}j(x,w,L,{once:!0}),w!=="error"&&D(x,F,{once:!0})})}function D(x,w,M){typeof x.on=="function"&&j(x,"error",w,M)}function j(x,w,M,I){if(typeof x.on=="function")I.once?x.once(w,M):x.on(w,M);else if(typeof x.addEventListener=="function")x.addEventListener(w,function F(L){I.once&&x.removeEventListener(w,F),M(L)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}return pl.exports}dF();function AT(n,e={}){const[t,i]=E.useState(lm(n)),[a,o]=E.useState(t?.isMuted),[l,u]=E.useState(t?.isSubscribed),[h,f]=E.useState(t?.track),[m,v]=E.useState("landscape"),b=E.useRef(),{className:C,trackObserver:T}=E.useMemo(()=>P9(n),[n.participant.sid??n.participant.identity,n.source,Xm(n)&&n.publication.trackSid]);return E.useEffect(()=>{const S=T.subscribe(R=>{Ht.debug("update track",R),i(R),o(R?.isMuted),u(R?.isSubscribed),f(R?.track)});return()=>S?.unsubscribe()},[T]),E.useEffect(()=>{var S,R;return h&&(b.current&&h.detach(b.current),(S=e.element)!=null&&S.current&&!(n.participant.isLocal&&h?.kind==="audio")&&h.attach(e.element.current)),b.current=(R=e.element)==null?void 0:R.current,()=>{b.current&&h?.detach(b.current)}},[h,e.element]),E.useEffect(()=>{var S,R;if(typeof((S=t?.dimensions)==null?void 0:S.width)=="number"&&typeof((R=t?.dimensions)==null?void 0:R.height)=="number"){const _=t.dimensions.width>t.dimensions.height?"landscape":"portrait";v(_)}},[t]),{publication:t,isMuted:a,isSubscribed:l,track:h,elementProps:eF(e.props,{className:C,"data-lk-local-participant":n.participant.isLocal,"data-lk-source":t?.source,...t?.kind==="video"&&{"data-lk-orientation":m}})}}var Sf,vS;function hF(){if(vS)return Sf;vS=1;var n="Expected a function",e=NaN,t="[object Symbol]",i=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt,h=typeof fl=="object"&&fl&&fl.Object===Object&&fl,f=typeof self=="object"&&self&&self.Object===Object&&self,m=h||f||Function("return this")(),v=Object.prototype,b=v.toString,C=Math.max,T=Math.min,S=function(){return m.Date.now()};function R(w,M,I){var F,L,A,O,Y,J,le=0,Te=!1,H=!1,ae=!0;if(typeof w!="function")throw new TypeError(n);M=x(M)||0,_(I)&&(Te=!!I.leading,H="maxWait"in I,A=H?C(x(I.maxWait)||0,M):A,ae="trailing"in I?!!I.trailing:ae);function de(fe){var Je=F,$e=L;return F=L=void 0,le=fe,O=w.apply($e,Je),O}function Ee(fe){return le=fe,Y=setTimeout(W,M),Te?de(fe):O}function De(fe){var Je=fe-J,$e=fe-le,Li=M-Je;return H?T(Li,A-$e):Li}function B(fe){var Je=fe-J,$e=fe-le;return J===void 0||Je>=M||Je<0||H&&$e>=A}function W(){var fe=S();if(B(fe))return oe(fe);Y=setTimeout(W,De(fe))}function oe(fe){return Y=void 0,ae&&F?de(fe):(F=L=void 0,O)}function he(){Y!==void 0&&clearTimeout(Y),le=0,F=J=L=Y=void 0}function Ce(){return Y===void 0?O:oe(S())}function re(){var fe=S(),Je=B(fe);if(F=arguments,L=this,J=fe,Je){if(Y===void 0)return Ee(J);if(H)return Y=setTimeout(W,M),de(J)}return Y===void 0&&(Y=setTimeout(W,M)),O}return re.cancel=he,re.flush=Ce,re}function _(w){var M=typeof w;return!!w&&(M=="object"||M=="function")}function D(w){return!!w&&typeof w=="object"}function j(w){return typeof w=="symbol"||D(w)&&b.call(w)==t}function x(w){if(typeof w=="number")return w;if(j(w))return e;if(_(w)){var M=typeof w.valueOf=="function"?w.valueOf():w;w=_(M)?M+"":M}if(typeof w!="string")return w===0?w:+w;w=w.replace(i,"");var I=o.test(w);return I||l.test(w)?u(w.slice(2),I?2:8):a.test(w)?e:+w}return Sf=R,Sf}var fF=hF();const yS=ZC(fF);function mF(n){const e=E.useRef(n);e.current=n,E.useEffect(()=>()=>{e.current()},[])}function pF(n,e=500,t){const i=E.useRef();mF(()=>{i.current&&i.current.cancel()});const a=E.useMemo(()=>{const o=yS(n,e,t),l=(...u)=>o(...u);return l.cancel=()=>{o.cancel()},l.isPending=()=>!!i.current,l.flush=()=>o.flush(),l},[n,e,t]);return E.useEffect(()=>{i.current=yS(n,e,t)},[n,e,t]),a}function gF(n,e,t){const i=((f,m)=>f===m),a=n instanceof Function?n():n,[o,l]=E.useState(a),u=E.useRef(a),h=pF(l,e,t);return i(u.current,a)||(h(a),u.current=a),[o,h]}function vF({threshold:n=0,root:e=null,rootMargin:t="0%",freezeOnceVisible:i=!1,initialIsIntersecting:a=!1,onChange:o}={}){var l;const[u,h]=E.useState(null),[f,m]=E.useState(()=>({isIntersecting:a,entry:void 0})),v=E.useRef();v.current=o;const b=((l=f.entry)==null?void 0:l.isIntersecting)&&i;E.useEffect(()=>{if(!u||!("IntersectionObserver"in window)||b)return;const S=new IntersectionObserver(R=>{const _=Array.isArray(S.thresholds)?S.thresholds:[S.thresholds];R.forEach(D=>{const j=D.isIntersecting&&_.some(x=>D.intersectionRatio>=x);m({isIntersecting:j,entry:D}),v.current&&v.current(j,D)})},{threshold:n,root:e,rootMargin:t});return S.observe(u),()=>{S.disconnect()}},[u,JSON.stringify(n),e,t,b,i]);const C=E.useRef(null);E.useEffect(()=>{var S;!u&&(S=f.entry)!=null&&S.target&&!i&&!b&&C.current!==f.entry.target&&(C.current=f.entry.target,m({isIntersecting:a,entry:void 0}))},[u,f.entry,i,b,a]);const T=[h,!!f.isIntersecting,f.entry];return T.ref=T[0],T.isIntersecting=T[1],T.entry=T[2],T}const yF=E.forwardRef(function({onTrackClick:n,onClick:e,onSubscriptionStatusChanged:t,trackRef:i,manageSubscription:a,...o},l){const u=wT(i),h=E.useRef(null);E.useImperativeHandle(l,()=>h.current);const f=vF({root:h.current}),[m]=gF(f,3e3);E.useEffect(()=>{a&&u.publication instanceof Yl&&m?.isIntersecting===!1&&f?.isIntersecting===!1&&u.publication.setSubscribed(!1)},[m,u,a]),E.useEffect(()=>{a&&u.publication instanceof Yl&&f?.isIntersecting===!0&&u.publication.setSubscribed(!0)},[f,u,a]);const{elementProps:v,publication:b,isSubscribed:C}=AT(u,{element:h,props:o});E.useEffect(()=>{t?.(!!C)},[C,t]);const T=S=>{e?.(S),n?.({participant:u?.participant,track:b})};return E.createElement("video",{ref:h,...v,muted:!0,onClick:T})}),bF=E.forwardRef(function({trackRef:n,onSubscriptionStatusChanged:e,volume:t,...i},a){const o=wT(n),l=E.useRef(null);E.useImperativeHandle(a,()=>l.current);const{elementProps:u,isSubscribed:h,track:f,publication:m}=AT(o,{element:l,props:i});return E.useEffect(()=>{e?.(!!h)},[h,e]),E.useEffect(()=>{f===void 0||t===void 0||(f instanceof QC?f.setVolume(t):Ht.warn("Volume can only be set on remote audio tracks."))},[t,f]),E.useEffect(()=>{m===void 0||i.muted===void 0||(m instanceof Yl?m.setEnabled(!i.muted):Ht.warn("Can only call setEnabled on remote track publications."))},[i.muted,m,f]),E.createElement("audio",{ref:l,...u})});function SF({room:n,volume:e,muted:t}){const i=Zm([ee.Source.Microphone,ee.Source.ScreenShareAudio,ee.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0,room:n}).filter(a=>!a.participant.isLocal&&a.publication.kind===ee.Kind.Audio);return E.createElement("div",{style:{display:"none"}},i.map(a=>E.createElement(bF,{key:D9(a),trackRef:a,volume:e,muted:t})))}function bS({participant:n,compact:e=!1}){const t=rF(n),i=ge(A=>A.currentVoiceChannelId),a=ge(A=>A.voiceStates),o=ge(A=>A.userVolumes),l=ge(A=>A.setUserVolume),u=et(A=>A.user?.id),[h,f]=E.useState(!1),[m,v]=E.useState({x:0,y:0}),b=E.useRef(null),T=(i?a[i]??[]:[]).find(A=>A.user_id===n.identity),S=n.name||n.identity,R=S.charAt(0).toUpperCase(),_=T?.is_muted??!1,D=T?.is_deafened??!1,j=n.identity===u,x=o[n.identity]??100,w=`voice-participant-avatar${t?" speaking":""}`,M=E.useCallback(A=>{j||(A.preventDefault(),v({x:A.clientX,y:A.clientY}),f(!0))},[j]);E.useEffect(()=>{if(!h)return;function A(Y){b.current&&!b.current.contains(Y.target)&&f(!1)}function O(Y){Y.key==="Escape"&&f(!1)}return requestAnimationFrame(()=>{document.addEventListener("mousedown",A),document.addEventListener("keydown",O)}),()=>{document.removeEventListener("mousedown",A),document.removeEventListener("keydown",O)}},[h]),E.useEffect(()=>{if(!h||!b.current)return;const A=b.current,O=A.getBoundingClientRect(),Y=window.innerWidth,J=window.innerHeight;let le=m.x,Te=m.y;le+O.width>Y-8&&(le=Y-O.width-8),Te+O.height>J-8&&(Te=J-O.height-8),A.style.left=`${le}px`,A.style.top=`${Te}px`},[h,m]);const I=E.useCallback(A=>{l(n.identity,Number(A.target.value))},[n.identity,l]),F=_||D?g.jsx("div",{className:"voice-participant-overlay",children:D?g.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728A9 9 0 015.636 5.636"})}):g.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}):null,L=h?g.jsxs("div",{ref:b,className:"vp-vol-popup",style:{position:"fixed",left:m.x,top:m.y,zIndex:9999},children:[g.jsx("div",{className:"vp-vol-header",children:S}),g.jsxs("div",{className:"vp-vol-slider",children:[g.jsx("svg",{style:{width:14,height:14,flexShrink:0},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072M17.95 6.05a8 8 0 010 11.9M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})}),g.jsx("input",{type:"range",min:0,max:200,value:x,onChange:I,className:"vp-vol-range",style:{background:`linear-gradient(to right, var(--primary) ${x/200*100}%, var(--bg-5) ${x/200*100}%)`}}),g.jsxs("span",{className:"vp-vol-value",children:[x,"%"]})]})]}):null;return e?g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"voice-participant-compact",onContextMenu:M,children:[g.jsxs("div",{className:w,children:[R,F]}),g.jsx("span",{className:"voice-participant-name",children:S})]}),L]}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"voice-participant",onContextMenu:M,children:[g.jsxs("div",{className:w,children:[R,F]}),g.jsx("span",{className:"voice-participant-name",children:S})]}),L]})}function kF(){const{t:n}=ye("voice"),e=cF(),i=Zm([{source:ee.Source.ScreenShare,withPlaceholder:!1}],{onlySubscribed:!0}).length>0;return e.length===0?i?null:g.jsx("div",{className:"voice-room-loading",children:g.jsx("p",{children:n("noOneInVoice")})}):i?g.jsx("div",{className:"voice-grid-strip",children:e.map(a=>g.jsx(bS,{participant:a,compact:!0},a.identity))}):g.jsx("div",{className:"voice-room-grid",children:e.map(a=>g.jsx(bS,{participant:a},a.identity))})}function CF(){const{t:n}=ye("voice"),e=aF();if(e===Be.Connected)return null;const i={[Be.Connecting]:{message:n("connectingToVoice"),dotClass:"voice-connection-dot connecting",textClass:"voice-connection-text warning"},[Be.Reconnecting]:{message:n("reconnectingToVoice"),dotClass:"voice-connection-dot connecting",textClass:"voice-connection-text warning"},[Be.Disconnected]:{message:n("voiceDisconnectedHint"),dotClass:"voice-connection-dot error",textClass:"voice-connection-text error"}}[e]??{message:e,dotClass:"voice-connection-dot",textClass:"voice-connection-text muted"};return g.jsxs("div",{className:"voice-connection-status",children:[g.jsx("span",{className:i.dotClass}),g.jsx("span",{className:i.textClass,children:i.message})]})}function kf({trackRef:n}){const{t:e}=ye("voice"),t=E.useRef(null),[i,a]=E.useState(!1);E.useEffect(()=>{function u(){a(document.fullscreenElement===t.current)}return document.addEventListener("fullscreenchange",u),()=>{document.removeEventListener("fullscreenchange",u)}},[]);const o=E.useCallback(()=>{t.current&&(document.fullscreenElement?document.exitFullscreen().catch(u=>{console.error("[ScreenSharePanel] Failed to exit fullscreen:",u)}):t.current.requestFullscreen().catch(u=>{console.error("[ScreenSharePanel] Failed to enter fullscreen:",u)}))},[]),l=n.participant.name||n.participant.identity;return g.jsxs("div",{ref:t,className:"screen-share-panel",children:[n.publication&&g.jsx(yF,{trackRef:n}),g.jsxs("div",{className:"screen-share-panel-overlay",children:[g.jsx("span",{className:"screen-share-panel-label",children:l}),g.jsx("button",{onClick:o,className:"screen-share-panel-btn",title:e(i?"exitFullscreen":"fullscreen"),children:i?g.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}):g.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})})})]})]})}function TF({direction:n,onResize:e}){const t=E.useRef(0),i=E.useRef(!1),a=E.useCallback(h=>{h.currentTarget.setPointerCapture(h.pointerId),i.current=!0,t.current=n==="vertical"?h.clientY:h.clientX,h.preventDefault()},[n]),o=E.useCallback(h=>{if(!i.current)return;const f=n==="vertical"?h.clientY:h.clientX,m=f-t.current;t.current=f,m!==0&&e(m)},[n,e]),l=E.useCallback(h=>{i.current=!1,h.currentTarget.releasePointerCapture(h.pointerId)},[]),u=`screen-share-resize ${n}`;return g.jsx("div",{className:u,onPointerDown:a,onPointerMove:o,onPointerUp:l,style:{touchAction:"none"},children:g.jsx("div",{className:"screen-share-resize-line"})})}const EF=20,xF=80,SS=50;function RF(){const{t:n}=ye("voice"),e=Zm([{source:ee.Source.ScreenShare,withPlaceholder:!1}],{onlySubscribed:!0}),[t,i]=E.useState("vertical"),[a,o]=E.useState(SS),l=E.useRef(null);E.useEffect(()=>{e.length<2&&o(SS)},[e.length]);const u=E.useCallback(v=>{if(!l.current)return;const b=t==="vertical"?l.current.clientHeight:l.current.clientWidth;if(b===0)return;const C=v/b*100;o(T=>Math.max(EF,Math.min(xF,T+C)))},[t]),h=E.useCallback(()=>{i(v=>v==="vertical"?"horizontal":"vertical")},[]);if(e.length===0)return null;if(e.length===1)return g.jsx("div",{className:"screen-share-view",children:g.jsx(kf,{trackRef:e[0]})});const f=t==="vertical",m=`screen-share-split ${f?"vertical":"horizontal"}`;return g.jsxs("div",{className:"screen-share-view",children:[g.jsx("button",{onClick:h,className:"screen-share-toggle",title:n("toggleLayout"),children:f?g.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v18M3.75 3h16.5a.75.75 0 01.75.75v16.5a.75.75 0 01-.75.75H3.75a.75.75 0 01-.75-.75V3.75A.75.75 0 013.75 3z"})}):g.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h18M3.75 3h16.5a.75.75 0 01.75.75v16.5a.75.75 0 01-.75.75H3.75a.75.75 0 01-.75-.75V3.75A.75.75 0 013.75 3z"})})}),g.jsxs("div",{ref:l,className:m,children:[g.jsx("div",{style:{flex:a},className:"screen-share-pane",children:g.jsx(kf,{trackRef:e[0]})}),g.jsx(TF,{direction:t,onResize:u}),g.jsx("div",{style:{flex:100-a},className:"screen-share-pane",children:g.jsx(kf,{trackRef:e[1]})})]})]})}function _F(){const{t:n}=ye("voice"),e=ge(i=>i.livekitUrl),t=ge(i=>i.livekitToken);return!e||!t?g.jsx("div",{className:"voice-room-loading",children:g.jsx("p",{children:n("connectingToVoice")})}):g.jsxs("div",{className:"voice-room",children:[g.jsx(CF,{}),g.jsx(RF,{}),g.jsx(kF,{})]})}function wF(){return be("/dms")}function MF(n){return be("/dms",{method:"POST",body:{user_id:n}})}function kS(n,e,t=50){const i=new URLSearchParams;return e&&i.set("before",e),i.set("limit",String(t)),be(`/dms/${n}/messages?${i}`)}function NF(n,e){return be(`/dms/${n}/messages`,{method:"POST",body:{content:e}})}function DF(n,e){return be(`/dms/messages/${n}`,{method:"PATCH",body:{content:e}})}function OF(n){return be(`/dms/messages/${n}`,{method:"DELETE"})}const AF=[],jF=[],st=Pt((n,e)=>({channels:AF,selectedDMId:null,messagesByChannel:{},hasMoreByChannel:{},dmUnreadCounts:{},isLoading:!1,isLoadingMessages:!1,fetchChannels:async()=>{n({isLoading:!0});const t=await wF();t.success&&t.data?n({channels:t.data,isLoading:!1}):n({isLoading:!1})},selectDM:t=>{n({selectedDMId:t})},createOrGetChannel:async t=>{const i=await MF(t);return i.success&&i.data?(n(a=>a.channels.some(l=>l.id===i.data.id)?a:{channels:[i.data,...a.channels]}),i.data.id):null},fetchMessages:async t=>{if(e().messagesByChannel[t])return;n({isLoadingMessages:!0});const i=await kS(t,void 0,50);i.success&&i.data?n(a=>({messagesByChannel:{...a.messagesByChannel,[t]:i.data.messages},hasMoreByChannel:{...a.hasMoreByChannel,[t]:i.data.has_more},isLoadingMessages:!1})):n({isLoadingMessages:!1})},fetchOlderMessages:async t=>{const i=e().messagesByChannel[t];if(!i||i.length===0||!e().hasMoreByChannel[t])return;const a=i[0].id,o=await kS(t,a,50);o.success&&o.data&&n(l=>({messagesByChannel:{...l.messagesByChannel,[t]:[...o.data.messages,...l.messagesByChannel[t]]},hasMoreByChannel:{...l.hasMoreByChannel,[t]:o.data.has_more}}))},sendMessage:async(t,i)=>(await NF(t,i)).success,editMessage:async(t,i)=>(await DF(t,i)).success,deleteMessage:async t=>(await OF(t)).success,incrementDMUnread:t=>{n(i=>({dmUnreadCounts:{...i.dmUnreadCounts,[t]:(i.dmUnreadCounts[t]??0)+1}}))},clearDMUnread:t=>{n(i=>{if(!i.dmUnreadCounts[t])return i;const a={...i.dmUnreadCounts};return delete a[t],{dmUnreadCounts:a}})},getTotalDMUnread:()=>{const t=e().dmUnreadCounts;return Object.values(t).reduce((i,a)=>i+a,0)},handleDMChannelCreate:t=>{n(i=>i.channels.some(a=>a.id===t.id)?i:{channels:[t,...i.channels]})},handleDMMessageCreate:t=>{n(i=>{const a=i.messagesByChannel[t.dm_channel_id];return!a||a.some(o=>o.id===t.id)?i:{messagesByChannel:{...i.messagesByChannel,[t.dm_channel_id]:[...a,t]}}})},handleDMMessageUpdate:t=>{n(i=>{const a=i.messagesByChannel[t.dm_channel_id];return a?{messagesByChannel:{...i.messagesByChannel,[t.dm_channel_id]:a.map(o=>o.id===t.id?t:o)}}:i})},handleDMMessageDelete:t=>{n(i=>{const a=i.messagesByChannel[t.dm_channel_id];return a?{messagesByChannel:{...i.messagesByChannel,[t.dm_channel_id]:a.filter(o=>o.id!==t.id)}}:i})},getMessagesForChannel:t=>e().messagesByChannel[t]??jF}));function PF({channelId:n}){const{t:e}=ye("chat"),t=et(J=>J.user),i=st(J=>J.fetchMessages),a=st(J=>J.messagesByChannel[n]??LF),o=st(J=>J.isLoadingMessages),l=st(J=>J.sendMessage),u=st(J=>J.editMessage),h=st(J=>J.deleteMessage),f=st(J=>J.channels),m=st(J=>J.selectDM),v=st(J=>J.clearDMUnread),[b,C]=E.useState(""),[T,S]=E.useState(!1),[R,_]=E.useState(null),[D,j]=E.useState(""),x=E.useRef(null),w=E.useRef(null),M=f.find(J=>J.id===n)?.other_user;E.useEffect(()=>{i(n)},[n,i]),E.useEffect(()=>(m(n),v(n),()=>{m(null)}),[n,m,v]),E.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[a.length]);const I=E.useCallback(async()=>{if(!b.trim()||T)return;S(!0),await l(n,b.trim())&&(C(""),w.current&&(w.current.style.height="auto")),S(!1)},[n,b,T,l]);function F(J){J.key==="Enter"&&!J.shiftKey&&(J.preventDefault(),I())}function L(J){C(J.target.value),w.current&&(w.current.style.height="auto",w.current.style.height=`${Math.min(w.current.scrollHeight,200)}px`)}async function A(J){D.trim()&&await u(J,D.trim()),_(null)}function O(J){return new Date(J).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Y(J,le){return!J||J.user_id!==le.user_id?!1:new Date(le.created_at).getTime()-new Date(J.created_at).getTime()<300*1e3}return o&&a.length===0?g.jsx("div",{className:"chat-area",children:g.jsx("div",{className:"dm-loading",children:e("loading",{ns:"common"})})}):g.jsxs("div",{className:"chat-area",children:[g.jsxs("div",{className:"dm-header",children:[g.jsx(Cn,{name:M?.display_name??M?.username??"?",avatarUrl:M?.avatar_url??void 0,size:24}),g.jsx("span",{className:"dm-header-name",children:M?.display_name??M?.username??"DM"})]}),g.jsxs("div",{className:"messages-scroll",children:[a.map((J,le)=>{const Te=Y(a[le-1],J),H=t?.id===J.user_id,ae=J.author?.display_name??J.author?.username??"Unknown";return g.jsxs("div",{className:`msg${Te?" grouped":" first-of-group"}`,children:[g.jsx("span",{className:"msg-gtime",children:O(J.created_at)}),g.jsxs("div",{className:"msg-row",children:[g.jsx("div",{className:"msg-avatar",children:g.jsx(Cn,{name:ae,avatarUrl:J.author?.avatar_url??void 0,size:30})}),g.jsxs("div",{className:"msg-body",children:[g.jsxs("div",{className:"msg-meta",children:[g.jsx("span",{className:"msg-name name-default",children:ae}),g.jsx("span",{className:"msg-time",children:O(J.created_at)})]}),R===J.id?g.jsxs("div",{className:"msg-edit-area",children:[g.jsx("textarea",{value:D,onChange:de=>j(de.target.value),onKeyDown:de=>{de.key==="Enter"&&!de.shiftKey&&(de.preventDefault(),A(J.id)),de.key==="Escape"&&_(null)},className:"msg-edit-textarea",rows:2,autoFocus:!0}),g.jsxs("p",{className:"msg-edit-hint",children:["escape = ",e("editCancel"),", enter = ",e("editSave")]})]}):g.jsxs("div",{className:"msg-text",children:[J.content,J.edited_at&&g.jsx("span",{className:"msg-edited",children:e("edited")})]})]})]}),H&&R!==J.id&&g.jsxs("div",{className:"msg-hover-actions",children:[g.jsx("button",{onClick:()=>{j(J.content??""),_(J.id)},title:e("editMessage"),children:g.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),g.jsx("button",{onClick:()=>h(J.id),title:e("deleteMessage"),children:g.jsx("svg",{style:{width:14,height:14},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},J.id)}),g.jsx("div",{ref:x})]}),g.jsx("div",{className:"input-area",children:g.jsxs("div",{className:"input-box",children:[g.jsx("textarea",{ref:w,value:b,onChange:L,onKeyDown:F,placeholder:e("dmPlaceholder",{user:M?.username??"DM"}),rows:1,disabled:T}),g.jsx("button",{className:"send-btn",onClick:I,children:g.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:g.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]})})]})}const LF=[];function IF(){return be("/friends")}function UF(){return be("/friends/requests")}function BF(n){return be("/friends/requests",{method:"POST",body:{username:n}})}function zF(n){return be(`/friends/requests/${n}/accept`,{method:"POST"})}function FF(n){return be(`/friends/requests/${n}`,{method:"DELETE"})}function VF(n){return be(`/friends/${n}`,{method:"DELETE"})}const qF=[],HF=[],$F=[],Dt=Pt((n,e)=>({friends:qF,incoming:HF,outgoing:$F,isLoading:!1,fetchFriends:async()=>{n({isLoading:!0});try{const t=await IF();t.success&&t.data&&n({friends:t.data})}finally{n({isLoading:!1})}},fetchRequests:async()=>{try{const t=await UF();t.success&&t.data&&n({incoming:t.data.incoming,outgoing:t.data.outgoing})}catch{}},sendRequest:async t=>{const i=await BF(t);return i.success&&i.data?(i.data.status==="accepted"?n(a=>({friends:[i.data,...a.friends]})):n(a=>({outgoing:[i.data,...a.outgoing]})),{success:!0}):{success:!1,error:i.error}},acceptRequest:async t=>{const i=await zF(t);return i.success&&i.data?(n(a=>({incoming:a.incoming.filter(o=>o.id!==t),friends:[i.data,...a.friends]})),!0):!1},declineRequest:async t=>(await FF(t)).success?(n(a=>({incoming:a.incoming.filter(o=>o.id!==t),outgoing:a.outgoing.filter(o=>o.id!==t)})),!0):!1,removeFriend:async t=>(await VF(t)).success?(n(a=>({friends:a.friends.filter(o=>o.user_id!==t)})),!0):!1,handleFriendRequestCreate:t=>{n(i=>({incoming:[t,...i.incoming]}))},handleFriendRequestAccept:t=>{const{outgoing:i}=e();n({outgoing:i.filter(a=>a.id!==t.id),friends:[t,...e().friends]})},handleFriendRequestDecline:t=>{n(i=>({incoming:i.incoming.filter(a=>a.id!==t.id),outgoing:i.outgoing.filter(a=>a.id!==t.id)}))},handleFriendRemove:t=>{n(i=>({friends:i.friends.filter(a=>a.user_id!==t.user_id)}))}}));function KF({friendship:n,type:e,onAccept:t,onDecline:i,onRemove:a}){const{t:o}=ye("common"),l=n.display_name??n.username,u=n.user_status;return g.jsxs("div",{className:"fi-item",children:[g.jsxs("div",{className:"fi-info",children:[g.jsx(Cn,{name:l,avatarUrl:n.avatar_url??void 0,size:36,isCircle:!0}),g.jsxs("div",{className:"fi-text",children:[g.jsx("span",{className:"fi-name",children:l}),g.jsxs("span",{className:"fi-username",children:["@",n.username]}),e==="friend"&&g.jsxs("span",{className:`fi-status fi-status-${n.user_status}`,children:[o(u),n.user_custom_status&&`  ${n.user_custom_status}`]})]})]}),g.jsxs("div",{className:"fi-actions",children:[e==="incoming"&&g.jsxs(g.Fragment,{children:[g.jsx("button",{className:"fi-btn fi-btn-accept",onClick:t,title:o("friendAccept"),children:""}),g.jsx("button",{className:"fi-btn fi-btn-decline",onClick:i,title:o("friendDecline"),children:""})]}),e==="outgoing"&&g.jsx("button",{className:"fi-btn fi-btn-decline",onClick:i,title:o("cancel"),children:""}),e==="friend"&&g.jsx("button",{className:"fi-btn fi-btn-remove",onClick:a,title:o("friendRemove"),children:""})]})]})}function GF(){const{t:n}=ye("common"),[e,t]=E.useState(""),[i,a]=E.useState(!1),[o,l]=E.useState(null),u=Dt(f=>f.sendRequest);async function h(f){f.preventDefault();const m=e.trim();if(!m||i)return;a(!0),l(null);const v=await u(m);v.success?(l({success:!0,message:n("friendRequestSent",{username:m})}),t("")):l({success:!1,message:v.error??n("somethingWentWrong")}),a(!1)}return g.jsxs("div",{className:"frf-container",children:[g.jsx("h3",{className:"frf-title",children:n("addFriend")}),g.jsx("p",{className:"frf-desc",children:n("addFriendDesc")}),g.jsxs("form",{className:"frf-form",onSubmit:h,children:[g.jsx("input",{className:"frf-input",type:"text",placeholder:n("addFriendPlaceholder"),value:e,onChange:f=>t(f.target.value),disabled:i,autoFocus:!0}),g.jsx("button",{className:"frf-btn",type:"submit",disabled:i||e.trim().length===0,children:n(i?"loading":"friendSendRequest")})]}),o&&g.jsx("div",{className:`frf-result ${o.success?"frf-success":"frf-error"}`,children:o.message})]})}function YF(){const{t:n}=ye("common"),[e,t]=E.useState("online"),i=Dt(T=>T.friends),a=Dt(T=>T.incoming),o=Dt(T=>T.outgoing),l=Dt(T=>T.isLoading),u=Dt(T=>T.fetchFriends),h=Dt(T=>T.fetchRequests),f=Dt(T=>T.acceptRequest),m=Dt(T=>T.declineRequest),v=Dt(T=>T.removeFriend);E.useEffect(()=>{u(),h()},[u,h]);const b=i.filter(T=>T.user_status!=="offline");function C(T,S){return T.length===0?g.jsx("div",{className:"fv-empty",children:n(S==="friend"?"noFriendsYet":S==="incoming"?"noIncomingRequests":"noOutgoingRequests")}):g.jsx("div",{className:"fv-list",children:T.map(R=>g.jsx(KF,{friendship:R,type:S,onAccept:S==="incoming"?()=>f(R.id):void 0,onDecline:S==="incoming"||S==="outgoing"?()=>m(R.id):void 0,onRemove:S==="friend"?()=>v(R.user_id):void 0},R.id))})}return g.jsxs("div",{className:"friends-view",children:[g.jsxs("div",{className:"fv-header",children:[g.jsx("h2",{className:"fv-title",children:n("friends")}),g.jsxs("div",{className:"fv-tabs",children:[g.jsxs("button",{className:`fv-tab${e==="online"?" active":""}`,onClick:()=>t("online"),children:[n("friendsOnline"),b.length>0&&g.jsx("span",{className:"fv-tab-count",children:b.length})]}),g.jsxs("button",{className:`fv-tab${e==="all"?" active":""}`,onClick:()=>t("all"),children:[n("friendsAll"),i.length>0&&g.jsx("span",{className:"fv-tab-count",children:i.length})]}),g.jsxs("button",{className:`fv-tab${e==="pending"?" active":""}`,onClick:()=>t("pending"),children:[n("friendsPending"),a.length+o.length>0&&g.jsx("span",{className:"fv-tab-count",children:a.length+o.length})]}),g.jsx("button",{className:`fv-tab fv-tab-add${e==="add"?" active":""}`,onClick:()=>t("add"),children:n("addFriend")})]})]}),g.jsx("div",{className:"fv-content",children:l?g.jsx("div",{className:"fv-empty",children:n("loading")}):e==="online"?C(b,"friend"):e==="all"?C(i,"friend"):e==="pending"?g.jsxs("div",{children:[a.length>0&&g.jsxs("div",{className:"fv-pending-section",children:[g.jsxs("h3",{className:"fv-pending-title",children:[n("friendsIncoming"),"  ",a.length]}),C(a,"incoming")]}),o.length>0&&g.jsxs("div",{className:"fv-pending-section",children:[g.jsxs("h3",{className:"fv-pending-title",children:[n("friendsOutgoing"),"  ",o.length]}),C(o,"outgoing")]}),a.length===0&&o.length===0&&g.jsx("div",{className:"fv-empty",children:n("noPendingRequests")})]}):g.jsx(GF,{})})]})}const JF=["left","right","top","bottom","center"];function Cf(n,e,t){const i=(n-t.left)/t.width,a=(e-t.top)/t.height,o=i,l=1-i,u=a,h=1-a,f=Math.min(o,l,u,h);return f>=.25?"center":f===o?"left":f===l?"right":f===u?"top":"bottom"}function QF({activeZone:n}){return n?g.jsx("div",{className:"drop-zone-overlay active",children:JF.map(e=>g.jsx("div",{className:`drop-zone drop-zone-${e}${n===e?" highlight":""}`},e))}):null}function XF({panelId:n,sendTyping:e}){const{t}=ye("chat"),i=Ye(x=>x.panels[n]),a=Ye(x=>x.setActivePanel),o=Ye(x=>x.splitPanel),l=Ye(x=>x.moveTab),u=Ye(x=>Object.keys(x.panels).length),h=Ot(x=>x.categories),f=i?.tabs.find(x=>x.id===i.activeTabId),m=f?h.flatMap(x=>x.channels).find(x=>x.id===f.channelId):null,[v,b]=E.useState(null),C=E.useRef(null),T=E.useRef(0),S=E.useCallback(()=>{a(n)},[n,a]),R=E.useCallback(x=>{if(x.dataTransfer.types.includes("text/tab-id")&&(x.preventDefault(),T.current+=1,T.current===1&&C.current)){const w=C.current.getBoundingClientRect();b(Cf(x.clientX,x.clientY,w))}},[]),_=E.useCallback(x=>{if(!x.dataTransfer.types.includes("text/tab-id")||(x.preventDefault(),x.dataTransfer.dropEffect="move",!C.current))return;const w=C.current.getBoundingClientRect();b(Cf(x.clientX,x.clientY,w))},[]),D=E.useCallback(x=>{x.preventDefault(),T.current-=1,T.current<=0&&(T.current=0,b(null))},[]),j=E.useCallback(x=>{x.preventDefault(),T.current=0,b(null);const w=x.dataTransfer.getData("text/tab-id"),M=x.dataTransfer.getData("text/panel-id");if(!w||!M||!C.current)return;const I=C.current.getBoundingClientRect(),F=Cf(x.clientX,x.clientY,I);if(!(M===n&&(F==="center"||!i||i.tabs.length<2)))switch(F){case"center":l(M,n,w);break;case"left":o(n,"horizontal",w,"before");break;case"right":o(n,"horizontal",w,"after");break;case"top":o(n,"vertical",w,"before");break;case"bottom":o(n,"vertical",w,"after");break}},[n,i,o,l]);return i?g.jsxs("div",{ref:C,className:"split-pane",style:{flex:1,position:"relative"},onClick:S,onDragEnter:R,onDragOver:_,onDragLeave:D,onDrop:j,children:[g.jsx(QF,{activeZone:v}),u>1&&g.jsx(N4,{panelId:n}),f?f.type==="text"?g.jsx(m5,{channelId:f.channelId,channel:m??null,sendTyping:e}):f.type==="dm"?g.jsx(PF,{channelId:f.channelId}):f.type==="friends"?g.jsx(YF,{}):g.jsxs("div",{className:"voice-room",children:[m&&g.jsxs("div",{className:"channel-bar",children:[g.jsx("span",{className:"ch-hash",children:f.type==="voice"?"":""}),g.jsx("span",{className:"ch-name",children:m.name})]}),g.jsx(_F,{})]}):g.jsx("div",{className:"no-channel",children:t("noChannel")})]}):null}function um({node:n,path:e=[],sendTyping:t}){if(n.type==="leaf")return g.jsx(XF,{panelId:n.panelId,sendTyping:t});const i=n.direction==="vertical";return g.jsxs("div",{className:`split-container${i?" vertical":""}`,children:[g.jsx("div",{className:"split-pane",style:{flex:n.ratio},children:g.jsx(um,{node:n.children[0],path:[...e,0],sendTyping:t})}),g.jsx(WF,{direction:n.direction,path:e,ratio:n.ratio}),g.jsx("div",{className:"split-pane",style:{flex:1-n.ratio},children:g.jsx(um,{node:n.children[1],path:[...e,1],sendTyping:t})})]})}function WF({direction:n,path:e}){const t=Ye(f=>f.setSplitRatio),[i,a]=E.useState(!1),o=E.useRef(null),l=n==="horizontal",u=E.useCallback(f=>{f.preventDefault(),a(!0);const m=o.current?.parentElement;if(!m)return;const v=m.getBoundingClientRect();function b(T){const S=l?(T.clientX-v.left)/v.width:(T.clientY-v.top)/v.height;t(e,S)}function C(){a(!1),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",C)}document.addEventListener("mousemove",b),document.addEventListener("mouseup",C)},[l,e,t]),h=`split-handle ${l?"horizontal":"vertical"}${i?" active":""}`;return g.jsx("div",{ref:o,className:h,onMouseDown:u,children:g.jsx("div",{className:"split-handle-dot"})})}function ZF(n){try{const e=localStorage.getItem(n);if(e){const t=Number(e);if(Number.isFinite(t)&&t>0)return t}}catch{}return null}function eV(n,e){try{localStorage.setItem(n,String(Math.round(e)))}catch{}}function jT(n){const{initialWidth:e,minWidth:t,maxWidth:i,direction:a,storageKey:o,onWidthChange:l}=n,[u,h]=E.useState(()=>{const S=ZF(o);return S!==null?Math.min(Math.max(S,t),i):e}),[f,m]=E.useState(!1),v=E.useRef(0),b=E.useRef(0),C=E.useCallback(S=>{S.preventDefault(),v.current=S.clientX,b.current=u,m(!0),document.body.style.userSelect="none",document.body.style.cursor="col-resize"},[u,a]);E.useEffect(()=>{if(!f)return;function S(_){const D=_.clientX-v.current,j=a==="right"?b.current+D:b.current-D,x=Math.min(Math.max(j,t),i);h(x),l?.(x)}function R(){m(!1),document.body.style.userSelect="",document.body.style.cursor=""}return document.addEventListener("mousemove",S),document.addEventListener("mouseup",R),()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",R)}},[f,a,t,i,l]);const T=E.useRef(!1);return E.useEffect(()=>{T.current&&!f&&eV(o,u),T.current=f},[f,u,o]),{width:u,handleMouseDown:C,isDragging:f}}function tV({role:n}){return g.jsxs("span",{className:"role-badge",children:[g.jsx("span",{className:"role-badge-dot",style:{backgroundColor:n.color||"#99AAB5"}}),n.name]})}function nV({member:n,position:e,onClose:t}){const{t:i}=ye("common"),a=cr(),o=E.useRef(null),l=et(_=>_.user),h=mt(_=>_.members.find(D=>D.id===l?.id))?.effective_permissions??0,f=l?.id===n.id,m=!f&&cn(h,Ne.KickMembers),v=!f&&cn(h,Ne.BanMembers);E.useEffect(()=>{let _;function D(j){o.current&&!o.current.contains(j.target)&&t()}return _=requestAnimationFrame(()=>{document.addEventListener("mousedown",D)}),()=>{cancelAnimationFrame(_),document.removeEventListener("mousedown",D)}},[t]);const b=[...n.roles].sort((_,D)=>D.position-_.position),C=new Date(n.created_at).toLocaleDateString();async function T(){await a({message:i("confirmKick",{username:n.username}),confirmLabel:i("kick"),danger:!0})&&(await ym(n.id),t())}async function S(){await a({message:i("confirmBan",{username:n.username}),confirmLabel:i("ban"),danger:!0})&&(await bm(n.id,""),t())}async function R(){const _=await st.getState().createOrGetChannel(n.id);if(_){const D=n.display_name??n.username;Ye.getState().openTab(_,"dm",D)}t()}return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"member-card-backdrop",onClick:t}),g.jsxs("div",{ref:o,className:"member-card",style:{top:e.top,left:e.left},children:[g.jsx("div",{className:"member-card-banner",style:b[0]?.color?{background:`linear-gradient(135deg, ${b[0].color}, var(--secondary))`}:void 0}),g.jsx("div",{className:"member-card-avatar",children:g.jsx("div",{className:"avatar av-default avatar-round",style:{width:64,height:64,fontSize:24},children:n.username.charAt(0).toUpperCase()})}),g.jsxs("div",{className:"member-card-body",children:[g.jsx("div",{className:"member-card-name",children:n.display_name??n.username}),n.display_name&&g.jsx("div",{className:"member-card-username",children:n.username}),n.custom_status&&g.jsx("div",{className:"member-card-username",style:{marginTop:4},children:n.custom_status}),g.jsx("div",{className:"member-card-divider"}),g.jsx("div",{className:"member-card-section-title",children:i("roles")}),g.jsx("div",{className:"member-card-roles",children:b.length>0?b.map(_=>g.jsx(tV,{role:_},_.id)):g.jsx("span",{className:"member-card-joined",children:i("noRoles")})}),g.jsx("div",{className:"member-card-divider"}),g.jsx("div",{className:"member-card-joined",children:i("joinedAt",{date:C})}),g.jsxs("div",{className:"member-card-actions",children:[!f&&g.jsx("button",{className:"member-card-btn member-card-btn-dm",onClick:R,children:i("sendMessage")}),m&&g.jsx("button",{className:"member-card-btn member-card-btn-kick",onClick:T,children:i("kick")}),v&&g.jsx("button",{className:"member-card-btn member-card-btn-ban",onClick:S,children:i("ban")})]})]})]})]})}function PT(n){return n.roles.length===0?null:n.roles.reduce((e,t)=>t.position>e.position?t:e)}function iV(n){const e=PT(n);if(!e)return null;const t=e.name.toLowerCase();return t.includes("admin")||t.includes("owner")?"admin":t.includes("mod")?"mod":null}function sV(n){switch(n){case"online":return"status-on";case"idle":return"status-idle";case"dnd":return"status-dnd";default:return"status-off"}}function Tf({member:n,isOnline:e}){const{t}=ye("common"),{menuState:i,openMenu:a,closeMenu:o}=sk(),l=cr(),u=et(x=>x.user),h=mt(x=>x.members),[f,m]=E.useState(!1),[v,b]=E.useState({top:0,left:0}),C=E.useRef(null),T=PT(n),S=iV(n),R=T?.color||void 0,_=n.display_name??n.username,D=E.useCallback(x=>{const w=u?.id===n.id,I=h.find(O=>O.id===u?.id)?.effective_permissions??0,F=cn(I,Ne.KickMembers),L=cn(I,Ne.BanMembers),A=[];w||A.push({label:t("sendMessage"),onClick:async()=>{const O=await st.getState().createOrGetChannel(n.id);O&&(st.getState().selectDM(O),Ye.getState().openTab(O,"dm",n.display_name??n.username))}}),A.push({label:"Copy ID",onClick:()=>navigator.clipboard.writeText(n.id),separator:!w}),F&&!w&&A.push({label:t("kick"),onClick:async()=>{await l({message:t("confirmKick",{username:n.username}),confirmLabel:t("kick"),danger:!0})&&await ym(n.id)},danger:!0,separator:!0}),L&&!w&&A.push({label:t("ban"),onClick:async()=>{await l({message:t("confirmBan",{username:n.username}),confirmLabel:t("ban"),danger:!0})&&await bm(n.id,"")},danger:!0}),a(x,A)},[u,n,h,a,l,t]),j=E.useCallback(()=>{if(f){m(!1);return}if(C.current){const x=C.current.getBoundingClientRect(),w=288,M=8;let I=x.top;const F=350;I+F>window.innerHeight&&(I=window.innerHeight-F-16),I<8&&(I=8),b({top:I,left:x.left-w-M})}m(!0)},[f]);return g.jsxs(g.Fragment,{children:[g.jsxs("div",{ref:C,onClick:j,onContextMenu:D,className:`member${e?"":" offline"}`,children:[g.jsxs("div",{className:"member-av-wrap",children:[g.jsx(Cn,{name:n.username,role:S,avatarUrl:n.avatar_url??void 0,size:32}),g.jsx("span",{className:`member-status ${sV(n.status)}`})]}),g.jsxs("div",{className:"member-info",children:[g.jsx("span",{className:"member-name",style:R?{color:R}:void 0,children:_}),n.custom_status&&g.jsx("span",{className:"member-activity",children:n.custom_status})]})]}),g.jsx(ak,{state:i,onClose:o}),f&&qS.createPortal(g.jsx(nV,{member:n,position:v,onClose:()=>m(!1)}),document.body)]})}const aV=160,rV=360,oV=240;function cV(n){return n.roles.length===0?null:n.roles.reduce((e,t)=>t.position>e.position?t:e)}function lV(n){const e=new Map;for(const i of n){const a=cV(i);if(!a)continue;const o=e.get(a.id);o?o.members.push(i):e.set(a.id,{role:a,members:[i]})}const t=Array.from(e.values()).sort((i,a)=>a.role.position-i.role.position);for(const i of t)i.members.sort((a,o)=>{const l=a.display_name??a.username,u=o.display_name??o.username;return l.localeCompare(u)});return t}function uV(){const{t:n}=ye("common"),e=mt(S=>S.members),t=mt(S=>S.isLoading),i=mt(S=>S.onlineUserIds),a=Ye(S=>S.toggleMembers),o=Ye(S=>S.membersOpen),{width:l,handleMouseDown:u,isDragging:h}=jT({initialWidth:oV,minWidth:aV,maxWidth:rV,direction:"left",storageKey:"mqvi_members_width"}),f=e.filter(S=>i.has(S.id)),m=e.filter(S=>!i.has(S.id)),v=lV(f),b=f.filter(S=>S.roles.length===0),C=[...m].sort((S,R)=>{const _=S.display_name??S.username,D=R.display_name??R.username;return _.localeCompare(D)}),T=o?l:0;return g.jsxs("div",{className:`members-panel${o?" open":""}`,style:o?{width:T}:void 0,children:[o&&g.jsx("div",{className:`resize-handle resize-handle-v${h?" active":""}`,onMouseDown:u}),g.jsxs("div",{className:"members-inner",style:{width:l},children:[g.jsxs("div",{className:"members-header",children:[g.jsx("h3",{children:n("members")}),g.jsx("button",{onClick:a,children:""})]}),g.jsxs("div",{className:"members-list",children:[t&&e.length===0&&g.jsx(J4,{count:8}),v.map(S=>g.jsxs("div",{children:[g.jsxs("div",{className:"member-label",children:[S.role.name,"  ",S.members.length]}),S.members.map(R=>g.jsx(Tf,{member:R,isOnline:!0},R.id))]},S.role.id)),b.length>0&&g.jsxs("div",{children:[g.jsxs("div",{className:"member-label",children:[n("online"),"  ",b.length]}),b.map(S=>g.jsx(Tf,{member:S,isOnline:!0},S.id))]}),C.length>0&&g.jsxs("div",{children:[g.jsxs("div",{className:"member-label",children:[n("offline"),"  ",C.length]}),C.map(S=>g.jsx(Tf,{member:S,isOnline:!1},S.id))]})]})]})]})}const LT="mqvi_sidebar";function dV(){try{const n=localStorage.getItem(LT);if(n){const e=JSON.parse(n);return{isExpanded:typeof e.isExpanded=="boolean"?e.isExpanded:!0,expandedSections:e.expandedSections&&typeof e.expandedSections=="object"?e.expandedSections:{friends:!0,dms:!0,server:!0}}}}catch{}return{isExpanded:!0,expandedSections:{friends:!0,dms:!0,server:!0}}}function mo(n){try{localStorage.setItem(LT,JSON.stringify(n))}catch{}}const CS=dV(),Io=Pt((n,e)=>({isExpanded:CS.isExpanded,expandedSections:CS.expandedSections,toggleSidebar:()=>{n(t=>{const i=!t.isExpanded;return mo({isExpanded:i,expandedSections:t.expandedSections}),{isExpanded:i}})},expandSidebar:()=>{n(t=>t.isExpanded?t:(mo({isExpanded:!0,expandedSections:t.expandedSections}),{isExpanded:!0}))},collapseSidebar:()=>{n(t=>t.isExpanded?(mo({isExpanded:!1,expandedSections:t.expandedSections}),{isExpanded:!1}):t)},toggleSection:t=>{n(i=>{const a=i.expandedSections[t]??!0,o={...i.expandedSections,[t]:!a};return mo({isExpanded:i.isExpanded,expandedSections:o}),{expandedSections:o}})},expandSection:t=>{n(i=>{if(i.expandedSections[t])return i;const a={...i.expandedSections,[t]:!0};return mo({isExpanded:i.isExpanded,expandedSections:a}),{expandedSections:a}})},isSectionExpanded:t=>e().expandedSections[t]??!0}));function hV(){const{t:n}=ye("common"),e=Io(i=>i.collapseSidebar),t=Ye(i=>i.toggleQuickSwitcher);return g.jsxs("div",{className:"sb-header",children:[g.jsxs("div",{className:"sb-header-brand",children:[g.jsx("img",{src:"/mqvi-icon.svg",alt:"mqvi",className:"sb-logo"}),g.jsx("span",{className:"sb-brand-name",children:n("appName")})]}),g.jsxs("div",{className:"sb-header-actions",children:[g.jsx("button",{className:"sb-header-btn",onClick:t,title:`${n("search")} (Ctrl+K)`,children:g.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("circle",{cx:"11",cy:"11",r:"7"}),g.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),g.jsx("button",{className:"sb-header-btn",onClick:e,title:"Collapse",children:g.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:g.jsx("polyline",{points:"15 18 9 12 15 6"})})})]})]})}function fV(n,e){return be(`/channels/${n}/read`,{method:"POST",body:{message_id:e}})}function mV(){return be("/channels/unread")}const Gs=Pt(n=>({unreadCounts:{},fetchUnreadCounts:async()=>{const e=await mV();e.success&&e.data&&n(t=>{const i={...t.unreadCounts};for(const a of e.data)i[a.channel_id]=Math.max(a.unread_count,i[a.channel_id]??0);return{unreadCounts:i}})},markAsRead:(e,t)=>{n(i=>{if(!i.unreadCounts[e])return i;const a={...i.unreadCounts};return delete a[e],{unreadCounts:a}}),fV(e,t)},incrementUnread:e=>{n(t=>({unreadCounts:{...t.unreadCounts,[e]:(t.unreadCounts[e]??0)+1}}))},clearUnread:e=>{n(t=>{if(!t.unreadCounts[e])return t;const i={...t.unreadCounts};return delete i[e],{unreadCounts:i}})}}));function pV({onJoinVoice:n}){const{t:e}=ye("common"),{t}=ye("voice"),i=Io(O=>O.toggleSection),a=Io(O=>O.expandedSections);function o(O){return a[O]??!0}const l=Ot(O=>O.categories),u=Ot(O=>O.selectedChannelId),h=Ot(O=>O.selectChannel),f=ou(O=>O.server),m=Ye(O=>O.openTab),v=ge(O=>O.voiceStates),b=ge(O=>O.currentVoiceChannelId),C=Gs(O=>O.unreadCounts),T=st(O=>O.channels),S=st(O=>O.selectedDMId),R=st(O=>O.selectDM),_=st(O=>O.dmUnreadCounts),D=st(O=>O.clearDMUnread),j=st(O=>O.fetchMessages),x=Dt(O=>O.friends),w=Dt(O=>O.incoming);function M(O,Y){h(O),m(O,"text",Y)}function I(O,Y){n(O),m(O,"voice",Y)}function F(O,Y){R(O),m(O,"dm",Y),D(O),j(O)}function L(){m("friends","friends",e("friends"))}function A({expanded:O}){return g.jsx("span",{className:`ch-tree-chevron${O?" expanded":""}`,children:""})}return g.jsxs("div",{className:"ch-tree",children:[g.jsxs("div",{className:"ch-tree-section",children:[g.jsxs("button",{className:"ch-tree-section-header",onClick:()=>i("friends"),children:[g.jsx(A,{expanded:o("friends")}),g.jsx("span",{children:e("friends")}),w.length>0&&g.jsx("span",{className:"ch-tree-badge",children:w.length})]}),o("friends")&&g.jsxs("div",{className:"ch-tree-section-body",children:[g.jsxs("button",{className:"ch-tree-item",onClick:L,children:[g.jsx("span",{className:"ch-tree-icon",children:""}),g.jsx("span",{className:"ch-tree-label",children:e("friends")}),w.length>0&&g.jsx("span",{className:"ch-tree-badge",children:w.length})]}),x.filter(O=>O.user_status==="online"||O.user_status==="idle"||O.user_status==="dnd").slice(0,10).map(O=>g.jsxs("button",{className:"ch-tree-item",onClick:()=>L(),children:[g.jsx(Cn,{name:O.display_name??O.username,avatarUrl:O.avatar_url??void 0,size:24}),g.jsx("span",{className:"ch-tree-label",children:O.display_name??O.username}),g.jsx("span",{className:"ch-tree-vu-dot",style:{background:O.user_status==="online"?"var(--green)":O.user_status==="idle"?"var(--yellow, #f0b232)":"var(--red)"}})]},O.user_id))]})]}),g.jsxs("div",{className:"ch-tree-section",children:[g.jsxs("button",{className:"ch-tree-section-header",onClick:()=>i("dms"),children:[g.jsx(A,{expanded:o("dms")}),g.jsx("span",{children:e("directMessages")})]}),o("dms")&&g.jsx("div",{className:"ch-tree-section-body",children:T.length===0?g.jsx("div",{className:"ch-tree-placeholder",children:g.jsx("span",{className:"ch-tree-placeholder-text",children:""})}):T.map(O=>{const Y=O.id===S,J=_[O.id]??0,le=O.other_user.display_name||O.other_user.username;return g.jsxs("button",{className:`ch-tree-item ch-tree-dm${Y?" active":""}${J>0?" has-unread":""}`,onClick:()=>F(O.id,le),children:[g.jsx(Cn,{name:le,avatarUrl:O.other_user.avatar_url,size:24,isCircle:!0}),g.jsx("span",{className:"ch-tree-label",children:le}),J>0&&g.jsx("span",{className:"ch-tree-badge",children:J})]},O.id)})})]}),g.jsxs("div",{className:"ch-tree-section",children:[g.jsxs("button",{className:"ch-tree-server-header",onClick:()=>i("server"),children:[g.jsx(A,{expanded:o("server")}),f?.icon_url?g.jsx("img",{src:f.icon_url,alt:f.name,className:"ch-tree-server-icon"}):g.jsx("span",{className:"ch-tree-server-icon-fallback",children:(f?.name??"S").charAt(0).toUpperCase()}),g.jsx("span",{className:"ch-tree-server-name",children:f?.name??e("server")})]}),o("server")&&g.jsx("div",{className:"ch-tree-section-body",children:l.map(O=>{const Y=`cat:${O.category.id}`,J=o(Y);return g.jsxs("div",{className:"ch-tree-category",children:[g.jsxs("button",{className:"ch-tree-cat-header",onClick:()=>i(Y),children:[g.jsx(A,{expanded:J}),g.jsx("span",{children:O.category.name})]}),J&&O.channels.map(le=>{const Te=le.type==="text",H=Te?le.id===u:le.id===b,ae=C[le.id]??0,de=v[le.id]??[];return g.jsxs("div",{children:[g.jsxs("button",{className:`ch-tree-item${H?" active":""}${Te?"":" voice"}${ae>0?" has-unread":""}`,onClick:()=>Te?M(le.id,le.name):I(le.id,le.name),title:Te?`#${le.name}`:`${le.name}  ${t("joinVoice")}`,children:[g.jsx("span",{className:"ch-tree-icon",children:Te?"#":""}),g.jsx("span",{className:"ch-tree-label",children:le.name}),ae>0&&g.jsx("span",{className:"ch-tree-unread-dot",title:`${ae}`})]}),!Te&&de.length>0&&g.jsx("div",{className:"ch-tree-voice-users",children:de.map(Ee=>g.jsxs("div",{className:"ch-tree-voice-user",children:[g.jsx(Cn,{name:Ee.username,avatarUrl:Ee.avatar_url,size:22,isCircle:!0}),g.jsx("span",{className:"ch-tree-vu-name",children:Ee.username}),!Ee.is_muted&&g.jsx("span",{className:"ch-tree-vu-dot"})]},Ee.user_id))})]},le.id)})]},O.category.id)})})]})]})}function gV(){const{t:n}=ye("common"),e=Io(l=>l.expandSidebar),t=et(l=>l.user),i=st(l=>l.getTotalDMUnread()),a=Gs(l=>l.unreadCounts),o=Object.values(a).reduce((l,u)=>l+u,0);return g.jsxs("div",{className:"sb-collapsed",children:[g.jsx("button",{className:"sb-collapsed-btn sb-collapsed-expand",onClick:e,title:"Expand sidebar",children:""}),g.jsxs("button",{className:"sb-collapsed-btn sb-collapsed-server",onClick:e,title:n("server"),children:[g.jsx("img",{src:"/mqvi-icon.svg",alt:"mqvi",className:"sb-collapsed-icon"}),o>0&&g.jsx("span",{className:"sb-collapsed-badge",children:o})]}),g.jsxs("button",{className:"sb-collapsed-btn sb-collapsed-dm",onClick:e,title:n("directMessages"),children:["",i>0&&g.jsx("span",{className:"sb-collapsed-badge",children:i})]}),g.jsx("div",{className:"sb-collapsed-spacer"}),t&&g.jsx("div",{className:"sb-collapsed-avatar",children:g.jsx(Cn,{name:t.display_name||t.username,avatarUrl:t.avatar_url,size:28,isCircle:!0})})]})}const vV={id:"ocean",nameKey:"themeOcean",descKey:"themeOceanDesc",swatches:["#112830","#00d0fc","#5ea5a8"],colors:{"--bg-0":"#112830","--bg-1":"#182f37","--bg-2":"#1f363e","--bg-3":"#263d46","--bg-4":"#2d444c","--bg-5":"#334a52","--bg-h":"#2a4149","--bg-ub":"#0d2228","--b1":"rgba(255,255,255,0.08)","--b2":"rgba(255,255,255,0.13)","--t0":"#f0f4f6","--t1":"#bcc8ce","--t2":"#8a9aa2","--t3":"#627178","--primary":"#00d0fc","--primary-s":"rgba(0,208,252,0.12)","--primary-m":"rgba(0,208,252,0.24)","--primary-h":"#33dafd","--green":"#6fb07a","--green-s":"rgba(111,176,122,0.10)","--red":"#c46b5e","--red-s":"rgba(196,107,94,0.10)","--yellow":"#e8b040","--teal":"#5ea5a8","--secondary":"#5ea5a8","--secondary-s":"rgba(94,165,168,0.10)","--gradient":"linear-gradient(135deg, #112830 0%, #152e38 40%, #193440 100%)"}},yV={id:"aurora",nameKey:"themeAurora",descKey:"themeAuroraDesc",swatches:["#080c16","#22d3a0","#7c6cf0"],colors:{"--bg-0":"#080c16","--bg-1":"#0f1520","--bg-2":"#172033","--bg-3":"#1c2840","--bg-4":"#21304d","--bg-5":"#273858","--bg-h":"#1c2840","--bg-ub":"#060a12","--b1":"rgba(255,255,255,0.06)","--b2":"rgba(255,255,255,0.10)","--t0":"#e0eaf0","--t1":"#8eaaba","--t2":"#5e7a94","--t3":"#3d5570","--primary":"#22d3a0","--primary-s":"rgba(34,211,160,0.10)","--primary-m":"rgba(34,211,160,0.22)","--primary-h":"#40e0b8","--green":"#22d3a0","--green-s":"rgba(34,211,160,0.10)","--red":"#e06090","--red-s":"rgba(224,96,144,0.10)","--yellow":"#f0c040","--teal":"#22d3a0","--secondary":"#7c6cf0","--secondary-s":"rgba(124,108,240,0.10)","--gradient":"linear-gradient(135deg, #080c16 0%, #0c1525 40%, #101830 100%)"}},bV={id:"midnight",nameKey:"themeMidnight",descKey:"themeMidnightDesc",swatches:["#111111","#3b82f6","#f59e0b"],colors:{"--bg-0":"#111111","--bg-1":"#191919","--bg-2":"#222222","--bg-3":"#2a2a2a","--bg-4":"#323232","--bg-5":"#3a3a3a","--bg-h":"#2a2a2a","--bg-ub":"#0f0f0f","--b1":"rgba(255,255,255,0.06)","--b2":"rgba(255,255,255,0.10)","--t0":"#e8e8e8","--t1":"#a3a3a3","--t2":"#737373","--t3":"#525252","--primary":"#3b82f6","--primary-s":"rgba(59,130,246,0.10)","--primary-m":"rgba(59,130,246,0.22)","--primary-h":"#5b9af7","--green":"#22c55e","--green-s":"rgba(34,197,94,0.10)","--red":"#ef4444","--red-s":"rgba(239,68,68,0.10)","--yellow":"#f59e0b","--teal":"#3b82f6","--secondary":"#3b82f6","--secondary-s":"rgba(59,130,246,0.08)","--gradient":"linear-gradient(135deg, #111111 0%, #161616 40%, #1a1a1a 100%)"}},SV={id:"ember",nameKey:"themeEmber",descKey:"themeEmberDesc",swatches:["#0f0c0a","#e8863a","#c07040"],colors:{"--bg-0":"#0f0c0a","--bg-1":"#1a1513","--bg-2":"#252019","--bg-3":"#302820","--bg-4":"#3a3028","--bg-5":"#443830","--bg-h":"#302820","--bg-ub":"#0c0a08","--b1":"rgba(255,255,255,0.06)","--b2":"rgba(255,255,255,0.10)","--t0":"#ede6df","--t1":"#b5a899","--t2":"#8a7d6f","--t3":"#5e554b","--primary":"#e8863a","--primary-s":"rgba(232,134,58,0.10)","--primary-m":"rgba(232,134,58,0.22)","--primary-h":"#f09850","--green":"#6fb07a","--green-s":"rgba(111,176,122,0.10)","--red":"#e85d5d","--red-s":"rgba(232,93,93,0.10)","--yellow":"#e8a030","--teal":"#c07040","--secondary":"#c07040","--secondary-s":"rgba(192,112,64,0.10)","--gradient":"linear-gradient(135deg, #0f0c0a 0%, #141110 40%, #1a1512 100%)"}},kV={id:"deepTeal",nameKey:"themeDeepTeal",descKey:"themeDeepTealDesc",swatches:["#091416","#20dbb0","#50b4d0"],colors:{"--bg-0":"#091416","--bg-1":"#0e1e22","--bg-2":"#15292e","--bg-3":"#1b3339","--bg-4":"#223d44","--bg-5":"#28474f","--bg-h":"#1b3339","--bg-ub":"#071012","--b1":"rgba(255,255,255,0.06)","--b2":"rgba(255,255,255,0.10)","--t0":"#daf0ee","--t1":"#8ec0ba","--t2":"#5e9490","--t3":"#3d6e6a","--primary":"#20dbb0","--primary-s":"rgba(32,219,176,0.10)","--primary-m":"rgba(32,219,176,0.22)","--primary-h":"#40e8c0","--green":"#20dbb0","--green-s":"rgba(32,219,176,0.10)","--red":"#f07068","--red-s":"rgba(240,112,104,0.10)","--yellow":"#e8c040","--teal":"#50b4d0","--secondary":"#50b4d0","--secondary-s":"rgba(80,180,208,0.10)","--gradient":"linear-gradient(135deg, #091416 0%, #0c1a1e 40%, #0e2024 100%)"}},IT={ocean:vV,aurora:yV,midnight:bV,ember:SV,deepTeal:kV},CV=["midnight","aurora","ocean","deepTeal","ember"],TV="midnight";function UT(n){const e=IT[n];if(!e)return;const t=document.documentElement;t.classList.add("theme-transitioning");for(const[i,a]of Object.entries(e.colors))t.style.setProperty(i,a);setTimeout(()=>{t.classList.remove("theme-transitioning")},400)}const BT="mqvi_theme";function EV(){try{const n=localStorage.getItem(BT);if(n==="ocean"||n==="aurora"||n==="midnight"||n==="ember"||n==="deepTeal")return n}catch{}return TV}const zT=EV(),ys=Pt(n=>({isOpen:!1,activeTab:"profile",themeId:zT,openSettings:(e="profile")=>n({isOpen:!0,activeTab:e}),closeSettings:()=>n({isOpen:!1}),setActiveTab:e=>n({activeTab:e}),setTheme:e=>{UT(e);try{localStorage.setItem(BT,e)}catch{}n({themeId:e})}}));UT(zT);function xV({onToggleMute:n,onToggleDeafen:e,onToggleScreenShare:t,onDisconnect:i}){const{t:a}=ye("voice"),o=et(b=>b.user),l=ge(b=>b.currentVoiceChannelId),u=ge(b=>b.isMuted),h=ge(b=>b.isDeafened),f=ge(b=>b.isStreaming),m=ys(b=>b.openSettings),v=!!l;return o?g.jsxs("div",{className:"user-bar",children:[v&&g.jsxs("div",{className:"ub-voice-row",children:[g.jsxs("div",{className:"ub-voice-info",children:[g.jsx("span",{className:"ub-voice-pulse"}),g.jsx("span",{className:"ub-voice-label",children:a("voiceConnected")})]}),g.jsxs("div",{className:"ub-voice-btns",children:[g.jsx("button",{className:`ub-ctrl${u?" active":""}`,onClick:n,title:a(u?"unmute":"mute"),children:g.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:u?g.jsx("path",{d:"M12 1a4 4 0 0 0-4 4v6a4 4 0 0 0 8 0V5a4 4 0 0 0-4-4zM2.7 2.7a1 1 0 0 1 1.4 0l17 17a1 1 0 0 1-1.4 1.4L2.7 4.1a1 1 0 0 1 0-1.4zM6 10a1 1 0 0 0-2 0 8 8 0 0 0 7 7.9V21H8a1 1 0 1 0 0 2h8a1 1 0 1 0 0-2h-3v-3.1A8 8 0 0 0 20 10a1 1 0 1 0-2 0 6 6 0 0 1-9.7 4.7"}):g.jsx("path",{d:"M12 1a4 4 0 0 0-4 4v6a4 4 0 0 0 8 0V5a4 4 0 0 0-4-4zM6 10a1 1 0 0 0-2 0 8 8 0 0 0 7 7.9V21H8a1 1 0 1 0 0 2h8a1 1 0 1 0 0-2h-3v-3.1A8 8 0 0 0 20 10a1 1 0 1 0-2 0 6 6 0 0 1-12 0z"})})}),g.jsx("button",{className:`ub-ctrl${h?" active":""}`,onClick:e,title:a(h?"undeafen":"deafen"),children:g.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:h?g.jsx("path",{d:"M3 12a9 9 0 0 1 18 0v5a4 4 0 0 1-4 4h-1a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h3v-1a7 7 0 0 0-14 0v1h3a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H7a4 4 0 0 1-4-4v-5zM2.7 2.7a1 1 0 0 1 1.4 0l17 17a1 1 0 0 1-1.4 1.4L2.7 4.1a1 1 0 0 1 0-1.4z"}):g.jsx("path",{d:"M3 12a9 9 0 0 1 18 0v5a4 4 0 0 1-4 4h-1a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h3v-1a7 7 0 0 0-14 0v1h3a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H7a4 4 0 0 1-4-4v-5z"})})}),g.jsx("button",{className:`ub-ctrl${f?" active":""}`,onClick:t,title:a(f?"stopScreenShare":"screenShare"),children:g.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:g.jsx("path",{d:"M3 4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6v2H7a1 1 0 1 0 0 2h10a1 1 0 1 0 0-2h-2v-2h6a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H3zm9 4a1 1 0 0 1 1 1v2h2a1 1 0 1 1 0 2h-2v2a1 1 0 1 1-2 0v-2H9a1 1 0 1 1 0-2h2V9a1 1 0 0 1 1-1z"})})}),g.jsx("button",{className:"ub-ctrl ub-end",onClick:i,title:a("endCall"),children:g.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:g.jsx("path",{d:"M12 8c-3.5 0-6.6 1.1-9 3a1 1 0 0 0 0 1.4l2.5 2.5a1 1 0 0 0 1.2.1c.8-.5 1.7-.9 2.7-1.1a1 1 0 0 0 .8-1v-2.8c.6-.1 1.2-.1 1.8-.1s1.2 0 1.8.1v2.8a1 1 0 0 0 .8 1c1 .2 1.9.6 2.7 1.1a1 1 0 0 0 1.2-.1L21 12.4a1 1 0 0 0 0-1.4c-2.4-1.9-5.5-3-9-3z"})})})]})]}),g.jsxs("div",{className:"ub-main",children:[g.jsxs("div",{className:"ub-user",children:[g.jsx(Cn,{name:o.display_name||o.username,avatarUrl:o.avatar_url,size:32,isCircle:!0}),g.jsxs("div",{className:"ub-info",children:[g.jsx("span",{className:"ub-name",children:o.display_name||o.username}),g.jsxs("span",{className:"ub-status",children:["#",o.username]})]})]}),g.jsx("button",{className:"ub-ctrl ub-settings",onClick:()=>m("profile"),title:"Settings",children:g.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:g.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm8.3-3.7a1.5 1.5 0 0 1 .3 1.7l-.9 1.5a1.5 1.5 0 0 1-1.6.7l-1.1-.2a7 7 0 0 1-1.2.7l-.3 1.1a1.5 1.5 0 0 1-1.4 1h-1.8a1.5 1.5 0 0 1-1.4-1l-.3-1.1a7 7 0 0 1-1.2-.7l-1.1.2a1.5 1.5 0 0 1-1.6-.7l-.9-1.5a1.5 1.5 0 0 1 .3-1.7l.8-.9V10a7 7 0 0 1 0-1.4l-.8-.9a1.5 1.5 0 0 1-.3-1.7l.9-1.5a1.5 1.5 0 0 1 1.6-.7l1.1.2a7 7 0 0 1 1.2-.7l.3-1.1a1.5 1.5 0 0 1 1.4-1h1.8a1.5 1.5 0 0 1 1.4 1l.3 1.1a7 7 0 0 1 1.2.7l1.1-.2a1.5 1.5 0 0 1 1.6.7l.9 1.5a1.5 1.5 0 0 1-.3 1.7l-.8.9a7 7 0 0 1 0 1.4l.8.9z"})})})]})]}):null}const RV=180,_V=400,wV=240;function MV({onJoinVoice:n,onToggleMute:e,onToggleDeafen:t,onToggleScreenShare:i,onDisconnect:a}){const o=Io(f=>f.isExpanded),{width:l,handleMouseDown:u,isDragging:h}=jT({initialWidth:wV,minWidth:RV,maxWidth:_V,direction:"right",storageKey:"mqvi_sidebar_width"});return o?g.jsxs("div",{className:"sidebar",style:{width:l},children:[g.jsxs("div",{className:"sidebar-inner",style:{width:l},children:[g.jsx(hV,{}),g.jsx(pV,{onJoinVoice:n}),g.jsx(xV,{onToggleMute:e,onToggleDeafen:t,onToggleScreenShare:i,onDisconnect:a})]}),g.jsx("div",{className:`resize-handle resize-handle-v${h?" active":""}`,onMouseDown:u})]}):g.jsx(gV,{})}const po=new Map,TS=5,NV=4e3,DV=300,ai=Pt((n,e)=>({toasts:[],addToast:(t,i,a=NV)=>{const o=crypto.randomUUID(),l={id:o,type:t,message:i,duration:a,isExiting:!1};n(h=>{const f=[...h.toasts,l];if(f.length>TS){const m=f.splice(0,f.length-TS);for(const v of m){const b=po.get(v.id);b&&(clearTimeout(b),po.delete(v.id))}}return{toasts:f}});const u=setTimeout(()=>{e().removeToast(o)},a);po.set(o,u)},removeToast:t=>{const i=po.get(t);i&&(clearTimeout(i),po.delete(t)),n(a=>({toasts:a.toasts.map(o=>o.id===t?{...o,isExiting:!0}:o)})),setTimeout(()=>{n(a=>({toasts:a.toasts.filter(o=>o.id!==t)}))},DV)}}));function OV({id:n,type:e,message:t,isExiting:i,onDismiss:a}){const o=E.useCallback(()=>{a(n)},[n,a]),l=`toast toast-${e} toast-border-${e}${i?" toast-exiting":""}`;return g.jsxs("div",{className:l,role:"alert",children:[g.jsx("div",{className:"toast-icon",children:g.jsx(AV,{type:e})}),g.jsx("span",{className:"toast-message",children:t}),g.jsx("button",{onClick:o,className:"toast-close","aria-label":"Close",children:""})]})}function AV({type:n}){switch(n){case"success":return g.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"error":return g.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"warning":return g.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})});case"info":return g.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})}}function jV(){const n=ai(t=>t.toasts),e=ai(t=>t.removeToast);return n.length===0?null:g.jsx("div",{className:"toast-container",children:n.map(t=>g.jsx(OV,{id:t.id,type:t.type,message:t.message,isExiting:t.isExiting,onDismiss:e},t.id))})}function PV(){const{t:n}=ye("common"),e=bl(u=>u.options),t=bl(u=>u.confirm),i=bl(u=>u.cancel),a=E.useCallback(u=>{u.key==="Escape"&&i()},[i]);if(E.useEffect(()=>{if(e)return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,a]),!e)return null;const o=e.confirmLabel??n("confirm"),l=e.cancelLabel??n("cancel");return g.jsx("div",{className:"modal-backdrop",onClick:i,children:g.jsxs("div",{className:"modal-card",onClick:u=>u.stopPropagation(),children:[e.title&&g.jsx("div",{className:"modal-header",children:g.jsx("h2",{className:"modal-title",children:e.title})}),g.jsx("p",{className:"modal-text",children:e.message}),g.jsxs("div",{className:"modal-actions",children:[g.jsx("button",{className:"settings-btn settings-btn-secondary",onClick:i,children:l}),g.jsx("button",{className:`settings-btn${e.danger?" settings-btn-danger":""}`,onClick:t,autoFocus:!0,children:o})]})]})})}const LV=[{id:"profile",labelKey:"profile"},{id:"appearance",labelKey:"appearance"},{id:"voice",labelKey:"voiceSettings"}],IV=[{id:"server-general",labelKey:"general"},{id:"channels",labelKey:"channels"},{id:"roles",labelKey:"roles"},{id:"members",labelKey:"members"},{id:"invites",labelKey:"invites"}];function UV(){const{t:n}=ye("settings"),e=ys(f=>f.activeTab),t=ys(f=>f.setActiveTab),i=et(f=>f.logout),a=et(f=>f.user),u=mt(f=>f.members).find(f=>f.id===a?.id)?.effective_permissions??0,h=cn(u,Ne.Admin)||cn(u,Ne.ManageChannels)||cn(u,Ne.ManageRoles)||cn(u,Ne.KickMembers)||cn(u,Ne.BanMembers);return g.jsxs("nav",{className:"settings-nav",children:[g.jsx("h3",{className:"settings-nav-label",children:n("userSettings")}),LV.map(f=>g.jsx("button",{className:`settings-nav-item${e===f.id?" active":""}`,onClick:()=>t(f.id),children:n(f.labelKey)},f.id)),h&&g.jsxs(g.Fragment,{children:[g.jsx("div",{style:{height:1,background:"var(--b1)",margin:"8px 0"}}),g.jsx("h3",{className:"settings-nav-label",children:n("serverSettings")}),IV.map(f=>g.jsx("button",{className:`settings-nav-item${e===f.id?" active":""}`,onClick:()=>t(f.id),children:n(f.labelKey)},f.id))]}),g.jsx("div",{style:{marginTop:"auto",borderTop:"1px solid var(--b1)",paddingTop:8},children:g.jsx("button",{className:"settings-nav-item",onClick:i,style:{color:"var(--red)"},children:n("logOut")})}),g.jsx("p",{style:{marginTop:8,padding:"0 8px",fontSize:11,color:"var(--t3)"},children:"mqvi v0.1.0"})]})}async function BV(){return be("/roles")}async function zV(n){return be("/roles",{method:"POST",body:n})}async function FV(n,e){return be(`/roles/${n}`,{method:"PATCH",body:e})}async function VV(n){return be(`/roles/${n}`,{method:"DELETE"})}const Ys=Pt((n,e)=>({roles:[],selectedRoleId:null,isLoading:!1,fetchRoles:async()=>{n({isLoading:!0});const t=await BV();if(t.data){const i=[...t.data].sort((a,o)=>o.position-a.position);n({roles:i,isLoading:!1}),!e().selectedRoleId&&i.length>0&&n({selectedRoleId:i[0].id})}else n({isLoading:!1})},selectRole:t=>{n({selectedRoleId:t})},createRole:async t=>{const i=await zV(t);if(i.data){const a=i.data;return n(o=>o.roles.some(l=>l.id===a.id)?{selectedRoleId:a.id}:{roles:[a,...o.roles].sort((l,u)=>u.position-l.position),selectedRoleId:a.id}),!0}return!1},updateRole:async(t,i)=>{const a=await FV(t,i);return a.data?(n(o=>({roles:o.roles.map(l=>l.id===t?a.data:l)})),!0):!1},deleteRole:async t=>(await VV(t)).data?(n(a=>{const o=a.roles.filter(l=>l.id!==t);return{roles:o,selectedRoleId:a.selectedRoleId===t?o[0]?.id??null:a.selectedRoleId}}),!0):!1,handleRoleCreate:t=>{n(i=>i.roles.some(a=>a.id===t.id)?i:{roles:[...i.roles,t].sort((a,o)=>o.position-a.position)})},handleRoleUpdate:t=>{n(i=>({roles:i.roles.map(a=>a.id===t.id?t:a)}))},handleRoleDelete:t=>{n(i=>{const a=i.roles.filter(o=>o.id!==t);return{roles:a,selectedRoleId:i.selectedRoleId===t?a[0]?.id??null:i.selectedRoleId}})}}));function qV({permBit:n,labelKey:e,descKey:t,isChecked:i,onChange:a,warningKey:o}){const{t:l}=ye("settings");return g.jsxs("div",{className:"permission-toggle",children:[g.jsx("button",{onClick:()=>a(n,!i),className:`permission-toggle-checkbox${i?" checked":""}`,children:i&&g.jsx("svg",{className:"permission-toggle-check",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),g.jsxs("div",{style:{flex:1,minWidth:0},children:[g.jsx("p",{className:"permission-toggle-label",children:l(e)}),g.jsx("p",{className:"permission-toggle-desc",children:l(t)}),o&&i&&g.jsx("p",{className:"permission-toggle-warn",children:l(o)})]})]})}const HV=["#1ABC9C","#2ECC71","#3498DB","#9B59B6","#E91E63","#F1C40F","#E67E22","#E74C3C","#95A5A6","#607D8B","#11806A","#1F8B4C","#206694","#71368A","#AD1457","#C27C0E","#A84300","#992D22","#979C9F","#546E7A"];function $V({value:n,onChange:e}){return g.jsxs("div",{children:[g.jsx("div",{className:"color-picker",children:HV.map(t=>g.jsx("button",{onClick:()=>e(t),className:`color-swatch${n.toUpperCase()===t?" selected":""}`,style:{backgroundColor:t}},t))}),g.jsxs("div",{className:"color-hex-row",children:[g.jsx("div",{className:"color-hex-preview",style:{backgroundColor:n||"var(--t1)"}}),g.jsx("input",{type:"text",value:n,onChange:t=>e(t.target.value),placeholder:"#99AAB5",maxLength:7,className:"color-hex-input"})]})]})}const KV=[{bit:Ne.Admin,label:"permAdmin",desc:"permAdminDesc",warning:"permAdminWarning"},{bit:Ne.ManageChannels,label:"permManageChannels",desc:"permManageChannelsDesc"},{bit:Ne.ManageRoles,label:"permManageRoles",desc:"permManageRolesDesc"},{bit:Ne.KickMembers,label:"permKickMembers",desc:"permKickMembersDesc"},{bit:Ne.BanMembers,label:"permBanMembers",desc:"permBanMembersDesc"},{bit:Ne.ManageMessages,label:"permManageMessages",desc:"permManageMessagesDesc"},{bit:Ne.SendMessages,label:"permSendMessages",desc:"permSendMessagesDesc"},{bit:Ne.ReadMessages,label:"permReadMessages",desc:"permReadMessagesDesc"},{bit:Ne.ConnectVoice,label:"permConnect",desc:"permConnectDesc"},{bit:Ne.Speak,label:"permSpeak",desc:"permSpeakDesc"},{bit:Ne.Stream,label:"permStream",desc:"permStreamDesc"},{bit:Ne.ManageInvites,label:"permManageInvites",desc:"permManageInvitesDesc"}];function GV(){const{t:n}=ye("settings"),{roles:e,selectedRoleId:t,isLoading:i,fetchRoles:a,selectRole:o,createRole:l,updateRole:u,deleteRole:h}=Ys(),f=ai(F=>F.addToast),m=cr(),v=e.find(F=>F.id===t),[b,C]=E.useState(""),[T,S]=E.useState(""),[R,_]=E.useState(0),[D,j]=E.useState(!1);E.useEffect(()=>{a()},[a]),E.useEffect(()=>{v&&(C(v.name),S(v.color),_(v.permissions),j(!1))},[v]);function x(F,L){_(A=>L?A|F:A&~F),j(!0)}async function w(){if(!t||!D)return;const F={};b!==v?.name&&(F.name=b),T!==v?.color&&(F.color=T),R!==v?.permissions&&(F.permissions=R),await u(t,F)?(j(!1),f("success",n("roleSaved"))):f("error",n("roleSaveError"))}async function M(){await l({name:"New Role",color:"#99AAB5",permissions:Ne.SendMessages|Ne.ReadMessages|Ne.ConnectVoice|Ne.Speak})?f("success",n("roleCreated")):f("error",n("roleSaveError"))}async function I(){if(!v||!await m({message:n("confirmDeleteRole",{name:v.name}),confirmLabel:n("deleteRole"),danger:!0}))return;await h(v.id)?f("success",n("roleDeleted")):f("error",n("roleSaveError"))}return i?g.jsx("div",{className:"no-channel",children:n("loading",{ns:"common"})}):g.jsxs("div",{className:"channel-settings-wrapper",children:[g.jsxs("div",{className:"role-list",children:[g.jsxs("div",{className:"channel-settings-header",children:[g.jsx("span",{className:"channel-settings-header-label",children:n("roles")}),g.jsx("button",{onClick:M,className:"settings-btn channel-settings-header-btn",children:n("createRole")})]}),g.jsx("div",{className:"channel-settings-ch-list",children:e.map(F=>g.jsxs("div",{onClick:()=>o(F.id),className:`role-list-item${F.id===t?" active":""}`,children:[g.jsx("span",{className:"role-list-dot",style:{backgroundColor:F.color||"#99AAB5"}}),g.jsx("span",{className:"role-list-name",children:F.name})]},F.id))})]}),g.jsx("div",{className:"settings-content channel-settings-right",children:v?g.jsxs("div",{className:"channel-perm-section",children:[g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:n("roleName")}),g.jsx("input",{type:"text",value:b,onChange:F=>{C(F.target.value),j(!0)},className:"settings-input"})]}),g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:n("roleColor")}),g.jsx($V,{value:T,onChange:F=>{S(F),j(!0)}})]}),v.is_default&&g.jsx("div",{style:{background:"var(--bg-4)",borderRadius:8,padding:12,fontSize:12,color:"var(--t2)",marginBottom:16},children:n("defaultRoleWarning")}),g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:n("permissions")}),g.jsx("div",{style:{background:"var(--bg-1)",borderRadius:8,overflow:"hidden"},children:KV.map(F=>g.jsx(qV,{permBit:F.bit,labelKey:F.label,descKey:F.desc,isChecked:(R&F.bit)!==0,onChange:x,warningKey:"warning"in F?F.warning:void 0},F.bit))})]}),g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[D&&g.jsx("button",{onClick:w,className:"settings-btn",children:n("saveChanges")}),!v.is_default&&g.jsx("button",{onClick:I,className:"settings-btn settings-btn-danger",children:n("deleteRole")})]}),D&&g.jsx("p",{style:{marginTop:8,fontSize:12,color:"var(--primary)"},children:n("unsavedChanges")})]}):g.jsx("div",{className:"no-channel",children:n("noRoleSelected")})})]})}async function YV(n){return be("/users/me/profile",{method:"PATCH",body:n})}async function JV(n){const e=new FormData;return e.append("file",n),be("/users/me/avatar",{method:"POST",body:e})}const QV="image/jpeg,image/png,image/gif,image/webp",XV=8*1024*1024;function FT({currentUrl:n,previewUrl:e,fallbackText:t,onUpload:i,isCircle:a=!0}){const{t:o}=ye("settings"),[l,u]=E.useState(!1),h=E.useRef(null),f=t.charAt(0).toUpperCase();async function m(v){const b=v.target.files?.[0];if(b&&!(b.size>XV)){u(!0);try{await i(b)}finally{u(!1),h.current&&(h.current.value="")}}}return g.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12,marginBottom:24},children:[g.jsxs("button",{type:"button",onClick:()=>h.current?.click(),className:"avatar-upload",disabled:l,style:{width:80,height:80,borderRadius:a?"999px":12,background:"linear-gradient(135deg, var(--primary), var(--secondary))",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",position:"relative"},children:[e??n?g.jsx("img",{src:e??n,alt:t,style:{width:"100%",height:"100%",objectFit:"cover"}}):g.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#fff",fontFamily:"var(--f-d)"},children:f}),g.jsx("div",{className:"avatar-upload-overlay",style:{borderRadius:a?"999px":12},children:l?g.jsx("div",{className:"spinner",style:{width:24,height:24}}):g.jsxs("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})})]}),g.jsxs("div",{style:{textAlign:"center"},children:[g.jsx("p",{style:{fontSize:11,color:"var(--t2)"},children:o("avatarUpload")}),g.jsx("p",{style:{fontSize:11,color:"var(--t3)",marginTop:2},children:o("avatarMaxSize")})]}),g.jsx("input",{ref:h,type:"file",accept:QV,onChange:m,style:{display:"none"}})]})}const WV=[{code:"en",labelKey:"english"},{code:"tr",labelKey:"turkish"}];function ZV({currentLanguage:n,onChange:e}){const{t}=ye("settings");return g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:t("language")}),g.jsx("p",{style:{fontSize:11,color:"var(--t2)",marginBottom:6},children:t("languageDescription")}),g.jsx("select",{value:n,onChange:i=>e(i.target.value),className:"settings-select",children:WV.map(i=>g.jsx("option",{value:i.code,children:t(i.labelKey)},i.code))})]})}function e7(){const{t:n}=ye("settings"),{i18n:e}=ye(),t=et(M=>M.user),i=et(M=>M.updateUser),a=ai(M=>M.addToast),[o,l]=E.useState(t?.display_name??""),[u,h]=E.useState(t?.custom_status??""),[f,m]=E.useState(t?.language??"en"),[v,b]=E.useState(null),[C,T]=E.useState(null),[S,R]=E.useState(!1),_=E.useRef(null);E.useEffect(()=>{l(t?.display_name??""),h(t?.custom_status??""),m(t?.language??"en"),b(null),_.current&&(URL.revokeObjectURL(_.current),_.current=null),T(null)},[t?.display_name,t?.custom_status,t?.language,t?.avatar_url]),E.useEffect(()=>()=>{_.current&&URL.revokeObjectURL(_.current)},[]);const D=o!==(t?.display_name??"")||u!==(t?.custom_status??"")||v!==null||f!==(t?.language??"en");async function j(M){_.current&&URL.revokeObjectURL(_.current);const I=URL.createObjectURL(M);_.current=I,b(M),T(I)}function x(M){m(M)}async function w(){if(!(!D||S)){R(!0);try{if(v){const I=await JV(v);if(I.success&&I.data)i({avatar_url:I.data.avatar_url});else{a("error",I.error??n("avatarUploadError")),R(!1);return}}if(o!==(t?.display_name??"")||u!==(t?.custom_status??"")||f!==(t?.language??"en")){const I=await YV({display_name:o||null,custom_status:u||null,language:f});if(I.success&&I.data)f!==(t?.language??"en")&&e.changeLanguage(f),i({display_name:I.data.display_name,custom_status:I.data.custom_status,language:f});else{a("error",I.error??n("profileSaveError")),R(!1);return}}b(null),_.current&&(URL.revokeObjectURL(_.current),_.current=null),T(null),a("success",n("profileSaved"))}catch{a("error",n("profileSaveError"))}finally{R(!1)}}}return t?g.jsxs("div",{className:"settings-section",children:[g.jsx("h2",{className:"settings-section-title",children:n("profile")}),g.jsx(FT,{currentUrl:t.avatar_url,previewUrl:C,fallbackText:t.display_name??t.username,onUpload:j}),g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{htmlFor:"displayName",className:"settings-label",children:n("displayName")}),g.jsx("input",{id:"displayName",type:"text",value:o,onChange:M=>l(M.target.value),placeholder:n("displayNamePlaceholder"),maxLength:32,className:"settings-input"})]}),g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{htmlFor:"customStatus",className:"settings-label",children:n("customStatus")}),g.jsx("input",{id:"customStatus",type:"text",value:u,onChange:M=>h(M.target.value),placeholder:n("customStatusPlaceholder"),maxLength:128,className:"settings-input"})]}),g.jsx(ZV,{currentLanguage:f,onChange:x}),g.jsx("div",{style:{height:1,background:"var(--b1)",margin:"24px 0"}}),g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[g.jsx("button",{onClick:w,disabled:!D||S,className:"settings-btn",children:S?n("saveChanges")+"...":n("saveChanges")}),D&&g.jsx("span",{style:{fontSize:13,color:"var(--primary)"},children:n("unsavedChanges")})]})]}):null}function t7(){const{t:n}=ye("settings"),e=ys(a=>a.themeId),t=ys(a=>a.setTheme);function i(a){t(a)}return g.jsxs("div",{children:[g.jsx("h2",{className:"settings-section-title",children:n("themeTitle")}),g.jsx("p",{className:"theme-section-desc",children:n("themeDescription")}),g.jsx("div",{className:"theme-grid",children:CV.map(a=>{const o=IT[a],l=a===e;return g.jsxs("button",{className:`theme-card${l?" theme-card-active":""}`,onClick:()=>i(a),type:"button",children:[g.jsx("div",{className:"theme-swatches",children:o.swatches.map((u,h)=>g.jsx("span",{className:"theme-swatch",style:{background:u}},h))}),g.jsx("span",{className:"theme-card-name",children:n(o.nameKey)}),g.jsx("span",{className:"theme-card-desc",children:n(o.descKey)}),l&&g.jsx("span",{className:"theme-card-check",children:""})]},a)})})]})}function n7(){const{t:n}=ye("settings"),e=ai(S=>S.addToast),[t,i]=E.useState(null),[a,o]=E.useState(""),[l,u]=E.useState(!1),[h,f]=E.useState(!1),[m,v]=E.useState(!1);E.useEffect(()=>{async function S(){const R=await ek();R.success&&R.data&&(i(R.data),o(R.data.name),u(R.data.invite_required)),v(!0)}S()},[]);const b=t!==null&&(a!==t.name||l!==t.invite_required);async function C(){if(!(!b||h)){f(!0);try{const S=await v4({name:a,invite_required:l});S.success&&S.data?(i(S.data),u(S.data.invite_required),e("success",n("serverSaved"))):e("error",S.error??n("serverSaveError"))}catch{e("error",n("serverSaveError"))}finally{f(!1)}}}async function T(S){try{const R=await y4(S);R.success&&R.data?(i(R.data),e("success",n("serverSaved"))):e("error",R.error??n("serverSaveError"))}catch{e("error",n("serverSaveError"))}}return m?t?g.jsxs("div",{className:"settings-section",children:[g.jsx("h2",{className:"settings-section-title",children:n("general")}),g.jsx(FT,{currentUrl:t.icon_url,fallbackText:t.name,onUpload:T,isCircle:!1}),g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{htmlFor:"serverName",className:"settings-label",children:n("serverName")}),g.jsx("input",{id:"serverName",type:"text",value:a,onChange:S=>o(S.target.value),maxLength:100,className:"settings-input"})]}),g.jsxs("div",{className:"settings-field",style:{display:"flex",alignItems:"center",gap:12},children:[g.jsx("input",{id:"inviteRequired",type:"checkbox",checked:l,onChange:S=>u(S.target.checked),style:{width:16,height:16,accentColor:"var(--primary)",cursor:"pointer"}}),g.jsxs("div",{children:[g.jsx("label",{htmlFor:"inviteRequired",style:{fontSize:13,fontWeight:600,color:"var(--t0)",cursor:"pointer"},children:n("inviteRequired")}),g.jsx("p",{style:{fontSize:11,color:"var(--t2)",marginTop:2},children:n("inviteRequiredDesc")})]})]}),g.jsx("div",{style:{height:1,background:"var(--b1)",margin:"24px 0"}}),g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[g.jsx("button",{onClick:C,disabled:!b||h,className:"settings-btn",children:h?n("saveChanges")+"...":n("saveChanges")}),b&&g.jsx("span",{style:{fontSize:13,color:"var(--primary)"},children:n("unsavedChanges")})]})]}):g.jsx("div",{className:"no-channel",children:n("serverSaveError")}):g.jsx("div",{className:"no-channel",children:n("loading",{ns:"common"})})}async function i7(){return be("/invites")}async function s7(n){return be("/invites",{method:"POST",body:n})}async function a7(n){return be(`/invites/${n}`,{method:"DELETE"})}const r7=[],go=Pt((n,e)=>({invites:r7,isLoading:!1,fetchInvites:async()=>{n({isLoading:!0});const t=await i7();t.success&&t.data?n({invites:t.data,isLoading:!1}):n({isLoading:!1})},createInvite:async(t,i)=>{const a=await s7({max_uses:t,expires_in:i});return a.success&&a.data?(await e().fetchInvites(),a.data):null},deleteInvite:async t=>(await a7(t)).success?(n(a=>({invites:a.invites.filter(o=>o.code!==t)})),!0):!1})),o7=[{value:30,labelKey:"expiry30min"},{value:60,labelKey:"expiry1h"},{value:360,labelKey:"expiry6h"},{value:720,labelKey:"expiry12h"},{value:1440,labelKey:"expiry1d"},{value:10080,labelKey:"expiry7d"},{value:0,labelKey:"expiryNever"}],c7=[{value:0,labelKey:"usesNoLimit"},{value:1,labelKey:"uses1"},{value:5,labelKey:"uses5"},{value:10,labelKey:"uses10"},{value:25,labelKey:"uses25"},{value:50,labelKey:"uses50"},{value:100,labelKey:"uses100"}];function l7(){const{t:n}=ye("settings"),e=go(R=>R.invites),t=go(R=>R.isLoading),i=go(R=>R.fetchInvites),a=go(R=>R.createInvite),o=go(R=>R.deleteInvite),l=ai(R=>R.addToast),[u,h]=E.useState(1440),[f,m]=E.useState(0),[v,b]=E.useState(!1);E.useEffect(()=>{i()},[i]);const C=E.useCallback(async()=>{if(v)return;b(!0);const R=await a(f,u);if(R){l("success",n("inviteCreated"));try{await navigator.clipboard.writeText(R.code),l("success",n("inviteCopied"))}catch{}}else l("error",n("inviteCreateError"));b(!1)},[v,a,f,u,l,n]),T=E.useCallback(async R=>{try{await navigator.clipboard.writeText(R),l("success",n("inviteCopied"))}catch{l("error",n("inviteCopyError"))}},[l,n]),S=E.useCallback(async R=>{await o(R)?l("success",n("inviteDeleted")):l("error",n("inviteDeleteError"))},[o,l,n]);return g.jsxs("div",{className:"settings-section",children:[g.jsx("h2",{className:"settings-section-title",children:n("invites")}),g.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-end",marginBottom:24},children:[g.jsxs("div",{className:"settings-field",style:{marginBottom:0},children:[g.jsx("label",{className:"settings-label",children:n("inviteExpiry")}),g.jsx("select",{value:u,onChange:R=>h(Number(R.target.value)),className:"settings-select",style:{maxWidth:180},children:o7.map(R=>g.jsx("option",{value:R.value,children:n(R.labelKey)},R.value))})]}),g.jsxs("div",{className:"settings-field",style:{marginBottom:0},children:[g.jsx("label",{className:"settings-label",children:n("inviteMaxUses")}),g.jsx("select",{value:f,onChange:R=>m(Number(R.target.value)),className:"settings-select",style:{maxWidth:160},children:c7.map(R=>g.jsx("option",{value:R.value,children:n(R.labelKey)},R.value))})]}),g.jsx("button",{onClick:C,disabled:v,className:"settings-btn",children:n(v?"inviteCreating":"inviteCreate")})]}),g.jsx("div",{style:{height:1,background:"var(--b1)",marginBottom:16}}),t?g.jsx("p",{style:{fontSize:13,color:"var(--t2)"},children:n("loading")}):e.length===0?g.jsx("p",{style:{fontSize:13,color:"var(--t2)"},children:n("noInvites")}):g.jsx("div",{className:"invite-list",children:e.map(R=>g.jsx(u7,{invite:R,onCopy:T,onDelete:S},R.code))})]})}function u7({invite:n,onCopy:e,onDelete:t}){const{t:i}=ye("settings"),a=n.expires_at!==null&&new Date(n.expires_at)<new Date,o=n.max_uses>0&&n.uses>=n.max_uses,l=a||o,u=n.creator_display_name??n.creator_username;function h(){if(!n.expires_at)return i("expiryNever");if(a)return i("inviteExpired");const f=new Date(n.expires_at).getTime()-Date.now(),m=Math.floor(f/(1e3*60*60)),v=Math.floor(f%(1e3*60*60)/(1e3*60));if(m>24){const b=Math.floor(m/24);return i("inviteExpiresInDays",{count:b})}return m>0?i("inviteExpiresInHours",{count:m}):i("inviteExpiresInMinutes",{count:v})}return g.jsxs("div",{className:"invite-item",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:l?"var(--red-s)":"var(--bg-3)",borderRadius:8,marginBottom:6,opacity:l?.6:1},children:[g.jsxs("div",{style:{minWidth:0},children:[g.jsx("div",{style:{fontFamily:"var(--f-m)",fontSize:14,fontWeight:500,color:"var(--t0)",letterSpacing:"0.02em"},children:n.code}),g.jsxs("div",{style:{fontSize:11,color:"var(--t2)",marginTop:2,display:"flex",gap:12},children:[g.jsx("span",{children:u}),g.jsxs("span",{children:[n.uses,n.max_uses>0?` / ${n.max_uses}`:""," ",i("inviteUsesLabel")]}),g.jsx("span",{children:h()})]})]}),g.jsxs("div",{style:{display:"flex",gap:6,flexShrink:0},children:[g.jsx("button",{onClick:()=>e(n.code),className:"settings-btn settings-btn-secondary",style:{height:28,padding:"0 10px",fontSize:11},children:i("inviteCopy")}),g.jsx("button",{onClick:()=>t(n.code),className:"settings-btn settings-btn-danger",style:{height:28,padding:"0 10px",fontSize:11},children:i("inviteDelete")})]})]})}function d7(n){return n.startsWith("Key")?n.slice(3):n.startsWith("Digit")?n.slice(5):{Space:"Space",ControlLeft:"Left Ctrl",ControlRight:"Right Ctrl",ShiftLeft:"Left Shift",ShiftRight:"Right Shift",AltLeft:"Left Alt",AltRight:"Right Alt",Tab:"Tab",CapsLock:"Caps Lock",Backquote:"`",Backslash:"\\",BracketLeft:"[",BracketRight:"]",Semicolon:";",Quote:"'",Comma:",",Period:".",Slash:"/",Minus:"-",Equal:"="}[n]??n}function ES(n,e){const t=n/e*100;return{background:`linear-gradient(to right, var(--primary) ${t}%, var(--bg-5) ${t}%)`}}function h7(){const{t:n}=ye("settings"),e=ge(M=>M.inputMode),t=ge(M=>M.pttKey),i=ge(M=>M.micSensitivity),a=ge(M=>M.inputDevice),o=ge(M=>M.outputDevice),l=ge(M=>M.masterVolume),u=ge(M=>M.soundsEnabled),h=ge(M=>M.setInputMode),f=ge(M=>M.setPTTKey),m=ge(M=>M.setMicSensitivity),v=ge(M=>M.setInputDevice),b=ge(M=>M.setOutputDevice),C=ge(M=>M.setMasterVolume),T=ge(M=>M.setSoundsEnabled),[S,R]=E.useState([]),[_,D]=E.useState([]),[j,x]=E.useState(!1);E.useEffect(()=>{async function M(){try{await navigator.mediaDevices.getUserMedia({audio:!0}).then(A=>{A.getTracks().forEach(O=>O.stop())}).catch(()=>{});const I=await navigator.mediaDevices.enumerateDevices(),F=I.filter(A=>A.kind==="audioinput").map((A,O)=>({deviceId:A.deviceId,label:A.label||`${n("inputDevice")} ${O+1}`})),L=I.filter(A=>A.kind==="audiooutput").map((A,O)=>({deviceId:A.deviceId,label:A.label||`${n("outputDevice")} ${O+1}`}));R(F),D(L)}catch{}}M()},[n]),E.useEffect(()=>{if(!j)return;function M(I){if(I.preventDefault(),I.stopPropagation(),I.code==="Escape"){x(!1);return}f(I.code),x(!1)}return document.addEventListener("keydown",M,{capture:!0}),()=>{document.removeEventListener("keydown",M,{capture:!0})}},[j,f]);const w=E.useCallback(M=>{h(M)},[h]);return g.jsxs("div",{className:"voice-settings",children:[g.jsx("h2",{className:"settings-section-title",children:n("voiceSettings")}),g.jsxs("div",{className:"vs-section",children:[g.jsx("div",{className:"vs-label",children:n("voiceInputMode")}),g.jsxs("div",{className:"vs-radio-group",children:[g.jsxs("button",{className:`vs-radio${e==="voice_activity"?" active":""}`,onClick:()=>w("voice_activity"),children:[g.jsx("div",{className:"vs-radio-dot"}),g.jsxs("div",{children:[g.jsx("div",{className:"vs-radio-title",children:n("voiceActivity")}),g.jsx("div",{className:"vs-desc",children:n("voiceActivityDesc")})]})]}),g.jsxs("button",{className:`vs-radio${e==="push_to_talk"?" active":""}`,onClick:()=>w("push_to_talk"),children:[g.jsx("div",{className:"vs-radio-dot"}),g.jsxs("div",{children:[g.jsx("div",{className:"vs-radio-title",children:n("pushToTalk")}),g.jsx("div",{className:"vs-desc",children:n("pushToTalkDesc")})]})]})]})]}),e==="push_to_talk"&&g.jsxs("div",{className:"vs-section",children:[g.jsx("div",{className:"vs-label",children:n("pttKey")}),g.jsx("button",{className:`vs-keybind${j?" listening":""}`,onClick:()=>x(!0),children:j?n("pttListening"):d7(t)}),g.jsx("div",{className:"vs-desc",children:n("pttKeyHint")})]}),e==="voice_activity"&&g.jsxs("div",{className:"vs-section",children:[g.jsx("div",{className:"vs-label",children:n("micSensitivity")}),g.jsxs("div",{className:"vs-slider-row",children:[g.jsx("input",{type:"range",min:0,max:100,value:i,onChange:M=>m(Number(M.target.value)),className:"vs-range",style:ES(i,100)}),g.jsxs("span",{className:"vs-slider-value",children:[i,"%"]})]})]}),g.jsxs("div",{className:"vs-section",children:[g.jsx("div",{className:"vs-label",children:n("inputDevice")}),g.jsxs("select",{className:"vs-select",value:a,onChange:M=>v(M.target.value),children:[g.jsx("option",{value:"",children:n("defaultDevice")}),S.map(M=>g.jsx("option",{value:M.deviceId,children:M.label},M.deviceId))]})]}),g.jsxs("div",{className:"vs-section",children:[g.jsx("div",{className:"vs-label",children:n("outputDevice")}),g.jsxs("select",{className:"vs-select",value:o,onChange:M=>b(M.target.value),children:[g.jsx("option",{value:"",children:n("defaultDevice")}),_.map(M=>g.jsx("option",{value:M.deviceId,children:M.label},M.deviceId))]})]}),g.jsxs("div",{className:"vs-section",children:[g.jsx("div",{className:"vs-label",children:n("masterVolume")}),g.jsxs("div",{className:"vs-slider-row",children:[g.jsx("input",{type:"range",min:0,max:100,value:l,onChange:M=>C(Number(M.target.value)),className:"vs-range",style:ES(l,100)}),g.jsxs("span",{className:"vs-slider-value",children:[l,"%"]})]})]}),g.jsx("div",{className:"vs-section",children:g.jsxs("div",{className:"vs-toggle-row",children:[g.jsxs("div",{children:[g.jsx("div",{className:"vs-label",children:n("joinLeaveSounds")}),g.jsx("div",{className:"vs-desc",children:n("joinLeaveSoundsDesc")})]}),g.jsxs("label",{className:"vs-switch",children:[g.jsx("input",{type:"checkbox",checked:u,onChange:M=>T(M.target.checked)}),g.jsx("span",{className:"vs-switch-slider"})]})]})})]})}function f7({permBit:n,labelKey:e,descKey:t,state:i,onChange:a}){const{t:o}=ye("settings");return g.jsxs("div",{className:"perm-tri",children:[g.jsxs("div",{className:"perm-tri-info",children:[g.jsx("p",{className:"perm-tri-label",children:o(e)}),g.jsx("p",{className:"perm-tri-desc",children:o(t)})]}),g.jsxs("div",{className:"perm-tri-controls",children:[g.jsx("button",{className:`perm-tri-btn deny${i==="deny"?" active":""}`,onClick:()=>a(n,i==="deny"?"inherit":"deny"),title:o("permOverrideDeny"),children:g.jsx("svg",{width:"14",height:"14",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),g.jsx("button",{className:`perm-tri-btn inherit${i==="inherit"?" active":""}`,onClick:()=>a(n,"inherit"),title:o("permOverrideInherit"),children:g.jsx("svg",{width:"14",height:"14",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:g.jsx("path",{strokeLinecap:"round",d:"M6 12h12"})})}),g.jsx("button",{className:`perm-tri-btn allow${i==="allow"?" active":""}`,onClick:()=>a(n,i==="allow"?"inherit":"allow"),title:o("permOverrideAllow"),children:g.jsx("svg",{width:"14",height:"14",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]})]})}const m7=[{bit:Ne.SendMessages,label:"permSendMessages",desc:"permSendMessagesDesc"},{bit:Ne.ReadMessages,label:"permReadMessages",desc:"permReadMessagesDesc"},{bit:Ne.ManageMessages,label:"permManageMessages",desc:"permManageMessagesDesc"}],p7=[{bit:Ne.ConnectVoice,label:"permConnect",desc:"permConnectDesc"},{bit:Ne.Speak,label:"permSpeak",desc:"permSpeakDesc"},{bit:Ne.Stream,label:"permStream",desc:"permStreamDesc"}];function g7({channel:n}){const{t:e}=ye("settings"),{roles:t,fetchRoles:i}=Ys(),{fetchOverrides:a,getOverrides:o,setOverride:l}=Mo(),u=ai(R=>R.addToast),[h,f]=E.useState("");E.useEffect(()=>{i(),a(n.id)},[i,a,n.id]),E.useEffect(()=>{!h&&t.length>0&&f(t[0].id)},[h,t]);const m=o(n.id),v=n.type==="voice"?p7:m7,b=m.find(R=>R.role_id===h),C=E.useCallback(R=>b?(b.allow&R)!==0?"allow":(b.deny&R)!==0?"deny":"inherit":"inherit",[b]);async function T(R,_){if(!h)return;let D=b?.allow??0,j=b?.deny??0;D&=~R,j&=~R,_==="allow"&&(D|=R),_==="deny"&&(j|=R),await l(n.id,h,D,j)?u("success",e("channelPermSaved")):u("error",e("channelPermSaveError"))}const S=t.find(R=>R.id===h);return g.jsxs("div",{children:[g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:e("roles")}),g.jsxs("div",{className:"perm-tri-role-select",children:[S&&g.jsx("span",{className:"role-list-dot",style:{backgroundColor:S.color||"#99AAB5"}}),g.jsx("select",{className:"settings-input perm-tri-role-dropdown",value:h,onChange:R=>f(R.target.value),children:t.map(R=>g.jsx("option",{value:R.id,children:R.name},R.id))})]})]}),g.jsx("p",{className:"perm-tri-section-desc",children:e("channelPermDesc")}),g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:n.type==="voice"?e("voicePermissions"):e("textPermissions")}),g.jsx("div",{className:"perm-tri-container",children:v.map(R=>g.jsx(f7,{permBit:R.bit,labelKey:R.label,descKey:R.desc,state:C(R.bit),onChange:T},R.bit))})]})]})}function v7(){const{t:n}=ye("channels"),{t:e}=ye("settings"),t=Ot(D=>D.categories),i=ai(D=>D.addToast),a=cr(),o=t.flatMap(D=>D.channels).sort((D,j)=>D.position-j.position),[l,u]=E.useState(null),[h,f]=E.useState(!1),[m,v]=E.useState(""),[b,C]=E.useState("text"),[T,S]=E.useState(!1);async function R(){const D=m.trim();if(!D||T)return;S(!0),(await _4({name:D,type:b})).success?(i("success",n("channelCreated")),v(""),f(!1)):i("error",n("channelCreateError")),S(!1)}async function _(D,j){if(!await a({message:n("deleteConfirm",{name:j}),confirmLabel:n("deleteChannel"),danger:!0}))return;(await w4(D)).success?(i("success",n("channelDeleted")),l?.id===D&&u(null)):i("error",n("channelDeleteError"))}return g.jsxs("div",{className:"channel-settings-wrapper",children:[g.jsxs("div",{className:"role-list",children:[g.jsxs("div",{className:"channel-settings-header",children:[g.jsx("span",{className:"channel-settings-header-label",children:e("channels")}),g.jsx("button",{onClick:()=>f(!h),className:"settings-btn channel-settings-header-btn",children:"+"})]}),h&&g.jsxs("div",{className:"channel-settings-create-inline",children:[g.jsx("input",{className:"settings-input",placeholder:n("channelName"),value:m,onChange:D=>v(D.target.value),onKeyDown:D=>{D.key==="Enter"&&R(),D.key==="Escape"&&f(!1)},autoFocus:!0}),g.jsxs("select",{className:"settings-input",value:b,onChange:D=>C(D.target.value),children:[g.jsx("option",{value:"text",children:n("text")}),g.jsx("option",{value:"voice",children:n("voice")})]}),g.jsx("button",{className:"settings-btn",onClick:R,disabled:!m.trim()||T,children:T?"...":n("createChannel")})]}),g.jsx("div",{className:"channel-settings-ch-list",children:o.map(D=>g.jsxs("div",{className:`role-list-item channel-settings-ch-row${D.id===l?.id?" active":""}`,onClick:()=>u(D),children:[g.jsx("span",{className:"channel-settings-ch-icon",children:D.type==="voice"?"":"#"}),g.jsx("span",{className:"role-list-name",children:D.name}),g.jsx("button",{className:"channel-settings-delete",onClick:j=>{j.stopPropagation(),_(D.id,D.name)},title:n("deleteChannel"),children:""})]},D.id))})]}),g.jsx("div",{className:"settings-content channel-settings-right",children:l?g.jsxs("div",{className:"channel-perm-section",children:[g.jsxs("h2",{className:"settings-section-title channel-settings-right-title",children:[l.type==="voice"?"":"#"," ",l.name]}),g.jsx(g7,{channel:l})]}):g.jsx("div",{className:"no-channel",children:e("selectChannelToEdit")})})]})}function y7(){const{t:n}=ye("settings"),e=mt(L=>L.members),t=mt(L=>L.fetchMembers),i=Ys(L=>L.roles),a=Ys(L=>L.fetchRoles),o=et(L=>L.user),l=ai(L=>L.addToast),u=cr(),[h,f]=E.useState(null),[m,v]=E.useState([]),[b,C]=E.useState(!1);E.useEffect(()=>{t(),a()},[t,a]);const T=e.find(L=>L.id===h);E.useEffect(()=>{T&&(v(T.roles.map(L=>L.id)),C(!1))},[T]);const S=E.useMemo(()=>e.find(A=>A.id===o?.id)?.effective_permissions??0,[e,o]),R=cn(S,Ne.ManageRoles),_=cn(S,Ne.KickMembers),D=cn(S,Ne.BanMembers);function j(L){return L.roles.length===0?"var(--color-text-secondary)":[...L.roles].sort((O,Y)=>Y.position-O.position)[0].color||"var(--color-text-secondary)"}function x(L){v(A=>A.includes(L)?A.filter(Y=>Y!==L):[...A,L]),C(!0)}async function w(){if(!h||!b)return;const L=await z4(h,m);L.data?(C(!1),l("success",n("memberRolesSaved"))):l("error",L.error??n("memberRolesSaveError"))}async function M(){if(!T)return;const L=T.display_name||T.username;if(!await u({message:n("confirmKick",{name:L}),confirmLabel:n("kickMember"),danger:!0}))return;const O=await ym(T.id);O.data?(l("success",n("memberKicked")),f(null)):l("error",O.error??n("memberKickError"))}async function I(){if(!T)return;const L=T.display_name||T.username;if(!await u({message:n("confirmBan",{name:L}),confirmLabel:n("banMember"),danger:!0}))return;const O=await bm(T.id,"Banned by admin");O.data?(l("success",n("memberBanned")),f(null)):l("error",O.error??n("memberBanError"))}const F=h===o?.id;return g.jsxs("div",{className:"channel-settings-wrapper",children:[g.jsxs("div",{className:"role-list",children:[g.jsx("div",{className:"channel-settings-header",children:g.jsxs("span",{className:"channel-settings-header-label",children:[n("members")," (",e.length,")"]})}),g.jsx("div",{className:"channel-settings-ch-list",children:e.map(L=>g.jsxs("div",{onClick:()=>f(L.id),className:`role-list-item${L.id===h?" active":""}`,children:[g.jsx("div",{className:"member-settings-avatar",style:{borderColor:j(L)},children:L.avatar_url?g.jsx("img",{src:L.avatar_url,alt:L.username,className:"member-settings-avatar-img"}):g.jsx("span",{className:"member-settings-avatar-fallback",children:(L.display_name||L.username).charAt(0).toUpperCase()})}),g.jsxs("div",{className:"member-settings-info",children:[g.jsx("span",{className:"member-settings-name",style:{color:j(L)},children:L.display_name||L.username}),g.jsx("span",{className:"member-settings-username",children:L.username})]})]},L.id))})]}),g.jsx("div",{className:"settings-content channel-settings-right",children:T?g.jsxs("div",{className:"channel-perm-section",children:[g.jsxs("div",{className:"member-settings-detail-header",children:[g.jsx("div",{className:"member-settings-avatar member-settings-avatar-lg",style:{borderColor:j(T)},children:T.avatar_url?g.jsx("img",{src:T.avatar_url,alt:T.username,className:"member-settings-avatar-img"}):g.jsx("span",{className:"member-settings-avatar-fallback",children:(T.display_name||T.username).charAt(0).toUpperCase()})}),g.jsxs("div",{children:[g.jsx("div",{className:"member-settings-detail-name",style:{color:j(T)},children:T.display_name||T.username}),g.jsxs("div",{className:"member-settings-detail-username",children:["@",T.username]})]})]}),g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:n("memberCurrentRoles")}),g.jsx("div",{className:"member-settings-role-tags",children:T.roles.length===0?g.jsx("span",{className:"member-settings-no-roles",children:n("memberNoRoles")}):T.roles.map(L=>g.jsxs("span",{className:"member-settings-role-tag",style:{borderColor:L.color||"var(--color-text-muted)"},children:[g.jsx("span",{className:"role-list-dot",style:{backgroundColor:L.color||"#99AAB5"}}),L.name]},L.id))})]}),R&&!F&&g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:n("memberAssignRoles")}),g.jsx("div",{className:"member-settings-role-checkboxes",children:i.map(L=>g.jsxs("label",{className:"member-settings-role-checkbox",children:[g.jsx("input",{type:"checkbox",checked:m.includes(L.id),onChange:()=>x(L.id)}),g.jsx("span",{className:"role-list-dot",style:{backgroundColor:L.color||"#99AAB5"}}),g.jsx("span",{children:L.name})]},L.id))})]}),R&&b&&!F&&g.jsxs("div",{className:"member-settings-actions",children:[g.jsx("button",{onClick:w,className:"settings-btn",children:n("saveChanges")}),g.jsx("p",{className:"member-settings-unsaved",children:n("unsavedChanges")})]}),!F&&(_||D)&&g.jsxs("div",{className:"settings-field",children:[g.jsx("label",{className:"settings-label",children:n("dangerZone")}),g.jsxs("div",{className:"member-settings-actions",children:[_&&g.jsx("button",{onClick:M,className:"settings-btn settings-btn-danger",children:n("kickMember")}),D&&g.jsx("button",{onClick:I,className:"settings-btn settings-btn-danger",children:n("banMember")})]})]})]}):g.jsx("div",{className:"no-channel",children:n("noMemberSelected")})})]})}function b7(){const{t:n}=ye("settings"),e=ys(a=>a.isOpen),t=ys(a=>a.activeTab),i=ys(a=>a.closeSettings);return E.useEffect(()=>{if(!e)return;function a(o){o.key==="Escape"&&i()}return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,i]),E.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[e]),e?g.jsxs("div",{className:"settings-overlay",children:[g.jsx(UV,{}),g.jsx("div",{className:"settings-content",children:g.jsx(S7,{activeTab:t})}),g.jsx("button",{onClick:i,className:"settings-close",title:n("title")+"  ESC",children:""})]}):null}function S7({activeTab:n}){switch(n){case"profile":return g.jsx(e7,{});case"roles":return g.jsx(GV,{});case"server-general":return g.jsx(n7,{});case"invites":return g.jsx(l7,{});case"voice":return g.jsx(h7,{});case"channels":return g.jsx(v7,{});case"appearance":return g.jsx(t7,{});case"members":return g.jsx(y7,{});default:return null}}function k7({setMicEnabled:n}){const e=ge(o=>o.inputMode),t=ge(o=>o.pttKey),i=ge(o=>o.currentVoiceChannelId),a=E.useRef(!1);E.useEffect(()=>{if(e!=="push_to_talk"||!i)return;function o(f){if(!f)return!1;const m=f.tagName;return!!(m==="INPUT"||m==="TEXTAREA"||f.isContentEditable)}function l(f){f.repeat||f.code===t&&(o(document.activeElement)||a.current||(a.current=!0,n(!0)))}function u(f){f.code===t&&a.current&&(a.current=!1,n(!1))}function h(){a.current&&(a.current=!1,n(!1))}return document.addEventListener("keydown",l),document.addEventListener("keyup",u),window.addEventListener("blur",h),()=>{document.removeEventListener("keydown",l),document.removeEventListener("keyup",u),window.removeEventListener("blur",h),a.current&&(a.current=!1,n(!1))}},[e,t,i,n])}function C7(){const n=Y9(),{localParticipant:e}=OT(),t=ge(b=>b.isMuted),i=ge(b=>b.isStreaming),a=ge(b=>b.inputMode),o=ge(b=>b.userVolumes),l=ge(b=>b.masterVolume),u=ge(b=>b.isDeafened),h=E.useRef(!1),f=E.useCallback(b=>{e.setMicrophoneEnabled(b).catch(C=>{console.error("[VoiceStateManager] PTT mic toggle failed:",C)})},[e]);k7({setMicEnabled:f}),E.useEffect(()=>{h.current&&e.setMicrophoneEnabled(!t).catch(b=>{console.error("[VoiceStateManager] Failed to toggle microphone:",b)})},[t,e]),E.useEffect(()=>{h.current&&e.setScreenShareEnabled(i).catch(b=>{console.error("[VoiceStateManager] Failed to toggle screen share:",b)})},[i,e]),E.useEffect(()=>{function b(){console.log("[VoiceStateManager] Connected to LiveKit room");const{isMuted:C,inputMode:T}=ge.getState(),S=T==="push_to_talk"?!1:!C;e.setMicrophoneEnabled(S).catch(R=>{console.error("[VoiceStateManager] Failed to set initial mic state:",R)}),h.current=!0}return n.state===Be.Connected&&b(),n.on(X.Connected,b),()=>{n.off(X.Connected,b),h.current=!1}},[n,e]),E.useEffect(()=>{if(h.current)if(a==="push_to_talk")e.setMicrophoneEnabled(!1).catch(b=>{console.error("[VoiceStateManager] Failed to mute on PTT switch:",b)});else{const b=ge.getState().isMuted;e.setMicrophoneEnabled(!b).catch(C=>{console.error("[VoiceStateManager] Failed to restore mic on VA switch:",C)})}},[a,e]);const m=E.useRef({userVolumes:o,masterVolume:l,isDeafened:u});m.current={userVolumes:o,masterVolume:l,isDeafened:u},E.useEffect(()=>{n.remoteParticipants.forEach(b=>{const C=o[b.identity]??100,T=u?0:C/100*(l/100);b.setVolume(T)})},[o,l,u,n]);const v=E.useCallback(b=>{const{userVolumes:C,masterVolume:T,isDeafened:S}=m.current,R=C[b.identity]??100,_=S?0:R/100*(T/100);b.setVolume(_)},[]);return E.useEffect(()=>{function b(C,T,S){C.kind===ee.Kind.Audio&&(v(S),setTimeout(()=>v(S),300))}return n.on(X.TrackSubscribed,b),()=>{n.off(X.TrackSubscribed,b)}},[n,v]),E.useEffect(()=>{function b(C){setTimeout(()=>v(C),500)}return n.on(X.ParticipantConnected,b),()=>{n.off(X.ParticipantConnected,b)}},[n,v]),null}function T7({children:n}){const{t:e}=ye("voice"),t=ge(m=>m.livekitUrl),i=ge(m=>m.livekitToken),a=ge(m=>m.leaveVoiceChannel),o=ge(m=>m.inputDevice),l=!!t&&!!i,u=E.useCallback(m=>{if(console.log("[VoiceProvider] Disconnected from LiveKit. Reason:",m),m===Ln.CLIENT_INITIATED){const{currentVoiceChannelId:v}=ge.getState();if(v){console.log("[VoiceProvider] Transition disconnect, ignoring (voice still active)");return}}a()},[a]),h=E.useCallback(m=>{if(m.message?.includes("Client initiated")){console.log("[VoiceProvider] Ignoring transition error:",m.message);return}console.error("[VoiceProvider] LiveKit error:",m),ai.getState().addToast("error",e("livekitConnectionError"),8e3)},[e]),f=E.useMemo(()=>({noiseSuppression:!0,autoGainControl:!0,echoCancellation:!0,...o?{deviceId:o}:{}}),[o]);return g.jsxs(sF,{serverUrl:t||"wss://placeholder.invalid",token:i||"",connect:l,audio:l,video:!1,options:l?{audioCaptureDefaults:f,webAudioMix:!0}:void 0,onDisconnected:u,onError:h,style:{display:"contents"},children:[l&&g.jsx(SF,{}),l&&g.jsx(C7,{}),n]})}let Ef=null;function E7(){return Ef||(Ef=new AudioContext),Ef}function VT(n,e,t,i){try{const a=E7();a.state==="suspended"&&a.resume().catch(()=>{});const o=a.currentTime,l=a.createOscillator();l.type="sine",l.frequency.setValueAtTime(n,o),l.frequency.linearRampToValueAtTime(e,o+t);const u=a.createGain();u.gain.setValueAtTime(i*.3,o),u.gain.linearRampToValueAtTime(0,o+t),l.connect(u),u.connect(a.destination),l.start(o),l.stop(o+t)}catch{}}function x7(){const{soundsEnabled:n,masterVolume:e}=ge.getState();if(!n)return;const t=e/100;VT(350,600,.15,t)}function R7(){const{soundsEnabled:n,masterVolume:e}=ge.getState();if(!n)return;const t=e/100;VT(400,200,.12,t)}const _7=3e3,w7=3e3;function M7(){const n=E.useRef(null),e=E.useRef(0),t=E.useRef(0),i=E.useRef(null),a=E.useRef(null),o=E.useRef(0),l=E.useRef(new Map),u=E.useRef(()=>{});function h(S){switch(S.op){case"heartbeat_ack":t.current=0;break;case"channel_create":Ot.getState().handleChannelCreate(S.d);break;case"channel_update":Ot.getState().handleChannelUpdate(S.d);break;case"channel_delete":Ot.getState().handleChannelDelete(S.d.id);break;case"channel_reorder":Ot.getState().handleChannelReorder(S.d);break;case"category_create":Ot.getState().handleCategoryCreate(S.d);break;case"category_update":Ot.getState().handleCategoryUpdate(S.d);break;case"category_delete":Ot.getState().handleCategoryDelete(S.d.id);break;case"message_create":{const R=S.d;ut.getState().handleMessageCreate(R);const _=et.getState().user?.id;if(R.author?.id===_||R.user_id===_)break;const D=Ye.getState(),j=D.panels[D.activePanelId],x=j?.tabs.find(M=>M.id===j.activeTabId);x?.type==="text"&&x?.channelId===R.channel_id?Gs.getState().markAsRead(R.channel_id,R.id):Gs.getState().incrementUnread(R.channel_id);break}case"message_update":ut.getState().handleMessageUpdate(S.d);break;case"message_delete":ut.getState().handleMessageDelete(S.d);break;case"typing_start":{const R=S.d;ut.getState().handleTypingStart(R.channel_id,R.username);break}case"ready":{const R=S.d;mt.getState().handleReady(R.online_user_ids),Gs.getState().fetchUnreadCounts(),st.getState().fetchChannels(),Dt.getState().fetchFriends(),Dt.getState().fetchRequests();break}case"presence_update":{const R=S.d;mt.getState().handlePresenceUpdate(R.user_id,R.status);break}case"member_join":mt.getState().handleMemberJoin(S.d);break;case"member_leave":mt.getState().handleMemberLeave(S.d.user_id);break;case"member_update":mt.getState().handleMemberUpdate(S.d);break;case"role_create":{const R=S.d;mt.getState().handleRoleCreate(R),Ys.getState().handleRoleCreate(R);break}case"role_update":{const R=S.d;mt.getState().handleRoleUpdate(R),Ys.getState().handleRoleUpdate(R);break}case"role_delete":{const R=S.d.id;mt.getState().handleRoleDelete(R),Ys.getState().handleRoleDelete(R);break}case"voice_state_update":{const R=S.d;ge.getState().handleVoiceStateUpdate(R);const _=et.getState().user?.id;R.user_id!==_&&(R.action==="join"?x7():R.action==="leave"&&R7());break}case"voice_states_sync":{const R=S.d;ge.getState().handleVoiceStatesSync(R.states);break}case"message_pin":Kn.getState().handleMessagePin(S.d);break;case"message_unpin":Kn.getState().handleMessageUnpin(S.d);break;case"reaction_update":{const R=S.d;ut.getState().handleReactionUpdate(R);break}case"dm_channel_create":st.getState().handleDMChannelCreate(S.d);break;case"dm_message_create":{const R=S.d;st.getState().handleDMMessageCreate(R);const _=et.getState().user?.id;if(R.user_id===_)break;const D=st.getState(),j=D.selectedDMId;R.dm_channel_id!==j&&D.incrementDMUnread(R.dm_channel_id);break}case"dm_message_update":st.getState().handleDMMessageUpdate(S.d);break;case"dm_message_delete":st.getState().handleDMMessageDelete(S.d);break;case"channel_permission_update":Mo.getState().handleOverrideUpdate(S.d);break;case"channel_permission_delete":{const R=S.d;Mo.getState().handleOverrideDelete(R.channel_id,R.role_id);break}case"friend_request_create":Dt.getState().handleFriendRequestCreate(S.d);break;case"friend_request_accept":Dt.getState().handleFriendRequestAccept(S.d);break;case"friend_request_decline":Dt.getState().handleFriendRequestDecline(S.d);break;case"friend_remove":Dt.getState().handleFriendRemove(S.d);break;case"server_update":ou.getState().handleServerUpdate(S.d);break}}u.current=h;function f(){i.current&&(clearInterval(i.current),i.current=null),a.current&&(clearTimeout(a.current),a.current=null)}const m=E.useCallback(S=>{const R=Date.now(),_=l.current.get(S)??0;R-_<w7||n.current?.readyState===WebSocket.OPEN&&(n.current.send(JSON.stringify({op:"typing",d:{channel_id:S}})),l.current.set(S,R))},[]),v=E.useCallback(S=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({op:"voice_join",d:{channel_id:S}}))},[]),b=E.useCallback(()=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({op:"voice_leave"}))},[]),C=E.useCallback(S=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({op:"presence_update",d:{status:S}}))},[]),T=E.useCallback(S=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({op:"voice_state_update_request",d:S}))},[]);return E.useEffect(()=>{const S=++o.current;function R(){const _=Of();if(!_||o.current!==S)return;f(),n.current&&(n.current.close(),n.current=null);const D=new WebSocket(`${s4}?token=${_}`);n.current=D,D.onopen=()=>{o.current===S&&(t.current=0,i.current=setInterval(()=>{if(o.current!==S){clearInterval(i.current);return}D.readyState===WebSocket.OPEN&&(D.send(JSON.stringify({op:"heartbeat"})),t.current++,t.current>=r4&&D.close())},a4))},D.onmessage=j=>{if(o.current!==S)return;let x;try{x=JSON.parse(j.data)}catch{return}x.seq&&(e.current=x.seq),u.current(x)},D.onclose=()=>{o.current===S&&(f(),a.current=setTimeout(()=>{o.current===S&&R()},_7))},D.onerror=()=>{}}return R(),()=>{o.current++,f(),n.current&&(n.current.close(),n.current=null)}},[]),{sendTyping:m,sendPresenceUpdate:C,sendVoiceJoin:v,sendVoiceLeave:b,sendVoiceStateUpdate:T}}function N7({sendVoiceJoin:n,sendVoiceLeave:e,sendVoiceStateUpdate:t}){const i=ge(C=>C.joinVoiceChannel),a=ge(C=>C.leaveVoiceChannel),o=ge(C=>C.toggleMute),l=ge(C=>C.toggleDeafen),u=ge(C=>C.setStreaming),h=E.useCallback(async C=>{await i(C)&&n(C)},[i,n]),f=E.useCallback(()=>{e(),a()},[a,e]),m=E.useCallback(()=>{o();const{isMuted:C,isDeafened:T}=ge.getState();t({is_muted:C,is_deafened:T})},[o,t]),v=E.useCallback(()=>{l();const{isMuted:C,isDeafened:T}=ge.getState();t({is_muted:C,is_deafened:T})},[l,t]),b=E.useCallback(()=>{const{isStreaming:C}=ge.getState(),T=!C;u(T),t({is_streaming:T})},[u,t]);return{joinVoice:h,leaveVoice:f,toggleMute:m,toggleDeafen:v,toggleScreenShare:b}}function D7({sendPresenceUpdate:n}){const e=E.useRef(!1),t=E.useRef(null);E.useEffect(()=>{function i(){t.current&&clearTimeout(t.current),e.current&&(e.current=!1,n("online")),t.current=setTimeout(()=>{e.current=!0,n("idle")},l4)}for(const a of Fb)window.addEventListener(a,i,{passive:!0});return i(),()=>{for(const a of Fb)window.removeEventListener(a,i);t.current&&clearTimeout(t.current)}},[n])}function O7({toggleMute:n,toggleDeafen:e}){E.useEffect(()=>{function t(i){const a=i.target,o=a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable;if(i.ctrlKey&&!i.shiftKey&&i.key==="k"){i.preventDefault(),Ye.getState().toggleQuickSwitcher();return}if(!o){if(i.ctrlKey&&i.shiftKey&&i.key==="M"){i.preventDefault(),n();return}if(i.ctrlKey&&i.shiftKey&&i.key==="D"){i.preventDefault(),e();return}}}return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[n,e])}function A7(){const{t:n}=ye("common"),e=Ye(_=>_.quickSwitcherOpen),t=Ye(_=>_.closeQuickSwitcher),i=Ye(_=>_.openTab),a=Ot(_=>_.categories),o=Ot(_=>_.selectChannel),l=st(_=>_.channels),u=st(_=>_.selectDM),[h,f]=E.useState(""),[m,v]=E.useState(0),b=E.useRef(null);E.useEffect(()=>{e&&(f(""),v(0),requestAnimationFrame(()=>b.current?.focus()))},[e]);const C=E.useMemo(()=>{const _=a.flatMap(j=>j.channels.map(x=>({id:x.id,label:x.name,type:"channel",channelType:x.type,category:j.category.name}))),D=l.map(j=>({id:j.id,label:j.other_user?.display_name??j.other_user?.username??"DM",type:"dm"}));return[..._,...D]},[a,l]),T=E.useMemo(()=>{if(!h.trim())return C;const _=h.toLowerCase();return C.filter(D=>D.label.toLowerCase().includes(_))},[C,h]);E.useEffect(()=>{m>=T.length&&v(Math.max(0,T.length-1))},[T.length,m]);function S(_){if(_.type==="channel"){o(_.id);const D=_.channelType==="voice"?"voice":"text";i(_.id,D,_.label)}else u(_.id),i(_.id,"dm",_.label);t()}function R(_){switch(_.key){case"ArrowDown":_.preventDefault(),v(D=>Math.min(D+1,T.length-1));break;case"ArrowUp":_.preventDefault(),v(D=>Math.max(D-1,0));break;case"Enter":_.preventDefault(),T[m]&&S(T[m]);break;case"Escape":_.preventDefault(),t();break}}return e?g.jsx("div",{className:"quick-switcher-overlay",onClick:t,children:g.jsxs("div",{className:"quick-switcher",onClick:_=>_.stopPropagation(),children:[g.jsx("input",{ref:b,className:"qs-input",type:"text",value:h,onChange:_=>{f(_.target.value),v(0)},onKeyDown:R,placeholder:n("quickSwitcherPlaceholder")}),g.jsx("div",{className:"qs-results",children:T.length===0?g.jsx("div",{className:"qs-empty",children:n("noResults")}):T.map((_,D)=>g.jsxs("button",{className:`qs-item${D===m?" qs-selected":""}`,onClick:()=>S(_),onMouseEnter:()=>v(D),children:[g.jsx("span",{className:"qs-icon",children:_.type==="channel"?_.channelType==="voice"?"":"#":"@"}),g.jsx("span",{className:"qs-label",children:_.label}),_.category&&g.jsx("span",{className:"qs-category",children:_.category})]},_.id))}),g.jsxs("div",{className:"qs-footer",children:[g.jsxs("span",{children:[" ",n("search")]}),g.jsxs("span",{children:[" ",n("confirm")]}),g.jsxs("span",{children:["esc ",n("close")]})]})]})}):null}function j7(){const{sendTyping:n,sendPresenceUpdate:e,sendVoiceJoin:t,sendVoiceLeave:i,sendVoiceStateUpdate:a}=M7();D7({sendPresenceUpdate:e});const o=ou(x=>x.fetchServer),l=Ot(x=>x.fetchChannels),u=mt(x=>x.fetchMembers),h=Ot(x=>x.selectedChannelId),f=Ot(x=>x.categories),m=Ye(x=>x.layout),v=Ye(x=>x.openTab),b=E.useRef(!1);E.useEffect(()=>{o(),l(),u()},[o,l,u]),E.useEffect(()=>{if(!h||b.current||f.length===0)return;const x=f.flatMap(w=>w.channels).find(w=>w.id===h);x&&(v(x.id,x.type==="text"?"text":"voice",x.name),b.current=!0)},[h,f,v]),E.useEffect(()=>{if(!h)return;const x=ut.getState().messagesByChannel[h];if(x&&x.length>0){const w=x[x.length-1];Gs.getState().markAsRead(h,w.id)}else Gs.getState().clearUnread(h)},[h]);const{joinVoice:C,leaveVoice:T,toggleMute:S,toggleDeafen:R,toggleScreenShare:_}=N7({sendVoiceJoin:t,sendVoiceLeave:i,sendVoiceStateUpdate:a});O7({toggleMute:S,toggleDeafen:R}),E.useEffect(()=>(ge.getState().registerOnLeave(T),()=>{ge.getState().registerOnLeave(null)}),[T]);const D=ge(x=>x.currentVoiceChannelId),j=E.useRef(null);return E.useEffect(()=>{const x=j.current;j.current=D,x&&!D&&Ye.getState().closeVoiceTabs(x)},[D]),g.jsxs("div",{className:"mqvi-app",children:[g.jsx(MV,{onJoinVoice:C,onToggleMute:S,onToggleDeafen:R,onToggleScreenShare:_,onDisconnect:T}),g.jsx(T7,{children:g.jsxs("div",{className:"app-body",children:[g.jsx(x4,{}),g.jsxs("div",{className:"main-area",children:[g.jsx(um,{node:m,sendTyping:n}),g.jsx(uV,{})]})]})}),g.jsx(b7,{}),g.jsx(PV,{}),g.jsx(jV,{}),g.jsx(A7,{})]})}function P7(){const{t:n}=ye("common"),e=et(a=>a.initialize),t=et(a=>a.isInitialized),i=et(a=>a.user);return E.useEffect(()=>{e()},[e]),t?g.jsxs(yR,{children:[g.jsx(vo,{path:"/login",element:i?g.jsx(cl,{to:"/channels",replace:!0}):g.jsx(p4,{})}),g.jsx(vo,{path:"/register",element:i?g.jsx(cl,{to:"/channels",replace:!0}):g.jsx(g4,{})}),g.jsx(vo,{path:"/channels/*",element:i?g.jsx(j7,{}):g.jsx(cl,{to:"/login",replace:!0})}),g.jsx(vo,{path:"*",element:g.jsx(cl,{to:i?"/channels":"/login",replace:!0})})]}):g.jsx("div",{className:"flex h-full items-center justify-center bg-background",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"mx-auto mb-6 h-14 w-14 animate-spin rounded-full border-4 border-surface border-t-brand"}),g.jsx("p",{className:"text-base text-text-muted",children:n("loading")})]})})}kx.createRoot(document.getElementById("root")).render(g.jsx(E.StrictMode,{children:g.jsx(VR,{children:g.jsx(P7,{})})}));
